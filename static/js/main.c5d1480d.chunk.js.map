{"version":3,"sources":["data/export.ts","data/db.ts","utils/iter.ts","project/AudioLibrary.ts","audio/ResListener.ts","audio/ResAudio.ts","project/GameObject.ts","project/Room.ts","project/Project.ts","utils/files.ts","data/import.ts","input/GamepadListener.ts","input/KeyboardListener.ts","runtime/Runtime.ts","runtime/RuntimeContainer.tsx","editor/Modal.tsx","editor/AudioFileModal.tsx","editor/AudioLibraryModal.tsx","editor/MenuBar.tsx","utils/math.ts","editor/styled.ts","editor/VisualControls.ts","editor/ObjectEditor.tsx","editor/EditorCanvas.ts","editor/RoomEditor.tsx","editor/ProjectManagerModal.tsx","editor/Editor.tsx","serviceWorker.ts","index.tsx"],"names":["createZip","_ref","Object","asyncToGenerator","regenerator_default","a","mark","_callee","project","metadata","zip","audioLibrary","audioFolder","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_value","_value2","_value3","key","value","wrap","_context","prev","next","toData","Zip","file","JSON","stringify","folder","asyncIterator","entries","sent","done","slicedToArray","push","id","name","type","toString","data","t0","return","finish","abrupt","generateAsync","stop","this","_x","apply","arguments","saveAsZip","_ref2","_callee2","_context2","saveAs","concat","_x2","dbPromise","openDB","upgrade","db","createObjectStore","keyPath","autoIncrement","createIndex","saveProject","put","_x3","getAllProjects","_ref3","_callee3","_context3","getAllFromIndex","loadAudio","_ref4","_callee4","projectId","audioId","_context4","get","_x4","_x5","saveAudio","_ref5","_callee5","audio","_context5","_x6","saveAudioMap","_ref6","_callee6","audioMap","tx","_ref9","_ref8","entry","_context6","transaction","undefined","Symbol","iterator","store","objectSpread","_x7","_x8","deleteAudio","_ref10","_callee7","_context7","delete","_x9","_x10","_callee8","cursor","_context8","awaitAsyncGenerator","index","openCursor","continue","element","AudioLibrary","Map","nextId","set","clear","_iterateProjectAudios","iterateProjectAudios","_wrapIteratorAsync","wrapIteratorAsync","ResListener","audioScene","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","force","esm_get","prototype","setListenerFromMatrix","matrixWorld","Object3D","ResAudio","audioContext","audioSource","source","createBufferSource","createSource","position","Float32Array","forward","connect","input","setFromMatrix","buffer","disconnect","loop","start","cubeGeometry","BoxGeometry","cubeMaterial","MeshLambertMaterial","GameObject","audioFile","add","decodeAudioData","slice","setBuffer","setLoop","play","toArray","scale","rotation","Mesh","wallGeometry","wallMaterial","Room","length","dimensions","width","depth","height","materials","ResonanceAudio","Utils","DEFAULT_ROOM_MATERIALS","roomDimensions","roomMaterials","grid","wallNorth","wallEast","wallSouth","wallWest","camera","PerspectiveCamera","AudioContext","listener","ambientLight","AmbientLight","light","PointLight","lookAt","gridSize","Math","max","GridHelper","updateWalls","z","y","Vector3","output","destination","setRoomProperties","remove","object","_this$roomDimensions","objects","children","filter","c","map","go","_this2","gameObjects","o","fromData","toConsumableArray","Scene","noop","defaultEvents","onSelect","onScale","onTranslate","Project","events","rooms","audioType","activeRoom","activeObject","outlineMesh","firstRoom","addObject","material","MeshBasicMaterial","color","side","BackSide","multiplyScalar","close","err","room","selectRoom","suspend","resume","aspect","updateProjectionMatrix","selectObject","geometry","savedAt","Date","r","nextAudioId","i","saveToProject","openFileDialog","options","Promise","resolve","document","createElement","accept","onchange","files","click","readFileAsArrayBuffer","reader","FileReader","onload","result","onerror","console","error","readAsArrayBuffer","loadZip","blob","loadAsync","async","t1","parse","t2","t3","t4","openZip","GamepadListener","onGamepadConnected","e","log","gamepad","onGamepadDisconnected","window","addEventListener","removeEventListener","gamepads","navigator","getGamepads","mapping","axis","axes","abs","v1","buttons","KeyboardListener","target","keysPressed","Set","lastKeyUp","reset","onKeyDown","preventDefault","timeStamp","onKeyUp","onClick","button","shiftKey","has","x","Runtime","rafHandle","previousTimestamp","renderer","WebGLRenderer","canvas","raycaster","Raycaster","keys","domElement","resize","_this$target","offsetWidth","offsetHeight","setPixelRatio","devicePixelRatio","setSize","animate","t","requestAnimationFrame","dt","update","render","tabIndex","listen","appendChild","cancelAnimationFrame","removeChild","focus","isPressed","translateOnAxis","rotateOnWorldAxis","gamepadAxes","getAxis","RuntimeContainer","targetRef","React","createRef","runtime","props","current","attach","detach","react_default","style","top","left","overflow","ref","Component","Backdrop","styled","div","_templateObject","Container","_templateObject2","TitleBar","_templateObject3","Content","_templateObject4","ActionGroup","_templateObject5","Action","_templateObject6","Modal","onBackdropClick","currentTarget","onDismiss","title","AudioFileModal","audioEntry","Modal_Modal","ceil","byteLength","onDelete","onExport","onCancel","AudioList","AudioLibraryModal_templateObject","AudioItem","AudioLibraryModal_templateObject2","AudioLibraryModal","previewAudio","Audio","state","selectedEntry","openAudioFileDialog","setState","stopPreview","pause","URL","revokeObjectURL","src","dismiss","unselectEntry","exportAudio","Blob","createObjectURL","sort","b","updateEntries","prevProps","_this$state","AudioFileModal_AudioFileModal","selectEntry","onMouseEnter","previewEntry","onMouseLeave","MenuType","MenuBar_templateObject","MenubarItem","MenuBar_templateObject2","isActive","css","MenuBar_templateObject3","Menu","MenuBar_templateObject4","MenuItem","MenuBar_templateObject5","MenuDivider","MenuBar_templateObject6","MenuBar","activeMenu","menuType","MenuBar_Container","onBlur","closeMenu","FileMenu","toggleMenu","hidden","onNewProject","onLoadProject","onImportProject","onSaveProject","onExportProject","EditMenu","onAddObject","onDeleteObject","onAddRoom","onDeleteRoom","ViewMenu","onShowAudioLibrary","HelpMenu","open","onRunProject","radToDeg","rad","PI","degToRad","deg","roundToPrecision","precision","round","ObjectDragDirection","styled_templateObject","InnerContainer","styled_templateObject2","Sidebar","aside","styled_templateObject3","FocusedLabel","styled_templateObject4","Main","main","styled_templateObject5","Group","styled_templateObject6","Input","_templateObject7","Select","withComponent","_templateObject8","InputGroup","_templateObject9","RoomList","ol","_templateObject10","RoomListItem","li","_templateObject11","active","_templateObject12","ObjectEditor","_this$props","onUpdateName","onUpdatePosition","onUpdateRotation","onUpdateScale","onChange","step","toFixed","valueAsNumber","min","readOnly","onShowAudioSelection","MouseButton","VisualControls","objectDragDirection","isScaling","dragOffset","lastPoint","plane","Plane","axisX","axisY","axisZ","scaleX","scaleY","scaleZ","planeYZ","planeXZ","planeXY","materialConfig","transparent","opacity","DoubleSide","axisGeometry","userData","direction","AxisX","AxisY","AxisZ","scaleGeometry","SphereGeometry","isScale","planeGeometry","PlaneGeometry","PlaneYZ","PlaneXZ","PlaneXY","copy","intersections","intersectObjects","intersection","hasOwnProperty","point","sub","getControlFromRaycaster","onMove","ray","p","altPlane","distanceToPoint","origin","intersectPlane","EditorCanvas","controls","isDraggingCamera","clearDepth","onMouseDown","Secondary","requestPointerLock","Primary","updateRaycaster","checkSceneClick","onMouseUp","exitPointerLock","onMouseMove","movementX","movementY","rotateOnAxis","onWheel","delta","deltaY","deltaMode","translateZ","autoClear","setClearColor","Color","stopPropagation","size","getSize","Vector2","pageX","offsetLeft","pageY","offsetTop","setFromCamera","ROOM_MATERIAL_COEFFICIENTS","RoomEditor","propertyName","onUpdateMaterials","defineProperty","_this$props2","onUpdateDimensions","materialOptions","ce","selectMaterialHandler","right","front","back","down","up","ModalType","TableContainer","ProjectManagerModal_templateObject","Table","table","ProjectManagerModal_templateObject2","TableHead","thead","ProjectManagerModal_templateObject3","TableRow","tr","ProjectManagerModal_templateObject4","ColumnHead","th","ProjectManagerModal_templateObject5","ColumnData","td","ProjectManagerModal_templateObject6","ProjectManagerModal","projects","onSelectProject","reverse","selectProject","toLocaleString","Editor","projectCanvas","selectedRoomId","selectedObject","modal","isRunning","mainRef","newProject","onSelectObject","onTranslateObject","onScaleObject","changeProject","showProjectSelection","ProjectSelection","prompt","save","importProject","exportProject","deleteObject","addRoom","s","deleteRoom","splice","showAudioLibrary","updateRoomName","updateRoomDimensions","updateRoomMaterials","updateName","_ref7","updateScale","updatePosition","updateRotation","Euler","showAudioSelection","AudioSelection","dismissModal","selectAudio","_ref11","loadProject","runProject","_ref12","_ref13","RuntimeContainer_RuntimeContainer","styled_Container","AudioLibraryModal_AudioLibraryModal","ProjectManagerModal_ProjectManagerModal","MenuBar_MenuBar","RoomEditor_RoomEditor","ObjectEditor_ObjectEditor","Boolean","location","hostname","match","global","webkitAudioContext","ReactDOM","Editor_Editor","getElementById","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.c5d1480d.chunk.js","sourcesContent":["/**\n * @author Niklas Korz\n * This module defines functions for exporting and saving projects to the local filesystem.\n */\nimport { saveAs } from \"file-saver\";\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\n\n/**\n * Serializes the given project as JSON and compresses it along its audio\n * data in a ZIP file. The audio data is saved as one file per audio in a\n * dedicated subdirectory \"audio\".\n */\nexport const createZip = async (project: Project): Promise<Blob> => {\n  const metadata = project.toData();\n  const zip = new Zip();\n  zip.file(\"metadata.json\", JSON.stringify(metadata));\n\n  const audioLibrary: Array<{ id: number; name: string; type: string }> = [];\n  const audioFolder = zip.folder(\"audio\");\n  for await (const [key, value] of project.audioLibrary.entries()) {\n    audioLibrary.push({ id: key, name: value.name, type: value.type });\n    audioFolder.file(key.toString(), value.data);\n  }\n  zip.file(\"audioLibrary.json\", JSON.stringify(audioLibrary));\n\n  return zip.generateAsync({ type: \"blob\" });\n};\n\n/**\n * Saves the given project, including its audio data, as a zip file on the\n * user's local filesystem\n */\nexport const saveAsZip = async (project: Project): Promise<void> => {\n  const data = await createZip(project);\n  saveAs(data, `${project.name}.audio3d.zip`);\n};\n","/**\n * @author Niklas Korz\n * Module for loading and saving projects and audio files from/to IndexedDB.\n */\nimport { openDB } from \"idb\";\nimport Project from \"../project/Project\";\nimport { Schema, AudioWithIds, AudioFile, ProjectData } from \"./schema\";\n\nconst dbPromise = openDB<Schema>(\"audio3d\", 1, {\n  upgrade(db) {\n    const projectStore = db.createObjectStore(\"projects\", {\n      keyPath: \"id\",\n      autoIncrement: true\n    });\n    projectStore.createIndex(\"savedAt\", \"savedAt\");\n    const audioStore = db.createObjectStore(\"audios\", {\n      keyPath: [\"projectId\", \"audioId\"]\n    });\n    audioStore.createIndex(\"project\", \"projectId\");\n  }\n});\n\nexport const loadProject = async (id: number): Promise<Project | undefined> => {\n  const db = await dbPromise;\n  const data = await db.get(\"projects\", id);\n  return data && new Project().fromData(data, id);\n};\n\nexport const saveProject = async (project: Project): Promise<number> => {\n  const db = await dbPromise;\n  const data = project.toData();\n  return await db.put(\"projects\", data, project.id);\n};\n\nexport const getAllProjects = async (): Promise<ProjectData[]> => {\n  const db = await dbPromise;\n  return await db.getAllFromIndex(\"projects\", \"savedAt\");\n};\n\nexport const loadAudio = async (\n  projectId: number,\n  audioId: number\n): Promise<AudioWithIds | undefined> => {\n  const db = await dbPromise;\n  const data = await db.get(\"audios\", [projectId, audioId]);\n  return data;\n};\n\nexport const saveAudio = async (audio: AudioWithIds): Promise<void> => {\n  const db = await dbPromise;\n  await db.put(\"audios\", audio);\n};\n\nexport const saveAudioMap = async (\n  projectId: number,\n  audioMap: Map<number, AudioFile>\n): Promise<void> => {\n  const db = await dbPromise;\n  const tx = db.transaction(\"audios\", \"readwrite\");\n  for (const [audioId, entry] of audioMap.entries()) {\n    tx.store.put({ ...entry, projectId, audioId });\n  }\n  await tx.done;\n};\n\nexport const deleteAudio = async (\n  projectId: number,\n  audioId: number\n): Promise<void> => {\n  const db = await dbPromise;\n  await db.delete(\"audios\", [projectId, audioId]);\n};\n\nexport async function* iterateProjectAudios(\n  projectId: number\n): AsyncIterableIterator<[number, AudioFile]> {\n  const db = await dbPromise;\n  const tx = db.transaction(\"audios\");\n  let cursor = await tx.store.index(\"project\").openCursor(projectId);\n  while (cursor) {\n    yield [cursor.value.audioId, cursor.value];\n    cursor = await cursor.continue();\n  }\n  await tx.done;\n}\n","/**\n * @author Niklas Korz\n * This modules defines utility functions for working with iterators\n */\n\n/**\n * Wraps an IterableIterator in an AsyncIterableIterator\n * @param iterator The iterator to be wrapped\n */\nexport async function* wrapIteratorAsync<T>(\n  iterator: IterableIterator<T>\n): AsyncIterableIterator<T> {\n  for (const element of iterator) {\n    yield element;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { AudioFile } from \"../data/schema\";\nimport {\n  saveAudio,\n  loadAudio,\n  deleteAudio,\n  saveAudioMap,\n  iterateProjectAudios\n} from \"../data/db\";\nimport { wrapIteratorAsync } from \"../utils/iter\";\n\nexport default class AudioLibrary {\n  projectId?: number;\n  audioMap = new Map<number, AudioFile>();\n  nextId = 0;\n\n  async add(entry: AudioFile): Promise<number> {\n    if (this.projectId != null) {\n      await saveAudio({\n        ...entry,\n        projectId: this.projectId,\n        audioId: this.nextId\n      });\n    } else {\n      this.audioMap.set(this.nextId, entry);\n    }\n    return this.nextId++;\n  }\n\n  async get(id: number): Promise<AudioFile | undefined> {\n    if (this.projectId != null) {\n      return await loadAudio(this.projectId, id);\n    }\n    return this.audioMap.get(id);\n  }\n\n  async set(id: number, entry: AudioFile): Promise<void> {\n    if (this.projectId != null) {\n      await loadAudio(this.projectId, id);\n    } else {\n      this.audioMap.set(id, entry);\n    }\n  }\n\n  async delete(id: number): Promise<void> {\n    if (this.projectId != null) {\n      await deleteAudio(this.projectId, id);\n    } else {\n      this.audioMap.delete(id);\n    }\n  }\n\n  async saveToProject(projectId: number): Promise<void> {\n    this.projectId = projectId;\n    await saveAudioMap(projectId, this.audioMap);\n    this.audioMap.clear();\n  }\n\n  entries(): AsyncIterableIterator<[number, AudioFile]> {\n    if (this.projectId != null) {\n      return iterateProjectAudios(this.projectId);\n    }\n    return wrapIteratorAsync(this.audioMap.entries());\n  }\n}\n","/**\n * @author Leon Erath / https://leonerath.de/\n */\n\nimport { ResonanceAudio } from \"resonance-audio\";\nimport { Object3D } from \"three\";\n\nexport default class ResListener extends Object3D {\n  audioScene: ResonanceAudio;\n\n  constructor(audioScene: ResonanceAudio) {\n    super();\n    this.audioScene = audioScene;\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n    this.audioScene.setListenerFromMatrix(this.matrixWorld);\n  }\n}\n","/**\n * @author Leon Erath / https://leonerath.de/\n */\n\nimport { ResonanceAudio } from \"resonance-audio\";\nimport { Object3D } from \"three\";\nimport AudioNode from \"./AudioNode\";\n\n/**\n * Class extends Object3D in order to work with the SceneCanvas.\n * The Idea ist to override the positionChange-Methods and change the ResonanceAudio\n * accordingly.\n */\n\nexport default class ResAudio extends Object3D implements AudioNode {\n  audioContext: AudioContext;\n  audioSource: AudioBufferSourceNode;\n  source: ResonanceAudio.Source;\n\n  constructor(audioScene: ResonanceAudio, audioContext: AudioContext) {\n    super();\n    this.audioContext = audioContext;\n    this.audioSource = audioContext.createBufferSource();\n    this.source = audioScene.createSource({\n      position: new Float32Array([0, 1, 3]),\n      forward: new Float32Array([1, 0, 0])\n    });\n    this.audioSource.connect(this.source.input);\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n    this.source.setFromMatrix(this.matrixWorld);\n  }\n\n  setBuffer(buffer: AudioBuffer): void {\n    if (this.audioSource.buffer) {\n      // Chrome does not allow \"resetting\" the buffer and throws an error\n      // with this message: Cannot set buffer to non-null after it has been already been set to a non-null buffer\n      // To circumvent this, we have to create a new buffer source\n      this.audioSource.stop();\n      this.audioSource.disconnect();\n      this.audioSource = this.audioContext.createBufferSource();\n      this.audioSource.connect(this.source.input);\n    }\n    this.audioSource.buffer = buffer;\n  }\n\n  setLoop(loop: boolean): void {\n    this.audioSource.loop = loop;\n  }\n\n  play(): void {\n    this.audioSource.start();\n  }\n\n  stop(): void {\n    if (this.audioSource.buffer) {\n      this.audioSource.stop();\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { BoxGeometry, Mesh, MeshLambertMaterial } from \"three\";\nimport { ResonanceAudio } from \"resonance-audio\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport ResAudio from \"../audio/ResAudio\";\nimport { ObjectData, AudioFile } from \"../data/schema\";\nimport AudioLibrary from \"./AudioLibrary\";\n\nconst cubeGeometry = new BoxGeometry(1, 1, 1);\nconst cubeMaterial = new MeshLambertMaterial();\n\nexport default class GameObject extends Mesh implements Serializable {\n  audioLibrary: AudioLibrary;\n  audioId?: number;\n  audioFile?: AudioFile;\n\n  audioContext: AudioContext;\n  audioScene: ResonanceAudio;\n  audio: ResAudio;\n\n  constructor(\n    audioLibrary: AudioLibrary,\n    audioContext: AudioContext,\n    audioScene: ResonanceAudio\n  ) {\n    super(cubeGeometry, cubeMaterial);\n    this.audioLibrary = audioLibrary;\n    this.audioContext = audioContext;\n    this.audioScene = audioScene;\n    this.audio = new ResAudio(audioScene, audioContext);\n    this.add(this.audio);\n  }\n\n  async loadAudio(id: number): Promise<void> {\n    this.audioId = id;\n    this.audioFile = await this.audioLibrary.get(id);\n    if (this.audioFile) {\n      const buffer = await this.audioContext.decodeAudioData(\n        this.audioFile.data.slice(0)\n      );\n      this.audio.stop();\n      this.audio.setBuffer(buffer);\n      this.audio.setLoop(true);\n      this.audio.play();\n    }\n  }\n\n  toData(): ObjectData {\n    return {\n      name: this.name,\n      position: this.position.toArray(),\n      scale: this.scale.toArray(),\n      rotation: this.rotation.toArray().slice(0, 3),\n      audioId: this.audioId\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.position.set(data.position[0], data.position[1], data.position[2]);\n    this.scale.set(data.scale[0], data.scale[1], data.scale[2]);\n    this.rotation.set(data.rotation[0], data.rotation[1], data.rotation[2]);\n\n    if (data.audioId != null) {\n      this.loadAudio(data.audioId);\n    }\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport {\n  AmbientLight,\n  BoxGeometry,\n  GridHelper,\n  Mesh,\n  MeshLambertMaterial,\n  Object3D,\n  PerspectiveCamera,\n  PointLight,\n  Scene,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport ResListener from \"../audio/ResListener\";\nimport { RoomData } from \"../data/schema\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\n\nconst wallGeometry = new BoxGeometry(1, 1, 1);\nconst wallMaterial = new MeshLambertMaterial();\n\n// A \"room\" is analog to levels of a game.\n// The user will only hear sounds that are part of the current room.\n// Also, this abstraction is necessary to support Resonance Audio as one of many\n// spatial audio implementations.\nexport default class Room extends Scene implements Serializable {\n  audioLibrary: AudioLibrary;\n  roomDimensions: RoomDimensions;\n  roomMaterials: RoomMaterials;\n\n  grid: GridHelper;\n  wallNorth = new Mesh(wallGeometry, wallMaterial);\n  wallEast = new Mesh(wallGeometry, wallMaterial);\n  wallSouth = new Mesh(wallGeometry, wallMaterial);\n  wallWest = new Mesh(wallGeometry, wallMaterial);\n  camera = new PerspectiveCamera(60, 1, 0.1, 1000);\n\n  audioContext = new AudioContext();\n  audioScene: ResonanceAudio;\n  listener: ResListener;\n\n  get dimensions(): RoomDimensions {\n    return this.roomDimensions;\n  }\n\n  set dimensions(dimensions: RoomDimensions) {\n    this.roomDimensions = dimensions;\n\n    this.audioScene.setRoomProperties(dimensions, this.roomMaterials);\n\n    this.remove(this.grid);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n\n    this.add(this.grid);\n\n    this.updateWalls();\n  }\n\n  get materials(): RoomMaterials {\n    return this.roomMaterials;\n  }\n\n  set materials(materials: RoomMaterials) {\n    this.roomMaterials = materials;\n    this.audioScene.setRoomProperties(this.roomDimensions, materials);\n  }\n\n  constructor(\n    audioLibrary: AudioLibrary,\n    name: string = \"\",\n    dimensions: RoomDimensions = { width: 15, depth: 15, height: 3 },\n    materials: RoomMaterials = ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS\n  ) {\n    super();\n\n    this.audioLibrary = audioLibrary;\n    this.name = name;\n    this.roomDimensions = dimensions;\n    this.roomMaterials = materials;\n\n    const ambientLight = new AmbientLight(0xffffff, 0.5);\n    this.add(ambientLight);\n    const light = new PointLight(0xffffff, 0.5);\n    light.position.set(5, 5, 0);\n    light.lookAt(0, 0, 0);\n    this.add(light);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n    this.add(this.grid);\n\n    this.updateWalls();\n    this.add(this.wallNorth);\n    this.add(this.wallEast);\n    this.add(this.wallSouth);\n    this.add(this.wallWest);\n\n    this.camera.position.z = 4;\n    this.camera.position.y = 3;\n    this.camera.lookAt(new Vector3(0, 1, 0));\n\n    // Audio setup\n\n    this.audioScene = new ResonanceAudio(this.audioContext, {\n      dimensions,\n      materials\n    });\n    this.listener = new ResListener(this.audioScene);\n\n    this.audioScene.output.connect(this.audioContext.destination);\n    this.camera.add(this.listener);\n  }\n\n  addObject(): GameObject {\n    const object = new GameObject(\n      this.audioLibrary,\n      this.audioContext,\n      this.audioScene\n    );\n    object.position.y += 0.5;\n    object.name = \"New object\";\n\n    this.add(object);\n    return object;\n  }\n\n  updateWalls(): void {\n    const { width, depth, height } = this.roomDimensions;\n\n    this.wallNorth.scale.set(width, height, 0.25);\n    this.wallEast.scale.set(0.25, height, depth);\n    this.wallSouth.scale.set(width, height, 0.25);\n    this.wallWest.scale.set(0.25, height, depth);\n\n    this.wallNorth.position.set(0, height / 2, depth / 2);\n    this.wallEast.position.set(width / 2, height / 2, 0);\n    this.wallSouth.position.set(0, height / 2, -depth / 2);\n    this.wallWest.position.set(-width / 2, height / 2, 0);\n  }\n\n  toData(): RoomData {\n    return {\n      name: this.name,\n      dimensions: this.dimensions,\n      materials: this.materials,\n      objects: this.children\n        .filter((c: Object3D): c is GameObject => c instanceof GameObject)\n        .map(go => go.toData())\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.dimensions = data.dimensions;\n    if (data.materials) {\n      this.materials = data.materials;\n    }\n\n    const gameObjects = data.objects.map((o: SerializedData) =>\n      new GameObject(\n        this.audioLibrary,\n        this.audioContext,\n        this.audioScene\n      ).fromData(o)\n    );\n    this.add(...gameObjects);\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport {\n  BackSide,\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport { ProjectData } from \"../data/schema\";\nimport { saveProject } from \"../data/db\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\nimport Room from \"./Room\";\n\nexport interface ProjectEvents {\n  onSelect(object: GameObject | null): void;\n  onTranslate(position: Vector3): void;\n  onScale(scale: Vector3): void;\n}\n\nconst noop = (): void => {\n  /* noop */\n};\nconst defaultEvents: ProjectEvents = {\n  onSelect: noop,\n  onScale: noop,\n  onTranslate: noop\n};\n\nexport default class Project implements Serializable {\n  events: ProjectEvents;\n  audioLibrary = new AudioLibrary();\n\n  id?: number;\n  name = \"New project\";\n\n  rooms: Room[] = [];\n  audioType: number = 1;\n\n  activeRoom: Room;\n  activeObject: GameObject | null = null;\n\n  outlineMesh = new Mesh();\n\n  get camera(): PerspectiveCamera {\n    return this.activeRoom.camera;\n  }\n\n  constructor(events: ProjectEvents = defaultEvents) {\n    this.events = events;\n\n    const firstRoom = new Room(this.audioLibrary, \"First room\");\n    firstRoom.addObject();\n    this.rooms.push(firstRoom);\n    this.activeRoom = firstRoom;\n\n    this.outlineMesh.material = new MeshBasicMaterial({\n      color: 0xffffff,\n      side: BackSide\n    });\n    this.outlineMesh.scale.multiplyScalar(1.05);\n  }\n\n  close(): void {\n    for (const room of this.rooms) {\n      room.audioContext.close();\n    }\n  }\n\n  addRoom(): Room {\n    const room = new Room(this.audioLibrary, \"New room\");\n    room.addObject();\n    this.rooms.push(room);\n    this.selectRoom(room);\n    return room;\n  }\n\n  selectRoom(room: Room): void {\n    this.activeRoom.audioContext.suspend();\n    room.audioContext.resume();\n    room.camera.aspect = this.activeRoom.camera.aspect;\n    room.camera.updateProjectionMatrix();\n    this.activeRoom = room;\n    this.selectObject(null);\n  }\n\n  selectObject(o: GameObject | null): void {\n    if (this.activeObject) {\n      this.activeObject.remove(this.outlineMesh);\n    }\n\n    if (o) {\n      this.outlineMesh.geometry = o.geometry;\n      o.add(this.outlineMesh);\n    }\n\n    this.activeObject = o;\n    this.events.onSelect(o);\n  }\n\n  // Serialize instance to a plain JavaScript object\n  toData(): ProjectData {\n    return {\n      savedAt: new Date(),\n      name: this.name,\n      rooms: this.rooms.map(r => r.toData()),\n      nextAudioId: this.audioLibrary.nextId\n    };\n  }\n\n  // Load data from a plain JavaScript object into this instance\n  fromData(data: SerializedData, projectId?: number): this {\n    this.id = projectId;\n    this.audioLibrary.projectId = projectId;\n    this.audioLibrary.nextId = data.nextAudioId || 0;\n\n    this.name = data.name;\n    this.rooms = data.rooms.map((r: SerializedData) =>\n      new Room(this.audioLibrary).fromData(r)\n    );\n    this.activeRoom = this.rooms[0];\n\n    // Disable audio in all inactive rooms\n    for (let i = 1; i < this.rooms.length; i++) {\n      this.rooms[i].audioContext.suspend();\n    }\n\n    return this;\n  }\n\n  async save(): Promise<void> {\n    const id = await saveProject(this);\n    if (this.id == null) {\n      this.id = id;\n      await this.audioLibrary.saveToProject(id);\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\n// Options for configuring the file modal\nexport interface OpenFileDialogOptions {\n  accept?: string;\n}\n\n/**\n * Opens a file dialog and lets the user select a file\n * @returns The selected file\n */\nexport const openFileDialog = (\n  options: OpenFileDialogOptions = {}\n): Promise<File> =>\n  new Promise(resolve => {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    if (options.accept) {\n      input.accept = options.accept;\n    }\n    input.onchange = () => {\n      if (input.files) {\n        resolve(input.files[0]);\n      }\n    };\n    input.click();\n  });\n\nexport const readFileAsArrayBuffer = (file: File): Promise<ArrayBuffer> =>\n  new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      if (reader.result) {\n        resolve(reader.result as ArrayBuffer);\n      }\n    };\n    reader.onerror = () => {\n      console.error(\"Error:\", reader.error);\n    };\n    reader.readAsArrayBuffer(file);\n  });\n","/**\n * @author Niklas Korz\n * This module defines functions for loading and importing projects from the local filesystem.\n */\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\nimport { openFileDialog } from \"../utils/files\";\n\n/**\n * Decompresses the given zip file, loads the included JSON metadata and reads all\n * included audio files as binary array buffers.\n * @param blob The blob to read from, usually a file returned by a FileReader instance.\n * @returns The project recreated from the data found in the zip\n */\nexport const loadZip = async (blob: Blob): Promise<Project> => {\n  const zip = await Zip.loadAsync(blob);\n  const metadata = JSON.parse(await zip.file(\"metadata.json\").async(\"text\"));\n\n  const audioLibrary = JSON.parse(\n    await zip.file(\"audioLibrary.json\").async(\"text\")\n  );\n  const audioFolder = zip.folder(\"audio\");\n  const project = new Project();\n  for (const { id, name, type } of audioLibrary) {\n    const data = await audioFolder.file(id.toString()).async(\"arraybuffer\");\n    project.audioLibrary.set(id, { name, type, data });\n\n    if (id >= project.audioLibrary.nextId) {\n      project.audioLibrary.nextId = id + 1;\n    }\n  }\n\n  project.fromData(metadata);\n  return project;\n};\n\n/**\n * Opens a file dialog and lets the user select a zip file that will be parsed\n * and loaded as a project.\n * @returns The project found in the zip\n */\nexport const openZip = async (): Promise<Project> => {\n  const file = await openFileDialog({ accept: \"application/zip\" });\n  return await loadZip(file);\n};\n","/**\n * @author Niklas Korz\n */\n\nconst AXIS_THRESHOLD = 0.1;\n\nexport default class GamepadListener {\n  listen(): void {\n    window.addEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.addEventListener(\"gamepaddisconnected\", this.onGamepadDisconnected);\n  }\n\n  stop(): void {\n    window.removeEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.removeEventListener(\n      \"gamepaddisconnected\",\n      this.onGamepadDisconnected\n    );\n  }\n\n  onGamepadConnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad connected:\", e.gamepad);\n  };\n\n  onGamepadDisconnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad disconnected:\", e.gamepad);\n  };\n\n  getAxis(index: number): number {\n    const gamepads = navigator.getGamepads();\n\n    let value = 0;\n    for (const gamepad of gamepads) {\n      if (!gamepad || gamepad.mapping !== \"standard\") {\n        continue;\n      }\n\n      if (index < 4) {\n        const axis = gamepad.axes[index];\n        if (\n          Math.abs(axis) >= AXIS_THRESHOLD &&\n          Math.abs(axis) > Math.abs(value)\n        ) {\n          value = axis;\n        }\n      } else if (index === 4) {\n        const v1 = gamepad.buttons[6].value;\n        const v2 = gamepad.buttons[7].value;\n        const axis = v2 - v1;\n        if (Math.abs(axis) > Math.abs(value)) {\n          value = axis;\n        }\n      }\n    }\n    return value;\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\nexport default class KeyboardListener {\n  target: HTMLElement;\n  keysPressed = new Set<string>();\n  lastKeyUp = new Map<string, number>();\n\n  constructor(target: HTMLElement) {\n    this.target = target;\n  }\n\n  listen(): void {\n    this.target.addEventListener(\"blur\", this.reset);\n    this.target.addEventListener(\"contextmenu\", this.reset);\n    this.target.addEventListener(\"keydown\", this.onKeyDown);\n    this.target.addEventListener(\"keyup\", this.onKeyUp);\n    document.addEventListener(\"click\", this.onClick);\n  }\n\n  stop(): void {\n    this.target.removeEventListener(\"blur\", this.reset);\n    this.target.removeEventListener(\"contextmenu\", this.reset);\n    this.target.removeEventListener(\"keydown\", this.onKeyDown);\n    this.target.removeEventListener(\"keyup\", this.onKeyUp);\n    document.removeEventListener(\"click\", this.onClick);\n    this.reset();\n  }\n\n  isPressed(key: string): boolean {\n    return this.keysPressed.has(key);\n  }\n\n  reset = (): void => {\n    this.keysPressed.clear();\n  };\n\n  onKeyDown = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    // Workaround for browsers firing a queued keydown shortly after a keyup\n    // Ignore keydown if the last keyup was triggered +-100ms from now\n    if (Math.abs(e.timeStamp - (this.lastKeyUp.get(e.key) || 0)) >= 100) {\n      this.keysPressed.add(e.key);\n    }\n  };\n\n  onKeyUp = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    this.keysPressed.delete(e.key);\n    this.lastKeyUp.set(e.key, e.timeStamp);\n  };\n\n  onClick = (e: MouseEvent): void => {\n    // Shift + right click forces context menu in firefox\n    if (e.button === 2 && e.shiftKey) {\n      this.reset();\n    }\n  };\n}\n","/**\n * @author Daniel Salomon\n */\nimport { Raycaster, Vector3, WebGLRenderer } from \"three\";\nimport GamepadListener from \"../input/GamepadListener\";\nimport KeyboardListener from \"../input/KeyboardListener\";\nimport Project from \"../project/Project\";\n\nconst axes = {\n  x: new Vector3(1, 0, 0),\n  y: new Vector3(0, 1, 0),\n  z: new Vector3(0, 0, 1)\n};\n\nexport default class Runtime {\n  target: HTMLElement | null = null;\n  project: Project;\n\n  rafHandle = 0;\n  previousTimestamp = 0;\n\n  renderer = new WebGLRenderer();\n  canvas: HTMLCanvasElement;\n\n  raycaster = new Raycaster();\n\n  keys = new KeyboardListener(this.renderer.domElement);\n  gamepads = new GamepadListener();\n\n  constructor(project: Project) {\n    this.project = project;\n    this.canvas = this.renderer.domElement;\n    this.canvas.tabIndex = -1; // Make element focusable\n\n    this.project.selectRoom(this.project.rooms[0]);\n    this.project.camera.position.set(0, 1, 2);\n    this.project.camera.rotation.set(0, 0, 0);\n  }\n\n  attach(target: HTMLElement): void {\n    this.keys.listen();\n    this.gamepads.listen();\n\n    this.target = target;\n    target.appendChild(this.canvas);\n\n    this.resize();\n    window.requestAnimationFrame(this.animate);\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  detach(): void {\n    window.cancelAnimationFrame(this.rafHandle);\n    window.removeEventListener(\"resize\", this.resize);\n\n    if (this.target) {\n      this.target.removeChild(this.canvas);\n      this.target = null;\n    }\n\n    this.keys.stop();\n    this.gamepads.stop();\n  }\n\n  focus(): void {\n    this.canvas.focus();\n  }\n\n  changeProject(project: Project): void {\n    this.project = project;\n    // Ensure the selected project's camera has the correct aspect ratio\n    this.resize();\n  }\n\n  resize = (): void => {\n    if (!this.target) {\n      return;\n    }\n\n    const { offsetWidth, offsetHeight } = this.target;\n\n    this.project.camera.aspect = offsetWidth / offsetHeight;\n    this.project.camera.updateProjectionMatrix();\n\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(offsetWidth, offsetHeight);\n  };\n\n  animate: FrameRequestCallback = t => {\n    this.rafHandle = window.requestAnimationFrame(this.animate);\n\n    const dt = (t - this.previousTimestamp) / 1000;\n    this.previousTimestamp = t;\n    this.update(dt);\n\n    this.renderer.render(this.project.activeRoom, this.project.camera);\n  };\n\n  update(dt: number): void {\n    const { camera } = this.project;\n\n    if (this.keys.isPressed(\"w\")) {\n      camera.translateOnAxis(axes.z, -2 * dt);\n    }\n    if (this.keys.isPressed(\"s\")) {\n      camera.translateOnAxis(axes.z, 2 * dt);\n    }\n    if (this.keys.isPressed(\"a\")) {\n      camera.translateOnAxis(axes.x, -2 * dt);\n    }\n    if (this.keys.isPressed(\"d\")) {\n      camera.translateOnAxis(axes.x, 2 * dt);\n    }\n\n    if (this.keys.isPressed(\"ArrowLeft\")) {\n      camera.rotateOnWorldAxis(axes.y, dt);\n    }\n    if (this.keys.isPressed(\"ArrowRight\")) {\n      camera.rotateOnWorldAxis(axes.y, -dt);\n    }\n\n    const gamepadAxes = {\n      x: this.gamepads.getAxis(0),\n      rX: this.gamepads.getAxis(2),\n      y: this.gamepads.getAxis(4)\n    };\n    // console.log(axes);\n    if (gamepadAxes.x) {\n      camera.translateOnAxis(axes.x, 2 * dt * gamepadAxes.x);\n    }\n    if (gamepadAxes.y) {\n      camera.translateOnAxis(axes.y, 2 * dt * gamepadAxes.y);\n    }\n    if (gamepadAxes.rX) {\n      camera.rotateOnWorldAxis(axes.y, -dt * gamepadAxes.rX);\n    }\n  }\n}\n","/**\n * @author Daniel Salomon\n */\nimport React from \"react\";\nimport Project from \"../project/Project\";\nimport Runtime from \"./Runtime\";\n\ninterface Props {\n  project: Project;\n}\n\nexport default class RuntimeContainer extends React.Component<Props> {\n  targetRef = React.createRef<HTMLDivElement>();\n  runtime = new Runtime(this.props.project);\n\n  componentDidMount(): void {\n    if (this.targetRef.current) {\n      this.runtime.attach(this.targetRef.current);\n      this.runtime.focus();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.runtime.detach();\n  }\n\n  render(): React.ReactNode {\n    return (\n      <div\n        style={{\n          position: \"absolute\",\n          top: 0,\n          left: 0,\n          width: \"100%\",\n          height: \"100%\",\n          overflow: \"hidden\"\n        }}\n        ref={this.targetRef}\n      />\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nconst Backdrop = styled.div`\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 2;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Container = styled.div`\n  border-radius: 5px;\n  overflow: hidden;\n  max-width: 600px;\n  color: #fff;\n  background: hsl(210, 29%, 29%);\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n`;\n\nconst TitleBar = styled.div`\n  padding: 10px 15px;\n  background: hsl(210, 29%, 15%);\n`;\n\nconst Content = styled.div`\n  padding: 10px 15px;\n`;\n\nexport const ActionGroup = styled.div`\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n`;\n\nexport const Action = styled.button`\n  display: block;\n  appearance: none;\n  border: none;\n  background: hsl(210, 29%, 20%);\n  color: #fff;\n  cursor: pointer;\n  border-radius: 3px;\n  padding: 8px 12px;\n  margin-left: 10px;\n  font-size: 0.9em;\n\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\ninterface Props {\n  title: string;\n  onDismiss?(): void;\n}\n\nexport default class Modal extends React.Component<Props> {\n  onBackdropClick: React.MouseEventHandler = e => {\n    if (e.currentTarget === e.target && this.props.onDismiss) {\n      this.props.onDismiss();\n    }\n  };\n\n  render(): React.ReactNode {\n    return (\n      <Backdrop onClick={this.onBackdropClick}>\n        <Container>\n          <TitleBar>{this.props.title}</TitleBar>\n          <Content>{this.props.children}</Content>\n        </Container>\n      </Backdrop>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\ninterface Props {\n  audioEntry: AudioEntry;\n  onDelete(audioEntry: AudioEntry): void;\n  onExport(audioEntry: AudioEntry): void;\n  onDismiss(): void;\n  onCancel(): void;\n}\n\nexport default class AudioFileModal extends React.Component<Props> {\n  render(): React.ReactNode {\n    const { audioEntry } = this.props;\n    return (\n      <Modal title=\"Audio File\" onDismiss={this.props.onDismiss}>\n        <p>\n          <b>Name:</b> {audioEntry.name}\n        </p>\n        <p>\n          <b>Type:</b> {audioEntry.type}\n        </p>\n        <p>\n          <b>Size:</b> {Math.ceil(audioEntry.data.byteLength / 1024)} KiB\n        </p>\n        <ActionGroup>\n          <Action onClick={() => this.props.onDelete(audioEntry)}>\n            Delete\n          </Action>\n          <Action onClick={() => this.props.onExport(audioEntry)}>\n            Export\n          </Action>\n          <Action onClick={this.props.onCancel}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { saveAs } from \"file-saver\";\nimport styled from \"styled-components\";\nimport AudioLibrary from \"../project/AudioLibrary\";\nimport { openFileDialog, readFileAsArrayBuffer } from \"../utils/files\";\nimport AudioFileModal from \"./AudioFileModal\";\nimport Modal, { Action, ActionGroup } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\nconst AudioList = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  margin: 0 -5px;\n`;\n\nconst AudioItem = styled.div`\n  flex: 1 1 150px;\n  margin: 5px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  cursor: pointer;\n  background: hsl(210, 29%, 20%);\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n`;\n\ninterface Props {\n  audioLibrary: AudioLibrary;\n  onDismiss(): void;\n  onSelect?(entry: AudioEntry): void;\n}\n\ninterface State {\n  entries: AudioEntry[];\n  selectedEntry: AudioEntry | null;\n}\n\nexport default class AudioLibraryModal extends React.Component<Props, State> {\n  previewAudio = new Audio();\n  state: State = { entries: [], selectedEntry: null };\n\n  openAudioFileDialog = async () => {\n    const file = await openFileDialog({ accept: \"audio/*\" });\n    const data = await readFileAsArrayBuffer(file);\n    const audioFile = { name: file.name, type: file.type, data };\n    const id = await this.props.audioLibrary.add(audioFile);\n    this.setState(({ entries }) => ({\n      entries: [\n        ...entries,\n        {\n          id,\n          ...audioFile\n        }\n      ]\n    }));\n  };\n\n  previewEntry(entry: AudioEntry): void {\n    this.previewAudio.src = URL.createObjectURL(new Blob([entry.data]));\n    this.previewAudio.loop = true;\n    this.previewAudio.play();\n  }\n\n  stopPreview = () => {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  };\n\n  dismiss = () => {\n    this.setState({ selectedEntry: null });\n    this.props.onDismiss();\n    this.stopPreview();\n  };\n\n  selectEntry(audioEntry: AudioEntry): void {\n    if (this.props.onSelect) {\n      this.props.onSelect(audioEntry);\n    } else {\n      this.setState({ selectedEntry: audioEntry });\n    }\n  }\n\n  unselectEntry = () => {\n    this.setState({ selectedEntry: null });\n    this.stopPreview();\n  };\n\n  deleteAudio = ({ id }: AudioEntry) => {\n    this.props.audioLibrary.delete(id);\n    this.setState(({ entries }) => ({\n      entries: entries.filter(e => e.id !== id),\n      selectedEntry: null\n    }));\n  };\n\n  exportAudio = ({ name, type, data }: AudioEntry) => {\n    saveAs(new Blob([data], { type }), name);\n  };\n\n  async updateEntries(): Promise<void> {\n    const entries: AudioEntry[] = [];\n    for await (const [id, audioFile] of this.props.audioLibrary.entries()) {\n      entries.push({ ...audioFile, id });\n    }\n    this.setState({\n      entries: entries.sort((a, b) => a.id - b.id)\n    });\n  }\n\n  async componentDidMount(): Promise<void> {\n    await this.updateEntries();\n  }\n\n  async componentDidUpdate(prevProps: Props): Promise<void> {\n    if (prevProps.audioLibrary !== this.props.audioLibrary) {\n      // The project and therefore the audio library to be rendered has changed\n      await this.updateEntries();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  }\n\n  render(): React.ReactNode {\n    const { entries, selectedEntry } = this.state;\n\n    if (selectedEntry) {\n      return (\n        <AudioFileModal\n          audioEntry={selectedEntry}\n          onDelete={this.deleteAudio}\n          onExport={this.exportAudio}\n          onCancel={this.unselectEntry}\n          onDismiss={this.dismiss}\n        />\n      );\n    }\n\n    return (\n      <Modal title=\"Audio Library\" onDismiss={this.dismiss}>\n        <AudioList>\n          {entries.length > 0 &&\n            entries.map(e => (\n              <AudioItem\n                key={e.id}\n                title={e.name}\n                onClick={() => this.selectEntry(e)}\n                onMouseEnter={() => this.previewEntry(e)}\n                onMouseLeave={this.stopPreview}\n              >\n                {e.name} <br />\n                {e.type} <br />\n                {Math.ceil(e.data.byteLength / 1024)} KiB\n              </AudioItem>\n            ))}\n        </AudioList>\n        {!entries.length && <div>You haven't added any audio files yet</div>}\n        <ActionGroup>\n          <Action onClick={this.openAudioFileDialog}>Add audio file</Action>\n          <Action onClick={this.dismiss}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","import React from \"react\";\nimport styled, { css } from \"styled-components\";\n\nconst Container = styled.div`\n  flex: 0 0 auto;\n  background: hsl(210, 29%, 15%);\n  color: #fff;\n  font-size: 0.9em;\n  padding: 0 10px;\n  user-select: none;\n\n  :focus {\n    outline: none;\n  }\n`;\n\ninterface MenubarItemProps {\n  isActive?: boolean;\n}\n\nconst MenubarItem = styled.div<MenubarItemProps>`\n  position: relative;\n  display: inline-block;\n  padding: 10px 15px;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 25%, 20%);\n  }\n\n  ${props =>\n    props.isActive &&\n    css`\n      background: hsl(210, 25%, 20%);\n    `}\n`;\n\nconst Menu = styled.div`\n  z-index: 1;\n  position: absolute;\n  left: 0;\n  top: 100%;\n  background: hsl(210, 25%, 20%);\n  padding: 5px 0;\n  min-width: 200px;\n  font-size: 0.95em;\n  box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.5);\n\n  border-bottom-left-radius: 3px;\n  border-bottom-right-radius: 3px;\n\n  cursor: default;\n`;\n\nconst MenuItem = styled.div`\n  white-space: nowrap;\n  padding: 8px 20px;\n  margin: 2px 0;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 15%);\n  }\n`;\n\nconst MenuDivider = styled.div`\n  height: 0;\n  margin: 5px;\n  border-bottom: 1px solid hsl(210, 15%, 35%);\n`;\n\ninterface Props {\n  onNewProject(): void;\n  onLoadProject(): void;\n  onSaveProject(): void;\n  onImportProject(): void;\n  onExportProject(): void;\n\n  onAddObject(): void;\n  onDeleteObject(): void;\n  onAddRoom(): void;\n  onDeleteRoom(): void;\n\n  onShowAudioLibrary(): void;\n\n  onRunProject(): void;\n}\n\nenum MenuType {\n  FileMenu,\n  EditMenu,\n  ViewMenu,\n  HelpMenu\n}\n\ninterface State {\n  activeMenu: MenuType | null;\n}\n\nexport default class MenuBar extends React.Component<Props, State> {\n  state: State = {\n    activeMenu: null\n  };\n\n  toggleMenu(menuType: MenuType): void {\n    this.setState(state => ({\n      activeMenu: state.activeMenu === menuType ? null : menuType\n    }));\n  }\n\n  closeMenu(): void {\n    this.setState({ activeMenu: null });\n  }\n\n  render(): React.ReactNode {\n    const { activeMenu } = this.state;\n\n    return (\n      <Container tabIndex={-1} onBlur={() => this.closeMenu()}>\n        <MenubarItem\n          isActive={activeMenu === MenuType.FileMenu}\n          onClick={() => this.toggleMenu(MenuType.FileMenu)}\n        >\n          File\n          <Menu hidden={activeMenu !== MenuType.FileMenu}>\n            <MenuItem onClick={this.props.onNewProject}>New project</MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onLoadProject}>Load project</MenuItem>\n            <MenuItem onClick={this.props.onImportProject}>\n              Import project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onSaveProject}>Save project</MenuItem>\n            <MenuItem onClick={this.props.onExportProject}>\n              Export project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem>Settings</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.EditMenu}\n          onClick={() => this.toggleMenu(MenuType.EditMenu)}\n        >\n          Edit\n          <Menu hidden={activeMenu !== MenuType.EditMenu}>\n            <MenuItem onClick={this.props.onAddObject}>Add object</MenuItem>\n            <MenuItem onClick={this.props.onDeleteObject}>\n              Delete object\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onAddRoom}>Add room</MenuItem>\n            <MenuItem onClick={this.props.onDeleteRoom}>Delete room</MenuItem>\n            <MenuDivider />\n            <MenuItem>Release the kraken</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.ViewMenu}\n          onClick={() => this.toggleMenu(MenuType.ViewMenu)}\n        >\n          View\n          <Menu hidden={activeMenu !== MenuType.ViewMenu}>\n            <MenuItem onClick={this.props.onShowAudioLibrary}>\n              Audio Library\n            </MenuItem>\n            <MenuItem>Project Manager</MenuItem>\n            <MenuDivider />\n            <MenuItem>Toggle Fullscreen</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.HelpMenu}\n          onClick={() => this.toggleMenu(MenuType.HelpMenu)}\n        >\n          Help\n          <Menu hidden={activeMenu !== MenuType.HelpMenu}>\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/issues\",\n                  \"_blank\"\n                )\n              }\n            >\n              Issues\n            </MenuItem>\n            <MenuItem\n              onClick={() =>\n                window.open(\"https://github.com/niklaskorz/audio3d\", \"_blank\")\n              }\n            >\n              Source Code\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/blob/master/README.md\",\n                  \"_blank\"\n                )\n              }\n            >\n              About\n            </MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem onClick={this.props.onRunProject}>Run</MenubarItem>\n      </Container>\n    );\n  }\n}\n","/**\n * Useful utility functions related to mathematics\n * @author Niklas Korz\n */\n\n// Converts radiant angles to degrees\nexport const radToDeg = (rad: number): number => (rad * 180) / Math.PI;\n\n// Converts degree angles to radiants\nexport const degToRad = (deg: number): number => (deg / 180) * Math.PI;\n\nexport const roundToPrecision = (value: number, precision: number): number =>\n  Math.round(value / precision) * precision;\n","import styled, { css } from \"styled-components\";\n\nexport const Container = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const InnerContainer = styled.div`\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n`;\n\nexport const Sidebar = styled.aside`\n  flex: 0 0 300px;\n  height: 100%;\n  background: hsl(210, 29%, 29%);\n  color: #fff;\n  padding: 0 15px;\n  overflow-x: hidden;\n  overflow-y: auto;\n`;\n\nexport const FocusedLabel = styled.div`\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n`;\n\nexport const Main = styled.main`\n  position: relative;\n  flex: 1;\n  height: 100%;\n\n  :focus-within > ${FocusedLabel} {\n    display: block;\n  }\n`;\n\nexport const Group = styled.div`\n  margin: 20px 0;\n`;\n\nexport const Input = styled.input`\n  display: block;\n  appearance: none;\n  background: hsl(210, 29%, 24%);\n  border-radius: 3px;\n  border: 2px solid hsl(210, 29%, 24%);\n  color: #fff;\n  width: 100%;\n  padding: 10px 12px;\n  margin: 5px 0;\n\n  transition: 0.2s ease border-color;\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\nexport const Select = styled(Input.withComponent(\"select\"))`\n  cursor: pointer;\n`;\n\nexport const InputGroup = styled.div`\n  display: flex;\n  flex-direction: row;\n\n  > ${Input} {\n    flex: 1;\n    width: auto;\n    min-width: 0;\n\n    margin-right: 5px;\n\n    :last-child {\n      margin-right: 0;\n    }\n  }\n`;\n\nexport const RoomList = styled.ol`\n  list-style: none;\n  padding: 5px;\n  margin: 5px 0;\n  border-radius: 3px;\n  background: hsl(210, 29%, 24%);\n`;\n\ninterface RoomListItemProps {\n  active?: boolean;\n}\n\nexport const RoomListItem = styled.li<RoomListItemProps>`\n  cursor: pointer;\n  padding: 7px 10px;\n  border-radius: 2px;\n  ${props =>\n    props.active &&\n    css`\n      background: hsl(210, 29%, 20%);\n      border-left: 2px solid #3498db;\n    `};\n`;\n","/**\n * @author Niklas Korz\n */\nimport {\n  BoxGeometry,\n  DoubleSide,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  Plane,\n  PlaneGeometry,\n  Raycaster,\n  Scene,\n  SphereGeometry,\n  Vector3\n} from \"three\";\nimport Project from \"../project/Project\";\n\n// The object drag direction is required for calculating the plane to ray cast\n// against later on. Also, of course, to determine whether the object should be\n// moved on one or two axes.\nenum ObjectDragDirection {\n  AxisX,\n  AxisY,\n  AxisZ,\n  PlaneYZ,\n  PlaneXZ,\n  PlaneXY\n}\n\n// Inspired by https://github.com/mrdoob/three.js/blob/dev/examples/js/controls/TransformControls.js\n// As in the example, we are using ray casting for calculating the movements of planes and axes.\n// Everything else in this implementation has resulted either from trial and error or by\n// consulting the Three.js documentation.\n// The controls are grouped as a scene instead of a group object to allow drawing\n// them separately, on top of the main scene, to avoid any controls to be obscured\n// by objects that would theoretically appear in front of them based on their Z coordinate.\n// Furthermore, the scene's position is set to the active mesh's when one is\n// selected. This way, coordinates in the controls scene are always relative to the\n// active mesh.\n// Theoretically, it could also be added as a child node to the active mesh,\n// but this would result in the rotation being copied as well, which is not desirable\n// in this case.\n// Beware though that intersection points are always given in absolute world coordinates.\nexport default class VisualControls extends Scene {\n  project: Project;\n\n  objectDragDirection: ObjectDragDirection | null = null;\n  isScaling: boolean = false;\n  // The drag offset is used to determine the distance of the point where the\n  // user started dragging and the center of the object.\n  // This way, the cursor will always have the same relative position to the\n  // object while dragging.\n  dragOffset = new Vector3();\n  lastPoint = new Vector3();\n\n  // In contrast to the Three.js example, we will be using a real plane instead of a\n  // mesh that only represents an area on a plane.\n  // As a consequence, the ray generated by the ray caster will be used directly\n  // for calculating the intersection.\n  plane = new Plane();\n\n  // The visual controls\n  axisX: Mesh;\n  axisY: Mesh;\n  axisZ: Mesh;\n  scaleX: Mesh;\n  scaleY: Mesh;\n  scaleZ: Mesh;\n  planeYZ: Mesh;\n  planeXZ: Mesh;\n  planeXY: Mesh;\n\n  constructor(project: Project) {\n    super();\n\n    this.project = project;\n\n    // Setup visual controls for transformation\n\n    const materialConfig = {\n      transparent: true,\n      opacity: 0.75,\n      side: DoubleSide // Needed to make the planes viewable from both sides\n    };\n\n    // The X, Y and Z axes, represented as cuboids\n\n    const axisGeometry = new BoxGeometry(0.05, 0.05, 0.5);\n\n    this.axisX = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0xff0000\n      })\n    );\n    this.axisX.position.set(0.275, 0.0, 0.0);\n    this.axisX.rotation.y = Math.PI / 2;\n    this.axisX.userData.direction = ObjectDragDirection.AxisX;\n\n    this.axisY = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x00ff00\n      })\n    );\n    this.axisY.position.set(0.0, 0.275, 0.0);\n    this.axisY.rotation.x = Math.PI / 2;\n    this.axisY.userData.direction = ObjectDragDirection.AxisY;\n\n    this.axisZ = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x0000ff\n      })\n    );\n    this.axisZ.position.set(0.0, 0.0, 0.275);\n    this.axisZ.userData.direction = ObjectDragDirection.AxisZ;\n\n    this.add(this.axisX);\n    this.add(this.axisY);\n    this.add(this.axisZ);\n\n    // Scaling controls per axis, represented as spheres\n\n    const scaleGeometry = new SphereGeometry(0.05, 16, 16);\n\n    this.scaleX = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff0000 })\n    );\n    this.scaleX.position.set(0.65, 0, 0);\n    this.scaleX.userData.direction = ObjectDragDirection.AxisX;\n    this.scaleX.userData.isScale = true;\n\n    this.scaleY = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ff00 })\n    );\n    this.scaleY.position.set(0, 0.65, 0);\n    this.scaleY.userData.direction = ObjectDragDirection.AxisY;\n    this.scaleY.userData.isScale = true;\n\n    this.scaleZ = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x0000ff })\n    );\n    this.scaleZ.position.set(0, 0, 0.65);\n    this.scaleZ.userData.direction = ObjectDragDirection.AxisZ;\n    this.scaleZ.userData.isScale = true;\n\n    this.add(this.scaleX);\n    this.add(this.scaleY);\n    this.add(this.scaleZ);\n\n    // The YZ, XZ, XY planes, represented as areas on each plane.\n    // Declaration is ordered by the normal of the plane, i.e.\n    // the axis that will not be moved by it.\n\n    const planeGeometry = new PlaneGeometry(0.25, 0.25);\n\n    this.planeYZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ffff })\n    );\n    this.planeYZ.position.set(0.0, 0.25, 0.25);\n    this.planeYZ.rotation.y = Math.PI / 2;\n    this.planeYZ.userData.direction = ObjectDragDirection.PlaneYZ;\n\n    this.planeXZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff00ff })\n    );\n    this.planeXZ.position.set(0.25, 0.0, 0.25);\n    this.planeXZ.rotation.x = Math.PI / 2;\n    this.planeXZ.userData.direction = ObjectDragDirection.PlaneXZ;\n\n    this.planeXY = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xffff00 })\n    );\n    this.planeXY.position.set(0.25, 0.25, 0.0);\n    this.planeXY.userData.direction = ObjectDragDirection.PlaneXY;\n\n    this.add(this.planeYZ);\n    this.add(this.planeXZ);\n    this.add(this.planeXY);\n  }\n\n  getControlFromRaycaster(raycaster: Raycaster): Object3D | null {\n    if (!this.project.activeObject) {\n      return null;\n    }\n\n    this.position.copy(this.project.activeObject.position);\n\n    const intersections = raycaster.intersectObjects(this.children);\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o.userData.hasOwnProperty(\"direction\")) {\n        // Save the drag offset by subtracting the absolute position of the cursor\n        // (absolute meaning world coordinates) from the object's absolute position.\n        this.dragOffset\n          .copy(intersection.point)\n          .sub(this.project.activeObject.position);\n        this.lastPoint.copy(intersection.point);\n        return o;\n      }\n    }\n    return null;\n  }\n\n  // As we don't have access to the camera here and to avoid creating the ray caster\n  // twice, we just pass it from the initial mouse click handler and use it here.\n  // The original mouse event and screen coordinates are not required for the functionality\n  // of the controls, so they will not be taken as parameters here.\n  onClick(raycaster: Raycaster): boolean {\n    const o = this.getControlFromRaycaster(raycaster);\n    if (o && o.userData.hasOwnProperty(\"direction\")) {\n      this.objectDragDirection = o.userData.direction;\n      this.isScaling = !!o.userData.isScale;\n      this.onMove(raycaster);\n      return true;\n    }\n    return false;\n  }\n\n  // Initially, I used a Vector3(dx, dy, 0) here and applied the world rotation\n  // that can be calculated by the camera with camera.getWorldQuaternion(),\n  // followed by zeroing out the directions that should not be changed based on\n  // the plane or axis selected by the user.\n  // This resulted in a \"weird\" feeling though, as the zeroed axis gets completely lost,\n  // therefore making one of the two remaining axis movements feel slower than the other\n  // even if both are dragged equally on the screen.\n  //\n  // Similar to the Three.js transform controls example, this now uses a ray\n  // casted from the camera origin onto a plane that represents the axes to move\n  // on and sets the position of the object to the intersection point.\n  onMove({ ray }: Raycaster): void {\n    if (this.objectDragDirection === null || !this.project.activeObject) {\n      return;\n    }\n\n    const c = this.project.activeObject.position;\n    const p = this.plane;\n    let altPlane: Plane | null = null;\n\n    // Update the normal and constant (^= position) of the plane\n    // The second parameter of the Plane constructor is called the \"constant\" and\n    // is used for defining the plane in Hessian normal form. It defines\n    // the negative distance from the origin to the plane.\n    switch (this.objectDragDirection) {\n      case ObjectDragDirection.AxisX:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisY:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 1, 0), -c.y);\n        break;\n      case ObjectDragDirection.PlaneXY:\n        p.set(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.PlaneYZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        break;\n      case ObjectDragDirection.PlaneXZ:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        break;\n    }\n\n    // If there is an alternative plane (i.e., for axes),\n    // check which one is farther away from the ray's origin.\n    // This is needed to prevent issues when the camera comes too close to the\n    // plane.\n    if (\n      altPlane &&\n      Math.abs(altPlane.distanceToPoint(ray.origin)) >\n        Math.abs(p.distanceToPoint(ray.origin))\n    ) {\n      p.copy(altPlane);\n    }\n\n    const point = ray.intersectPlane(p, new Vector3());\n    if (!point) {\n      // No intersection\n      return;\n    }\n\n    if (this.isScaling) {\n      // For scaling, we are using the relative movement instead of the position\n      // as no movement at all should leave the scale as is.\n      // I.e., we are adding the distance to the previously recorded intersection point\n      // to the object's scale.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.scale.x = Math.min(\n            Math.max(\n              this.project.activeObject.scale.x + (point.x - this.lastPoint.x),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.scale.y = Math.min(\n            Math.max(\n              this.project.activeObject.scale.y + (point.y - this.lastPoint.y),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.scale.z = Math.min(\n            Math.max(\n              this.project.activeObject.scale.z + (point.z - this.lastPoint.z),\n              0.1\n            ),\n            10\n          );\n          break;\n      }\n\n      this.project.events.onScale(this.project.activeObject.scale);\n    } else {\n      point.sub(this.dragOffset);\n\n      // If we are operating on an axis instead of a plane, ensure only the relevant\n      // coordinate is changed.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.position.x = point.x;\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.position.y = point.y;\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.position.z = point.z;\n          break;\n        default:\n          // The selected direction is a plane, so we can just copy the\n          // intersection point.\n          this.project.activeObject.position.copy(point);\n      }\n\n      this.project.events.onTranslate(this.project.activeObject.position);\n    }\n\n    this.lastPoint.copy(point);\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { degToRad, radToDeg, roundToPrecision } from \"../utils/math\";\nimport { Group, Input, InputGroup } from \"./styled\";\nimport { EditorObject } from \"./types\";\n\ninterface Props {\n  object: EditorObject;\n  onUpdateName(name: string): void;\n  onUpdatePosition(x: number, y: number, z: number): void;\n  onUpdateRotation(x: number, y: number, z: number): void;\n  onUpdateScale(x: number, y: number, z: number): void;\n  onShowAudioSelection(): void;\n}\n\n// UI component for editing properties specific to objects inside a room\nexport default class ObjectEditor extends React.Component<Props> {\n  render(): React.ReactNode {\n    const {\n      object: o,\n      onUpdateName,\n      onUpdatePosition,\n      onUpdateRotation,\n      onUpdateScale\n    } = this.props;\n\n    return (\n      <div>\n        <Group>\n          <label>Object Name</label>\n          <Input\n            type=\"text\"\n            value={o.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Position (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.x.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.y,\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.y.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.z.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  o.position.y,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Euler-Rotation in Degrees (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.x).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.y,\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.y).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.z).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  o.rotation.y,\n                  degToRad(e.currentTarget.valueAsNumber % 360)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Size (width, height, depth)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.x.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  e.currentTarget.valueAsNumber,\n                  o.scale.y,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.y.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  e.currentTarget.valueAsNumber,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.z.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  o.scale.y,\n                  e.currentTarget.valueAsNumber\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Audio</label>\n          <Input\n            type=\"text\"\n            readOnly={true}\n            value={\n              o.audio\n                ? `${o.audio.name} (${Math.ceil(\n                    o.audio.data.byteLength / 1024\n                  )} KiB)`\n                : \"None\"\n            }\n            onClick={this.props.onShowAudioSelection}\n          />\n        </Group>\n      </div>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { Color, Mesh, Raycaster, Vector2, Vector3, WebGLRenderer } from \"three\";\nimport GamepadListener from \"../input/GamepadListener\";\nimport KeyboardListener from \"../input/KeyboardListener\";\nimport GameObject from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport VisualControls from \"./VisualControls\";\n\nenum MouseButton {\n  Primary = 0,\n  Middle = 1,\n  Secondary = 2\n}\n\nconst axes = {\n  x: new Vector3(1, 0, 0),\n  y: new Vector3(0, 1, 0),\n  z: new Vector3(0, 0, 1)\n};\n\nexport default class EditorCanvas {\n  target: HTMLElement | null = null;\n  project: Project;\n\n  rafHandle = 0;\n  previousTimestamp = 0;\n\n  controls: VisualControls;\n\n  renderer = new WebGLRenderer();\n  canvas: HTMLCanvasElement;\n  outlineMesh = new Mesh();\n\n  raycaster = new Raycaster();\n\n  keys = new KeyboardListener(this.renderer.domElement);\n  gamepads = new GamepadListener();\n  isDraggingCamera = false;\n\n  constructor(project: Project) {\n    this.project = project;\n\n    this.renderer.autoClear = false;\n    this.renderer.setClearColor(new Color(0x192a56));\n    this.canvas = this.renderer.domElement;\n    this.canvas.tabIndex = -1; // Make element focusable\n    this.canvas.addEventListener(\"mousedown\", this.onMouseDown);\n    this.canvas.addEventListener(\"mouseup\", this.onMouseUp);\n    this.canvas.addEventListener(\"mousemove\", this.onMouseMove);\n    this.canvas.addEventListener(\"wheel\", this.onWheel);\n    this.canvas.addEventListener(\n      \"contextmenu\",\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      },\n      true\n    );\n\n    // Setup scene\n\n    this.controls = new VisualControls(project);\n\n    // const ph = new PlaneHelper(this.controls.plane, 10, 0x999999);\n    // this.scene.add(ph);\n  }\n\n  attach(target: HTMLElement): void {\n    this.keys.listen();\n    this.gamepads.listen();\n\n    this.target = target;\n    target.appendChild(this.canvas);\n\n    this.resize();\n    window.requestAnimationFrame(this.animate);\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  detach(): void {\n    window.cancelAnimationFrame(this.rafHandle);\n    window.removeEventListener(\"resize\", this.resize);\n\n    if (this.target) {\n      this.target.removeChild(this.canvas);\n      this.target = null;\n    }\n\n    this.keys.stop();\n    this.gamepads.stop();\n  }\n\n  focus(): void {\n    this.canvas.focus();\n  }\n\n  changeProject(project: Project): void {\n    this.project = project;\n    this.controls.project = project;\n    // Ensure the selected project's camera has the correct aspect ratio\n    this.resize();\n  }\n\n  resize = (): void => {\n    if (!this.target) {\n      return;\n    }\n\n    const { offsetWidth, offsetHeight } = this.target;\n\n    this.project.camera.aspect = offsetWidth / offsetHeight;\n    this.project.camera.updateProjectionMatrix();\n\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(offsetWidth, offsetHeight);\n  };\n\n  animate: FrameRequestCallback = t => {\n    this.rafHandle = window.requestAnimationFrame(this.animate);\n\n    const dt = (t - this.previousTimestamp) / 1000;\n    this.previousTimestamp = t;\n    this.update(dt);\n\n    this.renderer.clear();\n    this.renderer.render(this.project.activeRoom, this.project.camera);\n\n    if (this.project.activeObject) {\n      // Draw controls in front of all other objects\n      // https://stackoverflow.com/questions/12666570/how-to-change-the-zorder-of-object-with-threejs/12666937#12666937\n      this.controls.position.copy(this.project.activeObject.position);\n      this.renderer.clearDepth();\n      this.renderer.render(this.controls, this.project.camera);\n    }\n  };\n\n  update(dt: number): void {\n    const { camera } = this.project;\n\n    if (this.keys.isPressed(\"w\")) {\n      camera.translateOnAxis(axes.z, -2 * dt);\n    }\n    if (this.keys.isPressed(\"s\")) {\n      camera.translateOnAxis(axes.z, 2 * dt);\n    }\n    if (this.keys.isPressed(\"a\")) {\n      camera.translateOnAxis(axes.x, -2 * dt);\n    }\n    if (this.keys.isPressed(\"d\")) {\n      camera.translateOnAxis(axes.x, 2 * dt);\n    }\n    if (this.keys.isPressed(\" \")) {\n      camera.position.y += 2 * dt;\n    }\n    if (this.keys.isPressed(\"Shift\")) {\n      camera.position.y -= 2 * dt;\n    }\n\n    if (this.keys.isPressed(\"ArrowLeft\")) {\n      camera.rotateOnWorldAxis(axes.y, dt);\n    }\n    if (this.keys.isPressed(\"ArrowRight\")) {\n      camera.rotateOnWorldAxis(axes.y, -dt);\n    }\n    if (this.keys.isPressed(\"ArrowUp\")) {\n      camera.rotateOnAxis(axes.x, dt);\n    }\n    if (this.keys.isPressed(\"ArrowDown\")) {\n      camera.rotateOnAxis(axes.x, -dt);\n    }\n\n    const gamepadAxes = {\n      x: this.gamepads.getAxis(0),\n      y: this.gamepads.getAxis(1),\n      rX: this.gamepads.getAxis(2),\n      rY: this.gamepads.getAxis(3),\n      b: this.gamepads.getAxis(4)\n    };\n    // console.log(axes);\n    if (gamepadAxes.x) {\n      camera.translateOnAxis(axes.x, 2 * dt * gamepadAxes.x);\n    }\n    if (gamepadAxes.y) {\n      camera.translateOnAxis(axes.z, 2 * dt * gamepadAxes.y);\n    }\n    if (gamepadAxes.b) {\n      camera.translateOnAxis(axes.y, 2 * dt * gamepadAxes.b);\n    }\n    if (gamepadAxes.rX) {\n      camera.rotateOnWorldAxis(axes.y, -dt * gamepadAxes.rX);\n    }\n    if (gamepadAxes.rY) {\n      camera.rotateOnAxis(axes.x, -dt * gamepadAxes.rY);\n    }\n  }\n\n  checkSceneClick(raycaster: Raycaster): boolean {\n    const intersections = raycaster.intersectObjects(\n      this.project.activeRoom.children\n    );\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o instanceof GameObject) {\n        this.project.selectObject(o);\n        return true;\n      }\n    }\n\n    this.project.selectObject(null);\n    return false;\n  }\n\n  updateRaycaster(e: MouseEvent): void {\n    const size = this.renderer.getSize(new Vector2());\n    // Normalize screen coordinates\n    const x = ((e.pageX - this.target!.offsetLeft) / size.x) * 2 - 1;\n    const y = -((e.pageY - this.target!.offsetTop) / size.y) * 2 + 1;\n    // Update raycaster\n    this.raycaster.setFromCamera({ x, y }, this.project.camera);\n  }\n\n  onMouseDown = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary) {\n      this.isDraggingCamera = true;\n      this.canvas.requestPointerLock();\n    }\n\n    if (e.button !== MouseButton.Primary) {\n      return;\n    }\n\n    this.updateRaycaster(e);\n    if (this.controls.onClick(this.raycaster)) {\n      this.canvas.style.cursor = \"grabbing\";\n    } else {\n      this.checkSceneClick(this.raycaster);\n    }\n  };\n\n  onMouseUp = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary && this.isDraggingCamera) {\n      this.isDraggingCamera = false;\n      document.exitPointerLock();\n    }\n    if (\n      e.button === MouseButton.Primary &&\n      this.controls.objectDragDirection !== null\n    ) {\n      this.controls.objectDragDirection = null;\n      if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onMouseMove = (e: MouseEvent): void => {\n    if (this.isDraggingCamera) {\n      if (e.movementX) {\n        this.project.camera.rotateOnWorldAxis(axes.y, -e.movementX / 100);\n      }\n      if (e.movementY) {\n        this.project.camera.rotateOnAxis(axes.x, -e.movementY / 100);\n      }\n    } else {\n      this.updateRaycaster(e);\n      if (this.controls.objectDragDirection !== null) {\n        this.controls.onMove(this.raycaster);\n      } else if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onWheel = (e: WheelEvent): void => {\n    e.preventDefault();\n    // console.log('onWheel', e.deltaX, e.deltaY, e.deltaZ, e.deltaMode);\n    let delta = e.deltaY;\n    if (e.deltaMode === 0) {\n      // More granular zoom for pixel mode\n      delta /= 15;\n    }\n    this.project.camera.translateZ(delta / 10);\n  };\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport { Group, Input, InputGroup, Select } from \"./styled\";\nimport { EditorRoom } from \"./types\";\n\nconst materials = Object.keys(ResonanceAudio.Utils.ROOM_MATERIAL_COEFFICIENTS);\n\ninterface Props {\n  room: EditorRoom;\n  onUpdateName(name: string): void;\n  onUpdateDimensions(dimensions: RoomDimensions): void;\n  onUpdateMaterials(materials: RoomMaterials): void;\n}\n\n// UI component for editing properties specific to a room itself\nexport default class RoomEditor extends React.Component<Props> {\n  selectMaterialHandler(\n    propertyName: keyof RoomMaterials\n  ): React.ChangeEventHandler<HTMLSelectElement> {\n    return e => {\n      const { room, onUpdateMaterials } = this.props;\n      onUpdateMaterials({\n        ...room.materials,\n        [propertyName]: e.currentTarget.value\n      });\n    };\n  }\n\n  render(): React.ReactNode {\n    const { room: r, onUpdateName, onUpdateDimensions } = this.props;\n\n    const materialOptions = materials.map(ce => <option key={ce}>{ce}</option>);\n\n    return (\n      <div>\n        <Group>\n          <label>Room Name</label>\n          <Input\n            type=\"text\"\n            value={r.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Dimensions (width, depth, height)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.width}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  width: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.depth}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  depth: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={2}\n              max={10}\n              value={r.dimensions.height}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  height: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Left wall material</label>\n          <Select\n            value={r.materials.left}\n            onChange={this.selectMaterialHandler(\"left\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Right wall material</label>\n          <Select\n            value={r.materials.right}\n            onChange={this.selectMaterialHandler(\"right\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Front wall material</label>\n          <Select\n            value={r.materials.front}\n            onChange={this.selectMaterialHandler(\"front\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Back wall material</label>\n          <Select\n            value={r.materials.back}\n            onChange={this.selectMaterialHandler(\"back\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Floor material</label>\n          <Select\n            value={r.materials.down}\n            onChange={this.selectMaterialHandler(\"down\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Ceiling material</label>\n          <Select\n            value={r.materials.up}\n            onChange={this.selectMaterialHandler(\"up\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ProjectData } from \"../data/schema\";\nimport { getAllProjects } from \"../data/db\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\n\nconst TableContainer = styled.div`\n  border: 2px solid hsl(210, 29%, 20%);\n  border-radius: 3px;\n  max-height: 400px;\n  min-width: 500px;\n  overflow-y: auto;\n  padding-bottom: 5px;\n`;\n\nconst Table = styled.table`\n  width: 100%;\n`;\n\nconst TableHead = styled.thead`\n  text-align: left;\n`;\n\nconst TableRow = styled.tr`\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 40%);\n  }\n`;\n\nconst ColumnHead = styled.th`\n  padding: 5px 10px;\n`;\n\nconst ColumnData = styled.td`\n  padding: 5px 10px;\n`;\n\ninterface Props {\n  onSelectProject(data: ProjectData): void;\n  onNewProject(): void;\n  onDismiss(): void;\n}\n\ninterface State {\n  projects: ProjectData[];\n}\n\nexport default class ProjectManagerModal extends React.Component<Props, State> {\n  state: State = { projects: [] };\n\n  selectProject(data: ProjectData): void {\n    this.props.onSelectProject(data);\n  }\n\n  async componentDidMount(): Promise<void> {\n    const projects = await getAllProjects();\n    this.setState({ projects: projects.reverse() });\n  }\n\n  render(): React.ReactNode {\n    const { onDismiss } = this.props;\n    const { projects } = this.state;\n\n    return (\n      <Modal title=\"Projects\" onDismiss={onDismiss}>\n        <TableContainer>\n          <Table>\n            <TableHead>\n              <tr>\n                <ColumnHead>ID</ColumnHead>\n                <ColumnHead>Name</ColumnHead>\n                <ColumnHead>Rooms</ColumnHead>\n                <ColumnHead>Last update</ColumnHead>\n              </tr>\n            </TableHead>\n            <tbody>\n              {projects.map(p => (\n                <TableRow key={p.id} onClick={() => this.selectProject(p)}>\n                  <ColumnData>{p.id}</ColumnData>\n                  <ColumnData>{p.name}</ColumnData>\n                  <ColumnData>{p.rooms.length}</ColumnData>\n                  <ColumnData>{p.savedAt.toLocaleString()}</ColumnData>\n                </TableRow>\n              ))}\n            </tbody>\n          </Table>\n        </TableContainer>\n        <ActionGroup>\n          <Action onClick={onDismiss}>New project</Action>\n          <Action onClick={onDismiss}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, RoomMaterials } from \"resonance-audio\";\nimport { Euler, Vector3 } from \"three\";\nimport { saveAsZip } from \"../data/export\";\nimport { openZip } from \"../data/import\";\nimport GameObject from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport { ProjectData } from \"../data/schema\";\nimport RuntimeContainer from \"../runtime/RuntimeContainer\";\nimport AudioLibraryModal from \"./AudioLibraryModal\";\nimport MenuBar from \"./MenuBar\";\nimport ObjectEditor from \"./ObjectEditor\";\nimport EditorCanvas from \"./EditorCanvas\";\nimport RoomEditor from \"./RoomEditor\";\nimport {\n  Container,\n  FocusedLabel,\n  Group,\n  InnerContainer,\n  Main,\n  RoomList,\n  RoomListItem,\n  Sidebar\n} from \"./styled\";\nimport { EditorObject, EditorRoom, AudioEntry } from \"./types\";\nimport ProjectManagerModal from \"./ProjectManagerModal\";\n\nenum ModalType {\n  AudioLibrary,\n  AudioSelection,\n  ProjectManager,\n  ProjectSelection\n}\n\ninterface State {\n  rooms: EditorRoom[];\n  selectedRoomId: number;\n  selectedObject: EditorObject | null;\n  modal: ModalType | null;\n  isRunning: boolean;\n}\n\nexport default class Editor extends React.Component<{}, State> {\n  project: Project = new Project();\n  projectCanvas = new EditorCanvas(this.project);\n\n  state: State = {\n    rooms: this.project.rooms.map(r => ({\n      id: r.id,\n      name: r.name,\n      dimensions: r.dimensions,\n      materials: r.materials\n    })),\n    selectedRoomId: 0,\n    selectedObject: null,\n    modal: null,\n    isRunning: false\n  };\n  mainRef = React.createRef<HTMLElement>();\n\n  constructor(props: {}) {\n    super(props);\n\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n  }\n\n  // Menubar functionality\n\n  newProject = () => {\n    this.project.close();\n    this.project = new Project({\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    });\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null,\n      modal: null\n    });\n  };\n\n  showProjectSelection = async () => {\n    this.setState({\n      modal: ModalType.ProjectSelection\n    });\n  };\n\n  saveProject = async () => {\n    if (this.project.id == null) {\n      const name = prompt(\"Project name:\", this.project.name);\n      if (!name) {\n        return;\n      }\n      this.project.name = name;\n    }\n    await this.project.save();\n  };\n\n  importProject = async () => {\n    this.project.close();\n    this.project = await openZip();\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null\n    });\n  };\n\n  exportProject = () => {\n    saveAsZip(this.project);\n  };\n\n  addObject = () => {\n    this.project.activeRoom.addObject();\n  };\n\n  deleteObject = () => {\n    if (this.project.activeObject) {\n      this.project.activeRoom.remove(this.project.activeObject);\n      this.project.activeObject = null;\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  addRoom = () => {\n    const room = this.project.addRoom();\n    this.setState(s => ({\n      rooms: [\n        ...s.rooms,\n        {\n          id: room.id,\n          name: room.name,\n          dimensions: room.dimensions,\n          materials: room.materials\n        }\n      ],\n      selectedRoomId: s.rooms.length\n    }));\n  };\n\n  deleteRoom = () => {\n    // Ensure the first room cannot be deleted\n    if (this.state.selectedRoomId > 0) {\n      this.project.rooms.splice(this.state.selectedRoomId, 1);\n      this.setState(s => ({\n        rooms: [\n          ...s.rooms.slice(0, s.selectedRoomId),\n          ...s.rooms.slice(s.selectedRoomId + 1)\n        ],\n        selectedRoomId: 0\n      }));\n    }\n  };\n\n  showAudioLibrary = () => {\n    this.setState({ modal: ModalType.AudioLibrary });\n  };\n\n  // Room specific editor functionality\n\n  selectRoom(id: number): void {\n    this.project.selectRoom(this.project.rooms[id]);\n    this.setState({ selectedRoomId: id, selectedObject: null });\n  }\n\n  updateRoomName = (name: string) => {\n    this.project.activeRoom.name = name;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          name\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomDimensions = (dimensions: RoomDimensions) => {\n    this.project.activeRoom.dimensions = dimensions;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          dimensions\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomMaterials = (materials: RoomMaterials) => {\n    this.project.activeRoom.materials = materials;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          materials\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  // Object editor functionality\n\n  updateName = (name: string) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.name = name;\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        name\n      }\n    }));\n  };\n\n  updateScale = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.scale.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        scale: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updatePosition = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.position.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updateRotation = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.rotation.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        rotation: new Euler(x, y, z)\n      }\n    }));\n  };\n\n  showAudioSelection = () => {\n    this.setState({\n      modal: ModalType.AudioSelection\n    });\n  };\n\n  // Modal events\n\n  dismissModal = () => {\n    this.setState({ modal: null });\n  };\n\n  selectAudio = (audio: AudioEntry) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.loadAudio(audio.id);\n      this.setState(({ selectedObject }) => ({\n        selectedObject: selectedObject && {\n          ...selectedObject,\n          audio\n        },\n        modal: null\n      }));\n    }\n  };\n\n  loadProject = (data: ProjectData) => {\n    this.project.close();\n    this.project = new Project().fromData(data, data.id);\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null,\n      modal: null\n    });\n  };\n\n  runProject = () => {\n    this.projectCanvas.detach();\n    this.setState({ isRunning: true });\n  };\n\n  // Project canvas events\n\n  onSelectObject = (o: GameObject | null) => {\n    if (o) {\n      this.setState({\n        selectedObject: {\n          id: o.id,\n          name: o.name,\n          position: o.position,\n          scale: o.scale,\n          rotation: o.rotation,\n          audio: o.audioFile && {\n            ...o.audioFile,\n            id: o.audioId!\n          }\n        }\n      });\n    } else {\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  onTranslateObject = (p: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: p\n      }\n    }));\n  };\n\n  onScaleObject = (s: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        size: {\n          width: s.x,\n          height: s.y,\n          depth: s.z\n        }\n      }\n    }));\n  };\n\n  // React component lifecycle methods\n\n  componentDidMount(): void {\n    if (this.mainRef.current) {\n      this.projectCanvas.attach(this.mainRef.current);\n      this.projectCanvas.focus();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.projectCanvas.detach();\n  }\n\n  render(): React.ReactNode {\n    const { modal, isRunning } = this.state;\n    const o = this.state.selectedObject;\n\n    if (isRunning) {\n      return <RuntimeContainer project={this.project} />;\n    }\n\n    return (\n      <Container>\n        {(modal === ModalType.AudioLibrary ||\n          modal === ModalType.AudioSelection) && (\n          <AudioLibraryModal\n            audioLibrary={this.project.audioLibrary}\n            onDismiss={this.dismissModal}\n            onSelect={\n              modal === ModalType.AudioSelection ? this.selectAudio : undefined\n            }\n          />\n        )}\n        {modal === ModalType.ProjectSelection && (\n          <ProjectManagerModal\n            onSelectProject={this.loadProject}\n            onNewProject={this.newProject}\n            onDismiss={this.dismissModal}\n          />\n        )}\n        <MenuBar\n          onNewProject={this.newProject}\n          onLoadProject={this.showProjectSelection}\n          onSaveProject={this.saveProject}\n          onImportProject={this.importProject}\n          onExportProject={this.exportProject}\n          onAddObject={this.addObject}\n          onDeleteObject={this.deleteObject}\n          onAddRoom={this.addRoom}\n          onDeleteRoom={this.deleteRoom}\n          onShowAudioLibrary={this.showAudioLibrary}\n          onRunProject={this.runProject}\n        />\n        <InnerContainer>\n          <Sidebar>\n            <Group>\n              <label>Rooms</label>\n              <RoomList>\n                {this.state.rooms.map((r, i) => (\n                  <RoomListItem\n                    key={r.id}\n                    onClick={() => this.selectRoom(i)}\n                    active={i === this.state.selectedRoomId}\n                  >\n                    {r.name || \"Anonymous Room\"}\n                  </RoomListItem>\n                ))}\n              </RoomList>\n            </Group>\n            {!o && (\n              <RoomEditor\n                room={this.state.rooms[this.state.selectedRoomId]}\n                onUpdateName={this.updateRoomName}\n                onUpdateDimensions={this.updateRoomDimensions}\n                onUpdateMaterials={this.updateRoomMaterials}\n              />\n            )}\n            {o && (\n              <ObjectEditor\n                object={o}\n                onUpdateName={this.updateName}\n                onUpdatePosition={this.updatePosition}\n                onUpdateRotation={this.updateRotation}\n                onUpdateScale={this.updateScale}\n                onShowAudioSelection={this.showAudioSelection}\n              />\n            )}\n          </Sidebar>\n          <Main ref={this.mainRef}>\n            <FocusedLabel>Focused</FocusedLabel>\n          </Main>\n        </InnerContainer>\n      </Container>\n    );\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See http://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit http://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nexport function unregister(): void {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"normalize.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Editor from \"./editor/Editor\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nconst global = window as any;\n// Safari does not yet support the Web Audio API without a prefix\nif (!global.AudioContext && global.webkitAudioContext) {\n  global.AudioContext = global.webkitAudioContext;\n}\n\nReactDOM.render(<Editor />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}