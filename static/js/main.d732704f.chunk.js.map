{"version":3,"sources":["data/export.ts","project/AudioLibrary.ts","audio/ResListener.ts","audio/ResAudio.ts","project/GameObject.ts","project/Room.ts","project/Project.ts","utils/files.ts","data/import.ts","editor/Modal.tsx","editor/AudioFileModal.tsx","editor/AudioLibraryModal.tsx","editor/MenuBar.tsx","utils/math.ts","editor/styled.ts","editor/VisualControls.ts","editor/ObjectEditor.tsx","input/GamepadListener.ts","input/KeyboardListener.ts","editor/ProjectCanvas.ts","editor/Editor.tsx","editor/RoomEditor.tsx","serviceWorker.ts","index.tsx"],"names":["createZip","project","metadata","toData","zip","Zip","file","JSON","stringify","audioLibrary","audioFolder","folder","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","entries","Symbol","iterator","next","done","_ref3","value","_ref2","Object","slicedToArray","key","push","id","name","type","toString","data","err","return","generateAsync","saveAsZip","_ref4","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","sent","saveAs","stop","this","_x","apply","arguments","AudioLibrary","nextId","entry","set","Map","ResListener","audioScene","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","force","get","prototype","setListenerFromMatrix","matrixWorld","Object3D","ResAudio","audioContext","audioSource","source","createBufferSource","createSource","position","Float32Array","forward","connect","input","setFromMatrix","buffer","disconnect","loop","start","cubeGeometry","BoxGeometry","cubeMaterial","MeshLambertMaterial","GameObject","audioId","audioFile","audio","add","decodeAudioData","slice","setBuffer","setLoop","play","toArray","scale","rotation","loadAudio","Mesh","wallGeometry","wallMaterial","Room","length","dimensions","width","depth","height","materials","ResonanceAudio","Utils","DEFAULT_ROOM_MATERIALS","roomDimensions","roomMaterials","grid","wallNorth","wallEast","wallSouth","wallWest","camera","PerspectiveCamera","AudioContext","listener","ambientLight","AmbientLight","light","PointLight","lookAt","gridSize","Math","max","GridHelper","updateWalls","z","y","Vector3","output","destination","setRoomProperties","remove","object","_this$roomDimensions","objects","children","filter","c","map","go","_this2","gameObjects","o","fromData","toConsumableArray","Scene","noop","defaultEvents","onSelect","onScale","onTranslate","Project","events","rooms","audioType","activeRoom","activeObject","outlineMesh","firstRoom","addObject","material","MeshBasicMaterial","color","side","BackSide","multiplyScalar","room","selectRoom","suspend","resume","aspect","updateProjectionMatrix","selectObject","geometry","r","i","openFileDialog","options","Promise","resolve","document","createElement","accept","onchange","files","click","readFileAsArrayBuffer","reader","FileReader","onload","result","onerror","console","error","readAsArrayBuffer","loadZip","_ref","blob","loadAsync","t0","async","t1","parse","t2","t3","t4","finish","abrupt","openZip","_callee2","_context2","Backdrop","styled","div","_templateObject","Container","_templateObject2","TitleBar","_templateObject3","Content","_templateObject4","ActionGroup","_templateObject5","Action","button","_templateObject6","Modal","onBackdropClick","e","currentTarget","target","props","onDismiss","react_default","onClick","title","React","Component","AudioFileModal","audioEntry","Modal_Modal","ceil","byteLength","onDelete","onExport","onCancel","AudioList","AudioLibraryModal_templateObject","AudioItem","AudioLibraryModal_templateObject2","AudioLibraryModal","previewAudio","Audio","state","selectedEntry","openAudioFileDialog","setState","concat","objectSpread","stopPreview","pause","URL","revokeObjectURL","src","dismiss","unselectEntry","deleteAudio","delete","exportAudio","_ref5","Blob","createObjectURL","_this$state","AudioFileModal_AudioFileModal","selectEntry","onMouseEnter","previewEntry","onMouseLeave","Array","from","sort","b","_ref6","_ref7","MenuType","MenuBar_templateObject","MenubarItem","MenuBar_templateObject2","isActive","css","MenuBar_templateObject3","Menu","MenuBar_templateObject4","MenuItem","MenuBar_templateObject5","MenuDivider","MenuBar_templateObject6","MenuBar","activeMenu","menuType","MenuBar_Container","tabIndex","onBlur","closeMenu","FileMenu","toggleMenu","hidden","onNewProject","onImportProject","onExportProject","EditMenu","onAddObject","onDeleteObject","onAddRoom","onDeleteRoom","ViewMenu","onShowAudioLibrary","HelpMenu","window","open","radToDeg","rad","PI","degToRad","deg","roundToPrecision","precision","round","ObjectDragDirection","styled_templateObject","InnerContainer","styled_templateObject2","Sidebar","aside","styled_templateObject3","FocusedLabel","styled_templateObject4","Main","main","styled_templateObject5","Group","styled_templateObject6","Input","_templateObject7","Select","withComponent","_templateObject8","InputGroup","_templateObject9","RoomList","ol","_templateObject10","RoomListItem","li","_templateObject11","active","_templateObject12","ObjectEditor","_this$props","onUpdateName","onUpdatePosition","onUpdateRotation","onUpdateScale","onChange","step","x","toFixed","valueAsNumber","min","readOnly","onShowAudioSelection","GamepadListener","onGamepadConnected","log","gamepad","onGamepadDisconnected","addEventListener","removeEventListener","index","gamepads","navigator","getGamepads","mapping","axis","axes","abs","v1","buttons","KeyboardListener","keysPressed","Set","lastKeyUp","reset","clear","onKeyDown","preventDefault","timeStamp","onKeyUp","shiftKey","has","MouseButton","VisualControls","objectDragDirection","isScaling","dragOffset","lastPoint","plane","Plane","axisX","axisY","axisZ","scaleX","scaleY","scaleZ","planeYZ","planeXZ","planeXY","materialConfig","transparent","opacity","DoubleSide","axisGeometry","userData","direction","AxisX","AxisY","AxisZ","scaleGeometry","SphereGeometry","isScale","planeGeometry","PlaneGeometry","PlaneYZ","PlaneXZ","PlaneXY","raycaster","copy","intersections","intersectObjects","intersection","hasOwnProperty","point","sub","getControlFromRaycaster","onMove","ray","p","altPlane","distanceToPoint","origin","intersectPlane","ModalType","ProjectCanvas","rafHandle","previousTimestamp","controls","renderer","WebGLRenderer","canvas","Raycaster","keys","domElement","isDraggingCamera","resize","_this$target","offsetWidth","offsetHeight","setPixelRatio","devicePixelRatio","setSize","animate","t","requestAnimationFrame","dt","update","render","clearDepth","onMouseDown","Secondary","requestPointerLock","Primary","updateRaycaster","style","cursor","checkSceneClick","onMouseUp","exitPointerLock","onMouseMove","movementX","rotateOnWorldAxis","movementY","rotateOnAxis","onWheel","delta","deltaY","deltaMode","translateZ","autoClear","setClearColor","Color","stopPropagation","listen","appendChild","cancelAnimationFrame","removeChild","focus","isPressed","translateOnAxis","gamepadAxes","getAxis","size","getSize","Vector2","pageX","offsetLeft","pageY","offsetTop","setFromCamera","ROOM_MATERIAL_COEFFICIENTS","RoomEditor","propertyName","onUpdateMaterials","defineProperty","_this$props2","onUpdateDimensions","materialOptions","ce","left","selectMaterialHandler","right","front","back","down","up","Editor","projectCanvas","selectedRoomId","selectedObject","modal","mainRef","createRef","newProject","onSelectObject","onTranslateObject","onScaleObject","changeProject","importProject","exportProject","deleteObject","addRoom","s","deleteRoom","splice","showAudioLibrary","updateRoomName","updateRoomDimensions","updateRoomMaterials","updateName","updateScale","updatePosition","updateRotation","_ref8","Euler","showAudioSelection","AudioSelection","dismissModal","selectAudio","_ref9","_ref10","_ref11","current","attach","detach","styled_Container","AudioLibraryModal_AudioLibraryModal","MenuBar_MenuBar","RoomEditor_RoomEditor","ObjectEditor_ObjectEditor","ref","Boolean","location","hostname","match","global","webkitAudioContext","ReactDOM","Editor_Editor","getElementById","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.d732704f.chunk.js","sourcesContent":["/**\n * @author Niklas Korz\n * This module defines functions for exporting and saving projects to the local filesystem.\n */\nimport { saveAs } from \"file-saver\";\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\n\n/**\n * Serializes the given project as JSON and compresses it along its audio\n * data in a ZIP file. The audio data is saved as one file per audio in a\n * dedicated subdirectory \"audio\".\n */\nexport const createZip = (project: Project): Promise<Blob> => {\n  const metadata = project.toData();\n  const zip = new Zip();\n  zip.file(\"metadata.json\", JSON.stringify(metadata));\n\n  const audioLibrary: Array<{ id: number; name: string; type: string }> = [];\n  const audioFolder = zip.folder(\"audio\");\n  for (const [key, value] of project.audioLibrary.entries()) {\n    audioLibrary.push({ id: key, name: value.name, type: value.type });\n    audioFolder.file(key.toString(), value.data);\n  }\n  zip.file(\"audioLibrary.json\", JSON.stringify(audioLibrary));\n\n  return zip.generateAsync({ type: \"blob\" });\n};\n\n/**\n * Saves the given project, including its audio data, as a zip file on the\n * user's local filesystem\n */\nexport const saveAsZip = async (project: Project): Promise<void> => {\n  const data = await createZip(project);\n  saveAs(data, \"audio3d-project.zip\");\n};\n","/**\n * @author Niklas Korz\n */\n\nexport interface AudioFile {\n  name: string;\n  type: string;\n  data: ArrayBuffer;\n}\n\nexport default class AudioLibrary extends Map<number, AudioFile> {\n  nextId = 0;\n\n  add(entry: AudioFile): number {\n    this.set(this.nextId, entry);\n    return this.nextId++;\n  }\n}\n","/**\n * @author Leon Erath / https://leonerath.de/\n */\n\nimport { ResonanceAudio } from \"resonance-audio\";\nimport { Object3D } from \"three\";\n\nexport default class ResListener extends Object3D {\n  audioScene: ResonanceAudio;\n\n  constructor(audioScene: ResonanceAudio) {\n    super();\n    this.audioScene = audioScene;\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n    this.audioScene.setListenerFromMatrix(this.matrixWorld);\n  }\n}\n","/**\n * @author Leon Erath / https://leonerath.de/\n */\n\nimport { ResonanceAudio } from \"resonance-audio\";\nimport { Object3D } from \"three\";\nimport AudioNode from \"./AudioNode\";\n\n/**\n * Class extends Object3D in order to work with the SceneCanvas.\n * The Idea ist to override the positionChange-Methods and change the ResonanceAudio\n * accordingly.\n */\n\nexport default class ResAudio extends Object3D implements AudioNode {\n  audioContext: AudioContext;\n  audioSource: AudioBufferSourceNode;\n  source: ResonanceAudio.Source;\n\n  constructor(audioScene: ResonanceAudio, audioContext: AudioContext) {\n    super();\n    this.audioContext = audioContext;\n    this.audioSource = audioContext.createBufferSource();\n    this.source = audioScene.createSource({\n      position: new Float32Array([0, 1, 3]),\n      forward: new Float32Array([1, 0, 0])\n    });\n    this.audioSource.connect(this.source.input);\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n    this.source.setFromMatrix(this.matrixWorld);\n  }\n\n  setBuffer(buffer: AudioBuffer): void {\n    if (this.audioSource.buffer) {\n      // Chrome does not allow \"resetting\" the buffer and throws an error\n      // with this message: Cannot set buffer to non-null after it has been already been set to a non-null buffer\n      // To circumvent this, we have to create a new buffer source\n      this.audioSource.stop();\n      this.audioSource.disconnect();\n      this.audioSource = this.audioContext.createBufferSource();\n      this.audioSource.connect(this.source.input);\n    }\n    this.audioSource.buffer = buffer;\n  }\n\n  setLoop(loop: boolean): void {\n    this.audioSource.loop = loop;\n  }\n\n  play(): void {\n    this.audioSource.start();\n  }\n\n  stop(): void {\n    if (this.audioSource.buffer) {\n      this.audioSource.stop();\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { BoxGeometry, Mesh, MeshLambertMaterial } from \"three\";\nimport { ResonanceAudio } from \"resonance-audio\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport ResListener from \"../audio/ResListener\";\nimport ResAudio from \"../audio/ResAudio\";\nimport AudioLibrary, { AudioFile } from \"./AudioLibrary\";\n\nconst cubeGeometry = new BoxGeometry(1, 1, 1);\nconst cubeMaterial = new MeshLambertMaterial();\n\nexport default class GameObject extends Mesh implements Serializable {\n  audioLibrary: AudioLibrary;\n  audioId: number | null = null;\n  audioFile: AudioFile | null = null;\n\n  audioContext: AudioContext;\n  audioScene: ResonanceAudio;\n  audio: ResAudio;\n\n  constructor(\n    audioLibrary: AudioLibrary,\n    audioContext: AudioContext,\n    audioScene: ResonanceAudio\n  ) {\n    super(cubeGeometry, cubeMaterial);\n    this.audioLibrary = audioLibrary;\n    this.audioContext = audioContext;\n    this.audioScene = audioScene;\n    this.audio = new ResAudio(audioScene, audioContext);\n    this.add(this.audio);\n  }\n\n  async loadAudio(id: number): Promise<void> {\n    this.audioId = id;\n    this.audioFile = this.audioLibrary.get(id) || null;\n    if (this.audioFile) {\n      const buffer = await this.audioContext.decodeAudioData(\n        this.audioFile.data.slice(0)\n      );\n      this.audio.stop();\n      this.audio.setBuffer(buffer);\n      this.audio.setLoop(true);\n      this.audio.play();\n    }\n  }\n\n  toData(): SerializedData {\n    return {\n      name: this.name,\n      position: this.position.toArray(),\n      scale: this.scale.toArray(),\n      rotation: this.rotation.toArray(),\n      audioId: this.audioId\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.position.set(data.position[0], data.position[1], data.position[2]);\n    this.scale.set(data.scale[0], data.scale[1], data.scale[2]);\n    this.rotation.set(data.rotation[0], data.rotation[1], data.rotation[2]);\n\n    if (data.audioId != null) {\n      this.loadAudio(data.audioId);\n    }\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport {\n  AmbientLight,\n  BoxGeometry,\n  GridHelper,\n  Mesh,\n  MeshLambertMaterial,\n  Object3D,\n  PerspectiveCamera,\n  PointLight,\n  Scene,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport ResListener from \"../audio/ResListener\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\n\nconst wallGeometry = new BoxGeometry(1, 1, 1);\nconst wallMaterial = new MeshLambertMaterial();\n\n// A \"room\" is analog to levels of a game.\n// The user will only hear sounds that are part of the current room.\n// Also, this abstraction is necessary to support Resonance Audio as one of many\n// spatial audio implementations.\nexport default class Room extends Scene implements Serializable {\n  audioLibrary: AudioLibrary;\n  roomDimensions: RoomDimensions;\n  roomMaterials: RoomMaterials;\n\n  grid: GridHelper;\n  wallNorth = new Mesh(wallGeometry, wallMaterial);\n  wallEast = new Mesh(wallGeometry, wallMaterial);\n  wallSouth = new Mesh(wallGeometry, wallMaterial);\n  wallWest = new Mesh(wallGeometry, wallMaterial);\n  camera = new PerspectiveCamera(60, 1, 0.1, 1000);\n\n  audioContext = new AudioContext();\n  audioScene: ResonanceAudio;\n  listener: ResListener;\n\n  get dimensions(): RoomDimensions {\n    return this.roomDimensions;\n  }\n\n  set dimensions(dimensions: RoomDimensions) {\n    this.roomDimensions = dimensions;\n\n    this.audioScene.setRoomProperties(dimensions, this.roomMaterials);\n\n    this.remove(this.grid);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n\n    this.add(this.grid);\n\n    this.updateWalls();\n  }\n\n  get materials(): RoomMaterials {\n    return this.roomMaterials;\n  }\n\n  set materials(materials: RoomMaterials) {\n    this.roomMaterials = materials;\n    this.audioScene.setRoomProperties(this.roomDimensions, materials);\n  }\n\n  constructor(\n    audioLibrary: AudioLibrary,\n    name: string = \"\",\n    dimensions: RoomDimensions = { width: 15, depth: 15, height: 3 },\n    materials: RoomMaterials = ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS\n  ) {\n    super();\n\n    this.audioLibrary = audioLibrary;\n    this.name = name;\n    this.roomDimensions = dimensions;\n    this.roomMaterials = materials;\n\n    const ambientLight = new AmbientLight(0xffffff, 0.5);\n    this.add(ambientLight);\n    const light = new PointLight(0xffffff, 0.5);\n    light.position.set(5, 5, 0);\n    light.lookAt(0, 0, 0);\n    this.add(light);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n    this.add(this.grid);\n\n    this.updateWalls();\n    this.add(this.wallNorth);\n    this.add(this.wallEast);\n    this.add(this.wallSouth);\n    this.add(this.wallWest);\n\n    this.camera.position.z = 3;\n    this.camera.position.y = 3;\n    this.camera.lookAt(new Vector3(0, 0.5, 0));\n\n    // Audio setup\n\n    this.audioScene = new ResonanceAudio(this.audioContext, {\n      dimensions,\n      materials\n    });\n    this.listener = new ResListener(this.audioScene);\n\n    this.audioScene.output.connect(this.audioContext.destination);\n    this.camera.add(this.listener);\n  }\n\n  addObject(): GameObject {\n    const object = new GameObject(\n      this.audioLibrary,\n      this.audioContext,\n      this.audioScene\n    );\n    object.position.y += 0.5;\n    object.name = \"New object\";\n\n    this.add(object);\n    return object;\n  }\n\n  updateWalls(): void {\n    const { width, depth, height } = this.roomDimensions;\n\n    this.wallNorth.scale.set(width, height, 0.25);\n    this.wallEast.scale.set(0.25, height, depth);\n    this.wallSouth.scale.set(width, height, 0.25);\n    this.wallWest.scale.set(0.25, height, depth);\n\n    this.wallNorth.position.set(0, height / 2, depth / 2);\n    this.wallEast.position.set(width / 2, height / 2, 0);\n    this.wallSouth.position.set(0, height / 2, -depth / 2);\n    this.wallWest.position.set(-width / 2, height / 2, 0);\n  }\n\n  toData(): SerializedData {\n    return {\n      name: this.name,\n      dimensions: this.dimensions,\n      materials: this.materials,\n      objects: this.children\n        .filter((c: Object3D): c is GameObject => c instanceof GameObject)\n        .map(go => go.toData())\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.dimensions = data.dimensions;\n    if (data.materials) {\n      this.materials = data.materials;\n    }\n\n    const gameObjects = data.objects.map((o: SerializedData) =>\n      new GameObject(\n        this.audioLibrary,\n        this.audioContext,\n        this.audioScene\n      ).fromData(o)\n    );\n    this.add(...gameObjects);\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport {\n  BackSide,\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\nimport Room from \"./Room\";\n\nexport interface ProjectEvents {\n  onSelect(object: GameObject | null): void;\n  onTranslate(position: Vector3): void;\n  onScale(scale: Vector3): void;\n}\n\nconst noop = (): void => {\n  /* noop */\n};\nconst defaultEvents: ProjectEvents = {\n  onSelect: noop,\n  onScale: noop,\n  onTranslate: noop\n};\n\nexport default class Project implements Serializable {\n  events: ProjectEvents;\n  audioLibrary = new AudioLibrary();\n\n  id: number | null = null;\n  name = \"New project\";\n\n  rooms: Room[] = [];\n  audioType: number = 1;\n\n  activeRoom: Room;\n  activeObject: GameObject | null = null;\n\n  outlineMesh = new Mesh();\n\n  get camera(): PerspectiveCamera {\n    return this.activeRoom.camera;\n  }\n\n  constructor(events: ProjectEvents = defaultEvents) {\n    this.events = events;\n\n    const firstRoom = new Room(this.audioLibrary, \"First room\");\n    firstRoom.addObject();\n    this.rooms.push(firstRoom);\n    this.activeRoom = firstRoom;\n\n    this.outlineMesh.material = new MeshBasicMaterial({\n      color: 0xffffff,\n      side: BackSide\n    });\n    this.outlineMesh.scale.multiplyScalar(1.05);\n  }\n\n  addRoom(): Room {\n    const room = new Room(this.audioLibrary, \"New room\");\n    room.addObject();\n    this.rooms.push(room);\n    this.selectRoom(room);\n    return room;\n  }\n\n  selectRoom(room: Room): void {\n    this.activeRoom.audioContext.suspend();\n    room.audioContext.resume();\n    room.camera.aspect = this.activeRoom.camera.aspect;\n    room.camera.updateProjectionMatrix();\n    this.activeRoom = room;\n    this.selectObject(null);\n  }\n\n  selectObject(o: GameObject | null): void {\n    if (this.activeObject) {\n      this.activeObject.remove(this.outlineMesh);\n    }\n\n    if (o) {\n      this.outlineMesh.geometry = o.geometry;\n      o.add(this.outlineMesh);\n    }\n\n    this.activeObject = o;\n    this.events.onSelect(o);\n  }\n\n  // Serialize instance to a plain JavaScript object\n  toData(): SerializedData {\n    return {\n      name: this.name,\n      rooms: this.rooms.map(r => r.toData())\n    };\n  }\n\n  // Load data from a plain JavaScript object into this instance\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.rooms = data.rooms.map((r: SerializedData) =>\n      new Room(this.audioLibrary).fromData(r)\n    );\n    this.activeRoom = this.rooms[0];\n\n    // Disable audio in all inactive rooms\n    for (let i = 1; i < this.rooms.length; i++) {\n      this.rooms[i].audioContext.suspend();\n    }\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\n// Options for configuring the file modal\nexport interface OpenFileDialogOptions {\n  accept?: string;\n}\n\n/**\n * Opens a file dialog and lets the user select a file\n * @returns The selected file\n */\nexport const openFileDialog = (\n  options: OpenFileDialogOptions = {}\n): Promise<File> =>\n  new Promise(resolve => {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    if (options.accept) {\n      input.accept = options.accept;\n    }\n    input.onchange = () => {\n      if (input.files) {\n        resolve(input.files[0]);\n      }\n    };\n    input.click();\n  });\n\nexport const readFileAsArrayBuffer = (file: File): Promise<ArrayBuffer> =>\n  new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      if (reader.result) {\n        resolve(reader.result as ArrayBuffer);\n      }\n    };\n    reader.onerror = () => {\n      console.error(\"Error:\", reader.error);\n    };\n    reader.readAsArrayBuffer(file);\n  });\n","/**\n * @author Niklas Korz\n * This module defines functions for loading and importing projects from the local filesystem.\n */\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\nimport { openFileDialog } from \"../utils/files\";\n\n/**\n * Decompresses the given zip file, loads the included JSON metadata and reads all\n * included audio files as binary array buffers.\n * @param blob The blob to read from, usually a file returned by a FileReader instance.\n * @returns The project recreated from the data found in the zip\n */\nexport const loadZip = async (blob: Blob): Promise<Project> => {\n  const zip = await Zip.loadAsync(blob);\n  const metadata = JSON.parse(await zip.file(\"metadata.json\").async(\"text\"));\n\n  const audioLibrary = JSON.parse(\n    await zip.file(\"audioLibrary.json\").async(\"text\")\n  );\n  const audioFolder = zip.folder(\"audio\");\n  const project = new Project();\n  for (const { id, name, type } of audioLibrary) {\n    const data = await audioFolder.file(id.toString()).async(\"arraybuffer\");\n    project.audioLibrary.set(id, { name, type, data });\n\n    if (id >= project.audioLibrary.nextId) {\n      project.audioLibrary.nextId = id + 1;\n    }\n  }\n\n  project.fromData(metadata);\n  return project;\n};\n\n/**\n * Opens a file dialog and lets the user select a zip file that will be parsed\n * and loaded as a project.\n * @returns The project found in the zip\n */\nexport const openZip = async (): Promise<Project> => {\n  const file = await openFileDialog({ accept: \"application/zip\" });\n  return await loadZip(file);\n};\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nconst Backdrop = styled.div`\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 2;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Container = styled.div`\n  border-radius: 5px;\n  overflow: hidden;\n  max-width: 500px;\n  color: #fff;\n  background: hsl(210, 29%, 29%);\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n`;\n\nconst TitleBar = styled.div`\n  padding: 10px 15px;\n  background: hsl(210, 29%, 15%);\n`;\n\nconst Content = styled.div`\n  padding: 10px 15px;\n`;\n\nexport const ActionGroup = styled.div`\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n`;\n\nexport const Action = styled.button`\n  display: block;\n  appearance: none;\n  border: none;\n  background: hsl(210, 29%, 20%);\n  color: #fff;\n  cursor: pointer;\n  border-radius: 3px;\n  padding: 8px 12px;\n  margin-left: 10px;\n  font-size: 0.9em;\n\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\ninterface Props {\n  title: string;\n  onDismiss?(): void;\n}\n\nexport default class Modal extends React.Component<Props> {\n  onBackdropClick: React.MouseEventHandler = e => {\n    if (e.currentTarget === e.target && this.props.onDismiss) {\n      this.props.onDismiss();\n    }\n  };\n\n  render(): React.ReactNode {\n    return (\n      <Backdrop onClick={this.onBackdropClick}>\n        <Container>\n          <TitleBar>{this.props.title}</TitleBar>\n          <Content>{this.props.children}</Content>\n        </Container>\n      </Backdrop>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\ninterface Props {\n  audioEntry: AudioEntry;\n  onDelete(audioEntry: AudioEntry): void;\n  onExport(audioEntry: AudioEntry): void;\n  onDismiss(): void;\n  onCancel(): void;\n}\n\nexport default class AudioFileModal extends React.Component<Props> {\n  render(): React.ReactNode {\n    const { audioEntry } = this.props;\n    return (\n      <Modal title=\"Audio File\" onDismiss={this.props.onDismiss}>\n        <p>\n          <b>Name:</b> {audioEntry.name}\n        </p>\n        <p>\n          <b>Type:</b> {audioEntry.type}\n        </p>\n        <p>\n          <b>Size:</b> {Math.ceil(audioEntry.data.byteLength / 1024)} KiB\n        </p>\n        <ActionGroup>\n          <Action onClick={() => this.props.onDelete(audioEntry)}>\n            Delete\n          </Action>\n          <Action onClick={() => this.props.onExport(audioEntry)}>\n            Export\n          </Action>\n          <Action onClick={this.props.onCancel}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { saveAs } from \"file-saver\";\nimport styled from \"styled-components\";\nimport AudioLibrary from \"../project/AudioLibrary\";\nimport { openFileDialog, readFileAsArrayBuffer } from \"../utils/files\";\nimport AudioFileModal from \"./AudioFileModal\";\nimport Modal, { Action, ActionGroup } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\nconst AudioList = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  margin: 0 -5px;\n`;\n\nconst AudioItem = styled.div`\n  flex: 1 1 150px;\n  margin: 5px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  cursor: pointer;\n  background: hsl(210, 29%, 20%);\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n`;\n\ninterface Props {\n  audioLibrary: AudioLibrary;\n  onDismiss(): void;\n  onSelect?(entry: AudioEntry): void;\n}\n\ninterface State {\n  entries: AudioEntry[];\n  selectedEntry: AudioEntry | null;\n}\n\nexport default class AudioLibraryModal extends React.Component<Props, State> {\n  static getDerivedStateFromProps(props: Props): Partial<State> {\n    return {\n      entries: Array.from(props.audioLibrary.entries())\n        .sort((a, b) => a[0] - b[0])\n        .map(([id, audioFile]) => ({\n          id,\n          ...audioFile\n        }))\n    };\n  }\n\n  previewAudio = new Audio();\n  state: State = { entries: [], selectedEntry: null };\n\n  openAudioFileDialog = async () => {\n    const file = await openFileDialog({ accept: \"audio/*\" });\n    const data = await readFileAsArrayBuffer(file);\n    const audioFile = { name: file.name, type: file.type, data };\n    const id = this.props.audioLibrary.add(audioFile);\n    this.setState(({ entries }) => ({\n      entries: [\n        ...entries,\n        {\n          id,\n          ...audioFile\n        }\n      ]\n    }));\n  };\n\n  previewEntry(entry: AudioEntry): void {\n    this.previewAudio.src = URL.createObjectURL(new Blob([entry.data]));\n    this.previewAudio.loop = true;\n    this.previewAudio.play();\n  }\n\n  stopPreview = () => {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  };\n\n  dismiss = () => {\n    this.setState({ selectedEntry: null });\n    this.props.onDismiss();\n  };\n\n  selectEntry(audioEntry: AudioEntry): void {\n    if (this.props.onSelect) {\n      this.props.onSelect(audioEntry);\n    } else {\n      this.setState({ selectedEntry: audioEntry });\n    }\n  }\n\n  unselectEntry = () => {\n    this.setState({ selectedEntry: null });\n  };\n\n  deleteAudio = ({ id }: AudioEntry) => {\n    this.props.audioLibrary.delete(id);\n    this.setState(({ entries }) => ({\n      entries: entries.filter(e => e.id !== id),\n      selectedEntry: null\n    }));\n  };\n\n  exportAudio = ({ name, type, data }: AudioEntry) => {\n    saveAs(new Blob([data], { type }), name);\n  };\n\n  componentWillUnmount(): void {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  }\n\n  render(): React.ReactNode {\n    const { entries, selectedEntry } = this.state;\n\n    if (selectedEntry) {\n      return (\n        <AudioFileModal\n          audioEntry={selectedEntry}\n          onDelete={this.deleteAudio}\n          onExport={this.exportAudio}\n          onCancel={this.unselectEntry}\n          onDismiss={this.dismiss}\n        />\n      );\n    }\n\n    return (\n      <Modal title=\"Audio Library\" onDismiss={this.dismiss}>\n        <AudioList>\n          {entries.length > 0 &&\n            entries.map(e => (\n              <AudioItem\n                key={e.id}\n                title={e.name}\n                onClick={() => this.selectEntry(e)}\n                onMouseEnter={() => this.previewEntry(e)}\n                onMouseLeave={this.stopPreview}\n              >\n                {e.name} <br />\n                {e.type} <br />\n                {Math.ceil(e.data.byteLength / 1024)} KiB\n              </AudioItem>\n            ))}\n        </AudioList>\n        {!entries.length && <div>You haven't added any audio files yet</div>}\n        <ActionGroup>\n          <Action onClick={this.openAudioFileDialog}>Add audio file</Action>\n          <Action onClick={this.dismiss}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","import React from \"react\";\nimport styled, { css } from \"styled-components\";\n\nconst Container = styled.div`\n  flex: 0 0 auto;\n  background: hsl(210, 29%, 15%);\n  color: #fff;\n  font-size: 0.9em;\n  padding: 0 10px;\n  user-select: none;\n\n  :focus {\n    outline: none;\n  }\n`;\n\ninterface MenubarItemProps {\n  isActive?: boolean;\n}\n\nconst MenubarItem = styled.div<MenubarItemProps>`\n  position: relative;\n  display: inline-block;\n  padding: 10px 15px;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 25%, 20%);\n  }\n\n  ${props =>\n    props.isActive &&\n    css`\n      background: hsl(210, 25%, 20%);\n    `}\n`;\n\nconst Menu = styled.div`\n  z-index: 1;\n  position: absolute;\n  left: 0;\n  top: 100%;\n  background: hsl(210, 25%, 20%);\n  padding: 5px 0;\n  min-width: 200px;\n  font-size: 0.95em;\n  box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.5);\n\n  border-bottom-left-radius: 3px;\n  border-bottom-right-radius: 3px;\n\n  cursor: default;\n`;\n\nconst MenuItem = styled.div`\n  white-space: nowrap;\n  padding: 8px 20px;\n  margin: 2px 0;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 15%);\n  }\n`;\n\nconst MenuDivider = styled.div`\n  height: 0;\n  margin: 5px;\n  border-bottom: 1px solid hsl(210, 15%, 35%);\n`;\n\ninterface Props {\n  onNewProject(): void;\n  onImportProject(): void;\n  onExportProject(): void;\n\n  onAddObject(): void;\n  onDeleteObject(): void;\n  onAddRoom(): void;\n  onDeleteRoom(): void;\n\n  onShowAudioLibrary(): void;\n}\n\nenum MenuType {\n  FileMenu,\n  EditMenu,\n  ViewMenu,\n  HelpMenu\n}\n\ninterface State {\n  activeMenu: MenuType | null;\n}\n\nexport default class MenuBar extends React.Component<Props, State> {\n  state: State = {\n    activeMenu: null\n  };\n\n  toggleMenu(menuType: MenuType): void {\n    this.setState(state => ({\n      activeMenu: state.activeMenu === menuType ? null : menuType\n    }));\n  }\n\n  closeMenu(): void {\n    this.setState({ activeMenu: null });\n  }\n\n  render(): React.ReactNode {\n    const { activeMenu } = this.state;\n\n    return (\n      <Container tabIndex={-1} onBlur={() => this.closeMenu()}>\n        <MenubarItem\n          isActive={activeMenu === MenuType.FileMenu}\n          onClick={() => this.toggleMenu(MenuType.FileMenu)}\n        >\n          File\n          <Menu hidden={activeMenu !== MenuType.FileMenu}>\n            <MenuItem onClick={this.props.onNewProject}>New project</MenuItem>\n            <MenuDivider />\n            <MenuItem>Load project</MenuItem>\n            <MenuItem onClick={this.props.onImportProject}>\n              Import project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem>Save project</MenuItem>\n            <MenuItem onClick={this.props.onExportProject}>\n              Export project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem>Settings</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.EditMenu}\n          onClick={() => this.toggleMenu(MenuType.EditMenu)}\n        >\n          Edit\n          <Menu hidden={activeMenu !== MenuType.EditMenu}>\n            <MenuItem onClick={this.props.onAddObject}>Add object</MenuItem>\n            <MenuItem onClick={this.props.onDeleteObject}>\n              Delete object\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onAddRoom}>Add room</MenuItem>\n            <MenuItem onClick={this.props.onDeleteRoom}>Delete room</MenuItem>\n            <MenuDivider />\n            <MenuItem>Release the kraken</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.ViewMenu}\n          onClick={() => this.toggleMenu(MenuType.ViewMenu)}\n        >\n          View\n          <Menu hidden={activeMenu !== MenuType.ViewMenu}>\n            <MenuItem onClick={this.props.onShowAudioLibrary}>\n              Audio Library\n            </MenuItem>\n            <MenuItem>Project Manager</MenuItem>\n            <MenuDivider />\n            <MenuItem>Toggle Fullscreen</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.HelpMenu}\n          onClick={() => this.toggleMenu(MenuType.HelpMenu)}\n        >\n          Help\n          <Menu hidden={activeMenu !== MenuType.HelpMenu}>\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/issues\",\n                  \"_blank\"\n                )\n              }\n            >\n              Issues\n            </MenuItem>\n            <MenuItem\n              onClick={() =>\n                window.open(\"https://github.com/niklaskorz/audio3d\", \"_blank\")\n              }\n            >\n              Source Code\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/blob/master/README.md\",\n                  \"_blank\"\n                )\n              }\n            >\n              About\n            </MenuItem>\n          </Menu>\n        </MenubarItem>\n      </Container>\n    );\n  }\n}\n","/**\n * Useful utility functions related to mathematics\n * @author Niklas Korz\n */\n\n// Converts radiant angles to degrees\nexport const radToDeg = (rad: number): number => (rad * 180) / Math.PI;\n\n// Converts degree angles to radiants\nexport const degToRad = (deg: number): number => (deg / 180) * Math.PI;\n\nexport const roundToPrecision = (value: number, precision: number): number =>\n  Math.round(value / precision) * precision;\n","import styled, { css } from \"styled-components\";\n\nexport const Container = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const InnerContainer = styled.div`\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n`;\n\nexport const Sidebar = styled.aside`\n  flex: 0 0 300px;\n  height: 100%;\n  background: hsl(210, 29%, 29%);\n  color: #fff;\n  padding: 0 15px;\n  overflow-x: hidden;\n  overflow-y: auto;\n`;\n\nexport const FocusedLabel = styled.div`\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n`;\n\nexport const Main = styled.main`\n  position: relative;\n  flex: 1;\n  height: 100%;\n\n  :focus-within > ${FocusedLabel} {\n    display: block;\n  }\n`;\n\nexport const Group = styled.div`\n  margin: 20px 0;\n`;\n\nexport const Input = styled.input`\n  display: block;\n  appearance: none;\n  background: hsl(210, 29%, 24%);\n  border-radius: 3px;\n  border: 2px solid hsl(210, 29%, 24%);\n  color: #fff;\n  width: 100%;\n  padding: 10px 12px;\n  margin: 5px 0;\n\n  transition: 0.2s ease border-color;\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\nexport const Select = styled(Input.withComponent(\"select\"))`\n  cursor: pointer;\n`;\n\nexport const InputGroup = styled.div`\n  display: flex;\n  flex-direction: row;\n\n  > ${Input} {\n    flex: 1;\n    width: auto;\n    min-width: 0;\n\n    margin-right: 5px;\n\n    :last-child {\n      margin-right: 0;\n    }\n  }\n`;\n\nexport const RoomList = styled.ol`\n  list-style: none;\n  padding: 5px;\n  margin: 5px 0;\n  border-radius: 3px;\n  background: hsl(210, 29%, 24%);\n`;\n\ninterface RoomListItemProps {\n  active?: boolean;\n}\n\nexport const RoomListItem = styled.li<RoomListItemProps>`\n  cursor: pointer;\n  padding: 7px 10px;\n  border-radius: 2px;\n  ${props =>\n    props.active &&\n    css`\n      background: hsl(210, 29%, 20%);\n      border-left: 2px solid #3498db;\n    `};\n`;\n","/**\n * @author Niklas Korz\n */\nimport {\n  BoxGeometry,\n  DoubleSide,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  Plane,\n  PlaneGeometry,\n  Raycaster,\n  Scene,\n  SphereGeometry,\n  Vector3\n} from \"three\";\nimport Project from \"../project/Project\";\n\n// The object drag direction is required for calculating the plane to ray cast\n// against later on. Also, of course, to determine whether the object should be\n// moved on one or two axes.\nexport enum ObjectDragDirection {\n  AxisX,\n  AxisY,\n  AxisZ,\n  PlaneYZ,\n  PlaneXZ,\n  PlaneXY\n}\n\n// Inspired by https://github.com/mrdoob/three.js/blob/dev/examples/js/controls/TransformControls.js\n// As in the example, we are using ray casting for calculating the movements of planes and axes.\n// Everything else in this implementation has resulted either from trial and error or by\n// consulting the Three.js documentation.\n// The controls are grouped as a scene instead of a group object to allow drawing\n// them separately, on top of the main scene, to avoid any controls to be obscured\n// by objects that would theoretically appear in front of them based on their Z coordinate.\n// Furthermore, the scene's position is set to the active mesh's when one is\n// selected. This way, coordinates in the controls scene are always relative to the\n// active mesh.\n// Theoretically, it could also be added as a child node to the active mesh,\n// but this would result in the rotation being copied as well, which is not desirable\n// in this case.\n// Beware though that intersection points are always given in absolute world coordinates.\nexport default class VisualControls extends Scene {\n  project: Project;\n\n  objectDragDirection: ObjectDragDirection | null = null;\n  isScaling: boolean = false;\n  // The drag offset is used to determine the distance of the point where the\n  // user started dragging and the center of the object.\n  // This way, the cursor will always have the same relative position to the\n  // object while dragging.\n  dragOffset = new Vector3();\n  lastPoint = new Vector3();\n\n  // In contrast to the Three.js example, we will be using a real plane instead of a\n  // mesh that only represents an area on a plane.\n  // As a consequence, the ray generated by the ray caster will be used directly\n  // for calculating the intersection.\n  plane = new Plane();\n\n  // The visual controls\n  axisX: Mesh;\n  axisY: Mesh;\n  axisZ: Mesh;\n  scaleX: Mesh;\n  scaleY: Mesh;\n  scaleZ: Mesh;\n  planeYZ: Mesh;\n  planeXZ: Mesh;\n  planeXY: Mesh;\n\n  constructor(project: Project) {\n    super();\n\n    this.project = project;\n\n    // Setup visual controls for transformation\n\n    const materialConfig = {\n      transparent: true,\n      opacity: 0.75,\n      side: DoubleSide // Needed to make the planes viewable from both sides\n    };\n\n    // The X, Y and Z axes, represented as cuboids\n\n    const axisGeometry = new BoxGeometry(0.05, 0.05, 0.5);\n\n    this.axisX = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0xff0000\n      })\n    );\n    this.axisX.position.set(0.275, 0.0, 0.0);\n    this.axisX.rotation.y = Math.PI / 2;\n    this.axisX.userData.direction = ObjectDragDirection.AxisX;\n\n    this.axisY = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x00ff00\n      })\n    );\n    this.axisY.position.set(0.0, 0.275, 0.0);\n    this.axisY.rotation.x = Math.PI / 2;\n    this.axisY.userData.direction = ObjectDragDirection.AxisY;\n\n    this.axisZ = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x0000ff\n      })\n    );\n    this.axisZ.position.set(0.0, 0.0, 0.275);\n    this.axisZ.userData.direction = ObjectDragDirection.AxisZ;\n\n    this.add(this.axisX);\n    this.add(this.axisY);\n    this.add(this.axisZ);\n\n    // Scaling controls per axis, represented as spheres\n\n    const scaleGeometry = new SphereGeometry(0.05, 16, 16);\n\n    this.scaleX = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff0000 })\n    );\n    this.scaleX.position.set(0.65, 0, 0);\n    this.scaleX.userData.direction = ObjectDragDirection.AxisX;\n    this.scaleX.userData.isScale = true;\n\n    this.scaleY = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ff00 })\n    );\n    this.scaleY.position.set(0, 0.65, 0);\n    this.scaleY.userData.direction = ObjectDragDirection.AxisY;\n    this.scaleY.userData.isScale = true;\n\n    this.scaleZ = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x0000ff })\n    );\n    this.scaleZ.position.set(0, 0, 0.65);\n    this.scaleZ.userData.direction = ObjectDragDirection.AxisZ;\n    this.scaleZ.userData.isScale = true;\n\n    this.add(this.scaleX);\n    this.add(this.scaleY);\n    this.add(this.scaleZ);\n\n    // The YZ, XZ, XY planes, represented as areas on each plane.\n    // Declaration is ordered by the normal of the plane, i.e.\n    // the axis that will not be moved by it.\n\n    const planeGeometry = new PlaneGeometry(0.25, 0.25);\n\n    this.planeYZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ffff })\n    );\n    this.planeYZ.position.set(0.0, 0.25, 0.25);\n    this.planeYZ.rotation.y = Math.PI / 2;\n    this.planeYZ.userData.direction = ObjectDragDirection.PlaneYZ;\n\n    this.planeXZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff00ff })\n    );\n    this.planeXZ.position.set(0.25, 0.0, 0.25);\n    this.planeXZ.rotation.x = Math.PI / 2;\n    this.planeXZ.userData.direction = ObjectDragDirection.PlaneXZ;\n\n    this.planeXY = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xffff00 })\n    );\n    this.planeXY.position.set(0.25, 0.25, 0.0);\n    this.planeXY.userData.direction = ObjectDragDirection.PlaneXY;\n\n    this.add(this.planeYZ);\n    this.add(this.planeXZ);\n    this.add(this.planeXY);\n  }\n\n  getControlFromRaycaster(raycaster: Raycaster): Object3D | null {\n    if (!this.project.activeObject) {\n      return null;\n    }\n\n    this.position.copy(this.project.activeObject.position);\n\n    const intersections = raycaster.intersectObjects(this.children);\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o.userData.hasOwnProperty(\"direction\")) {\n        // Save the drag offset by subtracting the absolute position of the cursor\n        // (absolute meaning world coordinates) from the object's absolute position.\n        this.dragOffset\n          .copy(intersection.point)\n          .sub(this.project.activeObject.position);\n        this.lastPoint.copy(intersection.point);\n        return o;\n      }\n    }\n    return null;\n  }\n\n  // As we don't have access to the camera here and to avoid creating the ray caster\n  // twice, we just pass it from the initial mouse click handler and use it here.\n  // The original mouse event and screen coordinates are not required for the functionality\n  // of the controls, so they will not be taken as parameters here.\n  onClick(raycaster: Raycaster): boolean {\n    const o = this.getControlFromRaycaster(raycaster);\n    if (o && o.userData.hasOwnProperty(\"direction\")) {\n      this.objectDragDirection = o.userData.direction;\n      this.isScaling = !!o.userData.isScale;\n      this.onMove(raycaster);\n      return true;\n    }\n    return false;\n  }\n\n  // Initially, I used a Vector3(dx, dy, 0) here and applied the world rotation\n  // that can be calculated by the camera with camera.getWorldQuaternion(),\n  // followed by zeroing out the directions that should not be changed based on\n  // the plane or axis selected by the user.\n  // This resulted in a \"weird\" feeling though, as the zeroed axis gets completely lost,\n  // therefore making one of the two remaining axis movements feel slower than the other\n  // even if both are dragged equally on the screen.\n  //\n  // Similar to the Three.js transform controls example, this now uses a ray\n  // casted from the camera origin onto a plane that represents the axes to move\n  // on and sets the position of the object to the intersection point.\n  onMove({ ray }: Raycaster): void {\n    if (this.objectDragDirection === null || !this.project.activeObject) {\n      return;\n    }\n\n    const c = this.project.activeObject.position;\n    const p = this.plane;\n    let altPlane: Plane | null = null;\n\n    // Update the normal and constant (^= position) of the plane\n    // TODO: The origin of the plane has to be negative somehow, otherwise everything is mirrored. Why?\n    switch (this.objectDragDirection) {\n      case ObjectDragDirection.AxisX:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisY:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 1, 0), -c.y);\n        break;\n      case ObjectDragDirection.PlaneXY:\n        p.set(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.PlaneYZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        break;\n      case ObjectDragDirection.PlaneXZ:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        break;\n    }\n\n    // If there is an alternative plane (i.e., for axes),\n    // check which one is farther away from the ray's origin.\n    // This is needed to prevent issues when the camera comes too close to the\n    // plane.\n    if (\n      altPlane &&\n      Math.abs(altPlane.distanceToPoint(ray.origin)) >\n        Math.abs(p.distanceToPoint(ray.origin))\n    ) {\n      p.copy(altPlane);\n    }\n\n    const point = ray.intersectPlane(p, new Vector3());\n    if (!point) {\n      // No intersection\n      return;\n    }\n\n    if (this.isScaling) {\n      // For scaling, we are using the relative movement instead of the position\n      // as no movement at all should leave the scale as is.\n      // I.e., we are adding the distance to the previously recorded intersection point\n      // to the object's scale.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.scale.x = Math.min(\n            Math.max(\n              this.project.activeObject.scale.x + (point.x - this.lastPoint.x),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.scale.y = Math.min(\n            Math.max(\n              this.project.activeObject.scale.y + (point.y - this.lastPoint.y),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.scale.z = Math.min(\n            Math.max(\n              this.project.activeObject.scale.z + (point.z - this.lastPoint.z),\n              0.1\n            ),\n            10\n          );\n          break;\n      }\n\n      this.project.events.onScale(this.project.activeObject.scale);\n    } else {\n      point.sub(this.dragOffset);\n\n      // If we are operating on an axis instead of a plane, ensure only the relevant\n      // coordinate is changed.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.position.x = point.x;\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.position.y = point.y;\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.position.z = point.z;\n          break;\n        default:\n          // The selected direction is a plane, so we can just copy the\n          // intersection point.\n          this.project.activeObject.position.copy(point);\n      }\n\n      this.project.events.onTranslate(this.project.activeObject.position);\n    }\n\n    this.lastPoint.copy(point);\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { degToRad, radToDeg, roundToPrecision } from \"../utils/math\";\nimport { Group, Input, InputGroup } from \"./styled\";\nimport { EditorObject } from \"./types\";\n\ninterface Props {\n  object: EditorObject;\n  onUpdateName(name: string): void;\n  onUpdatePosition(x: number, y: number, z: number): void;\n  onUpdateRotation(x: number, y: number, z: number): void;\n  onUpdateScale(x: number, y: number, z: number): void;\n  onShowAudioSelection(): void;\n}\n\n// UI component for editing properties specific to objects inside a room\nexport default class ObjectEditor extends React.Component<Props> {\n  render(): React.ReactNode {\n    const {\n      object: o,\n      onUpdateName,\n      onUpdatePosition,\n      onUpdateRotation,\n      onUpdateScale\n    } = this.props;\n\n    return (\n      <div>\n        <Group>\n          <label>Object Name</label>\n          <Input\n            type=\"text\"\n            value={o.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Position (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.x.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.y,\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.y.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.z.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  o.position.y,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Euler-Rotation in Degrees (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.x).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.y,\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.y).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.z).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  o.rotation.y,\n                  degToRad(e.currentTarget.valueAsNumber % 360)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Size (width, height, depth)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.x.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  e.currentTarget.valueAsNumber,\n                  o.scale.y,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.y.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  e.currentTarget.valueAsNumber,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.z.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  o.scale.y,\n                  e.currentTarget.valueAsNumber\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Audio</label>\n          <Input\n            type=\"text\"\n            readOnly={true}\n            value={\n              o.audio\n                ? `${o.audio.name} (${Math.ceil(\n                    o.audio.data.byteLength / 1024\n                  )} KiB)`\n                : \"None\"\n            }\n            onClick={this.props.onShowAudioSelection}\n          />\n        </Group>\n      </div>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\nconst AXIS_THRESHOLD = 0.1;\n\nexport default class GamepadListener {\n  listen(): void {\n    window.addEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.addEventListener(\"gamepaddisconnected\", this.onGamepadDisconnected);\n  }\n\n  stop(): void {\n    window.removeEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.removeEventListener(\n      \"gamepaddisconnected\",\n      this.onGamepadDisconnected\n    );\n  }\n\n  onGamepadConnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad connected:\", e.gamepad);\n  };\n\n  onGamepadDisconnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad disconnected:\", e.gamepad);\n  };\n\n  getAxis(index: number): number {\n    const gamepads = navigator.getGamepads();\n\n    let value = 0;\n    for (const gamepad of gamepads) {\n      if (!gamepad || gamepad.mapping !== \"standard\") {\n        continue;\n      }\n\n      if (index < 4) {\n        const axis = gamepad.axes[index];\n        if (\n          Math.abs(axis) >= AXIS_THRESHOLD &&\n          Math.abs(axis) > Math.abs(value)\n        ) {\n          value = axis;\n        }\n      } else if (index === 4) {\n        const v1 = gamepad.buttons[6].value;\n        const v2 = gamepad.buttons[7].value;\n        const axis = v2 - v1;\n        if (Math.abs(axis) > Math.abs(value)) {\n          value = axis;\n        }\n      }\n    }\n    return value;\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\nexport default class KeyboardListener {\n  target: HTMLElement;\n  keysPressed = new Set<string>();\n  lastKeyUp = new Map<string, number>();\n\n  constructor(target: HTMLElement) {\n    this.target = target;\n  }\n\n  listen(): void {\n    this.target.addEventListener(\"blur\", this.reset);\n    this.target.addEventListener(\"contextmenu\", this.reset);\n    this.target.addEventListener(\"keydown\", this.onKeyDown);\n    this.target.addEventListener(\"keyup\", this.onKeyUp);\n    document.addEventListener(\"click\", this.onClick);\n  }\n\n  stop(): void {\n    this.target.removeEventListener(\"blur\", this.reset);\n    this.target.removeEventListener(\"contextmenu\", this.reset);\n    this.target.removeEventListener(\"keydown\", this.onKeyDown);\n    this.target.removeEventListener(\"keyup\", this.onKeyUp);\n    document.removeEventListener(\"click\", this.onClick);\n    this.reset();\n  }\n\n  isPressed(key: string): boolean {\n    return this.keysPressed.has(key);\n  }\n\n  reset = (): void => {\n    this.keysPressed.clear();\n  };\n\n  onKeyDown = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    // Workaround for browsers firing a queued keydown shortly after a keyup\n    // Ignore keydown if the last keyup was triggered +-100ms from now\n    if (Math.abs(e.timeStamp - (this.lastKeyUp.get(e.key) || 0)) >= 100) {\n      this.keysPressed.add(e.key);\n    }\n  };\n\n  onKeyUp = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    this.keysPressed.delete(e.key);\n    this.lastKeyUp.set(e.key, e.timeStamp);\n  };\n\n  onClick = (e: MouseEvent): void => {\n    // Shift + right click forces context menu in firefox\n    if (e.button === 2 && e.shiftKey) {\n      this.reset();\n    }\n  };\n}\n","/**\n * @author Niklas Korz\n */\nimport { Color, Mesh, Raycaster, Vector2, Vector3, WebGLRenderer } from \"three\";\nimport GamepadListener from \"../input/GamepadListener\";\nimport KeyboardListener from \"../input/KeyboardListener\";\nimport GameObject from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport VisualControls from \"./VisualControls\";\n\nenum MouseButton {\n  Primary = 0,\n  Middle = 1,\n  Secondary = 2\n}\n\nconst axes = {\n  x: new Vector3(1, 0, 0),\n  y: new Vector3(0, 1, 0),\n  z: new Vector3(0, 0, 1)\n};\n\nexport default class ProjectCanvas {\n  target: HTMLElement | null = null;\n  project: Project;\n\n  rafHandle = 0;\n  previousTimestamp = 0;\n\n  controls: VisualControls;\n\n  renderer = new WebGLRenderer();\n  canvas: HTMLCanvasElement;\n  outlineMesh = new Mesh();\n\n  raycaster = new Raycaster();\n\n  keys = new KeyboardListener(this.renderer.domElement);\n  gamepads = new GamepadListener();\n  isDraggingCamera = false;\n\n  constructor(project: Project) {\n    this.project = project;\n\n    this.renderer.autoClear = false;\n    this.renderer.setClearColor(new Color(0x192a56));\n    this.canvas = this.renderer.domElement;\n    this.canvas.tabIndex = -1; // Make element focusable\n    this.canvas.addEventListener(\"click\", this.onClick);\n    this.canvas.addEventListener(\"mousedown\", this.onMouseDown);\n    this.canvas.addEventListener(\"mouseup\", this.onMouseUp);\n    this.canvas.addEventListener(\"mousemove\", this.onMouseMove);\n    this.canvas.addEventListener(\"wheel\", this.onWheel);\n    this.canvas.addEventListener(\n      \"contextmenu\",\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      },\n      true\n    );\n\n    // Setup scene\n\n    this.controls = new VisualControls(project);\n\n    // const ph = new PlaneHelper(this.controls.plane, 10, 0x999999);\n    // this.scene.add(ph);\n  }\n\n  attach(target: HTMLElement): void {\n    this.keys.listen();\n    this.gamepads.listen();\n\n    this.target = target;\n    target.appendChild(this.canvas);\n\n    this.resize();\n    window.requestAnimationFrame(this.animate);\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  detach(): void {\n    window.cancelAnimationFrame(this.rafHandle);\n    window.removeEventListener(\"resize\", this.resize);\n\n    if (this.target) {\n      this.target.removeChild(this.canvas);\n      this.target = null;\n    }\n\n    this.keys.stop();\n    this.gamepads.stop();\n  }\n\n  focus(): void {\n    this.canvas.focus();\n  }\n\n  changeProject(project: Project): void {\n    this.project = project;\n    this.controls.project = project;\n    // Ensure the selected project's camera has the correct aspect ratio\n    this.resize();\n  }\n\n  resize = (): void => {\n    if (!this.target) {\n      return;\n    }\n\n    const { offsetWidth, offsetHeight } = this.target;\n\n    this.project.camera.aspect = offsetWidth / offsetHeight;\n    this.project.camera.updateProjectionMatrix();\n\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(offsetWidth, offsetHeight);\n  };\n\n  animate: FrameRequestCallback = t => {\n    this.rafHandle = window.requestAnimationFrame(this.animate);\n\n    const dt = (t - this.previousTimestamp) / 1000;\n    this.previousTimestamp = t;\n    this.update(dt);\n\n    this.renderer.clear();\n    this.renderer.render(this.project.activeRoom, this.project.camera);\n\n    if (this.project.activeObject) {\n      // Draw controls in front of all other objects\n      // https://stackoverflow.com/questions/12666570/how-to-change-the-zorder-of-object-with-threejs/12666937#12666937\n      this.controls.position.copy(this.project.activeObject.position);\n      this.renderer.clearDepth();\n      this.renderer.render(this.controls, this.project.camera);\n    }\n  };\n\n  update(dt: number): void {\n    const { camera } = this.project;\n\n    if (this.keys.isPressed(\"w\")) {\n      camera.translateOnAxis(axes.z, -2 * dt);\n    }\n    if (this.keys.isPressed(\"s\")) {\n      camera.translateOnAxis(axes.z, 2 * dt);\n    }\n    if (this.keys.isPressed(\"a\")) {\n      camera.translateOnAxis(axes.x, -2 * dt);\n    }\n    if (this.keys.isPressed(\"d\")) {\n      camera.translateOnAxis(axes.x, 2 * dt);\n    }\n    if (this.keys.isPressed(\" \")) {\n      camera.position.y += 2 * dt;\n    }\n    if (this.keys.isPressed(\"Shift\")) {\n      camera.position.y -= 2 * dt;\n    }\n\n    if (this.keys.isPressed(\"ArrowLeft\")) {\n      camera.rotateOnWorldAxis(axes.y, dt);\n    }\n    if (this.keys.isPressed(\"ArrowRight\")) {\n      camera.rotateOnWorldAxis(axes.y, -dt);\n    }\n    if (this.keys.isPressed(\"ArrowUp\")) {\n      camera.rotateOnAxis(axes.x, dt);\n    }\n    if (this.keys.isPressed(\"ArrowDown\")) {\n      camera.rotateOnAxis(axes.x, -dt);\n    }\n\n    const gamepadAxes = {\n      x: this.gamepads.getAxis(0),\n      y: this.gamepads.getAxis(1),\n      rX: this.gamepads.getAxis(2),\n      rY: this.gamepads.getAxis(3),\n      b: this.gamepads.getAxis(4)\n    };\n    // console.log(axes);\n    if (gamepadAxes.x) {\n      camera.translateOnAxis(axes.x, 2 * dt * gamepadAxes.x);\n    }\n    if (gamepadAxes.y) {\n      camera.translateOnAxis(axes.z, 2 * dt * gamepadAxes.y);\n    }\n    if (gamepadAxes.b) {\n      camera.translateOnAxis(axes.y, 2 * dt * gamepadAxes.b);\n    }\n    if (gamepadAxes.rX) {\n      camera.rotateOnWorldAxis(axes.y, -dt * gamepadAxes.rX);\n    }\n    if (gamepadAxes.rY) {\n      camera.rotateOnAxis(axes.x, -dt * gamepadAxes.rY);\n    }\n  }\n\n  checkSceneClick(raycaster: Raycaster): boolean {\n    const intersections = raycaster.intersectObjects(\n      this.project.activeRoom.children\n    );\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o instanceof GameObject) {\n        this.project.selectObject(o);\n        return true;\n      }\n    }\n\n    this.project.selectObject(null);\n    return false;\n  }\n\n  updateRaycaster(e: MouseEvent): void {\n    const size = this.renderer.getSize(new Vector2());\n    // Normalize screen coordinates\n    const x = ((e.pageX - this.target!.offsetLeft) / size.x) * 2 - 1;\n    const y = -((e.pageY - this.target!.offsetTop) / size.y) * 2 + 1;\n    // Update raycaster\n    this.raycaster.setFromCamera({ x, y }, this.project.camera);\n  }\n\n  onClick = (e: MouseEvent) => {\n    /* Nothing here yet */\n  };\n\n  onMouseDown = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary) {\n      this.isDraggingCamera = true;\n      this.canvas.requestPointerLock();\n    }\n\n    if (e.button !== MouseButton.Primary) {\n      return;\n    }\n\n    this.updateRaycaster(e);\n    if (this.controls.onClick(this.raycaster)) {\n      this.canvas.style.cursor = \"grabbing\";\n    } else {\n      this.checkSceneClick(this.raycaster);\n    }\n  };\n\n  onMouseUp = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary && this.isDraggingCamera) {\n      this.isDraggingCamera = false;\n      document.exitPointerLock();\n    }\n    if (\n      e.button === MouseButton.Primary &&\n      this.controls.objectDragDirection !== null\n    ) {\n      this.controls.objectDragDirection = null;\n      if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onMouseMove = (e: MouseEvent): void => {\n    if (this.isDraggingCamera) {\n      if (e.movementX) {\n        this.project.camera.rotateOnWorldAxis(axes.y, -e.movementX / 100);\n      }\n      if (e.movementY) {\n        this.project.camera.rotateOnAxis(axes.x, -e.movementY / 100);\n      }\n    } else {\n      this.updateRaycaster(e);\n      if (this.controls.objectDragDirection !== null) {\n        this.controls.onMove(this.raycaster);\n      } else if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onWheel = (e: WheelEvent): void => {\n    e.preventDefault();\n    // console.log('onWheel', e.deltaX, e.deltaY, e.deltaZ, e.deltaMode);\n    let delta = e.deltaY;\n    if (e.deltaMode === 0) {\n      // More granular zoom for pixel mode\n      delta /= 15;\n    }\n    this.project.camera.translateZ(delta / 10);\n  };\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, RoomMaterials } from \"resonance-audio\";\nimport { Euler, Vector3 } from \"three\";\nimport { saveAsZip } from \"../data/export\";\nimport { openZip } from \"../data/import\";\nimport GameObject from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport AudioLibraryModal from \"./AudioLibraryModal\";\nimport MenuBar from \"./MenuBar\";\nimport ObjectEditor from \"./ObjectEditor\";\nimport ProjectCanvas from \"./ProjectCanvas\";\nimport RoomEditor from \"./RoomEditor\";\nimport {\n  Container,\n  FocusedLabel,\n  Group,\n  InnerContainer,\n  Main,\n  RoomList,\n  RoomListItem,\n  Sidebar\n} from \"./styled\";\nimport { EditorObject, EditorRoom, AudioEntry } from \"./types\";\n\nenum ModalType {\n  AudioLibrary,\n  AudioSelection,\n  ProjectManager\n}\n\ninterface State {\n  rooms: EditorRoom[];\n  selectedRoomId: number;\n  selectedObject: EditorObject | null;\n  modal: ModalType | null;\n}\n\nexport default class Editor extends React.Component<{}, State> {\n  project: Project = new Project();\n  projectCanvas = new ProjectCanvas(this.project);\n\n  state: State = {\n    rooms: this.project.rooms.map(r => ({\n      id: r.id,\n      name: r.name,\n      dimensions: r.dimensions,\n      materials: r.materials\n    })),\n    selectedRoomId: 0,\n    selectedObject: null,\n    modal: null\n  };\n  mainRef = React.createRef<HTMLElement>();\n\n  constructor(props: {}) {\n    super(props);\n\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n  }\n\n  // Menubar functionality\n\n  newProject = () => {\n    this.project = new Project({\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    });\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null\n    });\n  };\n\n  importProject = async () => {\n    this.project = await openZip();\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null\n    });\n  };\n\n  exportProject = () => {\n    saveAsZip(this.project);\n  };\n\n  addObject = () => {\n    this.project.activeRoom.addObject();\n  };\n\n  deleteObject = () => {\n    if (this.project.activeObject) {\n      this.project.activeRoom.remove(this.project.activeObject);\n      this.project.activeObject = null;\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  addRoom = () => {\n    const room = this.project.addRoom();\n    this.setState(s => ({\n      rooms: [\n        ...s.rooms,\n        {\n          id: room.id,\n          name: room.name,\n          dimensions: room.dimensions,\n          materials: room.materials\n        }\n      ],\n      selectedRoomId: s.rooms.length\n    }));\n  };\n\n  deleteRoom = () => {\n    // Ensure the first room cannot be deleted\n    if (this.state.selectedRoomId > 0) {\n      this.project.rooms.splice(this.state.selectedRoomId, 1);\n      this.setState(s => ({\n        rooms: [\n          ...s.rooms.slice(0, s.selectedRoomId),\n          ...s.rooms.slice(s.selectedRoomId + 1)\n        ],\n        selectedRoomId: 0\n      }));\n    }\n  };\n\n  showAudioLibrary = () => {\n    this.setState({ modal: ModalType.AudioLibrary });\n  };\n\n  // Room specific editor functionality\n\n  selectRoom(id: number): void {\n    this.project.selectRoom(this.project.rooms[id]);\n    this.setState({ selectedRoomId: id, selectedObject: null });\n  }\n\n  updateRoomName = (name: string) => {\n    this.project.activeRoom.name = name;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          name\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomDimensions = (dimensions: RoomDimensions) => {\n    this.project.activeRoom.dimensions = dimensions;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          dimensions\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomMaterials = (materials: RoomMaterials) => {\n    this.project.activeRoom.materials = materials;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          materials\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  // Object editor functionality\n\n  updateName = (name: string) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.name = name;\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        name\n      }\n    }));\n  };\n\n  updateScale = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.scale.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        scale: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updatePosition = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.position.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updateRotation = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.rotation.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        rotation: new Euler(x, y, z)\n      }\n    }));\n  };\n\n  showAudioSelection = () => {\n    this.setState({\n      modal: ModalType.AudioSelection\n    });\n  };\n\n  // Modal events\n\n  dismissModal = () => {\n    this.setState({ modal: null });\n  };\n\n  selectAudio = (audio: AudioEntry) => {\n    console.log(\"Selected:\", audio);\n    if (this.project.activeObject) {\n      this.project.activeObject.loadAudio(audio.id);\n      this.setState(({ selectedObject }) => ({\n        selectedObject: selectedObject && {\n          ...selectedObject,\n          audio\n        },\n        modal: null\n      }));\n    }\n  };\n\n  // Project canvas events\n\n  onSelectObject = (o: GameObject | null) => {\n    if (o) {\n      this.setState({\n        selectedObject: {\n          id: o.id,\n          name: o.name,\n          position: o.position,\n          scale: o.scale,\n          rotation: o.rotation,\n          audio: o.audioFile && {\n            ...o.audioFile,\n            id: o.audioId!\n          }\n        }\n      });\n    } else {\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  onTranslateObject = (p: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: p\n      }\n    }));\n  };\n\n  onScaleObject = (s: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        size: {\n          width: s.x,\n          height: s.y,\n          depth: s.z\n        }\n      }\n    }));\n  };\n\n  // React component lifecycle methods\n\n  componentDidMount(): void {\n    if (this.mainRef.current) {\n      this.projectCanvas.attach(this.mainRef.current);\n      this.projectCanvas.focus();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.projectCanvas.detach();\n  }\n\n  render(): React.ReactNode {\n    const { modal } = this.state;\n    const o = this.state.selectedObject;\n\n    return (\n      <Container>\n        {(modal === ModalType.AudioLibrary ||\n          modal === ModalType.AudioSelection) && (\n          <AudioLibraryModal\n            audioLibrary={this.project.audioLibrary}\n            onDismiss={this.dismissModal}\n            onSelect={\n              modal === ModalType.AudioSelection ? this.selectAudio : undefined\n            }\n          />\n        )}\n        <MenuBar\n          onNewProject={this.newProject}\n          onImportProject={this.importProject}\n          onExportProject={this.exportProject}\n          onAddObject={this.addObject}\n          onDeleteObject={this.deleteObject}\n          onAddRoom={this.addRoom}\n          onDeleteRoom={this.deleteRoom}\n          onShowAudioLibrary={this.showAudioLibrary}\n        />\n        <InnerContainer>\n          <Sidebar>\n            <Group>\n              <label>Rooms</label>\n              <RoomList>\n                {this.state.rooms.map((r, i) => (\n                  <RoomListItem\n                    key={r.id}\n                    onClick={() => this.selectRoom(i)}\n                    active={i === this.state.selectedRoomId}\n                  >\n                    {r.name || \"Anonymous Room\"}\n                  </RoomListItem>\n                ))}\n              </RoomList>\n            </Group>\n            {!o && (\n              <RoomEditor\n                room={this.state.rooms[this.state.selectedRoomId]}\n                onUpdateName={this.updateRoomName}\n                onUpdateDimensions={this.updateRoomDimensions}\n                onUpdateMaterials={this.updateRoomMaterials}\n              />\n            )}\n            {o && (\n              <ObjectEditor\n                object={o}\n                onUpdateName={this.updateName}\n                onUpdatePosition={this.updatePosition}\n                onUpdateRotation={this.updateRotation}\n                onUpdateScale={this.updateScale}\n                onShowAudioSelection={this.showAudioSelection}\n              />\n            )}\n          </Sidebar>\n          <Main ref={this.mainRef}>\n            <FocusedLabel>Focused</FocusedLabel>\n          </Main>\n        </InnerContainer>\n      </Container>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport { Group, Input, InputGroup, Select } from \"./styled\";\nimport { EditorRoom } from \"./types\";\n\nconst materials = Object.keys(ResonanceAudio.Utils.ROOM_MATERIAL_COEFFICIENTS);\n\ninterface Props {\n  room: EditorRoom;\n  onUpdateName(name: string): void;\n  onUpdateDimensions(dimensions: RoomDimensions): void;\n  onUpdateMaterials(materials: RoomMaterials): void;\n}\n\n// UI component for editing properties specific to a room itself\nexport default class RoomEditor extends React.Component<Props> {\n  selectMaterialHandler(\n    propertyName: keyof RoomMaterials\n  ): React.ChangeEventHandler<HTMLSelectElement> {\n    return e => {\n      const { room, onUpdateMaterials } = this.props;\n      onUpdateMaterials({\n        ...room.materials,\n        [propertyName]: e.currentTarget.value\n      });\n    };\n  }\n\n  render(): React.ReactNode {\n    const { room: r, onUpdateName, onUpdateDimensions } = this.props;\n\n    const materialOptions = materials.map(ce => <option key={ce}>{ce}</option>);\n\n    return (\n      <div>\n        <Group>\n          <label>Room Name</label>\n          <Input\n            type=\"text\"\n            value={r.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Dimensions (width, depth, height)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.width}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  width: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.depth}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  depth: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={2}\n              max={10}\n              value={r.dimensions.height}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  height: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Left wall material</label>\n          <Select\n            value={r.materials.left}\n            onChange={this.selectMaterialHandler(\"left\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Right wall material</label>\n          <Select\n            value={r.materials.right}\n            onChange={this.selectMaterialHandler(\"right\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Front wall material</label>\n          <Select\n            value={r.materials.front}\n            onChange={this.selectMaterialHandler(\"front\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Back wall material</label>\n          <Select\n            value={r.materials.back}\n            onChange={this.selectMaterialHandler(\"back\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Floor material</label>\n          <Select\n            value={r.materials.down}\n            onChange={this.selectMaterialHandler(\"down\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Ceiling material</label>\n          <Select\n            value={r.materials.up}\n            onChange={this.selectMaterialHandler(\"up\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n      </div>\n    );\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See http://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit http://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nexport function unregister(): void {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"normalize.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Editor from \"./editor/Editor\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nconst global = window as any;\n// Safari does not yet support the Web Audio API without a prefix\nif (!global.AudioContext && global.webkitAudioContext) {\n  global.AudioContext = global.webkitAudioContext;\n}\n\nReactDOM.render(<Editor />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}