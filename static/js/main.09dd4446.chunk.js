(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{130:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);n(79);var a=n(0),r=n.n(a),i=n(31),o=n.n(i),s=n(9),c=n(13),u=n(2),l=n.n(u),d=n(5),p=n(4),h=n(3),m=n(10),f=n(8),v=n(11),b=n(1),j=n(21),x=n(33),y=n(34),w=n(35),O=n.n(w),g=function(){var e=Object(d.a)(l.a.mark(function e(t){var n,a,r,i,o,s,c,u,d,p,h,m,f,v;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.toData(),(a=new O.a).file("metadata.json",JSON.stringify(n)),r=[],i=a.folder("audio"),o=!0,s=!1,e.prev=7,u=Object(x.a)(t.audioLibrary.entries());case 9:return e.next=11,u.next();case 11:return d=e.sent,o=d.done,e.next=15,d.value;case 15:if(p=e.sent,o){e.next=23;break}h=p,m=Object(j.a)(h,2),f=m[0],v=m[1],r.push({id:f,name:v.name,type:v.type}),i.file(f.toString(),v.data);case 20:o=!0,e.next=9;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),s=!0,c=e.t0;case 29:if(e.prev=29,e.prev=30,o||null==u.return){e.next=34;break}return e.next=34,u.return();case 34:if(e.prev=34,!s){e.next=37;break}throw c;case 37:return e.finish(34);case 38:return e.finish(29);case 39:return a.file("audioLibrary.json",JSON.stringify(r)),e.abrupt("return",a.generateAsync({type:"blob"}));case 41:case"end":return e.stop()}},e,this,[[7,25,29,39],[30,,34,38]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(d.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:n=e.sent,Object(y.saveAs)(n,"".concat(t.name,".audio3d.zip"));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),E=n(22),S=n(37),A=n(76),P=Object(A.a)("audio3d",1,{upgrade:function(e){e.createObjectStore("projects",{keyPath:"id",autoIncrement:!0}).createIndex("savedAt","savedAt"),e.createObjectStore("audios",{keyPath:["projectId","audioId"]}).createIndex("project","projectId")}}),M=function(){var e=Object(d.a)(l.a.mark(function e(t){var n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,a=t.toData(),e.next=6,n.put("projects",a);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(d.a)(l.a.mark(function e(t){var n,a,r,i,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,a=n.transaction(["audios","projects"],"readwrite"),r=a.objectStore("projects"),i=a.objectStore("audios"),e.next=8,r.delete(t);case 8:return e.next=10,i.index("project").openKeyCursor(t);case 10:o=e.sent;case 11:if(!o){e.next=19;break}return e.next=14,i.delete(o.primaryKey);case 14:return e.next=16,o.continue();case 16:o=e.sent,e.next=11;break;case 19:return e.next=21,a.done;case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(d.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return t=e.sent,e.next=5,t.getAllFromIndex("projects","savedAt");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(d.a)(l.a.mark(function e(t,n){var a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return a=e.sent,e.next=5,a.get("audios",[t,n]);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),L=function(){var e=Object(d.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return n=e.sent,e.next=5,n.put("audios",t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(l.a.mark(function e(t,n){var a,r,i,o,c,u,d,p,h,m,f;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:for(a=e.sent,r=a.transaction("audios","readwrite"),i=!0,o=!1,c=void 0,e.prev=7,u=n.entries()[Symbol.iterator]();!(i=(d=u.next()).done);i=!0)p=d.value,h=Object(j.a)(p,2),m=h[0],f=h[1],r.store.put(Object(s.a)({},f,{projectId:t,audioId:m}));e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),o=!0,c=e.t0;case 15:e.prev=15,e.prev=16,i||null==u.return||u.return();case 18:if(e.prev=18,!o){e.next=21;break}throw c;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return e.next=25,r.done;case 25:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=Object(d.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P;case 2:return a=e.sent,e.next=5,a.delete("audios",[t,n]);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();function F(){return(F=Object(S.a)(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.a)(P);case 2:return n=e.sent,a=n.transaction("audios"),e.next=6,Object(E.a)(a.store.index("project").openCursor(t));case 6:r=e.sent;case 7:if(!r){e.next=15;break}return e.next=10,[r.value.audioId,r.value];case 10:return e.next=12,Object(E.a)(r.continue());case 12:r=e.sent,e.next=7;break;case 15:return e.next=17,Object(E.a)(a.done);case 17:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function T(){return(T=Object(S.a)(l.a.mark(function e(t){var n,a,r,i,o,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,a=!1,r=void 0,e.prev=3,i=t[Symbol.iterator]();case 5:if(n=(o=i.next()).done){e.next=12;break}return s=o.value,e.next=9,s;case 9:n=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a=!0,r=e.t0;case 18:e.prev=18,e.prev=19,n||null==i.return||i.return();case 21:if(e.prev=21,!a){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])}))).apply(this,arguments)}var N=function(){function e(){Object(p.a)(this,e),this.projectId=void 0,this.audioMap=new Map,this.nextId=0}return Object(h.a)(e,[{key:"add",value:function(){var e=Object(d.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,L(Object(s.a)({},t,{projectId:this.projectId,audioId:this.nextId}));case 3:e.next=6;break;case 5:this.audioMap.set(this.nextId,t);case 6:return e.abrupt("return",this.nextId++);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(d.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=4;break}return e.next=3,R(this.projectId,t);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",this.audioMap.get(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(d.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,R(this.projectId,t);case 3:e.next=6;break;case 5:this.audioMap.set(t,n);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(d.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.projectId){e.next=5;break}return e.next=3,z(this.projectId,t);case 3:e.next=6;break;case 5:this.audioMap.delete(t);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveToProject",value:function(){var e=Object(d.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.projectId=t,e.next=3,I(t,this.audioMap);case 3:this.audioMap.clear();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"entries",value:function(){return null!=this.projectId?function(e){return F.apply(this,arguments)}(this.projectId):function(e){return T.apply(this,arguments)}(this.audioMap.entries())}}]),e}(),Y=n(27),X=n(38),Z=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this))).audioScene=void 0,n.audioScene=e,n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"updateMatrixWorld",value:function(e){Object(X.a)(Object(f.a)(t.prototype),"updateMatrixWorld",this).call(this,e),this.audioScene.setListenerFromMatrix(this.matrixWorld)}}]),t}(b.k),U=function(e){function t(e,n){var a;return Object(p.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this))).audioContext=void 0,a.audioSource=void 0,a.source=void 0,a.audioContext=n,a.audioSource=n.createBufferSource(),a.source=e.createSource({position:new Float32Array([0,1,3]),forward:new Float32Array([1,0,0])}),a.audioSource.connect(a.source.input),a}return Object(v.a)(t,e),Object(h.a)(t,[{key:"updateMatrixWorld",value:function(e){Object(X.a)(Object(f.a)(t.prototype),"updateMatrixWorld",this).call(this,e),this.source.setFromMatrix(this.matrixWorld)}},{key:"setBuffer",value:function(e){this.audioSource.buffer&&(this.audioSource.stop(),this.audioSource.disconnect(),this.audioSource=this.audioContext.createBufferSource(),this.audioSource.connect(this.source.input)),this.audioSource.buffer=e}},{key:"setLoop",value:function(e){this.audioSource.loop=e}},{key:"play",value:function(){this.audioSource.start()}},{key:"stop",value:function(){this.audioSource.buffer&&this.audioSource.stop()}}]),t}(b.k),W=new b.c(1,1,1),H=new b.j,B=function(e){function t(e,n,a){var r;return Object(p.a)(this,t),(r=Object(m.a)(this,Object(f.a)(t).call(this,W,H))).audioLibrary=void 0,r.audioId=void 0,r.audioFile=void 0,r.audioContext=void 0,r.audioScene=void 0,r.audio=void 0,r.audioLibrary=e,r.audioContext=n,r.audioScene=a,r.audio=new U(a,n),r.add(r.audio),r}return Object(v.a)(t,e),Object(h.a)(t,[{key:"loadAudio",value:function(){var e=Object(d.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.audioId=t,e.next=3,this.audioLibrary.get(t);case 3:if(this.audioFile=e.sent,!this.audioFile){e.next=12;break}return e.next=7,this.audioContext.decodeAudioData(this.audioFile.data.slice(0));case 7:n=e.sent,this.audio.stop(),this.audio.setBuffer(n),this.audio.setLoop(!0),this.audio.play();case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"toData",value:function(){return{name:this.name,position:this.position.toArray(),scale:this.scale.toArray(),rotation:this.rotation.toArray().slice(0,3),audioId:this.audioId}}},{key:"fromData",value:function(e){return this.name=e.name,this.position.set(e.position[0],e.position[1],e.position[2]),this.scale.set(e.scale[0],e.scale[1],e.scale[2]),this.rotation.set(e.rotation[0],e.rotation[1],e.rotation[2]),null!=e.audioId&&this.loadAudio(e.audioId),this}}]),t}(b.h),K=new b.c(1,1,1),G=new b.j,q=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{width:15,depth:15,height:3},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS;Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this))).audioLibrary=void 0,n.roomDimensions=void 0,n.roomMaterials=void 0,n.grid=void 0,n.wallNorth=new b.h(K,G),n.wallEast=new b.h(K,G),n.wallSouth=new b.h(K,G),n.wallWest=new b.h(K,G),n.camera=new b.l(60,1,.1,1e3),n.audioContext=new AudioContext,n.audioScene=void 0,n.listener=void 0,n.audioLibrary=e,n.name=a,n.roomDimensions=r,n.roomMaterials=i;var o=new b.a(16777215,.5);n.add(o);var s=new b.o(16777215,.5);s.position.set(5,5,0),s.lookAt(0,0,0),n.add(s);var c=Math.max(r.width,r.depth);return n.grid=new b.g(c,c,16777215,16777215),n.add(n.grid),n.updateWalls(),n.add(n.wallNorth),n.add(n.wallEast),n.add(n.wallSouth),n.add(n.wallWest),n.camera.position.z=4,n.camera.position.y=3,n.camera.lookAt(new b.t(0,1,0)),n.audioScene=new Y.ResonanceAudio(n.audioContext,{dimensions:r,materials:i}),n.listener=new Z(n.audioScene),n.audioScene.output.connect(n.audioContext.destination),n.camera.add(n.listener),n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"dimensions",get:function(){return this.roomDimensions},set:function(e){this.roomDimensions=e,this.audioScene.setRoomProperties(e,this.roomMaterials),this.remove(this.grid);var t=Math.max(e.width,e.depth);this.grid=new b.g(t,t,16777215,16777215),this.add(this.grid),this.updateWalls()}},{key:"materials",get:function(){return this.roomMaterials},set:function(e){this.roomMaterials=e,this.audioScene.setRoomProperties(this.roomDimensions,e)}}]),Object(h.a)(t,[{key:"addObject",value:function(){var e=new B(this.audioLibrary,this.audioContext,this.audioScene);return e.position.y+=.5,e.name="New object",this.add(e),e}},{key:"updateWalls",value:function(){var e=this.roomDimensions,t=e.width,n=e.depth,a=e.height;this.wallNorth.scale.set(t,a,.25),this.wallEast.scale.set(.25,a,n),this.wallSouth.scale.set(t,a,.25),this.wallWest.scale.set(.25,a,n),this.wallNorth.position.set(0,a/2,n/2),this.wallEast.position.set(t/2,a/2,0),this.wallSouth.position.set(0,a/2,-n/2),this.wallWest.position.set(-t/2,a/2,0)}},{key:"toData",value:function(){return{name:this.name,dimensions:this.dimensions,materials:this.materials,objects:this.children.filter(function(e){return e instanceof B}).map(function(e){return e.toData()})}}},{key:"fromData",value:function(e){var t=this;this.name=e.name,this.dimensions=e.dimensions,e.materials&&(this.materials=e.materials);var n=e.objects.map(function(e){return new B(t.audioLibrary,t.audioContext,t.audioScene).fromData(e)});return this.add.apply(this,Object(c.a)(n)),this}}]),t}(b.q),_=function(){},J={onSelect:_,onScale:_,onTranslate:_},V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;Object(p.a)(this,e),this.events=void 0,this.audioLibrary=new N,this.id=void 0,this.name="New project",this.rooms=[],this.audioType=1,this.activeRoom=void 0,this.activeObject=null,this.outlineMesh=new b.h,this.events=t;var n=new q(this.audioLibrary,"First room");n.addObject(),this.rooms.push(n),this.activeRoom=n,this.outlineMesh.material=new b.i({color:16777215,side:b.b}),this.outlineMesh.scale.multiplyScalar(1.05)}return Object(h.a)(e,[{key:"camera",get:function(){return this.activeRoom.camera}}]),Object(h.a)(e,[{key:"close",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=this.rooms[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){a.value.audioContext.close()}}catch(i){t=!0,n=i}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"addRoom",value:function(){var e=new q(this.audioLibrary,"New room");return e.addObject(),this.rooms.push(e),this.selectRoom(e),e}},{key:"selectRoom",value:function(e){this.activeRoom.audioContext.suspend(),e.audioContext.resume(),e.camera.aspect=this.activeRoom.camera.aspect,e.camera.updateProjectionMatrix(),this.activeRoom=e,this.selectObject(null)}},{key:"selectObject",value:function(e){this.activeObject&&this.activeObject.remove(this.outlineMesh),e&&(this.outlineMesh.geometry=e.geometry,e.add(this.outlineMesh)),this.activeObject=e,this.events.onSelect(e)}},{key:"toData",value:function(){return{savedAt:new Date,name:this.name,rooms:this.rooms.map(function(e){return e.toData()}),nextAudioId:this.audioLibrary.nextId}}},{key:"fromData",value:function(e,t){var n=this;this.id=t,this.audioLibrary.projectId=t,this.audioLibrary.nextId=e.nextAudioId||0,this.name=e.name,this.rooms=e.rooms.map(function(e){return new q(n.audioLibrary).fromData(e)}),this.activeRoom=this.rooms[0];for(var a=1;a<this.rooms.length;a++)this.rooms[a].audioContext.suspend();return this}},{key:"save",value:function(){var e=Object(d.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(this);case 2:if(t=e.sent,null!=this.id){e.next=7;break}return this.id=t,e.next=7,this.audioLibrary.saveToProject(t);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t){var n=document.createElement("input");n.type="file",e.accept&&(n.accept=e.accept),n.onchange=function(){n.files&&t(n.files[0])},n.click()})},Q=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){n.result&&t(n.result)},n.onerror=function(){console.error("Error:",n.error)},n.readAsArrayBuffer(e)})},ee=function(){var e=Object(d.a)(l.a.mark(function e(t){var n,a,r,i,o,s,c,u,d,p,h,m,f,v,b;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.loadAsync(t);case 2:return n=e.sent,e.t0=JSON,e.next=6,n.file("metadata.json").async("text");case 6:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.t2=JSON,e.next=11,n.file("audioLibrary.json").async("text");case 11:e.t3=e.sent,r=e.t2.parse.call(e.t2,e.t3),i=n.folder("audio"),o=new V,s=!0,c=!1,u=void 0,e.prev=18,d=r[Symbol.iterator]();case 20:if(s=(p=d.next()).done){e.next=33;break}return h=p.value,m=h.id,f=h.name,v=h.type,e.next=27,i.file(m.toString()).async("arraybuffer");case 27:b=e.sent,o.audioLibrary.set(m,{name:f,type:v,data:b}),m>=o.audioLibrary.nextId&&(o.audioLibrary.nextId=m+1);case 30:s=!0,e.next=20;break;case 33:e.next=39;break;case 35:e.prev=35,e.t4=e.catch(18),c=!0,u=e.t4;case 39:e.prev=39,e.prev=40,s||null==d.return||d.return();case 42:if(e.prev=42,!c){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return o.fromData(a),e.abrupt("return",o);case 49:case"end":return e.stop()}},e,this,[[18,35,39,47],[40,,42,46]])}));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=Object(d.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({accept:"application/zip"});case 2:return t=e.sent,e.next=5,ee(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),ne=function(){function e(){Object(p.a)(this,e),this.onGamepadConnected=function(e){console.log("Gamepad connected:",e.gamepad)},this.onGamepadDisconnected=function(e){console.log("Gamepad disconnected:",e.gamepad)}}return Object(h.a)(e,[{key:"listen",value:function(){window.addEventListener("gamepadconnected",this.onGamepadConnected),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected)}},{key:"stop",value:function(){window.removeEventListener("gamepadconnected",this.onGamepadConnected),window.removeEventListener("gamepaddisconnected",this.onGamepadDisconnected)}},{key:"getAxis",value:function(e){var t=navigator.getGamepads(),n=0,a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=o.value;if(c&&"standard"===c.mapping)if(e<4){var u=c.axes[e];Math.abs(u)>=.1&&Math.abs(u)>Math.abs(n)&&(n=u)}else if(4===e){var l=c.buttons[6].value,d=c.buttons[7].value-l;Math.abs(d)>Math.abs(n)&&(n=d)}}}catch(p){r=!0,i=p}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}}]),e}(),ae=function(){function e(t){var n=this;Object(p.a)(this,e),this.target=void 0,this.keysPressed=new Set,this.lastKeyUp=new Map,this.reset=function(){n.keysPressed.clear()},this.onKeyDown=function(e){e.preventDefault(),Math.abs(e.timeStamp-(n.lastKeyUp.get(e.key)||0))>=100&&n.keysPressed.add(e.key)},this.onKeyUp=function(e){e.preventDefault(),n.keysPressed.delete(e.key),n.lastKeyUp.set(e.key,e.timeStamp)},this.onClick=function(e){2===e.button&&e.shiftKey&&n.reset()},this.target=t}return Object(h.a)(e,[{key:"listen",value:function(){this.target.addEventListener("blur",this.reset),this.target.addEventListener("contextmenu",this.reset),this.target.addEventListener("keydown",this.onKeyDown),this.target.addEventListener("keyup",this.onKeyUp),document.addEventListener("click",this.onClick)}},{key:"stop",value:function(){this.target.removeEventListener("blur",this.reset),this.target.removeEventListener("contextmenu",this.reset),this.target.removeEventListener("keydown",this.onKeyDown),this.target.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("click",this.onClick),this.reset()}},{key:"isPressed",value:function(e){return this.keysPressed.has(e)}}]),e}(),re={x:new b.t(1,0,0),y:new b.t(0,1,0),z:new b.t(0,0,1)},ie=function(){function e(t){var n=this;Object(p.a)(this,e),this.target=null,this.project=void 0,this.rafHandle=0,this.previousTimestamp=0,this.renderer=new b.u,this.canvas=void 0,this.raycaster=new b.p,this.keys=new ae(this.renderer.domElement),this.gamepads=new ne,this.resize=function(){if(n.target){var e=n.target,t=e.offsetWidth,a=e.offsetHeight;n.project.camera.aspect=t/a,n.project.camera.updateProjectionMatrix(),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(t,a)}},this.animate=function(e){n.rafHandle=window.requestAnimationFrame(n.animate);var t=(e-n.previousTimestamp)/1e3;n.previousTimestamp=e,n.update(t),n.renderer.render(n.project.activeRoom,n.project.camera)},this.project=t,this.canvas=this.renderer.domElement,this.canvas.tabIndex=-1,this.project.selectRoom(this.project.rooms[0]),this.project.camera.position.set(0,1,2),this.project.camera.rotation.set(0,0,0)}return Object(h.a)(e,[{key:"attach",value:function(e){this.keys.listen(),this.gamepads.listen(),this.target=e,e.appendChild(this.canvas),this.resize(),window.requestAnimationFrame(this.animate),window.addEventListener("resize",this.resize)}},{key:"detach",value:function(){window.cancelAnimationFrame(this.rafHandle),window.removeEventListener("resize",this.resize),this.target&&(this.target.removeChild(this.canvas),this.target=null),this.keys.stop(),this.gamepads.stop()}},{key:"focus",value:function(){this.canvas.focus()}},{key:"changeProject",value:function(e){this.project=e,this.resize()}},{key:"update",value:function(e){var t=this.project.camera;this.keys.isPressed("w")&&t.translateOnAxis(re.z,-2*e),this.keys.isPressed("s")&&t.translateOnAxis(re.z,2*e),this.keys.isPressed("a")&&t.translateOnAxis(re.x,-2*e),this.keys.isPressed("d")&&t.translateOnAxis(re.x,2*e),this.keys.isPressed("ArrowLeft")&&t.rotateOnWorldAxis(re.y,e),this.keys.isPressed("ArrowRight")&&t.rotateOnWorldAxis(re.y,-e);var n=this.gamepads.getAxis(0),a=this.gamepads.getAxis(2),r=this.gamepads.getAxis(4);n&&t.translateOnAxis(re.x,2*e*n),r&&t.translateOnAxis(re.y,2*e*r),a&&t.rotateOnWorldAxis(re.y,-e*a)}}]),e}(),oe=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(i)))).targetRef=r.a.createRef(),n.runtime=new ie(n.props.project),n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.targetRef.current&&(this.runtime.attach(this.targetRef.current),this.runtime.focus())}},{key:"componentWillUnmount",value:function(){this.runtime.detach()}},{key:"render",value:function(){return r.a.createElement("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},ref:this.targetRef})}}]),t}(r.a.Component),se=n(6),ce=n(7);function ue(){var e=Object(se.a)(["\n  display: block;\n  appearance: none;\n  border: none;\n  background: hsl(210, 29%, 20%);\n  color: #fff;\n  cursor: pointer;\n  border-radius: 3px;\n  padding: 8px 12px;\n  margin-left: 10px;\n  font-size: 0.9em;\n\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n"]);return ue=function(){return e},e}function le(){var e=Object(se.a)(["\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n"]);return le=function(){return e},e}function de(){var e=Object(se.a)(["\n  padding: 10px 15px;\n"]);return de=function(){return e},e}function pe(){var e=Object(se.a)(["\n  padding: 10px 15px;\n  background: hsl(210, 29%, 15%);\n"]);return pe=function(){return e},e}function he(){var e=Object(se.a)(["\n  border-radius: 5px;\n  overflow: hidden;\n  max-width: 600px;\n  color: #fff;\n  background: hsl(210, 29%, 29%);\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n"]);return he=function(){return e},e}function me(){var e=Object(se.a)(["\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 2;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]);return me=function(){return e},e}var fe=ce.b.div(me()),ve=ce.b.div(he()),be=ce.b.div(pe()),je=ce.b.div(de()),xe=ce.b.div(le()),ye=ce.b.button(ue()),we=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).onBackdropClick=function(e){e.currentTarget===e.target&&n.props.onDismiss&&n.props.onDismiss()},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement(fe,{onClick:this.onBackdropClick},r.a.createElement(ve,null,r.a.createElement(be,null,this.props.title),r.a.createElement(je,null,this.props.children)))}}]),t}(r.a.Component),Oe=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.audioEntry;return r.a.createElement(we,{title:"Audio File",onDismiss:this.props.onDismiss},r.a.createElement("p",null,r.a.createElement("b",null,"Name:")," ",t.name),r.a.createElement("p",null,r.a.createElement("b",null,"Type:")," ",t.type),r.a.createElement("p",null,r.a.createElement("b",null,"Size:")," ",Math.ceil(t.data.byteLength/1024)," KiB"),r.a.createElement(xe,null,r.a.createElement(ye,{onClick:function(){return e.props.onDelete(t)}},"Delete"),r.a.createElement(ye,{onClick:function(){return e.props.onExport(t)}},"Export"),r.a.createElement(ye,{onClick:this.props.onCancel},"Back")))}}]),t}(r.a.Component);function ge(){var e=Object(se.a)(["\n  flex: 1 1 150px;\n  margin: 5px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  cursor: pointer;\n  background: hsl(210, 29%, 20%);\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n"]);return ge=function(){return e},e}function ke(){var e=Object(se.a)(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  margin: 0 -5px;\n"]);return ke=function(){return e},e}var Ee=ce.b.div(ke()),Se=ce.b.div(ge()),Ae=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).previewAudio=new Audio,n.state={entries:[],selectedEntry:null},n.openAudioFileDialog=Object(d.a)(l.a.mark(function e(){var t,a,r,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({accept:"audio/*"});case 2:return t=e.sent,e.next=5,Q(t);case 5:return a=e.sent,r={name:t.name,type:t.type,data:a},e.next=9,n.props.audioLibrary.add(r);case 9:i=e.sent,n.setState(function(e){var t=e.entries;return{entries:[].concat(Object(c.a)(t),[Object(s.a)({id:i},r)])}});case 11:case"end":return e.stop()}},e,this)})),n.stopPreview=function(){n.previewAudio.pause(),URL.revokeObjectURL(n.previewAudio.src)},n.dismiss=function(){n.setState({selectedEntry:null}),n.props.onDismiss(),n.stopPreview()},n.unselectEntry=function(){n.setState({selectedEntry:null}),n.stopPreview()},n.deleteAudio=function(e){var t=e.id;n.props.audioLibrary.delete(t),n.setState(function(e){return{entries:e.entries.filter(function(e){return e.id!==t}),selectedEntry:null}})},n.exportAudio=function(e){var t=e.name,n=e.type,a=e.data;Object(y.saveAs)(new Blob([a],{type:n}),t)},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"previewEntry",value:function(e){this.previewAudio.src=URL.createObjectURL(new Blob([e.data])),this.previewAudio.loop=!0,this.previewAudio.play()}},{key:"selectEntry",value:function(e){this.props.onSelect?this.props.onSelect(e):this.setState({selectedEntry:e})}},{key:"updateEntries",value:function(){var e=Object(d.a)(l.a.mark(function e(){var t,n,a,r,i,o,c,u,d,p,h;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=!0,a=!1,e.prev=3,i=Object(x.a)(this.props.audioLibrary.entries());case 5:return e.next=7,i.next();case 7:return o=e.sent,n=o.done,e.next=11,o.value;case 11:if(c=e.sent,n){e.next=18;break}u=c,d=Object(j.a)(u,2),p=d[0],h=d[1],t.push(Object(s.a)({},h,{id:p}));case 15:n=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),a=!0,r=e.t0;case 24:if(e.prev=24,e.prev=25,n||null==i.return){e.next=29;break}return e.next=29,i.return();case 29:if(e.prev=29,!a){e.next=32;break}throw r;case 32:return e.finish(29);case 33:return e.finish(24);case 34:this.setState({entries:t.sort(function(e,t){return e.id-t.id})});case 35:case"end":return e.stop()}},e,this,[[3,20,24,34],[25,,29,33]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateEntries();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(d.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.audioLibrary===this.props.audioLibrary){e.next=3;break}return e.next=3,this.updateEntries();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.previewAudio.pause(),URL.revokeObjectURL(this.previewAudio.src)}},{key:"render",value:function(){var e=this,t=this.state,n=t.entries,a=t.selectedEntry;return a?r.a.createElement(Oe,{audioEntry:a,onDelete:this.deleteAudio,onExport:this.exportAudio,onCancel:this.unselectEntry,onDismiss:this.dismiss}):r.a.createElement(we,{title:this.props.onSelect?"Select Audio":"Audio Library",onDismiss:this.dismiss},r.a.createElement(Ee,null,n.length>0&&n.map(function(t){return r.a.createElement(Se,{key:t.id,title:t.name,onClick:function(){return e.selectEntry(t)},onMouseEnter:function(){return e.previewEntry(t)},onMouseLeave:e.stopPreview},t.name," ",r.a.createElement("br",null),t.type," ",r.a.createElement("br",null),Math.ceil(t.data.byteLength/1024)," KiB")})),!n.length&&r.a.createElement("div",null,"You haven't added any audio files yet"),r.a.createElement(xe,null,r.a.createElement(ye,{onClick:this.openAudioFileDialog},"Add audio file"),r.a.createElement(ye,{onClick:this.dismiss},"Cancel")))}}]),t}(r.a.Component);function Pe(){var e=Object(se.a)(["\n  height: 0;\n  margin: 5px;\n  border-bottom: 1px solid hsl(210, 15%, 35%);\n"]);return Pe=function(){return e},e}function Me(){var e=Object(se.a)(["\n  white-space: nowrap;\n  padding: 8px 20px;\n  margin: 2px 0;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 15%);\n  }\n"]);return Me=function(){return e},e}function Ce(){var e=Object(se.a)(["\n  z-index: 1;\n  position: absolute;\n  left: 0;\n  top: 100%;\n  background: hsl(210, 25%, 20%);\n  padding: 5px 0;\n  min-width: 200px;\n  font-size: 0.95em;\n  box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.5);\n\n  border-bottom-left-radius: 3px;\n  border-bottom-right-radius: 3px;\n\n  cursor: default;\n"]);return Ce=function(){return e},e}function De(){var e=Object(se.a)(["\n      background: hsl(210, 25%, 20%);\n    "]);return De=function(){return e},e}function Re(){var e=Object(se.a)(["\n  position: relative;\n  display: inline-block;\n  padding: 10px 15px;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 25%, 20%);\n  }\n\n  ","\n"]);return Re=function(){return e},e}function Le(){var e=Object(se.a)(["\n  flex: 0 0 auto;\n  background: hsl(210, 29%, 15%);\n  color: #fff;\n  font-size: 0.9em;\n  padding: 0 10px;\n  user-select: none;\n\n  :focus {\n    outline: none;\n  }\n"]);return Le=function(){return e},e}var Ie,ze=ce.b.div(Le()),Fe=ce.b.div(Re(),function(e){return e.isActive&&Object(ce.a)(De())}),Te=ce.b.div(Ce()),Ne=ce.b.div(Me()),Ye=ce.b.div(Pe());!function(e){e[e.FileMenu=0]="FileMenu",e[e.EditMenu=1]="EditMenu",e[e.ViewMenu=2]="ViewMenu",e[e.HelpMenu=3]="HelpMenu"}(Ie||(Ie={}));var Xe=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={activeMenu:null},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"toggleMenu",value:function(e){this.setState(function(t){return{activeMenu:t.activeMenu===e?null:e}})}},{key:"closeMenu",value:function(){this.setState({activeMenu:null})}},{key:"render",value:function(){var e=this,t=this.state.activeMenu;return r.a.createElement(ze,{tabIndex:-1,onBlur:function(){return e.closeMenu()}},r.a.createElement(Fe,{isActive:t===Ie.FileMenu,onClick:function(){return e.toggleMenu(Ie.FileMenu)}},"File",r.a.createElement(Te,{hidden:t!==Ie.FileMenu},r.a.createElement(Ne,{onClick:this.props.onNewProject},"New project"),r.a.createElement(Ye,null),r.a.createElement(Ne,{onClick:this.props.onLoadProject},"Load project"),r.a.createElement(Ne,{onClick:this.props.onImportProject},"Import project"),r.a.createElement(Ye,null),r.a.createElement(Ne,{onClick:this.props.onSaveProject},"Save project"),r.a.createElement(Ne,{onClick:this.props.onExportProject},"Export project"),r.a.createElement(Ye,null),r.a.createElement(Ne,null,"Settings"))),r.a.createElement(Fe,{isActive:t===Ie.EditMenu,onClick:function(){return e.toggleMenu(Ie.EditMenu)}},"Edit",r.a.createElement(Te,{hidden:t!==Ie.EditMenu},r.a.createElement(Ne,{onClick:this.props.onAddObject},"Add object"),r.a.createElement(Ne,{onClick:this.props.onDeleteObject},"Delete object"),r.a.createElement(Ye,null),r.a.createElement(Ne,{onClick:this.props.onAddRoom},"Add room"),r.a.createElement(Ne,{onClick:this.props.onDeleteRoom},"Delete room"),r.a.createElement(Ye,null),r.a.createElement(Ne,null,"Release the kraken"))),r.a.createElement(Fe,{isActive:t===Ie.ViewMenu,onClick:function(){return e.toggleMenu(Ie.ViewMenu)}},"View",r.a.createElement(Te,{hidden:t!==Ie.ViewMenu},r.a.createElement(Ne,{onClick:this.props.onShowAudioLibrary},"Audio Library"),r.a.createElement(Ne,{onClick:this.props.onShowProjectManager},"Project Manager"),r.a.createElement(Ye,null),r.a.createElement(Ne,null,"Toggle Fullscreen"))),r.a.createElement(Fe,{isActive:t===Ie.HelpMenu,onClick:function(){return e.toggleMenu(Ie.HelpMenu)}},"Help",r.a.createElement(Te,{hidden:t!==Ie.HelpMenu},r.a.createElement(Ne,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d/issues","_blank")}},"Issues"),r.a.createElement(Ne,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d","_blank")}},"Source Code"),r.a.createElement(Ye,null),r.a.createElement(Ne,{onClick:function(){return window.open("https://github.com/niklaskorz/audio3d/blob/master/README.md","_blank")}},"About"))),r.a.createElement(Fe,{onClick:this.props.onRunProject},"Run"))}}]),t}(r.a.Component),Ze=function(e){return 180*e/Math.PI},Ue=function(e){return e/180*Math.PI},We=function(e,t){return Math.round(e/t)*t};function He(){var e=Object(se.a)(["\n      background: hsl(210, 29%, 20%);\n      border-left: 2px solid #3498db;\n    "]);return He=function(){return e},e}function Be(){var e=Object(se.a)(["\n  cursor: pointer;\n  padding: 7px 10px;\n  border-radius: 2px;\n  ",";\n"]);return Be=function(){return e},e}function Ke(){var e=Object(se.a)(["\n  list-style: none;\n  padding: 5px;\n  margin: 5px 0;\n  border-radius: 3px;\n  background: hsl(210, 29%, 24%);\n"]);return Ke=function(){return e},e}function Ge(){var e=Object(se.a)(["\n  display: flex;\n  flex-direction: row;\n\n  > "," {\n    flex: 1;\n    width: auto;\n    min-width: 0;\n\n    margin-right: 5px;\n\n    :last-child {\n      margin-right: 0;\n    }\n  }\n"]);return Ge=function(){return e},e}function qe(){var e=Object(se.a)(["\n  cursor: pointer;\n"]);return qe=function(){return e},e}function _e(){var e=Object(se.a)(["\n  display: block;\n  appearance: none;\n  background: hsl(210, 29%, 24%);\n  border-radius: 3px;\n  border: 2px solid hsl(210, 29%, 24%);\n  color: #fff;\n  width: 100%;\n  padding: 10px 12px;\n  margin: 5px 0;\n\n  transition: 0.2s ease border-color;\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n"]);return _e=function(){return e},e}function Je(){var e=Object(se.a)(["\n  margin: 20px 0;\n"]);return Je=function(){return e},e}function Ve(){var e=Object(se.a)(["\n  position: relative;\n  flex: 1;\n  height: 100%;\n\n  :focus-within > "," {\n    display: block;\n  }\n"]);return Ve=function(){return e},e}function $e(){var e=Object(se.a)(["\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n"]);return $e=function(){return e},e}function Qe(){var e=Object(se.a)(["\n  flex: 0 0 300px;\n  height: 100%;\n  background: hsl(210, 29%, 29%);\n  color: #fff;\n  padding: 0 15px;\n  overflow-x: hidden;\n  overflow-y: auto;\n"]);return Qe=function(){return e},e}function et(){var e=Object(se.a)(["\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n"]);return et=function(){return e},e}function tt(){var e=Object(se.a)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n"]);return tt=function(){return e},e}var nt,at=ce.b.div(tt()),rt=ce.b.div(et()),it=ce.b.aside(Qe()),ot=ce.b.div($e()),st=ce.b.main(Ve(),ot),ct=ce.b.div(Je()),ut=ce.b.input(_e()),lt=Object(ce.b)(ut.withComponent("select"))(qe()),dt=ce.b.div(Ge(),ut),pt=ce.b.ol(Ke()),ht=ce.b.li(Be(),function(e){return e.active&&Object(ce.a)(He())}),mt=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props,t=e.object,n=e.onUpdateName,a=e.onUpdatePosition,i=e.onUpdateRotation,o=e.onUpdateScale;return r.a.createElement("div",null,r.a.createElement(ct,null,r.a.createElement("label",null,"Object Name"),r.a.createElement(ut,{type:"text",value:t.name,onChange:function(e){return n(e.currentTarget.value)}})),r.a.createElement(ct,null,r.a.createElement("label",null,"Position (x, y, z)"),r.a.createElement(dt,null,r.a.createElement(ut,{type:"number",step:.01,value:t.position.x.toFixed(2),onChange:function(e){return a(We(e.currentTarget.valueAsNumber,.01),t.position.y,t.position.z)}}),r.a.createElement(ut,{type:"number",step:.01,value:t.position.y.toFixed(2),onChange:function(e){return a(t.position.x,We(e.currentTarget.valueAsNumber,.01),t.position.z)}}),r.a.createElement(ut,{type:"number",step:.01,value:t.position.z.toFixed(2),onChange:function(e){return a(t.position.x,t.position.y,We(e.currentTarget.valueAsNumber,.01))}}))),r.a.createElement(ct,null,r.a.createElement("label",null,"Euler-Rotation in Degrees (x, y, z)"),r.a.createElement(dt,null,r.a.createElement(ut,{type:"number",step:1,value:Ze(t.rotation.x).toFixed(0),onChange:function(e){return i(Ue(e.currentTarget.valueAsNumber%360),t.rotation.y,t.rotation.z)}}),r.a.createElement(ut,{type:"number",step:1,value:Ze(t.rotation.y).toFixed(0),onChange:function(e){return i(t.rotation.x,Ue(e.currentTarget.valueAsNumber%360),t.rotation.z)}}),r.a.createElement(ut,{type:"number",step:1,value:Ze(t.rotation.z).toFixed(0),onChange:function(e){return i(t.rotation.x,t.rotation.y,Ue(e.currentTarget.valueAsNumber%360))}}))),r.a.createElement(ct,null,r.a.createElement("label",null,"Size (width, height, depth)"),r.a.createElement(dt,null,r.a.createElement(ut,{type:"number",step:.1,min:.1,max:10,value:t.scale.x.toFixed(1),onChange:function(e){return o(e.currentTarget.valueAsNumber,t.scale.y,t.scale.z)}}),r.a.createElement(ut,{type:"number",step:.1,min:.1,max:10,value:t.scale.y.toFixed(1),onChange:function(e){return o(t.scale.x,e.currentTarget.valueAsNumber,t.scale.z)}}),r.a.createElement(ut,{type:"number",step:.1,min:.1,max:10,value:t.scale.z.toFixed(1),onChange:function(e){return o(t.scale.x,t.scale.y,e.currentTarget.valueAsNumber)}}))),r.a.createElement(ct,null,r.a.createElement("label",null,"Audio"),r.a.createElement(ut,{type:"text",readOnly:!0,value:t.audio?"".concat(t.audio.name," (").concat(Math.ceil(t.audio.data.byteLength/1024)," KiB)"):"None",onClick:this.props.onShowAudioSelection})))}}]),t}(r.a.Component);!function(e){e[e.AxisX=0]="AxisX",e[e.AxisY=1]="AxisY",e[e.AxisZ=2]="AxisZ",e[e.PlaneYZ=3]="PlaneYZ",e[e.PlaneXZ=4]="PlaneXZ",e[e.PlaneXY=5]="PlaneXY"}(nt||(nt={}));var ft,vt=function(e){function t(e){var n;Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this))).project=void 0,n.objectDragDirection=null,n.isScaling=!1,n.dragOffset=new b.t,n.lastPoint=new b.t,n.plane=new b.m,n.axisX=void 0,n.axisY=void 0,n.axisZ=void 0,n.scaleX=void 0,n.scaleY=void 0,n.scaleZ=void 0,n.planeYZ=void 0,n.planeXZ=void 0,n.planeXY=void 0,n.project=e;var a={transparent:!0,opacity:.75,side:b.e},r=new b.c(.05,.05,.5);n.axisX=new b.h(r,new b.i(Object(s.a)({},a,{color:16711680}))),n.axisX.position.set(.275,0,0),n.axisX.rotation.y=Math.PI/2,n.axisX.userData.direction=nt.AxisX,n.axisY=new b.h(r,new b.i(Object(s.a)({},a,{color:65280}))),n.axisY.position.set(0,.275,0),n.axisY.rotation.x=Math.PI/2,n.axisY.userData.direction=nt.AxisY,n.axisZ=new b.h(r,new b.i(Object(s.a)({},a,{color:255}))),n.axisZ.position.set(0,0,.275),n.axisZ.userData.direction=nt.AxisZ,n.add(n.axisX),n.add(n.axisY),n.add(n.axisZ);var i=new b.r(.05,16,16);n.scaleX=new b.h(i,new b.i(Object(s.a)({},a,{color:16711680}))),n.scaleX.position.set(.65,0,0),n.scaleX.userData.direction=nt.AxisX,n.scaleX.userData.isScale=!0,n.scaleY=new b.h(i,new b.i(Object(s.a)({},a,{color:65280}))),n.scaleY.position.set(0,.65,0),n.scaleY.userData.direction=nt.AxisY,n.scaleY.userData.isScale=!0,n.scaleZ=new b.h(i,new b.i(Object(s.a)({},a,{color:255}))),n.scaleZ.position.set(0,0,.65),n.scaleZ.userData.direction=nt.AxisZ,n.scaleZ.userData.isScale=!0,n.add(n.scaleX),n.add(n.scaleY),n.add(n.scaleZ);var o=new b.n(.25,.25);return n.planeYZ=new b.h(o,new b.i(Object(s.a)({},a,{color:65535}))),n.planeYZ.position.set(0,.25,.25),n.planeYZ.rotation.y=Math.PI/2,n.planeYZ.userData.direction=nt.PlaneYZ,n.planeXZ=new b.h(o,new b.i(Object(s.a)({},a,{color:16711935}))),n.planeXZ.position.set(.25,0,.25),n.planeXZ.rotation.x=Math.PI/2,n.planeXZ.userData.direction=nt.PlaneXZ,n.planeXY=new b.h(o,new b.i(Object(s.a)({},a,{color:16776960}))),n.planeXY.position.set(.25,.25,0),n.planeXY.userData.direction=nt.PlaneXY,n.add(n.planeYZ),n.add(n.planeXZ),n.add(n.planeXY),n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"getControlFromRaycaster",value:function(e){if(!this.project.activeObject)return null;this.position.copy(this.project.activeObject.position);var t=e.intersectObjects(this.children),n=!0,a=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,c=s.object;if(c.userData.hasOwnProperty("direction"))return this.dragOffset.copy(s.point).sub(this.project.activeObject.position),this.lastPoint.copy(s.point),c}}catch(u){a=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return null}},{key:"onClick",value:function(e){var t=this.getControlFromRaycaster(e);return!(!t||!t.userData.hasOwnProperty("direction"))&&(this.objectDragDirection=t.userData.direction,this.isScaling=!!t.userData.isScale,this.onMove(e),!0)}},{key:"onMove",value:function(e){var t=e.ray;if(null!==this.objectDragDirection&&this.project.activeObject){var n=this.project.activeObject.position,a=this.plane,r=null;switch(this.objectDragDirection){case nt.AxisX:a.set(new b.t(0,1,0),-n.y),r=new b.m(new b.t(0,0,1),-n.z);break;case nt.AxisY:a.set(new b.t(1,0,0),-n.x),r=new b.m(new b.t(0,0,1),-n.z);break;case nt.AxisZ:a.set(new b.t(1,0,0),-n.x),r=new b.m(new b.t(0,1,0),-n.y);break;case nt.PlaneXY:a.set(new b.t(0,0,1),-n.z);break;case nt.PlaneYZ:a.set(new b.t(1,0,0),-n.x);break;case nt.PlaneXZ:a.set(new b.t(0,1,0),-n.y)}r&&Math.abs(r.distanceToPoint(t.origin))>Math.abs(a.distanceToPoint(t.origin))&&a.copy(r);var i=t.intersectPlane(a,new b.t);if(i){if(this.isScaling){switch(this.objectDragDirection){case nt.AxisX:this.project.activeObject.scale.x=Math.min(Math.max(this.project.activeObject.scale.x+(i.x-this.lastPoint.x),.1),10);break;case nt.AxisY:this.project.activeObject.scale.y=Math.min(Math.max(this.project.activeObject.scale.y+(i.y-this.lastPoint.y),.1),10);break;case nt.AxisZ:this.project.activeObject.scale.z=Math.min(Math.max(this.project.activeObject.scale.z+(i.z-this.lastPoint.z),.1),10)}this.project.events.onScale(this.project.activeObject.scale)}else{switch(i.sub(this.dragOffset),this.objectDragDirection){case nt.AxisX:this.project.activeObject.position.x=i.x;break;case nt.AxisY:this.project.activeObject.position.y=i.y;break;case nt.AxisZ:this.project.activeObject.position.z=i.z;break;default:this.project.activeObject.position.copy(i)}this.project.events.onTranslate(this.project.activeObject.position)}this.lastPoint.copy(i)}}}}]),t}(b.q);!function(e){e[e.Primary=0]="Primary",e[e.Middle=1]="Middle",e[e.Secondary=2]="Secondary"}(ft||(ft={}));var bt={x:new b.t(1,0,0),y:new b.t(0,1,0),z:new b.t(0,0,1)},jt=function(){function e(t){var n=this;Object(p.a)(this,e),this.target=null,this.project=void 0,this.rafHandle=0,this.previousTimestamp=0,this.controls=void 0,this.renderer=new b.u,this.canvas=void 0,this.outlineMesh=new b.h,this.raycaster=new b.p,this.keys=new ae(this.renderer.domElement),this.gamepads=new ne,this.isDraggingCamera=!1,this.resize=function(){if(n.target){var e=n.target,t=e.offsetWidth,a=e.offsetHeight;n.project.camera.aspect=t/a,n.project.camera.updateProjectionMatrix(),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(t,a)}},this.animate=function(e){n.rafHandle=window.requestAnimationFrame(n.animate);var t=(e-n.previousTimestamp)/1e3;n.previousTimestamp=e,n.update(t),n.renderer.clear(),n.renderer.render(n.project.activeRoom,n.project.camera),n.project.activeObject&&(n.controls.position.copy(n.project.activeObject.position),n.renderer.clearDepth(),n.renderer.render(n.controls,n.project.camera))},this.onMouseDown=function(e){e.button===ft.Secondary&&(n.isDraggingCamera=!0,n.canvas.requestPointerLock()),e.button===ft.Primary&&(n.updateRaycaster(e),n.controls.onClick(n.raycaster)?n.canvas.style.cursor="grabbing":n.checkSceneClick(n.raycaster))},this.onMouseUp=function(e){e.button===ft.Secondary&&n.isDraggingCamera&&(n.isDraggingCamera=!1,document.exitPointerLock()),e.button===ft.Primary&&null!==n.controls.objectDragDirection&&(n.controls.objectDragDirection=null,n.controls.getControlFromRaycaster(n.raycaster)?n.canvas.style.cursor="grab":n.canvas.style.cursor=null)},this.onMouseMove=function(e){n.isDraggingCamera?(e.movementX&&n.project.camera.rotateOnWorldAxis(bt.y,-e.movementX/100),e.movementY&&n.project.camera.rotateOnAxis(bt.x,-e.movementY/100)):(n.updateRaycaster(e),null!==n.controls.objectDragDirection?n.controls.onMove(n.raycaster):n.controls.getControlFromRaycaster(n.raycaster)?n.canvas.style.cursor="grab":n.canvas.style.cursor=null)},this.onWheel=function(e){e.preventDefault();var t=e.deltaY;0===e.deltaMode&&(t/=15),n.project.camera.translateZ(t/10)},this.project=t,this.renderer.autoClear=!1,this.renderer.setClearColor(new b.d(1649238)),this.canvas=this.renderer.domElement,this.canvas.tabIndex=-1,this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("wheel",this.onWheel),this.canvas.addEventListener("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1},!0),this.controls=new vt(t)}return Object(h.a)(e,[{key:"attach",value:function(e){this.keys.listen(),this.gamepads.listen(),this.target=e,e.appendChild(this.canvas),this.resize(),window.requestAnimationFrame(this.animate),window.addEventListener("resize",this.resize)}},{key:"detach",value:function(){window.cancelAnimationFrame(this.rafHandle),window.removeEventListener("resize",this.resize),this.target&&(this.target.removeChild(this.canvas),this.target=null),this.keys.stop(),this.gamepads.stop()}},{key:"focus",value:function(){this.canvas.focus()}},{key:"changeProject",value:function(e){this.project=e,this.controls.project=e,this.resize()}},{key:"update",value:function(e){var t=this.project.camera;this.keys.isPressed("w")&&t.translateOnAxis(bt.z,-2*e),this.keys.isPressed("s")&&t.translateOnAxis(bt.z,2*e),this.keys.isPressed("a")&&t.translateOnAxis(bt.x,-2*e),this.keys.isPressed("d")&&t.translateOnAxis(bt.x,2*e),this.keys.isPressed(" ")&&(t.position.y+=2*e),this.keys.isPressed("Shift")&&(t.position.y-=2*e),this.keys.isPressed("ArrowLeft")&&t.rotateOnWorldAxis(bt.y,e),this.keys.isPressed("ArrowRight")&&t.rotateOnWorldAxis(bt.y,-e),this.keys.isPressed("ArrowUp")&&t.rotateOnAxis(bt.x,e),this.keys.isPressed("ArrowDown")&&t.rotateOnAxis(bt.x,-e);var n=this.gamepads.getAxis(0),a=this.gamepads.getAxis(1),r=this.gamepads.getAxis(2),i=this.gamepads.getAxis(3),o=this.gamepads.getAxis(4);n&&t.translateOnAxis(bt.x,2*e*n),a&&t.translateOnAxis(bt.z,2*e*a),o&&t.translateOnAxis(bt.y,2*e*o),r&&t.rotateOnWorldAxis(bt.y,-e*r),i&&t.rotateOnAxis(bt.x,-e*i)}},{key:"checkSceneClick",value:function(e){var t=e.intersectObjects(this.project.activeRoom.children),n=!0,a=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value.object;if(s instanceof B)return this.project.selectObject(s),!0}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return this.project.selectObject(null),!1}},{key:"updateRaycaster",value:function(e){var t=this.renderer.getSize(new b.s),n=(e.pageX-this.target.offsetLeft)/t.x*2-1,a=-(e.pageY-this.target.offsetTop)/t.y*2+1;this.raycaster.setFromCamera({x:n,y:a},this.project.camera)}}]),e}(),xt=n(32),yt=Object.keys(Y.ResonanceAudio.Utils.ROOM_MATERIAL_COEFFICIENTS),wt=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"selectMaterialHandler",value:function(e){var t=this;return function(n){var a=t.props,r=a.room;(0,a.onUpdateMaterials)(Object(s.a)({},r.materials,Object(xt.a)({},e,n.currentTarget.value)))}}},{key:"render",value:function(){var e=this.props,t=e.room,n=e.onUpdateName,a=e.onUpdateDimensions,i=yt.map(function(e){return r.a.createElement("option",{key:e},e)});return r.a.createElement("div",null,r.a.createElement(ct,null,r.a.createElement("label",null,"Room Name"),r.a.createElement(ut,{type:"text",value:t.name,onChange:function(e){return n(e.currentTarget.value)}})),r.a.createElement(ct,null,r.a.createElement("label",null,"Dimensions (width, depth, height)"),r.a.createElement(dt,null,r.a.createElement(ut,{type:"number",step:1,min:5,max:50,value:t.dimensions.width,onChange:function(e){return a(Object(s.a)({},t.dimensions,{width:Math.round(e.currentTarget.valueAsNumber)}))}}),r.a.createElement(ut,{type:"number",step:1,min:5,max:50,value:t.dimensions.depth,onChange:function(e){return a(Object(s.a)({},t.dimensions,{depth:Math.round(e.currentTarget.valueAsNumber)}))}}),r.a.createElement(ut,{type:"number",step:1,min:2,max:10,value:t.dimensions.height,onChange:function(e){return a(Object(s.a)({},t.dimensions,{height:Math.round(e.currentTarget.valueAsNumber)}))}}))),r.a.createElement(ct,null,r.a.createElement("label",null,"Left wall material"),r.a.createElement(lt,{value:t.materials.left,onChange:this.selectMaterialHandler("left")},i)),r.a.createElement(ct,null,r.a.createElement("label",null,"Right wall material"),r.a.createElement(lt,{value:t.materials.right,onChange:this.selectMaterialHandler("right")},i)),r.a.createElement(ct,null,r.a.createElement("label",null,"Front wall material"),r.a.createElement(lt,{value:t.materials.front,onChange:this.selectMaterialHandler("front")},i)),r.a.createElement(ct,null,r.a.createElement("label",null,"Back wall material"),r.a.createElement(lt,{value:t.materials.back,onChange:this.selectMaterialHandler("back")},i)),r.a.createElement(ct,null,r.a.createElement("label",null,"Floor material"),r.a.createElement(lt,{value:t.materials.down,onChange:this.selectMaterialHandler("down")},i)),r.a.createElement(ct,null,r.a.createElement("label",null,"Ceiling material"),r.a.createElement(lt,{value:t.materials.up,onChange:this.selectMaterialHandler("up")},i)))}}]),t}(r.a.Component),Ot=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.project;return r.a.createElement(we,{title:"Project Info",onDismiss:this.props.onDismiss},r.a.createElement("p",null,r.a.createElement("b",null,"Name:")," ",t.name),r.a.createElement("p",null,r.a.createElement("b",null,"Last update:")," ",t.savedAt.toLocaleString()),r.a.createElement("p",null,r.a.createElement("b",null,"Rooms:")," ",t.rooms.length),r.a.createElement(xe,null,r.a.createElement(ye,{onClick:function(){return e.props.onDelete(t)}},"Delete"),r.a.createElement(ye,{onClick:function(){return e.props.onExport(t)}},"Export"),r.a.createElement(ye,{onClick:this.props.onCancel},"Back")))}}]),t}(r.a.Component);function gt(){var e=Object(se.a)(["\n  padding: 5px 10px;\n"]);return gt=function(){return e},e}function kt(){var e=Object(se.a)(["\n  padding: 5px 10px;\n"]);return kt=function(){return e},e}function Et(){var e=Object(se.a)(["\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 40%);\n  }\n"]);return Et=function(){return e},e}function St(){var e=Object(se.a)(["\n  text-align: left;\n"]);return St=function(){return e},e}function At(){var e=Object(se.a)(["\n  width: 100%;\n"]);return At=function(){return e},e}function Pt(){var e=Object(se.a)(["\n  border: 2px solid hsl(210, 29%, 20%);\n  border-radius: 3px;\n  max-height: 400px;\n  min-width: 500px;\n  overflow-y: auto;\n  padding-bottom: 5px;\n"]);return Pt=function(){return e},e}var Mt,Ct=ce.b.div(Pt()),Dt=ce.b.table(At()),Rt=ce.b.thead(St()),Lt=ce.b.tr(Et()),It=ce.b.th(kt()),zt=ce.b.td(gt()),Ft=function(e){function t(){var e,n;Object(p.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).state={projects:[],selectedProject:null},n.dismiss=function(){n.setState({selectedProject:null}),n.props.onDismiss()},n.unselectProject=function(){n.setState({selectedProject:null})},n.deleteProject=function(e){var t=e.id;t&&(C(t),n.setState(function(e){return{projects:e.projects.filter(function(e){return e.id!==t}),selectedProject:null}}))},n.exportProject=function(e){var t=(new V).fromData(e,e.id);k(t)},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"selectProject",value:function(e){this.props.onSelectProject?this.props.onSelectProject(e):this.setState({selectedProject:e})}},{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:t=e.sent,this.setState({projects:t.reverse()});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.projects,a=t.selectedProject;return a?r.a.createElement(Ot,{project:a,onDelete:this.deleteProject,onExport:this.exportProject,onCancel:this.unselectProject,onDismiss:this.dismiss}):r.a.createElement(we,{title:this.props.onSelectProject?"Load Project":"Project Manager",onDismiss:this.dismiss},n.length>0&&r.a.createElement(Ct,null,r.a.createElement(Dt,null,r.a.createElement(Rt,null,r.a.createElement("tr",null,r.a.createElement(It,null,"ID"),r.a.createElement(It,null,"Name"),r.a.createElement(It,null,"Rooms"),r.a.createElement(It,null,"Last update"))),r.a.createElement("tbody",null,n.map(function(t){return r.a.createElement(Lt,{key:t.id,onClick:function(){return e.selectProject(t)}},r.a.createElement(zt,null,t.id),r.a.createElement(zt,null,t.name),r.a.createElement(zt,null,t.rooms.length),r.a.createElement(zt,null,t.savedAt.toLocaleString()))})))),!n.length&&r.a.createElement("p",null,"You don't have any saved projects yet"),r.a.createElement(xe,null,r.a.createElement(ye,{onClick:this.props.onNewProject},"New project"),r.a.createElement(ye,{onClick:this.dismiss},"Cancel")))}}]),t}(r.a.Component);!function(e){e[e.AudioLibrary=0]="AudioLibrary",e[e.AudioSelection=1]="AudioSelection",e[e.ProjectManager=2]="ProjectManager",e[e.ProjectSelection=3]="ProjectSelection"}(Mt||(Mt={}));var Tt=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).project=new V,n.projectCanvas=new jt(n.project),n.state={rooms:n.project.rooms.map(function(e){return{id:e.id,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedObject:null,modal:null,isRunning:!1},n.mainRef=r.a.createRef(),n.newProject=function(){n.project.close(),n.project=new V({onSelect:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject}),n.projectCanvas.changeProject(n.project),n.setState({rooms:n.project.rooms.map(function(e){return{id:e.id,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedObject:null,modal:null})},n.showProjectSelection=Object(d.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({modal:Mt.ProjectSelection});case 1:case"end":return e.stop()}},e,this)})),n.saveProject=Object(d.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n.project.id){e.next=5;break}if(t=prompt("Project name:",n.project.name)){e.next=4;break}return e.abrupt("return");case 4:n.project.name=t;case 5:return e.next=7,n.project.save();case 7:case"end":return e.stop()}},e,this)})),n.importProject=Object(d.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.project.close(),e.next=3,te();case 3:n.project=e.sent,n.project.events={onSelect:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n.projectCanvas.changeProject(n.project),n.setState({rooms:n.project.rooms.map(function(e){return{id:e.id,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedObject:null});case 7:case"end":return e.stop()}},e,this)})),n.exportProject=function(){k(n.project)},n.addObject=function(){n.project.activeRoom.addObject()},n.deleteObject=function(){n.project.activeObject&&(n.project.activeRoom.remove(n.project.activeObject),n.project.activeObject=null,n.setState({selectedObject:null}))},n.addRoom=function(){var e=n.project.addRoom();n.setState(function(t){return{rooms:[].concat(Object(c.a)(t.rooms),[{id:e.id,name:e.name,dimensions:e.dimensions,materials:e.materials}]),selectedRoomId:t.rooms.length}})},n.deleteRoom=function(){n.state.selectedRoomId>0&&(n.project.rooms.splice(n.state.selectedRoomId,1),n.setState(function(e){return{rooms:[].concat(Object(c.a)(e.rooms.slice(0,e.selectedRoomId)),Object(c.a)(e.rooms.slice(e.selectedRoomId+1))),selectedRoomId:0}}))},n.showAudioLibrary=function(){n.setState({modal:Mt.AudioLibrary})},n.showProjectManager=function(){n.setState({modal:Mt.ProjectManager})},n.updateRoomName=function(e){n.project.activeRoom.name=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(c.a)(n.slice(0,a)),[Object(s.a)({},n[a],{name:e})],Object(c.a)(n.slice(a+1)))}})},n.updateRoomDimensions=function(e){n.project.activeRoom.dimensions=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(c.a)(n.slice(0,a)),[Object(s.a)({},n[a],{dimensions:e})],Object(c.a)(n.slice(a+1)))}})},n.updateRoomMaterials=function(e){n.project.activeRoom.materials=e,n.setState(function(t){var n=t.rooms,a=t.selectedRoomId;return{rooms:[].concat(Object(c.a)(n.slice(0,a)),[Object(s.a)({},n[a],{materials:e})],Object(c.a)(n.slice(a+1)))}})},n.updateName=function(e){n.project.activeObject&&(n.project.activeObject.name=e),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{name:e})}})},n.updateScale=function(e,t,a){n.project.activeObject&&n.project.activeObject.scale.set(e,t,a),n.setState(function(n){var r=n.selectedObject;return{selectedObject:r&&Object(s.a)({},r,{scale:new b.t(e,t,a)})}})},n.updatePosition=function(e,t,a){n.project.activeObject&&n.project.activeObject.position.set(e,t,a),n.setState(function(n){var r=n.selectedObject;return{selectedObject:r&&Object(s.a)({},r,{position:new b.t(e,t,a)})}})},n.updateRotation=function(e,t,a){n.project.activeObject&&n.project.activeObject.rotation.set(e,t,a),n.setState(function(n){var r=n.selectedObject;return{selectedObject:r&&Object(s.a)({},r,{rotation:new b.f(e,t,a)})}})},n.showAudioSelection=function(){n.setState({modal:Mt.AudioSelection})},n.dismissModal=function(){n.setState({modal:null})},n.selectAudio=function(e){n.project.activeObject&&(n.project.activeObject.loadAudio(e.id),n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{audio:e}),modal:null}}))},n.loadProject=function(e){n.project.close(),n.project=(new V).fromData(e,e.id),n.project.events={onSelect:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n.projectCanvas.changeProject(n.project),n.setState({rooms:n.project.rooms.map(function(e){return{id:e.id,name:e.name,dimensions:e.dimensions,materials:e.materials}}),selectedRoomId:0,selectedObject:null,modal:null})},n.runProject=function(){n.projectCanvas.detach(),n.setState({isRunning:!0})},n.onSelectObject=function(e){e?n.setState({selectedObject:{id:e.id,name:e.name,position:e.position,scale:e.scale,rotation:e.rotation,audio:e.audioFile&&Object(s.a)({},e.audioFile,{id:e.audioId})}}):n.setState({selectedObject:null})},n.onTranslateObject=function(e){n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{position:e})}})},n.onScaleObject=function(e){n.setState(function(t){var n=t.selectedObject;return{selectedObject:n&&Object(s.a)({},n,{size:{width:e.x,height:e.y,depth:e.z}})}})},n.project.events={onSelect:n.onSelectObject,onTranslate:n.onTranslateObject,onScale:n.onScaleObject},n}return Object(v.a)(t,e),Object(h.a)(t,[{key:"selectRoom",value:function(e){this.project.selectRoom(this.project.rooms[e]),this.setState({selectedRoomId:e,selectedObject:null})}},{key:"componentDidMount",value:function(){this.mainRef.current&&(this.projectCanvas.attach(this.mainRef.current),this.projectCanvas.focus())}},{key:"componentWillUnmount",value:function(){this.projectCanvas.detach()}},{key:"render",value:function(){var e=this,t=this.state,n=t.modal,a=t.isRunning,i=this.state.selectedObject;return a?r.a.createElement(oe,{project:this.project}):r.a.createElement(at,null,(n===Mt.AudioLibrary||n===Mt.AudioSelection)&&r.a.createElement(Ae,{audioLibrary:this.project.audioLibrary,onDismiss:this.dismissModal,onSelect:n===Mt.AudioSelection?this.selectAudio:void 0}),(n===Mt.ProjectManager||n===Mt.ProjectSelection)&&r.a.createElement(Ft,{onNewProject:this.newProject,onDismiss:this.dismissModal,onSelectProject:n===Mt.ProjectSelection?this.loadProject:void 0}),r.a.createElement(Xe,{onNewProject:this.newProject,onLoadProject:this.showProjectSelection,onSaveProject:this.saveProject,onImportProject:this.importProject,onExportProject:this.exportProject,onAddObject:this.addObject,onDeleteObject:this.deleteObject,onAddRoom:this.addRoom,onDeleteRoom:this.deleteRoom,onShowAudioLibrary:this.showAudioLibrary,onShowProjectManager:this.showProjectManager,onRunProject:this.runProject}),r.a.createElement(rt,null,r.a.createElement(it,null,r.a.createElement(ct,null,r.a.createElement("label",null,"Rooms"),r.a.createElement(pt,null,this.state.rooms.map(function(t,n){return r.a.createElement(ht,{key:t.id,onClick:function(){return e.selectRoom(n)},active:n===e.state.selectedRoomId},t.name||"Anonymous Room")}))),!i&&r.a.createElement(wt,{room:this.state.rooms[this.state.selectedRoomId],onUpdateName:this.updateRoomName,onUpdateDimensions:this.updateRoomDimensions,onUpdateMaterials:this.updateRoomMaterials}),i&&r.a.createElement(mt,{object:i,onUpdateName:this.updateName,onUpdatePosition:this.updatePosition,onUpdateRotation:this.updateRotation,onUpdateScale:this.updateScale,onShowAudioSelection:this.showAudioSelection})),r.a.createElement(st,{ref:this.mainRef},r.a.createElement(ot,null,"Focused"))))}}]),t}(r.a.Component);n(130),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Nt=window;!Nt.AudioContext&&Nt.webkitAudioContext&&(Nt.AudioContext=Nt.webkitAudioContext),o.a.render(r.a.createElement(Tt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},78:function(e,t,n){e.exports=n(132)},91:function(e,t){},93:function(e,t){}},[[78,2,1]]]);
//# sourceMappingURL=main.09dd4446.chunk.js.map