{"version":3,"sources":["audio/AudioImplementation.ts","data/export.ts","data/db.ts","utils/iter.ts","project/GameObject.ts","project/AudioLibrary.ts","audio/defaultAudioContext.ts","utils/math.ts","audio/binaural/BinauralSource.ts","audio/binaural/BinauralScene.ts","audio/Audio3D.ts","audio/Listener3D.ts","audio/binaural/hrtf.ts","audio/AudioScene.ts","project/CodeBlock.ts","project/Room.ts","project/Project.ts","utils/files.ts","data/import.ts","input/GamepadListener.ts","input/KeyboardListener.ts","runtime/Runtime.ts","runtime/styled.ts","runtime/RuntimeContainer.tsx","editor/Modal.tsx","editor/AudioFileModal.tsx","editor/AudioLibraryModal.tsx","editor/MenuBar.tsx","editor/styled.ts","editor/VisualControls.ts","editor/ObjectEditor.tsx","editor/EditorCanvas.ts","editor/RoomEditor.tsx","editor/ProjectInfoModal.tsx","editor/ProjectManagerModal.tsx","editor/Editor.tsx","serviceWorker.ts","index.tsx"],"names":["AudioImplementation","createZip","_ref","Object","asyncToGenerator","regenerator_default","a","mark","_callee","project","metadata","zip","audioLibrary","audioFolder","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","_value","_value2","_value3","key","value","wrap","_context","prev","next","toData","Zip","file","JSON","stringify","folder","asyncIterator","entries","sent","done","slicedToArray","push","id","name","type","toString","data","t0","return","finish","abrupt","generateAsync","stop","this","_x","apply","arguments","saveAsZip","_ref2","_callee2","_context2","saveAs","concat","_x2","dbPromise","openDB","upgrade","db","createObjectStore","keyPath","autoIncrement","createIndex","saveProject","put","_x3","deleteProject","_ref3","_callee3","tx","projects","audios","cursor","_context3","transaction","objectStore","delete","index","openKeyCursor","primaryKey","continue","_x4","getAllProjects","_ref4","_callee4","_context4","getAllFromIndex","loadAudio","_ref5","_callee5","projectId","audioId","_context5","get","_x5","_x6","saveAudio","_ref6","_callee6","audio","_context6","_x7","saveAudioMap","_ref7","_callee7","audioMap","_ref10","_ref9","entry","_context7","undefined","Symbol","iterator","store","objectSpread","_x8","_x9","deleteAudio","_ref11","_callee8","_context8","_x10","_x11","_callee9","_context9","awaitAsyncGenerator","openCursor","element","InteractionType","AudioLibrary","Map","nextId","set","clear","_iterateProjectAudios","iterateProjectAudios","_wrapIteratorAsync","wrapIteratorAsync","defaultAudioContext","AudioContext","radToDeg","rad","Math","PI","degToRad","deg","roundToPrecision","precision","round","BinauralSource","scene","classCallCheck","position","Vector3","orientation","binauralFIR","BinauralFIR","audioContext","HRTFDataset","hrtfDataset","connect","destination","input","listenerAzimuth","atan2","listenerOrientation","x","z","distance","listenerPosition","deltaZ","azimuth","atan","elevation","asin","y","setPosition","dummyHRTFDataset","buffer","createBuffer","BinauralScene","length","sources","source","err","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","update","Audio3D","webAudioContext","binauralAudioContext","resonanceAudioContext","webAudioPannerNode","binauralSource","resonanceSource","_this","possibleConstructorReturn","getPrototypeOf","call","webAudioBufferSource","binauralBufferSource","resonanceBufferSource","createBufferSource","force","esm_get","prototype","quaternion","Quaternion","scale","matrixWorld","decompose","applyQuaternion","setOrientation","copy","setFromMatrix","loop","start","disconnect","Object3D","Listener3D","webAudioListener","binauralScene","resonanceScene","up","setListenerFromMatrix","firCoefficientsToAudioBuffer","firCoeffsLeft","firCoeffsRight","copyToChannel","Float32Array","loadHRTFDataset","resp","dataset","fetch","json","map","hrtf","fir_coeffs_left","fir_coeffs_right","AudioScene","options","audioImplementation","WebAudio","ResonanceAudio","binauralHRTFDataset","isLoadingBinauralHRTFDataset","listener3D","listener","setRoomProperties","dimensions","Utils","DEFAULT_ROOM_DIMENSIONS","materials","DEFAULT_ROOM_MATERIALS","output","suspend","createPanner","createSource","close","resume","Binaural","loadBinauralHRTFDataset","setHRTFDataset","console","error","roomDimensions","roomMaterials","CodeBlock","func","playerState","roomState","thisObject","Function","cubeGeometry","BoxGeometry","cubeMaterial","MeshLambertMaterial","GameObject","audioScene","audioFile","interactionType","None","interactionAudioId","codeBlock","createAudio3D","add","decodeAudioData","slice","setBuffer","setLoop","play","toArray","rotation","codeBlockSource","Mesh","wallGeometry","wallMaterial","Room","width","depth","height","grid","wallNorth","wallEast","wallSouth","wallWest","camera","PerspectiveCamera","ambientLight","AmbientLight","light","PointLight","lookAt","gridSize","max","GridHelper","updateWalls","remove","object","_this$roomDimensions","objects","children","filter","c","go","_this2","gameObjects","o","fromData","toConsumableArray","Scene","noop","defaultEvents","onSelect","onScale","onTranslate","Project","events","rooms","audioType","activeAudioImplementation","activeRoom","activeObject","outlineMesh","firstRoom","addObject","material","MeshBasicMaterial","color","side","BackSide","multiplyScalar","window","p","room","selectRoom","selectAudioImplementation","aspect","updateProjectionMatrix","selectObject","geometry","savedAt","Date","r","nextAudioId","i","saveToProject","openFileDialog","Promise","resolve","document","createElement","accept","onchange","files","click","readFileAsArrayBuffer","reader","FileReader","onload","result","onerror","readAsArrayBuffer","loadZip","blob","loadAsync","async","t1","parse","t2","t3","t4","openZip","GamepadListener","onGamepadConnected","e","log","gamepad","onGamepadDisconnected","addEventListener","removeEventListener","gamepads","navigator","getGamepads","mapping","axis","axes","abs","v1","buttons","pressed","KeyboardListener","target","keysPressed","Set","lastKeyUp","reset","onKeyDown","preventDefault","timeStamp","onKeyUp","onClick","button","shiftKey","has","Runtime","rafHandle","previousTimestamp","playerHeight","lastCollisionSound","lastKnownButtonStatus","shouldRender","renderer","WebGLRenderer","canvas","raycaster","Raycaster","dummyCamera","keys","domElement","resize","_this$target","offsetWidth","offsetHeight","setPixelRatio","devicePixelRatio","setSize","animate","t","requestAnimationFrame","dt","render","updateMatrixWorld","tabIndex","listen","appendChild","cancelAnimationFrame","removeChild","focus","check","from","to","min","toInteractWith","rotateX","moveX","moveZ","rotateY","isPressed","newZ","newX","newY","gamepadAxes","getAxis","rotateOnWorldAxis","translateOnAxis","collided","bbox","Box3","setFromObject","bboxposition","getCenter","bboxscale","getSize","boundX1","boundX2","boundY1","boundY2","boundZ1","boundZ2","isBetween","now","nearestDist","Infinity","nearestObj","setFromCamera","intersections","intersectObjects","intersection","getButtonStatus","invokeInteraction","FocusedLabel","styled","div","_templateObject","RunningLabel","_templateObject2","RunningHeadline","_templateObject3","RunningButtonContainer","_templateObject4","RunningButton","_templateObject5","props","selected","css","_templateObject6","_templateObject7","ControlsTable","table","_templateObject8","Main","main","_templateObject9","RuntimeContainer","targetRef","React","createRef","runtime","activeButtonRef","state","onExit","detach","onVisualToggle","toggleRendering","onChangeAudio","event","setState","current","attach","react_default","ref","Component","Backdrop","Modal_templateObject","Container","Modal_templateObject2","TitleBar","Modal_templateObject3","Content","Modal_templateObject4","ActionGroup","Modal_templateObject5","Action","Modal_templateObject6","Modal","onBackdropClick","currentTarget","onDismiss","title","AudioFileModal","audioEntry","Modal_Modal","ceil","byteLength","onDelete","onExport","onCancel","AudioList","AudioLibraryModal_templateObject","AudioItem","AudioLibraryModal_templateObject2","AudioLibraryModal","previewAudio","Audio","selectedEntry","openAudioFileDialog","stopPreview","pause","URL","revokeObjectURL","src","dismiss","unselectEntry","exportAudio","Blob","createObjectURL","sort","b","updateEntries","prevProps","_this$state","AudioFileModal_AudioFileModal","selectEntry","onMouseEnter","previewEntry","onMouseLeave","MenuType","MenuBar_templateObject","MenubarItem","MenuBar_templateObject2","isActive","MenuBar_templateObject3","alignRight","MenuBar_templateObject4","MenubarItemLabel","label","MenuBar_templateObject5","Menu","MenuBar_templateObject6","MenuItem","MenuBar_templateObject7","MenuDivider","MenuBar_templateObject8","MenuBar","activeMenu","menuType","_this$props","onAudioChange","MenuBar_Container","onBlur","closeMenu","FileMenu","toggleMenu","hidden","onNewProject","onLoadProject","onImportProject","onSaveProject","onExportProject","EditMenu","onAddObject","onDeleteObject","onAddRoom","onDeleteRoom","ViewMenu","onShowAudioLibrary","onShowProjectManager","HelpMenu","open","onRunProject","AudioMenu","ObjectDragDirection","styled_templateObject","InnerContainer","styled_templateObject2","Sidebar","aside","styled_templateObject3","styled_templateObject4","styled_templateObject5","Group","styled_templateObject6","Input","styled_templateObject7","Select","withComponent","styled_templateObject8","CustomInput","styled_templateObject9","CodeEditor","_templateObject10","InputGroup","_templateObject11","RoomList","ol","_templateObject12","RoomListItem","li","_templateObject13","active","_templateObject14","ObjectEditor","codeCheckTimeout","checkCode","codeError","ex","updateCodeBlockSource","onUpdateCodeBlockSource","clearTimeout","setTimeout","onUpdateName","onUpdatePosition","onUpdateRotation","onUpdateScale","onUpdateInteractionType","onShowAudioSelection","onChange","step","toFixed","valueAsNumber","values","Fragment","placeholder","MouseButton","VisualControls","objectDragDirection","isScaling","dragOffset","lastPoint","plane","Plane","axisX","axisY","axisZ","scaleX","scaleY","scaleZ","planeYZ","planeXZ","planeXY","materialConfig","transparent","opacity","DoubleSide","axisGeometry","userData","direction","AxisX","AxisY","AxisZ","scaleGeometry","SphereGeometry","isScale","planeGeometry","PlaneGeometry","PlaneYZ","PlaneXZ","PlaneXY","hasOwnProperty","point","sub","getControlFromRaycaster","onMove","ray","altPlane","distanceToPoint","origin","intersectPlane","EditorCanvas","controls","isDraggingCamera","clearDepth","onMouseDown","Secondary","requestPointerLock","Primary","updateRaycaster","style","checkSceneClick","onMouseUp","exitPointerLock","onMouseMove","movementX","movementY","rotateOnAxis","onWheel","delta","deltaY","deltaMode","translateZ","autoClear","setClearColor","Color","stopPropagation","size","Vector2","pageX","offsetLeft","pageY","offsetTop","ROOM_MATERIAL_COEFFICIENTS","RoomEditor","propertyName","onUpdateMaterials","defineProperty","_this$props2","onUpdateDimensions","materialOptions","ce","left","selectMaterialHandler","right","front","back","down","ProjectInfoModal","toLocaleString","ModalType","TableContainer","ProjectManagerModal_templateObject","Table","ProjectManagerModal_templateObject2","TableHead","thead","ProjectManagerModal_templateObject3","TableRow","tr","ProjectManagerModal_templateObject4","ColumnHead","th","ProjectManagerModal_templateObject5","ColumnData","td","ProjectManagerModal_templateObject6","ProjectManagerModal","selectedProject","unselectProject","exportProject","onSelectProject","reverse","ProjectInfoModal_ProjectInfoModal","selectProject","Editor","projectCanvas","selectedRoomId","selectedObject","modal","isRunning","mainRef","newProject","onSelectObject","onTranslateObject","onScaleObject","changeProject","showProjectSelection","ProjectSelection","prompt","save","importProject","deleteObject","addRoom","s","deleteRoom","splice","showAudioLibrary","showProjectManager","ProjectManager","runProject","updateRoomName","updateRoomDimensions","updateRoomMaterials","updateName","updateScale","_ref8","updatePosition","updateRotation","Euler","updateInteractionType","_ref12","showAudioSelection","AudioSelection","dismissModal","selectAudio","_ref13","loadProject","_ref14","_ref15","exitRuntime","attachCanvas","RuntimeContainer_RuntimeContainer","styled_Container","AudioLibraryModal_AudioLibraryModal","ProjectManagerModal_ProjectManagerModal","MenuBar_MenuBar","RoomEditor_RoomEditor","ObjectEditor_ObjectEditor","styled_Main","styled_FocusedLabel","Boolean","location","hostname","match","global","webkitAudioContext","ReactDOM","Editor_Editor","getElementById","serviceWorker","ready","then","registration","unregister"],"mappings":"iIAAKA,8JCaQC,EAAS,eAAAC,EAAAC,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAC,EAAOC,GAAP,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAlB,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACjBjB,EAAWD,EAAQmB,UACnBjB,EAAM,IAAIkB,KACZC,KAAK,gBAAiBC,KAAKC,UAAUtB,IAEnCE,EAAkE,GAClEC,EAAcF,EAAIsB,OAAO,SANRnB,GAAA,EAAAC,GAAA,EAAAU,EAAAC,KAAA,EAAAT,EAAAd,OAAA+B,EAAA,EAAA/B,CAOUM,EAAQG,aAAauB,WAP/B,cAAAV,EAAAE,KAAA,GAAAV,EAAAU,OAAA,eAAAT,EAAAO,EAAAW,KAAAtB,EAAAI,EAAAmB,KAAAZ,EAAAE,KAAA,GAAAT,EAAAK,MAAA,WAAAJ,EAAAM,EAAAW,KAAAtB,EAAA,CAAAW,EAAAE,KAAA,SAAAP,EAAAD,EAAAE,EAAAlB,OAAAmC,EAAA,EAAAnC,CAAAiB,EAAA,GAOLE,EAPKD,EAAA,GAOAE,EAPAF,EAAA,GAQrBT,EAAa2B,KAAK,CAAEC,GAAIlB,EAAKmB,KAAMlB,EAAMkB,KAAMC,KAAMnB,EAAMmB,OAC3D7B,EAAYiB,KAAKR,EAAIqB,WAAYpB,EAAMqB,MATlB,QAAA9B,GAAA,EAAAW,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAoB,GAAApB,EAAA,SAAAV,GAAA,EAAAC,EAAAS,EAAAoB,GAAA,WAAApB,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAZ,GAAA,MAAAG,EAAA6B,OAAA,CAAArB,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAAAV,EAAA6B,SAAA,WAAArB,EAAAC,KAAA,IAAAX,EAAA,CAAAU,EAAAE,KAAA,eAAAX,EAAA,eAAAS,EAAAsB,OAAA,mBAAAtB,EAAAsB,OAAA,mBAWvBpC,EAAImB,KAAK,oBAAqBC,KAAKC,UAAUpB,IAXtBa,EAAAuB,OAAA,SAahBrC,EAAIsC,cAAc,CAAEP,KAAM,UAbV,yBAAAjB,EAAAyB,SAAA1C,EAAA2C,KAAA,+BAAH,gBAAAC,GAAA,OAAAlD,EAAAmD,MAAAF,KAAAG,YAAA,GAoBTC,EAAS,eAAAC,EAAArD,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAkD,EAAOhD,GAAP,IAAAmC,EAAA,OAAAvC,EAAAC,EAAAkB,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EACJ1B,EAAUQ,GADN,OACjBmC,EADiBc,EAAAtB,KAEvBuB,iBAAOf,EAAD,GAAAgB,OAAUnD,EAAQgC,KAAlB,iBAFiB,wBAAAiB,EAAAR,SAAAO,EAAAN,SAAH,gBAAAU,GAAA,OAAAL,EAAAH,MAAAF,KAAAG,YAAA,2BCzBhBQ,EAAYC,YAAe,UAAW,EAAG,CAC7CC,QAD6C,SACrCC,GACeA,EAAGC,kBAAkB,WAAY,CACpDC,QAAS,KACTC,eAAe,IAEJC,YAAY,UAAW,WACjBJ,EAAGC,kBAAkB,SAAU,CAChDC,QAAS,CAAC,YAAa,aAEdE,YAAY,UAAW,gBAUzBC,EAAW,eAAAd,EAAArD,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAkD,EAAOhD,GAAP,IAAAwD,EAAArB,EAAA,OAAAvC,EAAAC,EAAAkB,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EACRmC,EADQ,cACnBG,EADmBP,EAAAtB,KAEnBQ,EAAOnC,EAAQmB,SAFI8B,EAAA/B,KAAA,EAGZsC,EAAGM,IAAI,WAAY3B,GAHP,cAAAc,EAAAV,OAAA,SAAAU,EAAAtB,MAAA,wBAAAsB,EAAAR,SAAAO,EAAAN,SAAH,gBAAAqB,GAAA,OAAAhB,EAAAH,MAAAF,KAAAG,YAAA,GAMXmB,EAAa,eAAAC,EAAAvE,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAoE,EAAOnC,GAAP,IAAAyB,EAAAW,EAAAC,EAAAC,EAAAC,EAAA,OAAA1E,EAAAC,EAAAkB,KAAA,SAAAwD,GAAA,cAAAA,EAAAtD,KAAAsD,EAAArD,MAAA,cAAAqD,EAAArD,KAAA,EACVmC,EADU,cACrBG,EADqBe,EAAA5C,KAGrBwC,EAAKX,EAAGgB,YAAY,CAAC,SAAU,YAAa,aAE5CJ,EAAWD,EAAGM,YAAY,YAC1BJ,EAASF,EAAGM,YAAY,UANHF,EAAArD,KAAA,EASrBkD,EAASM,OAAO3C,GATK,cAAAwC,EAAArD,KAAA,GAYRmD,EAAOM,MAAM,WAAWC,cAAc7C,GAZ9B,QAYvBuC,EAZuBC,EAAA5C,KAAA,YAapB2C,EAboB,CAAAC,EAAArD,KAAA,gBAAAqD,EAAArD,KAAA,GAcnBmD,EAAOK,OAAOJ,EAAOO,YAdF,eAAAN,EAAArD,KAAA,GAeVoD,EAAOQ,WAfG,QAezBR,EAfyBC,EAAA5C,KAAA4C,EAAArD,KAAA,wBAAAqD,EAAArD,KAAA,GAkBrBiD,EAAGvC,KAlBkB,yBAAA2C,EAAA9B,SAAAyB,EAAAxB,SAAH,gBAAAqC,GAAA,OAAAd,EAAArB,MAAAF,KAAAG,YAAA,GAqBbmC,EAAc,eAAAC,EAAAvF,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAoF,IAAA,IAAA1B,EAAA,OAAA5D,EAAAC,EAAAkB,KAAA,SAAAoE,GAAA,cAAAA,EAAAlE,KAAAkE,EAAAjE,MAAA,cAAAiE,EAAAjE,KAAA,EACXmC,EADW,cACtBG,EADsB2B,EAAAxD,KAAAwD,EAAAjE,KAAA,EAEfsC,EAAG4B,gBAAgB,WAAY,WAFhB,cAAAD,EAAA5C,OAAA,SAAA4C,EAAAxD,MAAA,wBAAAwD,EAAA1C,SAAAyC,EAAAxC,SAAH,yBAAAuC,EAAArC,MAAAF,KAAAG,YAAA,GAKdwC,EAAS,eAAAC,EAAA5F,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAyF,EACvBC,EACAC,GAFuB,IAAAjC,EAAArB,EAAA,OAAAvC,EAAAC,EAAAkB,KAAA,SAAA2E,GAAA,cAAAA,EAAAzE,KAAAyE,EAAAxE,MAAA,cAAAwE,EAAAxE,KAAA,EAINmC,EAJM,cAIjBG,EAJiBkC,EAAA/D,KAAA+D,EAAAxE,KAAA,EAKJsC,EAAGmC,IAAI,SAAU,CAACH,EAAWC,IALzB,cAKjBtD,EALiBuD,EAAA/D,KAAA+D,EAAAnD,OAAA,SAMhBJ,GANgB,wBAAAuD,EAAAjD,SAAA8C,EAAA7C,SAAH,gBAAAkD,EAAAC,GAAA,OAAAP,EAAA1C,MAAAF,KAAAG,YAAA,GASTiD,EAAS,eAAAC,EAAArG,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAkG,EAAOC,GAAP,IAAAzC,EAAA,OAAA5D,EAAAC,EAAAkB,KAAA,SAAAmF,GAAA,cAAAA,EAAAjF,KAAAiF,EAAAhF,MAAA,cAAAgF,EAAAhF,KAAA,EACNmC,EADM,cACjBG,EADiB0C,EAAAvE,KAAAuE,EAAAhF,KAAA,EAEjBsC,EAAGM,IAAI,SAAUmC,GAFA,wBAAAC,EAAAzD,SAAAuD,EAAAtD,SAAH,gBAAAyD,GAAA,OAAAJ,EAAAnD,MAAAF,KAAAG,YAAA,GAKTuD,EAAY,eAAAC,EAAA3G,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAwG,EAC1Bd,EACAe,GAF0B,IAAA/C,EAAAW,EAAA9D,EAAAC,EAAAC,EAAAC,EAAAC,EAAA+F,EAAAC,EAAAhB,EAAAiB,EAAA,OAAA9G,EAAAC,EAAAkB,KAAA,SAAA4F,GAAA,cAAAA,EAAA1F,KAAA0F,EAAAzF,MAAA,cAAAyF,EAAAzF,KAAA,EAITmC,EAJS,OAM1B,IAFMG,EAJoBmD,EAAAhF,KAKpBwC,EAAKX,EAAGgB,YAAY,SAAU,aALVnE,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAAD,EAAA1F,KAAA,EAM1BT,EAA+B+F,EAAS7E,UAAxCmF,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAAmDmG,EAAA/F,EAAAK,MAAA2F,EAAA/G,OAAAmC,EAAA,EAAAnC,CAAA8G,EAAA,GAAvCf,EAAuCgB,EAAA,GAA9BC,EAA8BD,EAAA,GACjDtC,EAAG4C,MAAMjD,IAATpE,OAAAsH,EAAA,EAAAtH,CAAA,GAAkBgH,EAAlB,CAAyBlB,YAAWC,aAPZkB,EAAAzF,KAAA,iBAAAyF,EAAA1F,KAAA,GAAA0F,EAAAvE,GAAAuE,EAAA,SAAArG,GAAA,EAAAC,EAAAoG,EAAAvE,GAAA,QAAAuE,EAAA1F,KAAA,GAAA0F,EAAA1F,KAAA,GAAAZ,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAAsE,EAAA1F,KAAA,IAAAX,EAAA,CAAAqG,EAAAzF,KAAA,eAAAX,EAAA,eAAAoG,EAAArE,OAAA,mBAAAqE,EAAArE,OAAA,mBAAAqE,EAAAzF,KAAA,GASpBiD,EAAGvC,KATiB,yBAAA+E,EAAAlE,SAAA6D,EAAA5D,KAAA,+BAAH,gBAAAuE,EAAAC,GAAA,OAAAb,EAAAzD,MAAAF,KAAAG,YAAA,GAYZsE,EAAW,eAAAC,EAAA1H,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAuH,EACzB7B,EACAC,GAFyB,IAAAjC,EAAA,OAAA5D,EAAAC,EAAAkB,KAAA,SAAAuG,GAAA,cAAAA,EAAArG,KAAAqG,EAAApG,MAAA,cAAAoG,EAAApG,KAAA,EAIRmC,EAJQ,cAInBG,EAJmB8D,EAAA3F,KAAA2F,EAAApG,KAAA,EAKnBsC,EAAGkB,OAAO,SAAU,CAACc,EAAWC,IALb,wBAAA6B,EAAA7E,SAAA4E,EAAA3E,SAAH,gBAAA6E,EAAAC,GAAA,OAAAJ,EAAAxE,MAAAF,KAAAG,YAAA,8CAQjB,SAAA4E,EACLjC,GADK,IAAAhC,EAAAW,EAAAG,EAAA,OAAA1E,EAAAC,EAAAkB,KAAA,SAAA2G,GAAA,cAAAA,EAAAzG,KAAAyG,EAAAxG,MAAA,cAAAwG,EAAAxG,KAAA,EAAAxB,OAAAiI,EAAA,EAAAjI,CAGY2D,GAHZ,cAGCG,EAHDkE,EAAA/F,KAICwC,EAAKX,EAAGgB,YAAY,UAJrBkD,EAAAxG,KAAA,EAAAxB,OAAAiI,EAAA,EAAAjI,CAKcyE,EAAG4C,MAAMpC,MAAM,WAAWiD,WAAWpC,IALnD,OAKDlB,EALCoD,EAAA/F,KAAA,WAME2C,EANF,CAAAoD,EAAAxG,KAAA,SAOH,OAPGwG,EAAAxG,KAAA,GAOG,CAACoD,EAAOxD,MAAM2E,QAASnB,EAAOxD,OAPjC,eAAA4G,EAAAxG,KAAA,GAAAxB,OAAAiI,EAAA,EAAAjI,CAQY4E,EAAOQ,YARnB,QAQHR,EARGoD,EAAA/F,KAAA+F,EAAAxG,KAAA,uBAAAwG,EAAAxG,KAAA,GAAAxB,OAAAiI,EAAA,EAAAjI,CAUCyE,EAAGvC,MAVJ,yBAAA8F,EAAAjF,SAAAgF,EAAA/E,0CF9FFnD,sGAMUA,mDGGR,SAAAQ,EACL+G,GADK,IAAAzG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAoH,EAAA,OAAAjI,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAAAb,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA5F,EAAAC,KAAA,EAAAT,EAGiBsG,EAHjBD,OAAAC,YAAA,UAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,KAAA,CAAAZ,EAAAE,KAAA,SAIH,OADS2G,EAHNpH,EAAAK,MAAAE,EAAAE,KAAA,EAIG2G,EAJH,OAAAxH,GAAA,EAAAW,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAoB,GAAApB,EAAA,SAAAV,GAAA,EAAAC,EAAAS,EAAAoB,GAAA,QAAApB,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAZ,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAArB,EAAAC,KAAA,IAAAX,EAAA,CAAAU,EAAAE,KAAA,eAAAX,EAAA,eAAAS,EAAAsB,OAAA,mBAAAtB,EAAAsB,OAAA,6BAAAtB,EAAAyB,SAAA1C,EAAA2C,KAAA,0DCMKoF,ECFSC,mDACnBvC,sBACAe,SAAW,IAAIyB,SACfC,OAAS,0FAECvB,sEACc,MAAlBhE,KAAK8C,0CACDM,EAAUpG,OAAAsH,EAAA,EAAAtH,CAAA,GACXgH,EADU,CAEblB,UAAW9C,KAAK8C,UAChBC,QAAS/C,KAAKuF,uCAGhBvF,KAAK6D,SAAS2B,IAAIxF,KAAKuF,OAAQvB,mCAE1BhE,KAAKuF,iLAGJlG,sEACc,MAAlBW,KAAK8C,0CACMH,EAAU3C,KAAK8C,UAAWzD,2EAElCW,KAAK6D,SAASZ,IAAI5D,2KAGjBA,EAAY2E,sEACE,MAAlBhE,KAAK8C,0CACDH,EAAU3C,KAAK8C,UAAWzD,gCAEhCW,KAAK6D,SAAS2B,IAAInG,EAAI2E,+KAIb3E,sEACW,MAAlBW,KAAK8C,0CACD2B,EAAYzE,KAAK8C,UAAWzD,gCAElCW,KAAK6D,SAAS7B,OAAO3C,oLAILyD,0EAClB9C,KAAK8C,UAAYA,WACXY,EAAaZ,EAAW9C,KAAK6D,iBACnC7D,KAAK6D,SAAS4B,6IAId,OAAsB,MAAlBzF,KAAK8C,UHiCN,SAAP7C,GAAA,OAAAyF,EAAAxF,MAAAF,KAAAG,WGhCawF,CAAqB3F,KAAK8C,WFrDhC,SAAP7C,GAAA,OAAA2F,EAAA1F,MAAAF,KAAAG,WEuDW0F,CAAkB7F,KAAK6D,SAAS7E,4BC9D5B8G,EAFa,IAAIC,8BCMnBC,EAAW,SAACC,GAAD,OAAgC,IAANA,EAAaC,KAAKC,IAGvDC,EAAW,SAACC,GAAD,OAA0BA,EAAM,IAAOH,KAAKC,IAEvDG,EAAmB,SAAClI,EAAemI,GAAhB,OAC9BL,KAAKM,MAAMpI,EAAQmI,GAAaA,GCJbE,aAUnB,SAAAA,EAAYC,GAAuB1J,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAyG,GAAAzG,KATnC4G,SAAW,IAAIC,IASmB7G,KARlC8G,YAAc,IAAID,IAQgB7G,KAPlC0G,WAOkC,EAAA1G,KANlC+G,iBAMkC,EAChC/G,KAAK0G,MAAQA,EACb1G,KAAK+G,YAAc,IAAIC,IAAY,CAAEC,aAAcP,EAAMO,eACzDjH,KAAK+G,YAAYG,YAAcR,EAAMS,YACrCnH,KAAK+G,YAAYK,QAAQV,EAAMO,aAAaI,+DAP5C,OAAOrH,KAAK+G,YAAYO,wDAWxB,IAAMC,EAAkBrB,KAAKsB,MAC3BxH,KAAK0G,MAAMe,oBAAoBC,EAC/B1H,KAAK0G,MAAMe,oBAAoBE,GAG3BC,EAAW5H,KAAK+G,YAAYa,SAChC5H,KAAK4G,SACL5G,KAAK0G,MAAMmB,kBAGPC,EAAS9H,KAAK4G,SAASe,EAAI3H,KAAK0G,MAAMmB,iBAAiBF,EACvDI,EAAU/B,EACduB,EAAkBO,GAChB5B,KAAK8B,MAAMhI,KAAK4G,SAASc,EAAI1H,KAAK0G,MAAMmB,iBAAiBH,GAAKI,IAG5DG,EACJL,GACA5B,EACEE,KAAKgC,MAAMlI,KAAK4G,SAASuB,EAAInI,KAAK0G,MAAMmB,iBAAiBM,GAAKP,IAGlE5H,KAAK+G,YAAYqB,YAAYL,EAASE,EAAWL,YCvC/CS,EAA2B,CAC/B,CACEN,QAAS,EACTE,UAAW,EACXL,SAAU,EACVU,OAAQxC,EAAoByC,aAAa,EAAG,IAAK,SAIhCC,aAOnB,SAAAA,EACEvB,GAEA,IADAE,EACAhH,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GADsBkI,EACtBrL,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAwI,GAAAxI,KATF6H,iBAAmB,IAAIhB,IAAQ,EAAG,EAAG,GASnC7G,KARFyH,oBAAsB,IAAIZ,IAAQ,EAAG,EAAG,GAQtC7G,KAPF0I,QAA4B,GAO1B1I,KANFiH,kBAME,EAAAjH,KALFmH,iBAKE,EACAnH,KAAKiH,aAAeA,EACpBjH,KAAKmH,YAAcA,6DAInB,IAAMwB,EAAS,IAAIlC,EAAezG,MAElC,OADAA,KAAK0I,QAAQtJ,KAAKuJ,GACXA,yCAGMxB,GACbnH,KAAKmH,YAAcA,EADqB,IAAAxJ,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IAExC,QAAAnG,EAAAD,EAAqBkC,KAAK0I,QAA1BvE,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAAmC,CAAAI,EAAAK,MAC1B2I,YAAYG,YAAcC,GAHK,MAAAyB,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,qCAO3B,IAAAgL,GAAA,EAAAC,GAAA,EAAAC,OAAA7E,EAAA,IACb,QAAA8E,EAAAC,EAAqBjJ,KAAK0I,QAA1BvE,OAAAC,cAAAyE,GAAAG,EAAAC,EAAAzK,QAAAU,MAAA2J,GAAA,EAAmC,CAAAG,EAAA5K,MAC1B8K,UAFI,MAAAN,GAAAE,GAAA,EAAAC,EAAAH,EAAA,YAAAC,GAAA,MAAAI,EAAAtJ,QAAAsJ,EAAAtJ,SAAA,WAAAmJ,EAAA,MAAAC,qBChCII,cAanB,SAAAA,EACEC,EACAC,EACAC,EACAC,EACAC,EACAC,GACA,IAAAC,EAAA,OAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAmJ,IACAO,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAAmM,GAAAU,KAAA7J,QApBFoJ,qBAmBE,EAAAM,EAlBFL,0BAkBE,EAAAK,EAjBFJ,2BAiBE,EAAAI,EAfFH,wBAeE,EAAAG,EAdFF,oBAcE,EAAAE,EAbFD,qBAaE,EAAAC,EAXFI,0BAWE,EAAAJ,EAVFK,0BAUE,EAAAL,EATFM,2BASE,EAGAN,EAAKN,gBAAkBA,EACvBM,EAAKL,qBAAuBA,EAC5BK,EAAKJ,sBAAwBA,EAE7BI,EAAKH,mBAAqBA,EAC1BG,EAAKF,eAAiBA,EACtBE,EAAKD,gBAAkBA,EAEvBC,EAAKI,qBAAuBV,EAAgBa,qBAC5CP,EAAKK,qBAAuBV,EAAqBY,qBACjDP,EAAKM,sBAAwBV,EAAsBW,qBAEnDP,EAAKI,qBAAqB1C,QAAQmC,GAClCG,EAAKK,qBAAqB3C,QAAQoC,EAAelC,OACjDoC,EAAKM,sBAAsB5C,QAAQqC,EAAgBnC,OAEnDoC,EAAKH,mBAAmBnC,QAAQgC,EAAgB/B,aAnBhDqC,iFAsBgBQ,GAChBlN,OAAAmN,EAAA,EAAAnN,QAAA4M,EAAA,EAAA5M,CAAAmM,EAAAiB,WAAA,oBAAApK,MAAA6J,KAAA7J,KAAwBkK,GAExB,IAAMtD,EAAW,IAAIC,IACfwD,EAAa,IAAIC,IACjBC,EAAQ,IAAI1D,IAClB7G,KAAKwK,YAAYC,UAAU7D,EAAUyD,EAAYE,GACjD,IAAMzD,EAAc,IAAID,IAAQ,EAAG,EAAG,GAAG6D,gBAAgBL,GAEzDrK,KAAKuJ,mBAAmBnB,YAAYxB,EAASc,EAAGd,EAASuB,EAAGvB,EAASe,GACrE3H,KAAKuJ,mBAAmBoB,eACtB7D,EAAYY,EACZZ,EAAYqB,EACZrB,EAAYa,GAGd3H,KAAKwJ,eAAe5C,SAASgE,KAAKhE,GAClC5G,KAAKwJ,eAAe1C,YAAY8D,KAAK9D,GACrC9G,KAAKwJ,eAAeN,SAEpBlJ,KAAKyJ,gBAAgBoB,cAAc7K,KAAKwK,+CAGhClC,GACJtI,KAAK8J,qBAAqBxB,SAK5BtI,KAAKD,OAELC,KAAK8J,qBAAuB9J,KAAKoJ,gBAAgBa,qBACjDjK,KAAK+J,qBAAuB/J,KAAKqJ,qBAAqBY,qBACtDjK,KAAKgK,sBAAwBhK,KAAKsJ,sBAAsBW,qBAExDjK,KAAK8J,qBAAqB1C,QAAQpH,KAAKuJ,oBACvCvJ,KAAK+J,qBAAqB3C,QAAQpH,KAAKwJ,eAAelC,OACtDtH,KAAKgK,sBAAsB5C,QAAQpH,KAAKyJ,gBAAgBnC,QAG1DtH,KAAK8J,qBAAqBxB,OAASA,EACnCtI,KAAK+J,qBAAqBzB,OAASA,EACnCtI,KAAKgK,sBAAsB1B,OAASA,kCAG9BwC,GACN9K,KAAK8J,qBAAqBgB,KAAOA,EACjC9K,KAAK+J,qBAAqBe,KAAOA,EACjC9K,KAAKgK,sBAAsBc,KAAOA,iCAIlC9K,KAAK8J,qBAAqBiB,QAC1B/K,KAAK+J,qBAAqBgB,QAC1B/K,KAAKgK,sBAAsBe,uCAIvB/K,KAAK8J,qBAAqBxB,SAC5BtI,KAAK8J,qBAAqB/J,OAC1BC,KAAK+J,qBAAqBhK,OAC1BC,KAAKgK,sBAAsBjK,OAE3BC,KAAK8J,qBAAqBkB,aAC1BhL,KAAK+J,qBAAqBiB,aAC1BhL,KAAKgK,sBAAsBgB,qBA3GIC,KCNhBC,eAKnB,SAAAA,EACEC,EACAC,EACAC,GACA,IAAA3B,EAAA,OAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAkL,IACAxB,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAAkO,GAAArB,KAAA7J,QATFmL,sBAQE,EAAAzB,EAPF0B,mBAOE,EAAA1B,EANF2B,oBAME,EAEA3B,EAAKyB,iBAAmBA,EACxBzB,EAAK0B,cAAgBA,EACrB1B,EAAK2B,eAAiBA,EAJtB3B,iFAOgBQ,GAChBlN,OAAAmN,EAAA,EAAAnN,QAAA4M,EAAA,EAAA5M,CAAAkO,EAAAd,WAAA,oBAAApK,MAAA6J,KAAA7J,KAAwBkK,GAExB,IAAMtD,EAAW,IAAIC,IACfwD,EAAa,IAAIC,IACjBC,EAAQ,IAAI1D,IAClB7G,KAAKwK,YAAYC,UAAU7D,EAAUyD,EAAYE,GACjD,IAAMzD,EAAc,IAAID,IAAQ,EAAG,EAAG,GAAG6D,gBAAgBL,GAEzDrK,KAAKmL,iBAAiB/C,aAAaxB,EAASc,EAAGd,EAASuB,GAAIvB,EAASe,GACrE3H,KAAKmL,iBAAiBR,eACpB7D,EAAYY,EACZZ,EAAYqB,EACZrB,EAAYa,EACZ3H,KAAKsL,GAAG5D,EACR1H,KAAKsL,GAAGnD,EACRnI,KAAKsL,GAAG3D,GAGV3H,KAAKoL,cAAcvD,iBAAiB+C,KAAKhE,GACzC5G,KAAKoL,cAAc3D,oBAAoBmD,KAAK9D,GAC5C9G,KAAKoL,cAAclC,SAEnBlJ,KAAKqL,eAAeE,sBAAsBvL,KAAKwK,oBAvCXS,KCLlCO,GAA+B,SACnCC,EACAC,GAEA,IAAMpD,EAASxC,EAAoByC,aAAa,EAAG,IAAK,OAGxD,OAFAD,EAAOqD,cAAc,IAAIC,aAAaH,GAAgB,GACtDnD,EAAOqD,cAAc,IAAIC,aAAaF,GAAiB,GAChDpD,GAGIuD,GAAe,eAAA9O,EAAAC,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAC,IAAA,IAAAyO,EAAAC,EAAA,OAAA7O,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACVwN,MAAM,wBADI,cACvBF,EADuBxN,EAAAW,KAAAX,EAAAE,KAAA,EAEPsN,EAAKG,OAFE,cAEvBF,EAFuBzN,EAAAW,KAAAX,EAAAuB,OAAA,SAItBkM,EAAQG,IAAI,SAACC,GAAD,MAAgB,CACjCpE,QAASoE,EAAKpE,QACdE,UAAWkE,EAAKlE,UAChBL,SAAUuE,EAAKvE,SACfU,OAAQkD,GACNW,EAAKC,gBACLD,EAAKE,sBAVoB,wBAAA/N,EAAAyB,SAAA1C,EAAA2C,SAAH,yBAAAjD,EAAAmD,MAAAF,KAAAG,YAAA,GCIPmM,cAmBnB,SAAAA,EAAYC,GAAmBvP,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAsM,GAAAtM,KAlB/BwM,oBAA2C3P,EAAoB4P,SAkBjCzM,KAhB9BoJ,gBAAkB,IAAIrD,aAgBQ/F,KAf9BqJ,qBAAuB,IAAItD,aAeG/F,KAd9BsJ,sBAAwB,IAAIvD,aAcE/F,KAZ9BoL,cAAgB,IAAI5C,EAAcxI,KAAKqJ,sBAYTrJ,KAX9BqL,eAAiB,IAAIqB,iBAAe1M,KAAKsJ,uBAWXtJ,KAT9B2M,oBAAqC,KASP3M,KAR9B4M,8BAA+B,EAQD5M,KAN9B6M,WAAa,IAAI3B,GACflL,KAAKoJ,gBAAgB0D,SACrB9M,KAAKoL,cACLpL,KAAKqL,gBAILrL,KAAKqL,eAAe0B,kBAClBR,EAAQS,YAAcN,iBAAeO,MAAMC,wBAC3CX,EAAQY,WAAaT,iBAAeO,MAAMG,wBAE5CpN,KAAKqL,eAAegC,OAAOjG,QAAQpH,KAAKsJ,sBAAsBjC,aAE9DrH,KAAKsN,sEAIL,OAAO,IAAInE,EACTnJ,KAAKoJ,gBACLpJ,KAAKqJ,qBACLrJ,KAAKsJ,sBACLtJ,KAAKoJ,gBAAgBmE,eACrBvN,KAAKoL,cAAcoC,eACnBxN,KAAKqL,eAAemC,gDAKtBxN,KAAKoJ,gBAAgBqE,QACrBzN,KAAKqJ,qBAAqBoE,QAC1BzN,KAAKsJ,sBAAsBmE,0CAI3BzN,KAAKoJ,gBAAgBkE,UACrBtN,KAAKqJ,qBAAqBiE,UAC1BtN,KAAKsJ,sBAAsBgE,2CAI3B,OAAQtN,KAAKwM,qBACX,KAAK3P,EAAoB4P,SACvBzM,KAAKoJ,gBAAgBsE,SACrB,MACF,KAAK7Q,EAAoB8Q,SACvB3N,KAAKqJ,qBAAqBqE,SAC1B,MACF,KAAK7Q,EAAoB6P,eACvB1M,KAAKsJ,sBAAsBoE,4DAKPlB,GAEtBA,IAAwB3P,EAAoB8Q,UAC3C3N,KAAK2M,qBACL3M,KAAK4M,8BAEN5M,KAAK4N,0BAGP5N,KAAKsN,UACLtN,KAAKwM,oBAAsBA,EAC3BxM,KAAK0N,0KAIL1N,KAAK4M,8BAA+B,oBAEDf,YAAjC7L,KAAK2M,2BACL3M,KAAKoL,cAAcyC,eAAe7N,KAAK2M,qEAEvCmB,QAAQC,MAAM,2CAAdzP,EAAAoB,YAEFM,KAAK4M,8BAA+B,uJAIpCoB,EACAC,GAEAjO,KAAKqL,eAAe0B,kBAAkBiB,EAAgBC,YC7GrCC,cAInB,SAAAA,IAAiC,IAArBvF,EAAqBxI,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAAJ,GAAInD,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAkO,GAAAlO,KAHjC2I,YAGiC,EAAA3I,KAFjCmO,UAEiC,EAC/BnO,KAAK2I,OAASA,qDAGTA,GACL3I,KAAK2I,OAASA,EACd3I,KAAKmO,UAAOjK,kCAGNkK,EAAkBC,GAA8C,IAA9BC,EAA8BnO,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAAZ,KACrDH,KAAKmO,OACRnO,KAAKmO,KAAO,IAAII,SAAS,cAAe,YAAavO,KAAK2I,SAE5D3I,KAAKmO,KAAKtE,KAAKyE,EAAYF,EAAaC,YVRtCG,GAAe,IAAIC,IAAY,EAAG,EAAG,GACrCC,GAAe,IAAIC,cAEbvJ,wIAQSwJ,eAYnB,SAAAA,EAAYnR,EAA4BoR,GAAwB,IAAAnF,EAAA,OAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAA4O,IAC9DlF,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAA4R,GAAA/E,KAAA7J,KAAMwO,GAAcE,MAZtBjR,kBAWgE,EAAAiM,EAVhE3G,aAUgE,EAAA2G,EAThEoF,eASgE,EAAApF,EAPhEnG,WAOgE,EAAAmG,EAJhEqF,gBAAkB3J,EAAgB4J,KAI8BtF,EAHhEuF,wBAGgE,EAAAvF,EAFhEwF,eAEgE,EAE9DxF,EAAKjM,aAAeA,EAEpBiM,EAAKnG,MAAQsL,EAAWM,gBACxBzF,EAAK0F,IAAI1F,EAAKnG,OALgDmG,iHAQhDrK,gFACdW,KAAK+C,QAAU1D,WACQW,KAAKvC,aAAawF,IAAI5D,aAA7CW,KAAK8O,iBACL9O,KAAKuD,MAAMxD,QACPC,KAAK8O,2CACchJ,EAAoBuJ,gBACvCrP,KAAK8O,UAAUrP,KAAK6P,MAAM,WADtBhH,SAGNtI,KAAKuD,MAAMgM,UAAUjH,GACrBtI,KAAKuD,MAAMiM,SAAQ,GACnBxP,KAAKuD,MAAMkM,4IAKb,MAAO,CACLnQ,KAAMU,KAAKV,KACXsH,SAAU5G,KAAK4G,SAAS8I,UACxBnF,MAAOvK,KAAKuK,MAAMmF,UAClBC,SAAU3P,KAAK2P,SAASD,UAAUJ,MAAM,EAAG,GAC3CvM,QAAS/C,KAAK+C,0CAITtD,GAgBP,OAfAO,KAAKV,KAAOG,EAAKH,KACjBU,KAAK4G,SAASpB,IAAI/F,EAAKmH,SAAS,GAAInH,EAAKmH,SAAS,GAAInH,EAAKmH,SAAS,IACpE5G,KAAKuK,MAAM/E,IAAI/F,EAAK8K,MAAM,GAAI9K,EAAK8K,MAAM,GAAI9K,EAAK8K,MAAM,IACxDvK,KAAK2P,SAASnK,IAAI/F,EAAKkQ,SAAS,GAAIlQ,EAAKkQ,SAAS,GAAIlQ,EAAKkQ,SAAS,IAEhD,MAAhBlQ,EAAKsD,SACP/C,KAAK2C,UAAUlD,EAAKsD,SAGtB/C,KAAK+O,gBAAkBtP,EAAKsP,iBAAmB3J,EAAgB4J,KAC/DhP,KAAKiP,mBAAqBxP,EAAKwP,mBAC3BxP,EAAKmQ,kBACP5P,KAAKkP,UAAY,IAAIhB,GAAUzO,EAAKmQ,kBAG/B5P,YA5D6B6P,KWAlCC,GAAe,IAAIrB,IAAY,EAAG,EAAG,GACrCsB,GAAe,IAAIpB,IAMJqB,eA0CnB,SAAAA,EACEvS,GAIA,IAAAiM,EAHApK,EAGAa,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAHe,GACf6M,EAEA7M,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAF6B,CAAE8P,MAAO,GAAIC,MAAO,GAAIC,OAAQ,GAC7DhD,EACAhN,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAD2BuM,iBAAeO,MAAMG,uBAChDpQ,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAgQ,IACAtG,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAAgT,GAAAnG,KAAA7J,QA/CFvC,kBA8CE,EAAAiM,EA7CFsE,oBA6CE,EAAAtE,EA5CFuE,mBA4CE,EAAAvE,EA1CF0G,UA0CE,EAAA1G,EAzCF2G,UAAY,IAAIR,IAAKC,GAAcC,IAyCjCrG,EAxCF4G,SAAW,IAAIT,IAAKC,GAAcC,IAwChCrG,EAvCF6G,UAAY,IAAIV,IAAKC,GAAcC,IAuCjCrG,EAtCF8G,SAAW,IAAIX,IAAKC,GAAcC,IAsChCrG,EArCF+G,OAAS,IAAIC,IAAkB,GAAI,EAAG,GAAK,KAqCzChH,EAnCFmF,gBAmCE,EAGAnF,EAAKjM,aAAeA,EACpBiM,EAAKpK,KAAOA,EACZoK,EAAKsE,eAAiBhB,EACtBtD,EAAKuE,cAAgBd,EAErB,IAAMwD,EAAe,IAAIC,IAAa,SAAU,IAChDlH,EAAK0F,IAAIuB,GACT,IAAME,EAAQ,IAAIC,IAAW,SAAU,IACvCD,EAAMjK,SAASpB,IAAI,EAAG,EAAG,GACzBqL,EAAME,OAAO,EAAG,EAAG,GACnBrH,EAAK0F,IAAIyB,GAET,IAAMG,EAAW9K,KAAK+K,IAAIjE,EAAWiD,MAAOjD,EAAWkD,OAfvD,OAgBAxG,EAAK0G,KAAO,IAAIc,IAAWF,EAAUA,EAAU,SAAU,UACzDtH,EAAK0F,IAAI1F,EAAK0G,MAEd1G,EAAKyH,cACLzH,EAAK0F,IAAI1F,EAAK2G,WACd3G,EAAK0F,IAAI1F,EAAK4G,UACd5G,EAAK0F,IAAI1F,EAAK6G,WACd7G,EAAK0F,IAAI1F,EAAK8G,UAEd9G,EAAK+G,OAAO7J,SAASe,EAAI,EACzB+B,EAAK+G,OAAO7J,SAASuB,EAAI,EACzBuB,EAAK+G,OAAOM,OAAO,IAAIlK,IAAQ,EAAG,EAAG,IAGrC6C,EAAKmF,WAAa,IAAIvC,GAAW,CAC/BU,WAAYA,EACZG,UAAWA,IAGbzD,EAAK+G,OAAOrB,IAAI1F,EAAKmF,WAAWhC,YAnChCnD,0EAhCA,OAAO1J,KAAKgO,6BAGChB,GACbhN,KAAKgO,eAAiBhB,EAEtBhN,KAAK6O,WAAW9B,kBAAkBC,EAAYhN,KAAKiO,eAEnDjO,KAAKoR,OAAOpR,KAAKoQ,MAEjB,IAAMY,EAAW9K,KAAK+K,IAAIjE,EAAWiD,MAAOjD,EAAWkD,OACvDlQ,KAAKoQ,KAAO,IAAIc,IAAWF,EAAUA,EAAU,SAAU,UAEzDhR,KAAKoP,IAAIpP,KAAKoQ,MAEdpQ,KAAKmR,gDAIL,OAAOnR,KAAKiO,4BAGAd,GACZnN,KAAKiO,cAAgBd,EACrBnN,KAAK6O,WAAW9B,kBAAkB/M,KAAKgO,eAAgBb,wDA+CvD,IAAMkE,EAAS,IAAIzC,GAAW5O,KAAKvC,aAAcuC,KAAK6O,YAKtD,OAJAwC,EAAOzK,SAASuB,GAAK,GACrBkJ,EAAO/R,KAAO,aAEdU,KAAKoP,IAAIiC,GACFA,wCAGW,IAAAC,EACetR,KAAKgO,eAA9BiC,EADUqB,EACVrB,MAAOC,EADGoB,EACHpB,MAAOC,EADJmB,EACInB,OAEtBnQ,KAAKqQ,UAAU9F,MAAM/E,IAAIyK,EAAOE,EAAQ,KACxCnQ,KAAKsQ,SAAS/F,MAAM/E,IAAI,IAAM2K,EAAQD,GACtClQ,KAAKuQ,UAAUhG,MAAM/E,IAAIyK,EAAOE,EAAQ,KACxCnQ,KAAKwQ,SAASjG,MAAM/E,IAAI,IAAM2K,EAAQD,GAEtClQ,KAAKqQ,UAAUzJ,SAASpB,IAAI,EAAG2K,EAAS,EAAGD,EAAQ,GACnDlQ,KAAKsQ,SAAS1J,SAASpB,IAAIyK,EAAQ,EAAGE,EAAS,EAAG,GAClDnQ,KAAKuQ,UAAU3J,SAASpB,IAAI,EAAG2K,EAAS,GAAID,EAAQ,GACpDlQ,KAAKwQ,SAAS5J,SAASpB,KAAKyK,EAAQ,EAAGE,EAAS,EAAG,oCAInD,MAAO,CACL7Q,KAAMU,KAAKV,KACX0N,WAAYhN,KAAKgN,WACjBG,UAAWnN,KAAKmN,UAChBoE,QAASvR,KAAKwR,SACXC,OAAO,SAACC,GAAD,OAAkCA,aAAa9C,KACtD1C,IAAI,SAAAyF,GAAE,OAAIA,EAAGlT,6CAIXgB,GAA4B,IAAAmS,EAAA5R,KACnCA,KAAKV,KAAOG,EAAKH,KACjBU,KAAKgN,WAAavN,EAAKuN,WACnBvN,EAAK0N,YACPnN,KAAKmN,UAAY1N,EAAK0N,WAGxB,IAAM0E,EAAcpS,EAAK8R,QAAQrF,IAAI,SAAC4F,GAAD,OACnC,IAAIlD,GAAWgD,EAAKnU,aAAcmU,EAAK/C,YAAYkD,SAASD,KAI9D,OAFA9R,KAAKoP,IAALlP,MAAAF,KAAAhD,OAAAgV,EAAA,EAAAhV,CAAY6U,IAEL7R,YAnIuBiS,KCN5BC,GAAO,aAGPC,GAA+B,CACnCC,SAAUF,GACVG,QAASH,GACTI,YAAaJ,IAGMK,cAoBnB,SAAAA,IAAmD,IAAvCC,EAAuCrS,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GAAfgS,GAAenV,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAuS,GAAAvS,KAnBnDwS,YAmBmD,EAAAxS,KAlBnDvC,aAAe,IAAI4H,EAkBgCrF,KAhBnDX,QAgBmD,EAAAW,KAfnDV,KAAO,cAe4CU,KAbnDyS,MAAgB,GAamCzS,KAZnD0S,UAAoB,EAY+B1S,KAVnD2S,0BAA4B9V,EAAoB4P,SAUGzM,KATnD4S,gBASmD,EAAA5S,KARnD6S,aAAkC,KAQiB7S,KANnD8S,YAAc,IAAIjD,IAOhB7P,KAAKwS,OAASA,EAEd,IAAMO,EAAY,IAAI/C,GAAKhQ,KAAKvC,aAAc,cAC9CsV,EAAUC,YACVhT,KAAKyS,MAAMrT,KAAK2T,GAChB/S,KAAK4S,WAAaG,EAElB/S,KAAK8S,YAAYG,SAAW,IAAIC,IAAkB,CAChDC,MAAO,SACPC,KAAMC,MAERrT,KAAK8S,YAAYvI,MAAM+I,eAAe,MAErCC,OAAeC,EAAIxT,wDAjBpB,OAAOA,KAAK4S,WAAWnC,wDAoBX,IAAA9S,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IACZ,QAAAnG,EAAAD,EAAmBkC,KAAKyS,MAAxBtO,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAA+B,CAAAI,EAAAK,MACxByQ,WAAWpB,SAFN,MAAA7E,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,sCAOZ,IAAM4V,EAAO,IAAIzD,GAAKhQ,KAAKvC,aAAc,YAIzC,OAHAgW,EAAKT,YACLhT,KAAKyS,MAAMrT,KAAKqU,GAChBzT,KAAK0T,WAAWD,GACTA,oDAGiBjH,GACxBxM,KAAK2S,0BAA4BnG,EACjCxM,KAAK4S,WAAW/D,WAAW8E,0BAA0BnH,sCAG5CiH,GACTzT,KAAK4S,WAAW/D,WAAWvB,UAC3BmG,EAAK5E,WAAW8E,0BAA0B3T,KAAK2S,2BAC/Cc,EAAKhD,OAAOmD,OAAS5T,KAAK4S,WAAWnC,OAAOmD,OAC5CH,EAAKhD,OAAOoD,yBACZ7T,KAAK4S,WAAaa,EAClBzT,KAAK8T,aAAa,2CAGPhC,GACP9R,KAAK6S,cACP7S,KAAK6S,aAAazB,OAAOpR,KAAK8S,aAG5BhB,IACF9R,KAAK8S,YAAYiB,SAAWjC,EAAEiC,SAC9BjC,EAAE1C,IAAIpP,KAAK8S,cAGb9S,KAAK6S,aAAef,EACpB9R,KAAKwS,OAAOJ,SAASN,oCAKrB,MAAO,CACLkC,QAAS,IAAIC,KACb3U,KAAMU,KAAKV,KACXmT,MAAOzS,KAAKyS,MAAMvG,IAAI,SAAAgI,GAAC,OAAIA,EAAEzV,WAC7B0V,YAAanU,KAAKvC,aAAa8H,yCAK1B9F,EAAsBqD,GAA0B,IAAA4G,EAAA1J,KACvDA,KAAKX,GAAKyD,EACV9C,KAAKvC,aAAaqF,UAAYA,EAC9B9C,KAAKvC,aAAa8H,OAAS9F,EAAK0U,aAAe,EAE/CnU,KAAKV,KAAOG,EAAKH,KACjBU,KAAKyS,MAAQhT,EAAKgT,MAAMvG,IAAI,SAACgI,GAAD,OAC1B,IAAIlE,GAAKtG,EAAKjM,cAAcsU,SAASmC,KAEvClU,KAAK4S,WAAa5S,KAAKyS,MAAM,GAG7B,IAAK,IAAI2B,EAAI,EAAGA,EAAIpU,KAAKyS,MAAMhK,OAAQ2L,IACrCpU,KAAKyS,MAAM2B,GAAGvF,WAAWvB,UAG3B,OAAOtN,kKAIUmB,EAAYnB,gBAAvBX,SACS,MAAXW,KAAKX,0BACPW,KAAKX,GAAKA,WACJW,KAAKvC,aAAa4W,cAAchV,8GCrI/BiV,GAAiB,eAC5B/H,EAD4BpM,UAAAsI,OAAA,QAAAvE,IAAA/D,UAAA,GAAAA,UAAA,GACK,GADL,OAG5B,IAAIoU,QAAQ,SAAAC,GACV,IAAMlN,EAAQmN,SAASC,cAAc,SACrCpN,EAAM/H,KAAO,OACTgN,EAAQoI,SACVrN,EAAMqN,OAASpI,EAAQoI,QAEzBrN,EAAMsN,SAAW,WACXtN,EAAMuN,OACRL,EAAQlN,EAAMuN,MAAM,KAGxBvN,EAAMwN,WAGGC,GAAwB,SAACpW,GAAD,OACnC,IAAI4V,QAAQ,SAAAC,GACV,IAAMQ,EAAS,IAAIC,WACnBD,EAAOE,OAAS,WACVF,EAAOG,QACTX,EAAQQ,EAAOG,SAGnBH,EAAOI,QAAU,WACftH,QAAQC,MAAM,SAAUiH,EAAOjH,QAEjCiH,EAAOK,kBAAkB1W,MC3BhB2W,GAAO,eAAAvY,EAAAC,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAC,EAAOkY,GAAP,IAAA/X,EAAAD,EAAAE,EAAAC,EAAAJ,EAAAK,EAAAC,EAAAC,EAAAC,EAAAC,EAAAwD,EAAAlC,EAAAC,EAAAC,EAAAE,EAAA,OAAAvC,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACHE,IAAI8W,UAAUD,GADX,cACf/X,EADec,EAAAW,KAAAX,EAAAoB,GAEJd,KAFIN,EAAAE,KAAA,EAEahB,EAAImB,KAAK,iBAAiB8W,MAAM,QAF7C,cAAAnX,EAAAoX,GAAApX,EAAAW,KAEf1B,EAFee,EAAAoB,GAECiW,MAFD9L,KAAAvL,EAAAoB,GAAApB,EAAAoX,IAAApX,EAAAsX,GAIAhX,KAJAN,EAAAE,KAAA,GAKbhB,EAAImB,KAAK,qBAAqB8W,MAAM,QALvB,QAAAnX,EAAAuX,GAAAvX,EAAAW,KAIfxB,EAJea,EAAAsX,GAIKD,MAJL9L,KAAAvL,EAAAsX,GAAAtX,EAAAuX,IAOfnY,EAAcF,EAAIsB,OAAO,SACzBxB,EAAU,IAAIiV,GARC5U,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA5F,EAAAC,KAAA,GAAAT,EASYL,EATZ0G,OAAAC,YAAA,WAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,KAAA,CAAAZ,EAAAE,KAAA,gBAAA+C,EAAAxD,EAAAK,MASRiB,EATQkC,EASRlC,GAAIC,EATIiC,EASJjC,KAAMC,EATFgC,EASEhC,KATFjB,EAAAE,KAAA,GAUAd,EAAYiB,KAAKU,EAAGG,YAAYiW,MAAM,eAVtC,QAUbhW,EAVanB,EAAAW,KAWnB3B,EAAQG,aAAa+H,IAAInG,EAAI,CAAEC,OAAMC,OAAME,SAEvCJ,GAAM/B,EAAQG,aAAa8H,SAC7BjI,EAAQG,aAAa8H,OAASlG,EAAK,GAdlB,QAAA1B,GAAA,EAAAW,EAAAE,KAAA,iBAAAF,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAwX,GAAAxX,EAAA,UAAAV,GAAA,EAAAC,EAAAS,EAAAwX,GAAA,QAAAxX,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAZ,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAArB,EAAAC,KAAA,IAAAX,EAAA,CAAAU,EAAAE,KAAA,eAAAX,EAAA,eAAAS,EAAAsB,OAAA,mBAAAtB,EAAAsB,OAAA,mBAkBrBtC,EAAQyU,SAASxU,GAlBIe,EAAAuB,OAAA,SAmBdvC,GAnBc,yBAAAgB,EAAAyB,SAAA1C,EAAA2C,KAAA,gCAAH,gBAAAC,GAAA,OAAAlD,EAAAmD,MAAAF,KAAAG,YAAA,GA2BP4V,GAAO,eAAAxT,EAAAvF,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAAG,SAAAkD,IAAA,IAAA3B,EAAA,OAAAzB,EAAAC,EAAAkB,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,cAAA+B,EAAA/B,KAAA,EACF8V,GAAe,CAAEK,OAAQ,oBADvB,cACfhW,EADe4B,EAAAtB,KAAAsB,EAAA/B,KAAA,EAER8W,GAAQ3W,GAFA,cAAA4B,EAAAV,OAAA,SAAAU,EAAAtB,MAAA,wBAAAsB,EAAAR,SAAAO,EAAAN,SAAH,yBAAAuC,EAAArC,MAAAF,KAAAG,YAAA,GCnCC6V,oDAcnBC,mBAAqB,SAACC,GACpBpI,QAAQqI,IAAI,qBAAsBD,EAAEE,eAGtCC,sBAAwB,SAACH,GACvBpI,QAAQqI,IAAI,wBAAyBD,EAAEE,+DAjBvC7C,OAAO+C,iBAAiB,mBAAoBtW,KAAKiW,oBACjD1C,OAAO+C,iBAAiB,sBAAuBtW,KAAKqW,sDAIpD9C,OAAOgD,oBAAoB,mBAAoBvW,KAAKiW,oBACpD1C,OAAOgD,oBACL,sBACAvW,KAAKqW,uDAYDpU,GACN,IAAMuU,EAAWC,UAAUC,cAEvBtY,EAAQ,EAHiBT,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IAI7B,QAAAnG,EAAAD,EAAsB0Y,EAAtBrS,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAAgC,KAArByY,EAAqBrY,EAAAK,MAC9B,GAAKgY,GAA+B,aAApBA,EAAQO,QAIxB,GAAI1U,EAAQ,EAAG,CACb,IAAM2U,EAAOR,EAAQS,KAAK5U,GAExBiE,KAAK4Q,IAAIF,IApCI,KAqCb1Q,KAAK4Q,IAAIF,GAAQ1Q,KAAK4Q,IAAI1Y,KAE1BA,EAAQwY,QAEL,GAAc,IAAV3U,EAAa,CACtB,IAAM8U,EAAKX,EAAQY,QAAQ,GAAG5Y,MAExBwY,EADKR,EAAQY,QAAQ,GAAG5Y,MACZ2Y,EACd7Q,KAAK4Q,IAAIF,GAAQ1Q,KAAK4Q,IAAI1Y,KAC5BA,EAAQwY,KAtBe,MAAAhO,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,GA0B7B,OAAOO,0CAGO6D,GACd,IAAMuU,EAAWC,UAAUC,cADW7N,GAAA,EAAAC,GAAA,EAAAC,OAAA7E,EAAA,IAGtC,QAAA8E,EAAAC,EAAsBuN,EAAtBrS,OAAAC,cAAAyE,GAAAG,EAAAC,EAAAzK,QAAAU,MAAA2J,GAAA,EAAgC,KAArBuN,EAAqBpN,EAAA5K,MAC9B,GAAKgY,GAA+B,aAApBA,EAAQO,SAIpBP,EAAQY,QAAQ/U,GAAOgV,QACzB,OAAO,GAT2B,MAAArO,GAAAE,GAAA,EAAAC,EAAAH,EAAA,YAAAC,GAAA,MAAAI,EAAAtJ,QAAAsJ,EAAAtJ,SAAA,WAAAmJ,EAAA,MAAAC,GAYtC,OAAO,WCjEUmO,cAKnB,SAAAA,EAAYC,GAAqB,IAAAzN,EAAA1J,KAAAhD,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAkX,GAAAlX,KAJjCmX,YAIiC,EAAAnX,KAHjCoX,YAAc,IAAIC,IAGerX,KAFjCsX,UAAY,IAAIhS,IAEiBtF,KAyBjCuX,MAAQ,WACN7N,EAAK0N,YAAY3R,SA1BczF,KA6BjCwX,UAAY,SAACtB,GACXA,EAAEuB,iBAGEvR,KAAK4Q,IAAIZ,EAAEwB,WAAahO,EAAK4N,UAAUrU,IAAIiT,EAAE/X,MAAQ,KAAO,KAC9DuL,EAAK0N,YAAYhI,IAAI8G,EAAE/X,MAlCM6B,KAsCjC2X,QAAU,SAACzB,GACTA,EAAEuB,iBACF/N,EAAK0N,YAAYpV,OAAOkU,EAAE/X,KAC1BuL,EAAK4N,UAAU9R,IAAI0Q,EAAE/X,IAAK+X,EAAEwB,YAzCG1X,KA4CjC4X,QAAU,SAAC1B,GAEQ,IAAbA,EAAE2B,QAAgB3B,EAAE4B,UACtBpO,EAAK6N,SA9CPvX,KAAKmX,OAASA,uDAIdnX,KAAKmX,OAAOb,iBAAiB,OAAQtW,KAAKuX,OAC1CvX,KAAKmX,OAAOb,iBAAiB,cAAetW,KAAKuX,OACjDvX,KAAKmX,OAAOb,iBAAiB,UAAWtW,KAAKwX,WAC7CxX,KAAKmX,OAAOb,iBAAiB,QAAStW,KAAK2X,SAC3ClD,SAAS6B,iBAAiB,QAAStW,KAAK4X,wCAIxC5X,KAAKmX,OAAOZ,oBAAoB,OAAQvW,KAAKuX,OAC7CvX,KAAKmX,OAAOZ,oBAAoB,cAAevW,KAAKuX,OACpDvX,KAAKmX,OAAOZ,oBAAoB,UAAWvW,KAAKwX,WAChDxX,KAAKmX,OAAOZ,oBAAoB,QAASvW,KAAK2X,SAC9ClD,SAAS8B,oBAAoB,QAASvW,KAAK4X,SAC3C5X,KAAKuX,0CAGGpZ,GACR,OAAO6B,KAAKoX,YAAYW,IAAI5Z,YCtB1B0Y,GAAO,CACXnP,EAAG,IAAIb,IAAQ,EAAG,EAAG,GACrBsB,EAAG,IAAItB,IAAQ,EAAG,EAAG,GACrBc,EAAG,IAAId,IAAQ,EAAG,EAAG,IAGFmR,cAsBnB,SAAAA,EAAY1a,GAAkB,IAAAoM,EAAA1J,KAAAhD,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAgY,GAAAhY,KArB9BmX,OAA6B,KAqBCnX,KApB9B1C,aAoB8B,EAAA0C,KAlB9BiY,UAAY,EAkBkBjY,KAjB9BkY,kBAAoB,EAiBUlY,KAhB9BmY,aAAe,IAgBenY,KAf9BoY,mBAAqB,EAeSpY,KAd9BqY,uBAAwB,EAcMrY,KAZ9BsY,cAAe,EAYetY,KAV9BuY,SAAW,IAAIC,IAUexY,KAT9ByY,YAS8B,EAAAzY,KAP9B0Y,UAAY,IAAIC,IAOc3Y,KAL9B4Y,YAAc,IAAI3N,IAKYjL,KAH9B6Y,KAAO,IAAI3B,GAAiBlX,KAAKuY,SAASO,YAGZ9Y,KAF9BwW,SAAW,IAAIR,GAEehW,KAuC9B+Y,OAAS,WACP,GAAKrP,EAAKyN,OAAV,CADmB,IAAA6B,EAKmBtP,EAAKyN,OAAnC8B,EALWD,EAKXC,YAAaC,EALFF,EAKEE,aAErBxP,EAAKpM,QAAQmT,OAAOmD,OAASqF,EAAcC,EAC3CxP,EAAKpM,QAAQmT,OAAOoD,yBAEpBnK,EAAK6O,SAASY,cAAc5F,OAAO6F,kBACnC1P,EAAK6O,SAASc,QAAQJ,EAAaC,KAlDPlZ,KAqD9BsZ,QAAgC,SAAAC,GAC9B7P,EAAKuO,UAAY1E,OAAOiG,sBAAsB9P,EAAK4P,SAEnD,IAAMG,GAAMF,EAAI7P,EAAKwO,mBAAqB,IAC1CxO,EAAKwO,kBAAoBqB,EACzB7P,EAAKR,OAAOuQ,GAER/P,EAAK4O,aACP5O,EAAK6O,SAASmB,OAAOhQ,EAAKpM,QAAQsV,WAAYlJ,EAAKpM,QAAQmT,SAS3D/G,EAAKpM,QAAQsV,WAAW+G,oBACxBjQ,EAAKpM,QAAQsV,WAAWnC,OAAOkJ,mBAAkB,KAtEnD3Z,KAAK1C,QAAUA,EACf0C,KAAKyY,OAASzY,KAAKuY,SAASO,WAC5B9Y,KAAKyY,OAAOmB,UAAY,EAExB5Z,KAAK1C,QAAQoW,WAAW1T,KAAK1C,QAAQmV,MAAM,IAC3CzS,KAAK1C,QAAQmT,OAAO7J,SAASpB,IAAI,EAAGxF,KAAKmY,aAAe,GAAK,GAC7DnY,KAAK1C,QAAQmT,OAAOd,SAASnK,IAAI,EAAG,EAAG,sDAGlC2R,GACLnX,KAAK6Y,KAAKgB,SACV7Z,KAAKwW,SAASqD,SAEd7Z,KAAKmX,OAASA,EACdA,EAAO2C,YAAY9Z,KAAKyY,QAExBzY,KAAK+Y,SACLxF,OAAOiG,sBAAsBxZ,KAAKsZ,SAClC/F,OAAO+C,iBAAiB,SAAUtW,KAAK+Y,yCAIvCxF,OAAOwG,qBAAqB/Z,KAAKiY,WACjC1E,OAAOgD,oBAAoB,SAAUvW,KAAK+Y,QAEtC/Y,KAAKmX,SACPnX,KAAKmX,OAAO6C,YAAYha,KAAKyY,QAC7BzY,KAAKmX,OAAS,MAGhBnX,KAAK6Y,KAAK9Y,OACVC,KAAKwW,SAASzW,uCAIdC,KAAKyY,OAAOwB,kDAwCZja,KAAKsY,cAAetY,KAAKsY,aACzBtY,KAAKuY,SAAS9S,0CAINyU,EAAeC,EAAcC,GACrC,IAAMC,EAAMnU,KAAKmU,IAAIna,MAAMgG,KAAM,CAACiU,EAAMC,IACtCnJ,EAAM/K,KAAK+K,IAAI/Q,MAAMgG,KAAM,CAACiU,EAAMC,IACpC,OAAOF,GAASG,GAAOH,GAASjJ,8CAIhC,IAAMqJ,EAAiBta,KAAK1C,QAAQuV,aACpC,OAAsB,MAAlByH,IACFA,EAAeC,QAAQ,KAChB,kCAMJd,GAAkB,IACfhJ,EAAWzQ,KAAK1C,QAAhBmT,OACRzQ,KAAK4Y,YAAYhS,SAASgE,KAAK6F,EAAO7J,UACtC5G,KAAK4Y,YAAYjJ,SAAS/E,KAAK6F,EAAOd,UAEtC,IAAI6K,EAAQ,EACRC,EAAQ,EACRC,EAAU,EAMd,GAAI1a,KAAK6Y,KAAK8B,UAAU,KAAM,CAC5B,IAAMC,GAAQ,EAAInB,EAClBgB,EAAQvU,KAAK4Q,IAAI2D,GAASvU,KAAK4Q,IAAI8D,GAAQA,EAAOH,EAEpD,GAAIza,KAAK6Y,KAAK8B,UAAU,KAAM,CAC5B,IAAMC,EAAO,EAAInB,EACjBgB,EAAQvU,KAAK4Q,IAAI2D,GAASvU,KAAK4Q,IAAI8D,GAAQA,EAAOH,EAEpD,GAAIza,KAAK6Y,KAAK8B,UAAU,KAAM,CAC5B,IAAME,GAAQ,EAAIpB,EAClBe,EAAQtU,KAAK4Q,IAAI0D,GAAStU,KAAK4Q,IAAI+D,GAAQA,EAAOL,EAEpD,GAAIxa,KAAK6Y,KAAK8B,UAAU,KAAM,CAC5B,IAAME,EAAO,EAAIpB,EACjBe,EAAQtU,KAAK4Q,IAAI0D,GAAStU,KAAK4Q,IAAI+D,GAAQA,EAAOL,EAGpD,GAAIxa,KAAK6Y,KAAK8B,UAAU,aAAc,CACpC,IAAMG,EAAOrB,EACbiB,EAAUxU,KAAK4Q,IAAI4D,GAAWxU,KAAK4Q,IAAIgE,GAAQA,EAAOJ,EAExD,GAAI1a,KAAK6Y,KAAK8B,UAAU,cAAe,CACrC,IAAMG,GAAQrB,EACdiB,EAAUxU,KAAK4Q,IAAI4D,GAAWxU,KAAK4Q,IAAIgE,GAAQA,EAAOJ,EAIxD,IAAMK,EACD/a,KAAKwW,SAASwE,QAAQ,GADrBD,EAED/a,KAAKwW,SAASwE,QAAQ,GAFrBD,EAGA/a,KAAKwW,SAASwE,QAAQ,GAE5B,GAAID,EAAe,CACjB,IAAMF,EAAO,EAAIpB,EAAKsB,EACtBP,EAAQtU,KAAK4Q,IAAI0D,GAAStU,KAAK4Q,IAAI+D,GAAQA,EAAOL,EAEpD,GAAIO,EAAe,CACjB,IAAMH,EAAO,EAAInB,EAAKsB,EACtBN,EAAQvU,KAAK4Q,IAAI2D,GAASvU,KAAK4Q,IAAI8D,GAAQA,EAAOH,EAEpD,GAAIM,EAAgB,CAClB,IAAMD,GAAQrB,EAAKsB,EACnBL,EAAUxU,KAAK4Q,IAAI4D,GAAWxU,KAAK4Q,IAAIgE,GAAQA,EAAOJ,EAIxDjK,EAAOwK,kBAAkBpE,GAAK1O,EAAGuS,GAEjC1a,KAAK4Y,YAAYsC,gBAAgBrE,GAAKlP,EAAG8S,GACzCza,KAAK4Y,YAAYsC,gBAAgBrE,GAAKnP,EAAG8S,GAGzC,IAAMK,EAAO7a,KAAK4Y,YAAYhS,SAASc,EACjCkT,EAAO5a,KAAK4Y,YAAYhS,SAASe,EAGnCwT,GAAW,EArEQxd,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IAsEvB,QAAAnG,EAAAD,EAAgBkC,KAAK1C,QAAQsV,WAAWpB,SAAxCrN,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAAkD,KAAvCyW,EAAuCrW,EAAAK,MAChD,GAAMgW,aAAavE,IAAnB,CAGA,IAGIuL,GAAO,IAAIC,KAAOC,cAAclH,GAC9BmH,EAAeH,EAAKI,UAAU,IAAI3U,KAClC4U,EAAYL,EAAKM,QAAQ,IAAI7U,KAG7B8U,EAAUJ,EAAa7T,EAAI+T,EAAU/T,EAAI,EARrB,IASpBkU,EAAUL,EAAa7T,EAAI+T,EAAU/T,EAAI,EATrB,IAUpBmU,EAAUN,EAAapT,EAAIsT,EAAUtT,EAAI,EATvB,IAUlB2T,EAAUP,EAAapT,EAAIsT,EAAUtT,EAAI,EAVvB,IAWlB4T,EAAUR,EAAa5T,EAAI8T,EAAU9T,EAAI,EAZrB,IAapBqU,EAAUT,EAAa5T,EAAI8T,EAAU9T,EAAI,EAbrB,IAiBxB3H,KAAKic,UAAUpB,EAAMe,EAASD,IAC9B3b,KAAKic,UAAUrB,EAAMoB,EAASD,KAC7B/b,KAAKic,UAAUJ,EAAS,EAAG7b,KAAKmY,eAC/BnY,KAAKic,UAAUH,EAAS,EAAG9b,KAAKmY,eAC/BnY,KAAKic,UAAUjc,KAAKmY,aAAc2D,EAASD,IAC1C7b,KAAKic,UAAU,EAAGH,EAASD,MAE/BV,GAAW,KAlGQ,MAAAvS,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,GAuGlBsd,EAEMnb,KAAKoY,mBAAqB,IAAOnE,KAAKiI,QAE/Clc,KAAKoY,mBAAqBnE,KAAKiI,OAH/BzL,EAAO7J,SAASgE,KAAK5K,KAAK4Y,YAAYhS,UAYxC,IAHA,IAAIuV,EAAcC,IACdC,EAAgC,KAE3BjI,EAAI,EAAGA,IAAM,EAAGA,GAAK,GAAK,CAEjCpU,KAAK0Y,UAAU4D,cAAc,CAAE5U,EAAG,EAAGS,EAAGiM,GAAK3D,GAC7C,IAAM8L,EAAgBvc,KAAK0Y,UAAU8D,iBAEnCxc,KAAK1C,QAAQsV,WAAWpB,UALO3I,GAAA,EAAAC,GAAA,EAAAC,OAAA7E,EAAA,IAQjC,QAAA8E,EAAAC,EAA2BsT,EAA3BpY,OAAAC,cAAAyE,GAAAG,EAAAC,EAAAzK,QAAAU,MAAA2J,GAAA,EAA0C,KAA/B4T,EAA+BzT,EAAA5K,MAElC0T,EAAI2K,EAAapL,OACnBS,aAAalD,IAAc6N,EAAa7U,SAAWuU,IACrDA,EAAcM,EAAa7U,SAC3ByU,EAAavK,IAbgB,MAAAlJ,GAAAE,GAAA,EAAAC,EAAAH,EAAA,YAAAC,GAAA,MAAAI,EAAAtJ,QAAAsJ,EAAAtJ,SAAA,WAAAmJ,EAAA,MAAAC,IAkB/BoT,GAAe,KAAqB,MAAdE,EAExBrc,KAAK1C,QAAQwW,aAAauI,GAG1Brc,KAAK1C,QAAQwW,aAAa,OAMzB9T,KAAKwW,SAASkG,gBAAgB,KAAM1c,KAAK6Y,KAAK8B,UAAU,MAExD3a,KAAKqY,sBAIIrY,KAAKwW,SAASkG,gBAAgB,IAAO1c,KAAK6Y,KAAK8B,UAAU,OACnE3a,KAAKqY,uBAAwB,IAH7BrY,KAAKqY,uBAAwB,EAC7BrY,KAAK2c,k8DCvRJ,IAAMC,GAAeC,KAAOC,IAAVC,MAcZC,GAAeH,KAAOC,IAAVG,MAaZC,GAAkBL,KAAOrJ,EAAV2J,MAOfC,GAAyBP,KAAOC,IAAVO,MAStBC,GAAgBT,KAAOC,IAAVS,KAOtB,SAAAC,GAAK,OACLA,EAAMC,UACNC,aADAC,OAWE,SAAAH,GAAK,OACJA,EAAMC,UACPC,aADAE,QAOOC,GAAgBhB,KAAOiB,MAAVC,MAObC,GAAOnB,KAAOoB,KAAVC,KASGtB,IClECuB,eAOnB,SAAAA,EAAYX,GAAc,IAAA9T,EAAA,OAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAme,IACxBzU,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAAmhB,GAAAtU,KAAA7J,KAAMwd,KAPRY,UAAYC,IAAMC,YAMQ5U,EAL1B6U,QAAU,IAAIvG,GAAQtO,EAAK8T,MAAMlgB,SAKPoM,EAJ1B8U,gBAAsC,KAIZ9U,EAF1B+U,MAAe,CAAEjS,oBAAqB3P,EAAoB4P,UAEhC/C,EAgB1BgV,OAAS,WACPhV,EAAK6U,QAAQI,SACbjV,EAAK8T,MAAMkB,UAlBahV,EAqB1BkV,eAAiB,WACflV,EAAK6U,QAAQM,mBAtBWnV,EAyB1BoV,cAAgB,SACdC,EACAxb,GAEAmG,EAAK8T,MAAMlgB,QAAQqW,0BAA0BpQ,GAC7CmG,EAAKsV,SAAS,CAAExS,oBAAqBjJ,KA5BrCmG,EAAK+U,MAAMjS,oBAAsB9C,EAAK8T,MAAMlgB,QAAQqV,0BAF5BjJ,mFAMpB1J,KAAKoe,UAAUa,UACjBjf,KAAKue,QAAQW,OAAOlf,KAAKoe,UAAUa,SACnCjf,KAAKue,QAAQtE,wDAKfja,KAAKue,QAAQI,0CAoBW,IAAA/M,EAAA5R,KAChBwM,EAAwBxM,KAAKye,MAA7BjS,oBAER,OACE2S,EAAAhiB,EAAAuX,cAACsJ,GAAD,CAAMoB,IAAKpf,KAAKoe,WACde,EAAAhiB,EAAAuX,cAACsI,GAAD,eAEEmC,EAAAhiB,EAAAuX,cAACwI,GAAD,aACAiC,EAAAhiB,EAAAuX,cAAC0I,GAAD,KACE+B,EAAAhiB,EAAAuX,cAAC4I,GAAD,CAAe1F,QAAS5X,KAAK0e,QAA7B,QACAS,EAAAhiB,EAAAuX,cAAC4I,GAAD,CAAe1F,QAAS5X,KAAK4e,gBAA7B,mBAIFO,EAAAhiB,EAAAuX,cAACwI,GAAD,6BACAiC,EAAAhiB,EAAAuX,cAAC0I,GAAD,KACE+B,EAAAhiB,EAAAuX,cAAC4I,GAAD,CACE1F,QAAS,SAAA1B,GAAC,OAAItE,EAAKkN,cAAc5I,EAAGrZ,EAAoB4P,WACxDgR,SAAUjR,IAAwB3P,EAAoB4P,UAFxD,iBAMA0S,EAAAhiB,EAAAuX,cAAC4I,GAAD,CACEG,SAAUjR,IAAwB3P,EAAoB8Q,SACtDiK,QAAS,SAAA1B,GAAC,OAAItE,EAAKkN,cAAc5I,EAAGrZ,EAAoB8Q,YAF1D,eAMAwR,EAAAhiB,EAAAuX,cAAC4I,GAAD,CACEG,SACEjR,IAAwB3P,EAAoB6P,eAE9CkL,QAAS,SAAA1B,GAAC,OACRtE,EAAKkN,cAAc5I,EAAGrZ,EAAoB6P,kBAL9C,oBAWFyS,EAAAhiB,EAAAuX,cAACwI,GAAD,iBACAiC,EAAAhiB,EAAAuX,cAACmJ,GAAD,KACEsB,EAAAhiB,EAAAuX,cAAA,UACEyK,EAAAhiB,EAAAuX,cAAA,kBACAyK,EAAAhiB,EAAAuX,cAAA,oCAEFyK,EAAAhiB,EAAAuX,cAAA,UACEyK,EAAAhiB,EAAAuX,cAAA,kBACAyK,EAAAhiB,EAAAuX,cAAA,wCAEFyK,EAAAhiB,EAAAuX,cAAA,UACEyK,EAAAhiB,EAAAuX,cAAA,sBACAyK,EAAAhiB,EAAAuX,cAAA,8BAINyK,EAAAhiB,EAAAuX,cAACkI,GAAD,wBA/FsCyB,IAAMgB,s4CCnBpD,IAAMC,GAAWzC,KAAOC,IAAVyC,MAcRC,GAAY3C,KAAOC,IAAV2C,MASTC,GAAW7C,KAAOC,IAAV6C,MAKRC,GAAU/C,KAAOC,IAAV+C,MAIAC,GAAcjD,KAAOC,IAAViD,MAMXC,GAASnD,KAAOhF,OAAVoI,MA+BEC,8MACnBC,gBAA2C,SAAAjK,GACrCA,EAAEkK,gBAAkBlK,EAAEiB,QAAUzN,EAAK8T,MAAM6C,WAC7C3W,EAAK8T,MAAM6C,qFAKb,OACElB,EAAAhiB,EAAAuX,cAAC4K,GAAD,CAAU1H,QAAS5X,KAAKmgB,iBACtBhB,EAAAhiB,EAAAuX,cAAC8K,GAAD,KACEL,EAAAhiB,EAAAuX,cAACgL,GAAD,KAAW1f,KAAKwd,MAAM8C,OACtBnB,EAAAhiB,EAAAuX,cAACkL,GAAD,KAAU5f,KAAKwd,MAAMhM,mBAZI6M,IAAMgB,WC5DpBkB,oLACO,IAAA7W,EAAA1J,KAChBwgB,EAAexgB,KAAKwd,MAApBgD,WACR,OACErB,EAAAhiB,EAAAuX,cAAC+L,GAAD,CAAOH,MAAM,aAAaD,UAAWrgB,KAAKwd,MAAM6C,WAC9ClB,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,kBADF,IACgB8L,EAAWlhB,MAE3B6f,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,kBADF,IACgB8L,EAAWjhB,MAE3B4f,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,kBADF,IACgBxO,KAAKwa,KAAKF,EAAW/gB,KAAKkhB,WAAa,MADvD,QAGAxB,EAAAhiB,EAAAuX,cAACoL,GAAD,KACEX,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS,kBAAMlO,EAAK8T,MAAMoD,SAASJ,KAA3C,UAGArB,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS,kBAAMlO,EAAK8T,MAAMqD,SAASL,KAA3C,UAGArB,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAKwd,MAAMsD,UAA5B,iBArBkCzC,IAAMgB,gnBCHlD,IAAM0B,GAAYlE,KAAOC,IAAVkE,MAOTC,GAAYpE,KAAOC,IAAVoE,MA+BMC,8MACnBC,aAAe,IAAIC,QACnB5C,MAAe,CAAEzf,QAAS,GAAIsiB,cAAe,QAE7CC,yCAAsB,SAAAlkB,IAAA,IAAAsB,EAAAc,EAAAqP,EAAAzP,EAAA,OAAAnC,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACD8V,GAAe,CAAEK,OAAQ,YADxB,cACdhW,EADcL,EAAAW,KAAAX,EAAAE,KAAA,EAEDuW,GAAsBpW,GAFrB,cAEdc,EAFcnB,EAAAW,KAGd6P,EAAY,CAAExP,KAAMX,EAAKW,KAAMC,KAAMZ,EAAKY,KAAME,QAHlCnB,EAAAE,KAAA,EAIHkL,EAAK8T,MAAM/f,aAAa2R,IAAIN,GAJzB,OAIdzP,EAJcf,EAAAW,KAKpByK,EAAKsV,SAAS,SAAA3e,GAAA,IAAGrB,EAAHqB,EAAGrB,QAAH,MAAkB,CAC9BA,QAAO,GAAAyB,OAAAzD,OAAAgV,EAAA,EAAAhV,CACFgC,GADE,CAAAhC,OAAAsH,EAAA,EAAAtH,CAAA,CAGHqC,MACGyP,QAVW,yBAAAxQ,EAAAyB,SAAA1C,EAAA2C,WAsBtBwhB,YAAc,WACZ9X,EAAK0X,aAAaK,QAClBC,IAAIC,gBAAgBjY,EAAK0X,aAAaQ,QAGxCC,QAAU,WACRnY,EAAKsV,SAAS,CAAEsC,cAAe,OAC/B5X,EAAK8T,MAAM6C,YACX3W,EAAK8X,iBAWPM,cAAgB,WACdpY,EAAKsV,SAAS,CAAEsC,cAAe,OAC/B5X,EAAK8X,iBAGP/c,YAAc,SAAAlD,GAAwB,IAArBlC,EAAqBkC,EAArBlC,GACfqK,EAAK8T,MAAM/f,aAAauE,OAAO3C,GAC/BqK,EAAKsV,SAAS,SAAAzc,GAAA,MAAkB,CAC9BvD,QADYuD,EAAGvD,QACEyS,OAAO,SAAAyE,GAAC,OAAIA,EAAE7W,KAAOA,IACtCiiB,cAAe,WAInBS,YAAc,SAAAnf,GAAsC,IAAnCtD,EAAmCsD,EAAnCtD,KAAMC,EAA6BqD,EAA7BrD,KAAME,EAAuBmD,EAAvBnD,KAC3Be,iBAAO,IAAIwhB,KAAK,CAACviB,GAAO,CAAEF,SAASD,gFAvCxB0E,GACXhE,KAAKohB,aAAaQ,IAAMF,IAAIO,gBAAgB,IAAID,KAAK,CAAChe,EAAMvE,QAC5DO,KAAKohB,aAAatW,MAAO,EACzB9K,KAAKohB,aAAa3R,2CAcR+Q,GACNxgB,KAAKwd,MAAMpL,SACbpS,KAAKwd,MAAMpL,SAASoO,GAEpBxgB,KAAKgf,SAAS,CAAEsC,cAAed,8KAsB3BxhB,EAAwB,oCACMgB,KAAKwd,MAAM/f,aAAauB,2JAA1CK,OAAIyP,OACpB9P,EAAQI,KAARpC,OAAAsH,EAAA,EAAAtH,CAAA,GAAkB8R,EAAlB,CAA6BzP,yTAE/BW,KAAKgf,SAAS,CACZhgB,QAASA,EAAQkjB,KAAK,SAAC/kB,EAAGglB,GAAJ,OAAUhlB,EAAEkC,GAAK8iB,EAAE9iB,ySAKrCW,KAAKoiB,qMAGYC,sEACnBA,EAAU5kB,eAAiBuC,KAAKwd,MAAM/f,6CAElCuC,KAAKoiB,kKAKbpiB,KAAKohB,aAAaK,QAClBC,IAAIC,gBAAgB3hB,KAAKohB,aAAaQ,sCAGd,IAAAhQ,EAAA5R,KAAAsiB,EACWtiB,KAAKye,MAAhCzf,EADgBsjB,EAChBtjB,QAASsiB,EADOgB,EACPhB,cAEjB,OAAIA,EAEAnC,EAAAhiB,EAAAuX,cAAC6N,GAAD,CACE/B,WAAYc,EACZV,SAAU5gB,KAAKyE,YACfoc,SAAU7gB,KAAK+hB,YACfjB,SAAU9gB,KAAK8hB,cACfzB,UAAWrgB,KAAK6hB,UAMpB1C,EAAAhiB,EAAAuX,cAAC+L,GAAD,CACEH,MAAOtgB,KAAKwd,MAAMpL,SAAW,eAAiB,gBAC9CiO,UAAWrgB,KAAK6hB,SAEhB1C,EAAAhiB,EAAAuX,cAACqM,GAAD,KACG/hB,EAAQyJ,OAAS,GAChBzJ,EAAQkN,IAAI,SAAAgK,GAAC,OACXiJ,EAAAhiB,EAAAuX,cAACuM,GAAD,CACE9iB,IAAK+X,EAAE7W,GACPihB,MAAOpK,EAAE5W,KACTsY,QAAS,kBAAMhG,EAAK4Q,YAAYtM,IAChCuM,aAAc,kBAAM7Q,EAAK8Q,aAAaxM,IACtCyM,aAAc/Q,EAAK4P,aAElBtL,EAAE5W,KAPL,IAOW6f,EAAAhiB,EAAAuX,cAAA,WACRwB,EAAE3W,KARL,IAQW4f,EAAAhiB,EAAAuX,cAAA,WACRxO,KAAKwa,KAAKxK,EAAEzW,KAAKkhB,WAAa,MATjC,YAaJ3hB,EAAQyJ,QAAU0W,EAAAhiB,EAAAuX,cAAA,oDACpByK,EAAAhiB,EAAAuX,cAACoL,GAAD,KACEX,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAKuhB,qBAAtB,kBACApC,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAK6hB,SAAtB,mBA/HqCxD,IAAMgB,8gDC3CrD,IAmGKuD,GAnGCpD,GAAY3C,KAAOC,IAAV+F,MAkBTC,GAAcjG,KAAOC,IAAViG,KAUb,SAAAvF,GAAK,OACLA,EAAMwF,UACNtF,aADAuF,OAKA,SAAAzF,GAAK,OACLA,EAAM0F,YACNxF,aADAyF,QAMEC,GAAmBvG,KAAOwG,MAAVC,MAIhBC,GAAO1G,KAAOC,IAAV0G,MAiBJC,GAAW5G,KAAOC,IAAV4G,MAWRC,GAAc9G,KAAOC,IAAV8G,gBA0BZhB,8JAYgBiB,8MACnBpF,MAAe,CACbqF,WAAY,gFAGHC,GACT/jB,KAAKgf,SAAS,SAAAP,GAAK,MAAK,CACtBqF,WAAYrF,EAAMqF,aAAeC,EAAW,KAAOA,yCAKrD/jB,KAAKgf,SAAS,CAAE8E,WAAY,wCAGJ,IAAAlS,EAAA5R,KAAAgkB,EACuBhkB,KAAKwd,MAA5ChR,EADgBwX,EAChBxX,oBAAqByX,EADLD,EACKC,cACrBH,EAAe9jB,KAAKye,MAApBqF,WAER,OACE3E,EAAAhiB,EAAAuX,cAACwP,GAAD,CAAWtK,UAAW,EAAGuK,OAAQ,kBAAMvS,EAAKwS,cAC1CjF,EAAAhiB,EAAAuX,cAACoO,GAAD,CACEE,SAAUc,IAAelB,GAASyB,SAClCzM,QAAS,kBAAMhG,EAAK0S,WAAW1B,GAASyB,YAExClF,EAAAhiB,EAAAuX,cAAC0O,GAAD,aACAjE,EAAAhiB,EAAAuX,cAAC6O,GAAD,CAAMgB,OAAQT,IAAelB,GAASyB,UACpClF,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMgH,cAA9B,eACArF,EAAAhiB,EAAAuX,cAACiP,GAAD,MACAxE,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMiH,eAA9B,gBACAtF,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMkH,iBAA9B,kBAGAvF,EAAAhiB,EAAAuX,cAACiP,GAAD,MACAxE,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMmH,eAA9B,gBACAxF,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMoH,iBAA9B,kBAGAzF,EAAAhiB,EAAAuX,cAACiP,GAAD,MACAxE,EAAAhiB,EAAAuX,cAAC+O,GAAD,mBAGJtE,EAAAhiB,EAAAuX,cAACoO,GAAD,CACEE,SAAUc,IAAelB,GAASiC,SAClCjN,QAAS,kBAAMhG,EAAK0S,WAAW1B,GAASiC,YAExC1F,EAAAhiB,EAAAuX,cAAC0O,GAAD,aACAjE,EAAAhiB,EAAAuX,cAAC6O,GAAD,CAAMgB,OAAQT,IAAelB,GAASiC,UACpC1F,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMsH,aAA9B,cACA3F,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMuH,gBAA9B,iBAGA5F,EAAAhiB,EAAAuX,cAACiP,GAAD,MACAxE,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMwH,WAA9B,YACA7F,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAMyH,cAA9B,iBAGJ9F,EAAAhiB,EAAAuX,cAACoO,GAAD,CACEE,SAAUc,IAAelB,GAASsC,SAClCtN,QAAS,kBAAMhG,EAAK0S,WAAW1B,GAASsC,YAExC/F,EAAAhiB,EAAAuX,cAAC0O,GAAD,aACAjE,EAAAhiB,EAAAuX,cAAC6O,GAAD,CAAMgB,OAAQT,IAAelB,GAASsC,UACpC/F,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAM2H,oBAA9B,iBAGAhG,EAAAhiB,EAAAuX,cAAC+O,GAAD,CAAU7L,QAAS5X,KAAKwd,MAAM4H,sBAA9B,qBAKJjG,EAAAhiB,EAAAuX,cAACoO,GAAD,CACEE,SAAUc,IAAelB,GAASyC,SAClCzN,QAAS,kBAAMhG,EAAK0S,WAAW1B,GAASyC,YAExClG,EAAAhiB,EAAAuX,cAAC0O,GAAD,aACAjE,EAAAhiB,EAAAuX,cAAC6O,GAAD,CAAMgB,OAAQT,IAAelB,GAASyC,UACpClG,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBACPrE,OAAO+R,KACL,+CACA,YAJN,UAUAnG,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBACPrE,OAAO+R,KAAK,wCAAyC,YAFzD,eAOAnG,EAAAhiB,EAAAuX,cAACiP,GAAD,MACAxE,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBACPrE,OAAO+R,KACL,8DACA,YAJN,WAYJnG,EAAAhiB,EAAAuX,cAACoO,GAAD,CAAaI,YAAU,EAACtL,QAAS5X,KAAKwd,MAAM+H,cAC1CpG,EAAAhiB,EAAAuX,cAAC0O,GAAD,aAEFjE,EAAAhiB,EAAAuX,cAACoO,GAAD,CACEI,YAAU,EACVF,SAAUc,IAAelB,GAAS4C,UAClC5N,QAAS,kBAAMhG,EAAK0S,WAAW1B,GAAS4C,aAExCrG,EAAAhiB,EAAAuX,cAAC0O,GAAD,eAA0B5W,GAC1B2S,EAAAhiB,EAAAuX,cAAC6O,GAAD,CAAMgB,OAAQT,IAAelB,GAAS4C,WACpCrG,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBAAMqM,EAAcpnB,EAAoB4P,YAEhD5P,EAAoB4P,UAEvB0S,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBAAMqM,EAAcpnB,EAAoB8Q,YAEhD9Q,EAAoB8Q,UAGvBwR,EAAAhiB,EAAAuX,cAAC+O,GAAD,CACE7L,QAAS,kBAAMqM,EAAcpnB,EAAoB6P,kBAEhD7P,EAAoB6P,0BAnIE2R,IAAMgB,80FCjHpC,ICgBFoG,GDhBQjG,GAAY3C,KAAOC,IAAV4I,MAcTC,GAAiB9I,KAAOC,IAAV8I,MAOdC,GAAUhJ,KAAOiJ,MAAVC,MAUPnJ,GAAeC,KAAOC,IAAVkJ,MAcZhI,GAAOnB,KAAOoB,KAAVgI,KAKGrJ,IAKPsJ,GAAQrJ,KAAOC,IAAVqJ,MAILC,GAAQvJ,KAAOvV,MAAV+e,MAkBLC,GAASzJ,aAAOuJ,GAAMG,cAAc,UAA3B1J,CAAH2J,MAINC,GAAc5J,aAAOuJ,GAAMG,cAAc,OAA3B1J,CAAH6J,MAIXC,GAAa9J,aAAOuJ,GAAMG,cAAc,YAA3B1J,CAAH+J,MAYVC,GAAahK,KAAOC,IAAVgK,KAIjBV,IAaOW,GAAWlK,KAAOmK,GAAVC,MAYRC,GAAerK,KAAOsK,GAAVC,KAIrB,SAAA5J,GAAK,OACLA,EAAM6J,QACN3J,aADA4J,QExGiBC,8MACnBC,iBAAkC,OAClC/I,MAAe,KAEfgJ,UAAY,WAAM,IACR7X,EAAoBlG,EAAK8T,MAAMnM,OAA/BzB,gBACR,GAAKA,EAIL,IAEE,IAAIrB,SAAS,cAAe,YAAaqB,GACzClG,EAAKsV,SAAS,CAAE0I,eAAWxjB,IAC3B,MAAOyjB,GACPje,EAAKsV,SAAS,CAAE0I,UAAWC,EAAGnoB,iBAIlCooB,sBAAuE,SAAA1R,GACrExM,EAAK8T,MAAMqK,wBAAwB3R,EAAEkK,cAAchiB,OACtB,MAAzBsL,EAAK8d,kBACPjU,OAAOuU,aAAape,EAAK8d,kBAE3BjU,OAAOwU,WAAWre,EAAK+d,UAAW,8EAGV,IAAAzD,EASpBhkB,KAAKwd,MAPC1L,EAFckS,EAEtB3S,OACA2W,EAHsBhE,EAGtBgE,aACAC,EAJsBjE,EAItBiE,iBACAC,EALsBlE,EAKtBkE,iBACAC,EANsBnE,EAMtBmE,cACAC,EAPsBpE,EAOtBoE,wBACAC,EARsBrE,EAQtBqE,qBAEMX,EAAc1nB,KAAKye,MAAnBiJ,UAER,OACEvI,EAAAhiB,EAAAuX,cAAA,WACEyK,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,4BACAyK,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,OACLnB,MAAO0T,EAAExS,KACTgpB,SAAU,SAAApS,GAAC,OAAI8R,EAAa9R,EAAEkK,cAAchiB,WAGhD+gB,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,mCACAyK,EAAAhiB,EAAAuX,cAACmS,GAAD,KACE1H,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,IACNnqB,MAAO0T,EAAElL,SAASc,EAAE8gB,QAAQ,GAC5BF,SAAU,SAAApS,GAAC,OACT+R,EACE3hB,EAAiB4P,EAAEkK,cAAcqI,cAAe,KAChD3W,EAAElL,SAASuB,EACX2J,EAAElL,SAASe,MAIjBwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,IACNnqB,MAAO0T,EAAElL,SAASuB,EAAEqgB,QAAQ,GAC5BF,SAAU,SAAApS,GAAC,OACT+R,EACEnW,EAAElL,SAASc,EACXpB,EAAiB4P,EAAEkK,cAAcqI,cAAe,KAChD3W,EAAElL,SAASe,MAIjBwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,IACNnqB,MAAO0T,EAAElL,SAASe,EAAE6gB,QAAQ,GAC5BF,SAAU,SAAApS,GAAC,OACT+R,EACEnW,EAAElL,SAASc,EACXoK,EAAElL,SAASuB,EACX7B,EAAiB4P,EAAEkK,cAAcqI,cAAe,WAM1DtJ,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,oDACAyK,EAAAhiB,EAAAuX,cAACmS,GAAD,KACE1H,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNnqB,MAAO4H,EAAS8L,EAAEnC,SAASjI,GAAG8gB,QAAQ,GACtCF,SAAU,SAAApS,GAAC,OACTgS,EACE9hB,EAAS8P,EAAEkK,cAAcqI,cAAgB,KACzC3W,EAAEnC,SAASxH,EACX2J,EAAEnC,SAAShI,MAIjBwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNnqB,MAAO4H,EAAS8L,EAAEnC,SAASxH,GAAGqgB,QAAQ,GACtCF,SAAU,SAAApS,GAAC,OACTgS,EACEpW,EAAEnC,SAASjI,EACXtB,EAAS8P,EAAEkK,cAAcqI,cAAgB,KACzC3W,EAAEnC,SAAShI,MAIjBwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNnqB,MAAO4H,EAAS8L,EAAEnC,SAAShI,GAAG6gB,QAAQ,GACtCF,SAAU,SAAApS,GAAC,OACTgS,EACEpW,EAAEnC,SAASjI,EACXoK,EAAEnC,SAASxH,EACX/B,EAAS8P,EAAEkK,cAAcqI,cAAgB,WAMnDtJ,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,4CACAyK,EAAAhiB,EAAAuX,cAACmS,GAAD,KACE1H,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,GACNlO,IAAK,GACLpJ,IAAK,GACL7S,MAAO0T,EAAEvH,MAAM7C,EAAE8gB,QAAQ,GACzBF,SAAU,SAAApS,GAAC,OACTiS,EACEjS,EAAEkK,cAAcqI,cAChB3W,EAAEvH,MAAMpC,EACR2J,EAAEvH,MAAM5C,MAIdwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,GACNlO,IAAK,GACLpJ,IAAK,GACL7S,MAAO0T,EAAEvH,MAAMpC,EAAEqgB,QAAQ,GACzBF,SAAU,SAAApS,GAAC,OACTiS,EACErW,EAAEvH,MAAM7C,EACRwO,EAAEkK,cAAcqI,cAChB3W,EAAEvH,MAAM5C,MAIdwX,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,GACNlO,IAAK,GACLpJ,IAAK,GACL7S,MAAO0T,EAAEvH,MAAM5C,EAAE6gB,QAAQ,GACzBF,SAAU,SAAApS,GAAC,OACTiS,EACErW,EAAEvH,MAAM7C,EACRoK,EAAEvH,MAAMpC,EACR+N,EAAEkK,cAAcqI,oBAM1BtJ,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,sBACAyK,EAAAhiB,EAAAuX,cAAC+R,GAAD,CAAa7O,QAASyQ,GACnBvW,EAAEvO,MAAF,GAAA9C,OACMqR,EAAEvO,MAAMjE,KADd,MAAAmB,OACuByF,KAAKwa,KACvB5O,EAAEvO,MAAM9D,KAAKkhB,WAAa,MAF/B,SAIG,SAGRxB,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,4BACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO0T,EAAE/C,gBACTuZ,SAAU,SAAApS,GAAC,OACTkS,EAAwBlS,EAAEkK,cAAchiB,SAGzCpB,OAAO0rB,OAAOtjB,GAAiB8G,IAAI,SAAAqN,GAAC,OACnC4F,EAAAhiB,EAAAuX,cAAA,UAAQvW,IAAKob,GAAIA,MAGpBzH,EAAE/C,kBAAoB3J,EAAgB8I,WACrCiR,EAAAhiB,EAAAuX,cAAAyK,EAAAhiB,EAAAwrB,SAAA,KACExJ,EAAAhiB,EAAAuX,cAACiS,GAAD,CACEiC,YAAY,gBACZxqB,MAAO0T,EAAElC,gBACT0Y,SAAUtoB,KAAK4nB,wBAEjBzI,EAAAhiB,EAAAuX,cAAA,SAAIgT,GAAa,uCA/MWrJ,IAAMgB,qBDX3CoG,+JEXAoD,GFkCgBC,eA6BnB,SAAAA,EAAYxrB,GAAkB,IAAAoM,EAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAA8oB,IAC5Bpf,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAA8rB,GAAAjf,KAAA7J,QA7BF1C,aA4B8B,EAAAoM,EA1B9Bqf,oBAAkD,KA0BpBrf,EAzB9Bsf,WAAqB,EAyBStf,EApB9Buf,WAAa,IAAIpiB,IAoBa6C,EAnB9Bwf,UAAY,IAAIriB,IAmBc6C,EAb9Byf,MAAQ,IAAIC,IAakB1f,EAV9B2f,WAU8B,EAAA3f,EAT9B4f,WAS8B,EAAA5f,EAR9B6f,WAQ8B,EAAA7f,EAP9B8f,YAO8B,EAAA9f,EAN9B+f,YAM8B,EAAA/f,EAL9BggB,YAK8B,EAAAhgB,EAJ9BigB,aAI8B,EAAAjgB,EAH9BkgB,aAG8B,EAAAlgB,EAF9BmgB,aAE8B,EAG5BngB,EAAKpM,QAAUA,EAIf,IAAMwsB,EAAiB,CACrBC,aAAa,EACbC,QAAS,IACT5W,KAAM6W,KAKFC,EAAe,IAAIzb,IAAY,IAAM,IAAM,IAEjD/E,EAAK2f,MAAQ,IAAIxZ,IACfqa,EACA,IAAIhX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GACK8sB,EADL,CAEE3W,MAAO,aAGXzJ,EAAK2f,MAAMziB,SAASpB,IAAI,KAAO,EAAK,GACpCkE,EAAK2f,MAAM1Z,SAASxH,EAAIjC,KAAKC,GAAK,EAClCuD,EAAK2f,MAAMc,SAASC,UAAY3E,GAAoB4E,MAEpD3gB,EAAK4f,MAAQ,IAAIzZ,IACfqa,EACA,IAAIhX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GACK8sB,EADL,CAEE3W,MAAO,UAGXzJ,EAAK4f,MAAM1iB,SAASpB,IAAI,EAAK,KAAO,GACpCkE,EAAK4f,MAAM3Z,SAASjI,EAAIxB,KAAKC,GAAK,EAClCuD,EAAK4f,MAAMa,SAASC,UAAY3E,GAAoB6E,MAEpD5gB,EAAK6f,MAAQ,IAAI1Z,IACfqa,EACA,IAAIhX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GACK8sB,EADL,CAEE3W,MAAO,QAGXzJ,EAAK6f,MAAM3iB,SAASpB,IAAI,EAAK,EAAK,MAClCkE,EAAK6f,MAAMY,SAASC,UAAY3E,GAAoB8E,MAEpD7gB,EAAK0F,IAAI1F,EAAK2f,OACd3f,EAAK0F,IAAI1F,EAAK4f,OACd5f,EAAK0F,IAAI1F,EAAK6f,OAId,IAAMiB,EAAgB,IAAIC,IAAe,IAAM,GAAI,IAEnD/gB,EAAK8f,OAAS,IAAI3Z,IAChB2a,EACA,IAAItX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,aAEpDzJ,EAAK8f,OAAO5iB,SAASpB,IAAI,IAAM,EAAG,GAClCkE,EAAK8f,OAAOW,SAASC,UAAY3E,GAAoB4E,MACrD3gB,EAAK8f,OAAOW,SAASO,SAAU,EAE/BhhB,EAAK+f,OAAS,IAAI5Z,IAChB2a,EACA,IAAItX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,UAEpDzJ,EAAK+f,OAAO7iB,SAASpB,IAAI,EAAG,IAAM,GAClCkE,EAAK+f,OAAOU,SAASC,UAAY3E,GAAoB6E,MACrD5gB,EAAK+f,OAAOU,SAASO,SAAU,EAE/BhhB,EAAKggB,OAAS,IAAI7Z,IAChB2a,EACA,IAAItX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,QAEpDzJ,EAAKggB,OAAO9iB,SAASpB,IAAI,EAAG,EAAG,KAC/BkE,EAAKggB,OAAOS,SAASC,UAAY3E,GAAoB8E,MACrD7gB,EAAKggB,OAAOS,SAASO,SAAU,EAE/BhhB,EAAK0F,IAAI1F,EAAK8f,QACd9f,EAAK0F,IAAI1F,EAAK+f,QACd/f,EAAK0F,IAAI1F,EAAKggB,QAMd,IAAMiB,EAAgB,IAAIC,IAAc,IAAM,KAzFlB,OA2F5BlhB,EAAKigB,QAAU,IAAI9Z,IACjB8a,EACA,IAAIzX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,UAEpDzJ,EAAKigB,QAAQ/iB,SAASpB,IAAI,EAAK,IAAM,KACrCkE,EAAKigB,QAAQha,SAASxH,EAAIjC,KAAKC,GAAK,EACpCuD,EAAKigB,QAAQQ,SAASC,UAAY3E,GAAoBoF,QAEtDnhB,EAAKkgB,QAAU,IAAI/Z,IACjB8a,EACA,IAAIzX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,aAEpDzJ,EAAKkgB,QAAQhjB,SAASpB,IAAI,IAAM,EAAK,KACrCkE,EAAKkgB,QAAQja,SAASjI,EAAIxB,KAAKC,GAAK,EACpCuD,EAAKkgB,QAAQO,SAASC,UAAY3E,GAAoBqF,QAEtDphB,EAAKmgB,QAAU,IAAIha,IACjB8a,EACA,IAAIzX,IAAJlW,OAAAsH,EAAA,EAAAtH,CAAA,GAA2B8sB,EAA3B,CAA2C3W,MAAO,aAEpDzJ,EAAKmgB,QAAQjjB,SAASpB,IAAI,IAAM,IAAM,GACtCkE,EAAKmgB,QAAQM,SAASC,UAAY3E,GAAoBsF,QAEtDrhB,EAAK0F,IAAI1F,EAAKigB,SACdjgB,EAAK0F,IAAI1F,EAAKkgB,SACdlgB,EAAK0F,IAAI1F,EAAKmgB,SApHcngB,uFAuHNgP,GACtB,IAAK1Y,KAAK1C,QAAQuV,aAChB,OAAO,KAGT7S,KAAK4G,SAASgE,KAAK5K,KAAK1C,QAAQuV,aAAajM,UAE7C,IAAM2V,EAAgB7D,EAAU8D,iBAAiBxc,KAAKwR,UAPO7T,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IAQ7D,QAAAnG,EAAAD,EAA2Bye,EAA3BpY,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAA0C,KAA/B8e,EAA+B1e,EAAAK,MAClC0T,EAAI2K,EAAapL,OACvB,GAAIS,EAAEqY,SAASa,eAAe,aAO5B,OAJAhrB,KAAKipB,WACFre,KAAK6R,EAAawO,OAClBC,IAAIlrB,KAAK1C,QAAQuV,aAAajM,UACjC5G,KAAKkpB,UAAUte,KAAK6R,EAAawO,OAC1BnZ,GAjBkD,MAAAlJ,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,GAoB7D,OAAO,qCAOD6a,GACN,IAAM5G,EAAI9R,KAAKmrB,wBAAwBzS,GACvC,SAAI5G,IAAKA,EAAEqY,SAASa,eAAe,gBACjChrB,KAAK+oB,oBAAsBjX,EAAEqY,SAASC,UACtCpqB,KAAKgpB,YAAclX,EAAEqY,SAASO,QAC9B1qB,KAAKorB,OAAO1S,IACL,qCAgBsB,IAAxB2S,EAAwBtuB,EAAxBsuB,IACP,GAAiC,OAA7BrrB,KAAK+oB,qBAAiC/oB,KAAK1C,QAAQuV,aAAvD,CAIA,IAAMnB,EAAI1R,KAAK1C,QAAQuV,aAAajM,SAC9B4M,EAAIxT,KAAKmpB,MACXmC,EAAyB,KAM7B,OAAQtrB,KAAK+oB,qBACX,KAAKtD,GAAoB4E,MACvB7W,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAEvJ,GAC/BmjB,EAAW,IAAIlC,IAAM,IAAIviB,IAAQ,EAAG,EAAG,IAAK6K,EAAE/J,GAC9C,MACF,KAAK8d,GAAoB6E,MACvB9W,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAEhK,GAC/B4jB,EAAW,IAAIlC,IAAM,IAAIviB,IAAQ,EAAG,EAAG,IAAK6K,EAAE/J,GAC9C,MACF,KAAK8d,GAAoB8E,MACvB/W,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAEhK,GAC/B4jB,EAAW,IAAIlC,IAAM,IAAIviB,IAAQ,EAAG,EAAG,IAAK6K,EAAEvJ,GAC9C,MACF,KAAKsd,GAAoBsF,QACvBvX,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAE/J,GAC/B,MACF,KAAK8d,GAAoBoF,QACvBrX,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAEhK,GAC/B,MACF,KAAK+d,GAAoBqF,QACvBtX,EAAEhO,IAAI,IAAIqB,IAAQ,EAAG,EAAG,IAAK6K,EAAEvJ,GASjCmjB,GACAplB,KAAK4Q,IAAIwU,EAASC,gBAAgBF,EAAIG,SACpCtlB,KAAK4Q,IAAItD,EAAE+X,gBAAgBF,EAAIG,UAEjChY,EAAE5I,KAAK0gB,GAGT,IAAML,EAAQI,EAAII,eAAejY,EAAG,IAAI3M,KACxC,GAAKokB,EAAL,CAKA,GAAIjrB,KAAKgpB,UAAW,CAKlB,OAAQhpB,KAAK+oB,qBACX,KAAKtD,GAAoB4E,MACvBrqB,KAAK1C,QAAQuV,aAAatI,MAAM7C,EAAIxB,KAAKmU,IACvCnU,KAAK+K,IACHjR,KAAK1C,QAAQuV,aAAatI,MAAM7C,GAAKujB,EAAMvjB,EAAI1H,KAAKkpB,UAAUxhB,GAC9D,IAEF,IAEF,MACF,KAAK+d,GAAoB6E,MACvBtqB,KAAK1C,QAAQuV,aAAatI,MAAMpC,EAAIjC,KAAKmU,IACvCnU,KAAK+K,IACHjR,KAAK1C,QAAQuV,aAAatI,MAAMpC,GAAK8iB,EAAM9iB,EAAInI,KAAKkpB,UAAU/gB,GAC9D,IAEF,IAEF,MACF,KAAKsd,GAAoB8E,MACvBvqB,KAAK1C,QAAQuV,aAAatI,MAAM5C,EAAIzB,KAAKmU,IACvCnU,KAAK+K,IACHjR,KAAK1C,QAAQuV,aAAatI,MAAM5C,GAAKsjB,EAAMtjB,EAAI3H,KAAKkpB,UAAUvhB,GAC9D,IAEF,IAKN3H,KAAK1C,QAAQkV,OAAOH,QAAQrS,KAAK1C,QAAQuV,aAAatI,WACjD,CAKL,OAJA0gB,EAAMC,IAAIlrB,KAAKipB,YAIPjpB,KAAK+oB,qBACX,KAAKtD,GAAoB4E,MACvBrqB,KAAK1C,QAAQuV,aAAajM,SAASc,EAAIujB,EAAMvjB,EAC7C,MACF,KAAK+d,GAAoB6E,MACvBtqB,KAAK1C,QAAQuV,aAAajM,SAASuB,EAAI8iB,EAAM9iB,EAC7C,MACF,KAAKsd,GAAoB8E,MACvBvqB,KAAK1C,QAAQuV,aAAajM,SAASe,EAAIsjB,EAAMtjB,EAC7C,MACF,QAGE3H,KAAK1C,QAAQuV,aAAajM,SAASgE,KAAKqgB,GAG5CjrB,KAAK1C,QAAQkV,OAAOF,YAAYtS,KAAK1C,QAAQuV,aAAajM,UAG5D5G,KAAKkpB,UAAUte,KAAKqgB,YAxToBhZ,eElCvC4W,8FAML,IAAMhS,GAAO,CACXnP,EAAG,IAAIb,IAAQ,EAAG,EAAG,GACrBsB,EAAG,IAAItB,IAAQ,EAAG,EAAG,GACrBc,EAAG,IAAId,IAAQ,EAAG,EAAG,IAGF6kB,cAmBnB,SAAAA,EAAYpuB,GAAkB,IAAAoM,EAAA1J,KAAAhD,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAA0rB,GAAA1rB,KAlB9BmX,OAA6B,KAkBCnX,KAjB9B1C,aAiB8B,EAAA0C,KAf9BiY,UAAY,EAekBjY,KAd9BkY,kBAAoB,EAcUlY,KAZ9B2rB,cAY8B,EAAA3rB,KAV9BuY,SAAW,IAAIC,IAUexY,KAT9ByY,YAS8B,EAAAzY,KAR9B8S,YAAc,IAAIjD,IAQY7P,KAN9B0Y,UAAY,IAAIC,IAMc3Y,KAJ9B6Y,KAAO,IAAI3B,GAAiBlX,KAAKuY,SAASO,YAIZ9Y,KAH9BwW,SAAW,IAAIR,GAGehW,KAF9B4rB,kBAAmB,EAEW5rB,KAiE9B+Y,OAAS,WACP,GAAKrP,EAAKyN,OAAV,CADmB,IAAA6B,EAKmBtP,EAAKyN,OAAnC8B,EALWD,EAKXC,YAAaC,EALFF,EAKEE,aAErBxP,EAAKpM,QAAQmT,OAAOmD,OAASqF,EAAcC,EAC3CxP,EAAKpM,QAAQmT,OAAOoD,yBAEpBnK,EAAK6O,SAASY,cAAc5F,OAAO6F,kBACnC1P,EAAK6O,SAASc,QAAQJ,EAAaC,KA5EPlZ,KA+E9BsZ,QAAgC,SAAAC,GAC9B7P,EAAKuO,UAAY1E,OAAOiG,sBAAsB9P,EAAK4P,SAEnD,IAAMG,GAAMF,EAAI7P,EAAKwO,mBAAqB,IAC1CxO,EAAKwO,kBAAoBqB,EACzB7P,EAAKR,OAAOuQ,GAEZ/P,EAAK6O,SAAS9S,QACdiE,EAAK6O,SAASmB,OAAOhQ,EAAKpM,QAAQsV,WAAYlJ,EAAKpM,QAAQmT,QAEvD/G,EAAKpM,QAAQuV,eAGfnJ,EAAKiiB,SAAS/kB,SAASgE,KAAKlB,EAAKpM,QAAQuV,aAAajM,UACtD8C,EAAK6O,SAASsT,aACdniB,EAAK6O,SAASmB,OAAOhQ,EAAKiiB,SAAUjiB,EAAKpM,QAAQmT,UA9FvBzQ,KAuL9B8rB,YAAc,SAAC5V,GACTA,EAAE2B,SAAWgR,GAAYkD,YAC3BriB,EAAKkiB,kBAAmB,EACxBliB,EAAK+O,OAAOuT,sBAGV9V,EAAE2B,SAAWgR,GAAYoD,UAI7BviB,EAAKwiB,gBAAgBhW,GACjBxM,EAAKiiB,SAAS/T,QAAQlO,EAAKgP,WAC7BhP,EAAK+O,OAAO0T,MAAMvqB,OAAS,WAE3B8H,EAAK0iB,gBAAgB1iB,EAAKgP,aArMA1Y,KAyM9BqsB,UAAY,SAACnW,GACPA,EAAE2B,SAAWgR,GAAYkD,WAAariB,EAAKkiB,mBAC7CliB,EAAKkiB,kBAAmB,EACxBnX,SAAS6X,mBAGTpW,EAAE2B,SAAWgR,GAAYoD,SACa,OAAtCviB,EAAKiiB,SAAS5C,sBAEdrf,EAAKiiB,SAAS5C,oBAAsB,KAChCrf,EAAKiiB,SAASR,wBAAwBzhB,EAAKgP,WAC7ChP,EAAK+O,OAAO0T,MAAMvqB,OAAS,OAE3B8H,EAAK+O,OAAO0T,MAAMvqB,OAAS,OAtNH5B,KA2N9BusB,YAAc,SAACrW,GACTxM,EAAKkiB,kBACH1V,EAAEsW,WACJ9iB,EAAKpM,QAAQmT,OAAOwK,kBAAkBpE,GAAK1O,GAAI+N,EAAEsW,UAAY,KAE3DtW,EAAEuW,WACJ/iB,EAAKpM,QAAQmT,OAAOic,aAAa7V,GAAKnP,GAAIwO,EAAEuW,UAAY,OAG1D/iB,EAAKwiB,gBAAgBhW,GACqB,OAAtCxM,EAAKiiB,SAAS5C,oBAChBrf,EAAKiiB,SAASP,OAAO1hB,EAAKgP,WACjBhP,EAAKiiB,SAASR,wBAAwBzhB,EAAKgP,WACpDhP,EAAK+O,OAAO0T,MAAMvqB,OAAS,OAE3B8H,EAAK+O,OAAO0T,MAAMvqB,OAAS,OA1OH5B,KA+O9B2sB,QAAU,SAACzW,GACTA,EAAEuB,iBAEF,IAAImV,EAAQ1W,EAAE2W,OACM,IAAhB3W,EAAE4W,YAEJF,GAAS,IAEXljB,EAAKpM,QAAQmT,OAAOsc,WAAWH,EAAQ,KAtPvC5sB,KAAK1C,QAAUA,EAEf0C,KAAKuY,SAASyU,WAAY,EAC1BhtB,KAAKuY,SAAS0U,cAAc,IAAIC,IAAM,UACtCltB,KAAKyY,OAASzY,KAAKuY,SAASO,WAC5B9Y,KAAKyY,OAAOmB,UAAY,EACxB5Z,KAAKyY,OAAOnC,iBAAiB,YAAatW,KAAK8rB,aAC/C9rB,KAAKyY,OAAOnC,iBAAiB,UAAWtW,KAAKqsB,WAC7CrsB,KAAKyY,OAAOnC,iBAAiB,YAAatW,KAAKusB,aAC/CvsB,KAAKyY,OAAOnC,iBAAiB,QAAStW,KAAK2sB,SAC3C3sB,KAAKyY,OAAOnC,iBACV,cACA,SAAAJ,GAGE,OAFAA,EAAEuB,iBACFvB,EAAEiX,mBACK,IAET,GAKFntB,KAAK2rB,SAAW,IAAI7C,GAAexrB,sDAM9B6Z,GACLnX,KAAK6Y,KAAKgB,SACV7Z,KAAKwW,SAASqD,SAEd7Z,KAAKmX,OAASA,EACdA,EAAO2C,YAAY9Z,KAAKyY,QAExBzY,KAAK+Y,SACLxF,OAAOiG,sBAAsBxZ,KAAKsZ,SAClC/F,OAAO+C,iBAAiB,SAAUtW,KAAK+Y,yCAIvCxF,OAAOwG,qBAAqB/Z,KAAKiY,WACjC1E,OAAOgD,oBAAoB,SAAUvW,KAAK+Y,QAEtC/Y,KAAKmX,SACPnX,KAAKmX,OAAO6C,YAAYha,KAAKyY,QAC7BzY,KAAKmX,OAAS,MAGhBnX,KAAK6Y,KAAK9Y,OACVC,KAAKwW,SAASzW,uCAIdC,KAAKyY,OAAOwB,8CAGA3c,GACZ0C,KAAK1C,QAAUA,EACf0C,KAAK2rB,SAASruB,QAAUA,EAExB0C,KAAK+Y,wCAoCAU,GAAkB,IACfhJ,EAAWzQ,KAAK1C,QAAhBmT,OAEJzQ,KAAK6Y,KAAK8B,UAAU,MACtBlK,EAAOyK,gBAAgBrE,GAAKlP,GAAI,EAAI8R,GAElCzZ,KAAK6Y,KAAK8B,UAAU,MACtBlK,EAAOyK,gBAAgBrE,GAAKlP,EAAG,EAAI8R,GAEjCzZ,KAAK6Y,KAAK8B,UAAU,MACtBlK,EAAOyK,gBAAgBrE,GAAKnP,GAAI,EAAI+R,GAElCzZ,KAAK6Y,KAAK8B,UAAU,MACtBlK,EAAOyK,gBAAgBrE,GAAKnP,EAAG,EAAI+R,GAEjCzZ,KAAK6Y,KAAK8B,UAAU,OACtBlK,EAAO7J,SAASuB,GAAK,EAAIsR,GAEvBzZ,KAAK6Y,KAAK8B,UAAU,WACtBlK,EAAO7J,SAASuB,GAAK,EAAIsR,GAGvBzZ,KAAK6Y,KAAK8B,UAAU,cACtBlK,EAAOwK,kBAAkBpE,GAAK1O,EAAGsR,GAE/BzZ,KAAK6Y,KAAK8B,UAAU,eACtBlK,EAAOwK,kBAAkBpE,GAAK1O,GAAIsR,GAEhCzZ,KAAK6Y,KAAK8B,UAAU,YACtBlK,EAAOic,aAAa7V,GAAKnP,EAAG+R,GAE1BzZ,KAAK6Y,KAAK8B,UAAU,cACtBlK,EAAOic,aAAa7V,GAAKnP,GAAI+R,GAG/B,IAAMsB,EACD/a,KAAKwW,SAASwE,QAAQ,GADrBD,EAED/a,KAAKwW,SAASwE,QAAQ,GAFrBD,EAGA/a,KAAKwW,SAASwE,QAAQ,GAHtBD,EAIA/a,KAAKwW,SAASwE,QAAQ,GAJtBD,EAKD/a,KAAKwW,SAASwE,QAAQ,GAGvBD,GACFtK,EAAOyK,gBAAgBrE,GAAKnP,EAAG,EAAI+R,EAAKsB,GAEtCA,GACFtK,EAAOyK,gBAAgBrE,GAAKlP,EAAG,EAAI8R,EAAKsB,GAEtCA,GACFtK,EAAOyK,gBAAgBrE,GAAK1O,EAAG,EAAIsR,EAAKsB,GAEtCA,GACFtK,EAAOwK,kBAAkBpE,GAAK1O,GAAIsR,EAAKsB,GAErCA,GACFtK,EAAOic,aAAa7V,GAAKnP,GAAI+R,EAAKsB,2CAItBrC,GACd,IAAM6D,EAAgB7D,EAAU8D,iBAC9Bxc,KAAK1C,QAAQsV,WAAWpB,UAFmB7T,GAAA,EAAAC,GAAA,EAAAC,OAAAqG,EAAA,IAI7C,QAAAnG,EAAAD,EAA2Bye,EAA3BpY,OAAAC,cAAAzG,GAAAI,EAAAD,EAAAU,QAAAU,MAAAvB,GAAA,EAA0C,KAClCmU,EADkC/T,EAAAK,MACjBiT,OACvB,GAAIS,aAAalD,GAEf,OADA5O,KAAK1C,QAAQwW,aAAahC,IACnB,GARkC,MAAAlJ,GAAAhL,GAAA,EAAAC,EAAA+K,EAAA,YAAAjL,GAAA,MAAAG,EAAA6B,QAAA7B,EAAA6B,SAAA,WAAA/B,EAAA,MAAAC,GAa7C,OADAmC,KAAK1C,QAAQwW,aAAa,OACnB,0CAGOoC,GACd,IAAMkX,EAAOptB,KAAKuY,SAASmD,QAAQ,IAAI2R,KAEjC3lB,GAAMwO,EAAEoX,MAAQttB,KAAKmX,OAAQoW,YAAcH,EAAK1lB,EAAK,EAAI,EACzDS,IAAO+N,EAAEsX,MAAQxtB,KAAKmX,OAAQsW,WAAaL,EAAKjlB,EAAK,EAAI,EAE/DnI,KAAK0Y,UAAU4D,cAAc,CAAE5U,IAAGS,KAAKnI,KAAK1C,QAAQmT,0BCrNlDtD,GAAYnQ,OAAO6b,KAAKnM,iBAAeO,MAAMygB,4BAU9BC,iMAEjBC,GAC6C,IAAAlkB,EAAA1J,KAC7C,OAAO,SAAAkW,GAAK,IAAA8N,EAC0Bta,EAAK8T,MAAjC/J,EADEuQ,EACFvQ,MACRoa,EAFU7J,EACI6J,mBACI7wB,OAAAsH,EAAA,EAAAtH,CAAA,GACbyW,EAAKtG,UADOnQ,OAAA8wB,GAAA,EAAA9wB,CAAA,GAEd4wB,EAAe1X,EAAEkK,cAAchiB,2CAKZ,IAAA2vB,EAC8B/tB,KAAKwd,MAA7CtJ,EADU6Z,EAChBta,KAASuU,EADO+F,EACP/F,aAAcgG,EADPD,EACOC,mBAEzBC,EAAkB9gB,GAAUjB,IAAI,SAAAgiB,GAAE,OAAI/O,EAAAhiB,EAAAuX,cAAA,UAAQvW,IAAK+vB,GAAKA,KAE9D,OACE/O,EAAAhiB,EAAAuX,cAAA,WACEyK,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,0BACAyK,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,OACLnB,MAAO8V,EAAE5U,KACTgpB,SAAU,SAAApS,GAAC,OAAI8R,EAAa9R,EAAEkK,cAAchiB,WAGhD+gB,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,kDACAyK,EAAAhiB,EAAAuX,cAACmS,GAAD,KACE1H,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNlO,IAAK,EACLpJ,IAAK,GACL7S,MAAO8V,EAAElH,WAAWiD,MACpBqY,SAAU,SAAApS,GAAC,OACT8X,EAAmBhxB,OAAAsH,EAAA,EAAAtH,CAAA,GACdkX,EAAElH,WADW,CAEhBiD,MAAO/J,KAAKM,MAAM0P,EAAEkK,cAAcqI,qBAIxCtJ,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNlO,IAAK,EACLpJ,IAAK,GACL7S,MAAO8V,EAAElH,WAAWkD,MACpBoY,SAAU,SAAApS,GAAC,OACT8X,EAAmBhxB,OAAAsH,EAAA,EAAAtH,CAAA,GACdkX,EAAElH,WADW,CAEhBkD,MAAOhK,KAAKM,MAAM0P,EAAEkK,cAAcqI,qBAIxCtJ,EAAAhiB,EAAAuX,cAAC0R,GAAD,CACE7mB,KAAK,SACLgpB,KAAM,EACNlO,IAAK,EACLpJ,IAAK,GACL7S,MAAO8V,EAAElH,WAAWmD,OACpBmY,SAAU,SAAApS,GAAC,OACT8X,EAAmBhxB,OAAAsH,EAAA,EAAAtH,CAAA,GACdkX,EAAElH,WADW,CAEhBmD,OAAQjK,KAAKM,MAAM0P,EAAEkK,cAAcqI,uBAM7CtJ,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,mCACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAUghB,KACnB7F,SAAUtoB,KAAKouB,sBAAsB,SAEpCH,IAGL9O,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,oCACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAUkhB,MACnB/F,SAAUtoB,KAAKouB,sBAAsB,UAEpCH,IAGL9O,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,oCACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAUmhB,MACnBhG,SAAUtoB,KAAKouB,sBAAsB,UAEpCH,IAGL9O,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,mCACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAUohB,KACnBjG,SAAUtoB,KAAKouB,sBAAsB,SAEpCH,IAGL9O,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,+BACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAUqhB,KACnBlG,SAAUtoB,KAAKouB,sBAAsB,SAEpCH,IAGL9O,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,iCACAyK,EAAAhiB,EAAAuX,cAAC4R,GAAD,CACEloB,MAAO8V,EAAE/G,UAAU7B,GACnBgd,SAAUtoB,KAAKouB,sBAAsB,OAEpCH,YA3H2B5P,IAAMgB,WCHzBoP,oLACO,IAAA/kB,EAAA1J,KAChB1C,EAAY0C,KAAKwd,MAAjBlgB,QACR,OACE6hB,EAAAhiB,EAAAuX,cAAC+L,GAAD,CAAOH,MAAM,eAAeD,UAAWrgB,KAAKwd,MAAM6C,WAChDlB,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,kBADF,IACgBpX,EAAQgC,MAExB6f,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,yBADF,IACuBpX,EAAQ0W,QAAQ0a,kBAEvCvP,EAAAhiB,EAAAuX,cAAA,SACEyK,EAAAhiB,EAAAuX,cAAA,mBADF,IACiBpX,EAAQmV,MAAMhK,QAE/B0W,EAAAhiB,EAAAuX,cAACoL,GAAD,KACEX,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS,kBAAMlO,EAAK8T,MAAMoD,SAAStjB,KAA3C,UACA6hB,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS,kBAAMlO,EAAK8T,MAAMqD,SAASvjB,KAA3C,UACA6hB,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAKwd,MAAMsD,UAA5B,iBAjBoCzC,IAAMgB,4vBCHpD,ICoBKsP,GDpBCC,GAAiB/R,KAAOC,IAAV+R,MASdC,GAAQjS,KAAOiB,MAAViR,MAILC,GAAYnS,KAAOoS,MAAVC,MAITC,GAAWtS,KAAOuS,GAAVC,MAQRC,GAAazS,KAAO0S,GAAVC,MAIVC,GAAa5S,KAAO6S,GAAVC,MAeKC,8MACnBnR,MAAe,CAAE/c,SAAU,GAAImuB,gBAAiB,QAEhDhO,QAAU,WACRnY,EAAKsV,SAAS,CAAE6Q,gBAAiB,OACjCnmB,EAAK8T,MAAM6C,eAWbyP,gBAAkB,WAChBpmB,EAAKsV,SAAS,CAAE6Q,gBAAiB,UAGnCvuB,cAAgB,SAAAvE,GAAyB,IAAtBsC,EAAsBtC,EAAtBsC,GACZA,IAGLiC,EAAcjC,GACdqK,EAAKsV,SAAS,SAAA3e,GAAA,MAAmB,CAC/BqB,SADYrB,EAAGqB,SACI+P,OAAO,SAAA+B,GAAC,OAAIA,EAAEnU,KAAOA,IACxCwwB,gBAAiB,YAIrBE,cAAgB,SAACtwB,GACf,IAAMnC,GAAU,IAAIiV,IAAUR,SAAStS,EAAMA,EAAKJ,IAClDe,EAAU9C,iFAzBEmC,GACRO,KAAKwd,MAAMwS,gBACbhwB,KAAKwd,MAAMwS,gBAAgBvwB,GAE3BO,KAAKgf,SAAS,CAAE6Q,gBAAiBpwB,8KAyBZ6C,WAAjBZ,SACN1B,KAAKgf,SAAS,CAAEtd,SAAUA,EAASuuB,+IAGX,IAAAre,EAAA5R,KAAAsiB,EACctiB,KAAKye,MAAnC/c,EADgB4gB,EAChB5gB,SAAUmuB,EADMvN,EACNuN,gBAElB,OAAIA,EAEA1Q,EAAAhiB,EAAAuX,cAACwb,GAAD,CACE5yB,QAASuyB,EACTjP,SAAU5gB,KAAKsB,cACfuf,SAAU7gB,KAAK+vB,cACfjP,SAAU9gB,KAAK8vB,gBACfzP,UAAWrgB,KAAK6hB,UAMpB1C,EAAAhiB,EAAAuX,cAAC+L,GAAD,CACEH,MAAOtgB,KAAKwd,MAAMwS,gBAAkB,eAAiB,kBACrD3P,UAAWrgB,KAAK6hB,SAEfngB,EAAS+G,OAAS,GACjB0W,EAAAhiB,EAAAuX,cAACka,GAAD,KACEzP,EAAAhiB,EAAAuX,cAACoa,GAAD,KACE3P,EAAAhiB,EAAAuX,cAACsa,GAAD,KACE7P,EAAAhiB,EAAAuX,cAAA,UACEyK,EAAAhiB,EAAAuX,cAAC4a,GAAD,WACAnQ,EAAAhiB,EAAAuX,cAAC4a,GAAD,aACAnQ,EAAAhiB,EAAAuX,cAAC4a,GAAD,cACAnQ,EAAAhiB,EAAAuX,cAAC4a,GAAD,sBAGJnQ,EAAAhiB,EAAAuX,cAAA,aACGhT,EAASwK,IAAI,SAAAsH,GAAC,OACb2L,EAAAhiB,EAAAuX,cAACya,GAAD,CAAUhxB,IAAKqV,EAAEnU,GAAIuY,QAAS,kBAAMhG,EAAKue,cAAc3c,KACrD2L,EAAAhiB,EAAAuX,cAAC+a,GAAD,KAAajc,EAAEnU,IACf8f,EAAAhiB,EAAAuX,cAAC+a,GAAD,KAAajc,EAAElU,MACf6f,EAAAhiB,EAAAuX,cAAC+a,GAAD,KAAajc,EAAEf,MAAMhK,QACrB0W,EAAAhiB,EAAAuX,cAAC+a,GAAD,KAAajc,EAAEQ,QAAQ0a,yBAOjChtB,EAAS+G,QAAU0W,EAAAhiB,EAAAuX,cAAA,kDACrByK,EAAAhiB,EAAAuX,cAACoL,GAAD,KACEX,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAKwd,MAAMgH,cAA5B,eACArF,EAAAhiB,EAAAuX,cAACsL,GAAD,CAAQpI,QAAS5X,KAAK6hB,SAAtB,mBAxFuCxD,IAAMgB,qBCxBlDsP,iLAgBgByB,eAmBnB,SAAAA,EAAY5S,GAAW,IAAA9T,EAAA,OAAA1M,OAAA2J,EAAA,EAAA3J,CAAAgD,KAAAowB,IACrB1mB,EAAA1M,OAAA2M,EAAA,EAAA3M,CAAAgD,KAAAhD,OAAA4M,EAAA,EAAA5M,CAAAozB,GAAAvmB,KAAA7J,KAAMwd,KAnBRlgB,QAAmB,IAAIiV,GAkBA7I,EAjBvB2mB,cAAgB,IAAI3E,GAAahiB,EAAKpM,SAiBfoM,EAfvB+U,MAAe,CACbjS,oBAAqB9C,EAAKpM,QAAQqV,0BAClCF,MAAO/I,EAAKpM,QAAQmV,MAAMvG,IAAI,SAAAgI,GAAC,MAAK,CAClC7U,GAAI6U,EAAE7U,GACNC,KAAM4U,EAAE5U,KACR0N,WAAYkH,EAAElH,WACdG,UAAW+G,EAAE/G,aAEfmjB,eAAgB,EAChBC,eAAgB,KAChBC,MAAO,KACPC,WAAW,GAIU/mB,EAFvBgnB,QAAUrS,IAAMC,YAEO5U,EAYvBinB,WAAa,WACXjnB,EAAKpM,QAAQmQ,QACb/D,EAAKpM,QAAU,IAAIiV,GAAQ,CACzBH,SAAU1I,EAAKknB,eACfte,YAAa5I,EAAKmnB,kBAClBxe,QAAS3I,EAAKonB,gBAEhBpnB,EAAK2mB,cAAcU,cAAcrnB,EAAKpM,SACtCoM,EAAKsV,SAAS,CACZxS,oBAAqB9C,EAAKpM,QAAQqV,0BAClCF,MAAO/I,EAAKpM,QAAQmV,MAAMvG,IAAI,SAAAgI,GAAC,MAAK,CAClC7U,GAAI6U,EAAE7U,GACNC,KAAM4U,EAAE5U,KACR0N,WAAYkH,EAAElH,WACdG,UAAW+G,EAAE/G,aAEfmjB,eAAgB,EAChBC,eAAgB,KAChBC,MAAO,QA9BY9mB,EAkCvBsnB,qBAlCuBh0B,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAkCA,SAAAC,IAAA,OAAAH,EAAAC,EAAAkB,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACrBkL,EAAKsV,SAAS,CACZwR,MAAO7B,GAAUsC,mBAFE,wBAAA3yB,EAAAyB,SAAA1C,EAAA2C,SAlCA0J,EAwCvBvI,YAxCuBnE,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAwCT,SAAAkD,IAAA,IAAAhB,EAAA,OAAApC,EAAAC,EAAAkB,KAAA,SAAAkC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,UACW,MAAnBkL,EAAKpM,QAAQ+B,GADL,CAAAkB,EAAA/B,KAAA,WAEJc,EAAO4xB,OAAO,gBAAiBxnB,EAAKpM,QAAQgC,MAFxC,CAAAiB,EAAA/B,KAAA,eAAA+B,EAAAV,OAAA,iBAMV6J,EAAKpM,QAAQgC,KAAOA,EANV,cAAAiB,EAAA/B,KAAA,EAQNkL,EAAKpM,QAAQ6zB,OARP,wBAAA5wB,EAAAR,SAAAO,EAAAN,SAxCS0J,EAmDvB0nB,cAnDuBp0B,OAAAC,EAAA,EAAAD,CAAAE,EAAAC,EAAAC,KAmDP,SAAAoE,IAAA,OAAAtE,EAAAC,EAAAkB,KAAA,SAAAwD,GAAA,cAAAA,EAAAtD,KAAAsD,EAAArD,MAAA,cACdkL,EAAKpM,QAAQmQ,QADC5L,EAAArD,KAAA,EAEOuX,KAFP,OAEdrM,EAAKpM,QAFSuE,EAAA5C,KAGdyK,EAAKpM,QAAQkV,OAAS,CACpBJ,SAAU1I,EAAKknB,eACfte,YAAa5I,EAAKmnB,kBAClBxe,QAAS3I,EAAKonB,eAEhBpnB,EAAK2mB,cAAcU,cAAcrnB,EAAKpM,SACtCoM,EAAKsV,SAAS,CACZxS,oBAAqB9C,EAAKpM,QAAQqV,0BAClCF,MAAO/I,EAAKpM,QAAQmV,MAAMvG,IAAI,SAAAgI,GAAC,MAAK,CAClC7U,GAAI6U,EAAE7U,GACNC,KAAM4U,EAAE5U,KACR0N,WAAYkH,EAAElH,WACdG,UAAW+G,EAAE/G,aAEfmjB,eAAgB,EAChBC,eAAgB,OAlBJ,wBAAA1uB,EAAA9B,SAAAyB,EAAAxB,SAnDO0J,EAyEvBqmB,cAAgB,WACd3vB,EAAUsJ,EAAKpM,UA1EMoM,EA6EvBsJ,UAAY,WACVtJ,EAAKpM,QAAQsV,WAAWI,aA9EHtJ,EAiFvB2nB,aAAe,WACT3nB,EAAKpM,QAAQuV,eACfnJ,EAAKpM,QAAQsV,WAAWxB,OAAO1H,EAAKpM,QAAQuV,cAC5CnJ,EAAKpM,QAAQuV,aAAatP,MAAMxD,OAChC2J,EAAKpM,QAAQuV,aAAe,KAC5BnJ,EAAKsV,SAAS,CAAEuR,eAAgB,SAtFb7mB,EA0FvB4nB,QAAU,WACR,IAAM7d,EAAO/J,EAAKpM,QAAQg0B,UAC1B5nB,EAAKsV,SAAS,SAAAuS,GAAC,MAAK,CAClB9e,MAAK,GAAAhS,OAAAzD,OAAAgV,EAAA,EAAAhV,CACAu0B,EAAE9e,OADF,CAEH,CACEpT,GAAIoU,EAAKpU,GACTC,KAAMmU,EAAKnU,KACX0N,WAAYyG,EAAKzG,WACjBG,UAAWsG,EAAKtG,aAGpBmjB,eAAgBiB,EAAE9e,MAAMhK,WAtGLiB,EA0GvB8nB,WAAa,WAEP9nB,EAAK+U,MAAM6R,eAAiB,IAC9B5mB,EAAKpM,QAAQmV,MAAMgf,OAAO/nB,EAAK+U,MAAM6R,eAAgB,GACrD5mB,EAAKsV,SAAS,SAAAuS,GAAC,MAAK,CAClB9e,MAAK,GAAAhS,OAAAzD,OAAAgV,EAAA,EAAAhV,CACAu0B,EAAE9e,MAAMnD,MAAM,EAAGiiB,EAAEjB,iBADnBtzB,OAAAgV,EAAA,EAAAhV,CAEAu0B,EAAE9e,MAAMnD,MAAMiiB,EAAEjB,eAAiB,KAEtCA,eAAgB,OAnHC5mB,EAwHvBgoB,iBAAmB,WACjBhoB,EAAKsV,SAAS,CAAEwR,MAAO7B,GAAUtpB,gBAzHZqE,EA4HvBioB,mBAAqB,WACnBjoB,EAAKsV,SAAS,CAAEwR,MAAO7B,GAAUiD,kBA7HZloB,EAgIvBiK,0BAA4B,SAACnH,GAC3B9C,EAAKpM,QAAQqW,0BAA0BnH,GACvC9C,EAAKsV,SAAS,CAAExS,yBAlIK9C,EAqIvBmoB,WAAa,WACXnoB,EAAK2mB,cAAc1R,SACnBjV,EAAKsV,SAAS,CAAEyR,WAAW,KAvIN/mB,EAiJvBooB,eAAiB,SAACxyB,GAChBoK,EAAKpM,QAAQsV,WAAWtT,KAAOA,EAC/BoK,EAAKsV,SAAS,SAAAzc,GAAA,IAAGkQ,EAAHlQ,EAAGkQ,MAAO6d,EAAV/tB,EAAU+tB,eAAV,MAAgC,CAC5C7d,MAAK,GAAAhS,OAAAzD,OAAAgV,EAAA,EAAAhV,CACAyV,EAAMnD,MAAM,EAAGghB,IADf,CAAAtzB,OAAAsH,EAAA,EAAAtH,CAAA,GAGEyV,EAAM6d,GAHR,CAIDhxB,UAJCtC,OAAAgV,EAAA,EAAAhV,CAMAyV,EAAMnD,MAAMghB,EAAiB,SA1Jf5mB,EA+JvBqoB,qBAAuB,SAAC/kB,GACtBtD,EAAKpM,QAAQsV,WAAW5F,WAAaA,EACrCtD,EAAKsV,SAAS,SAAApc,GAAA,IAAG6P,EAAH7P,EAAG6P,MAAO6d,EAAV1tB,EAAU0tB,eAAV,MAAgC,CAC5C7d,MAAK,GAAAhS,OAAAzD,OAAAgV,EAAA,EAAAhV,CACAyV,EAAMnD,MAAM,EAAGghB,IADf,CAAAtzB,OAAAsH,EAAA,EAAAtH,CAAA,GAGEyV,EAAM6d,GAHR,CAIDtjB,gBAJChQ,OAAAgV,EAAA,EAAAhV,CAMAyV,EAAMnD,MAAMghB,EAAiB,SAxKf5mB,EA6KvBsoB,oBAAsB,SAAC7kB,GACrBzD,EAAKpM,QAAQsV,WAAWzF,UAAYA,EACpCzD,EAAKsV,SAAS,SAAA3b,GAAA,IAAGoP,EAAHpP,EAAGoP,MAAO6d,EAAVjtB,EAAUitB,eAAV,MAAgC,CAC5C7d,MAAK,GAAAhS,OAAAzD,OAAAgV,EAAA,EAAAhV,CACAyV,EAAMnD,MAAM,EAAGghB,IADf,CAAAtzB,OAAAsH,EAAA,EAAAtH,CAAA,GAGEyV,EAAM6d,GAHR,CAIDnjB,eAJCnQ,OAAAgV,EAAA,EAAAhV,CAMAyV,EAAMnD,MAAMghB,EAAiB,SAtLf5mB,EA6LvBuoB,WAAa,SAAC3yB,GACRoK,EAAKpM,QAAQuV,eACfnJ,EAAKpM,QAAQuV,aAAavT,KAAOA,GAEnCoK,EAAKsV,SAAS,SAAArb,GAAA,IAAG4sB,EAAH5sB,EAAG4sB,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5BjxB,aApMiBoK,EAyMvBwoB,YAAc,SAACxqB,EAAWS,EAAWR,GAC/B+B,EAAKpM,QAAQuV,cACfnJ,EAAKpM,QAAQuV,aAAatI,MAAM/E,IAAIkC,EAAGS,EAAGR,GAE5C+B,EAAKsV,SAAS,SAAAmT,GAAA,IAAG5B,EAAH4B,EAAG5B,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5BhmB,MAAO,IAAI1D,IAAQa,EAAGS,EAAGR,SAhNR+B,EAqNvB0oB,eAAiB,SAAC1qB,EAAWS,EAAWR,GAClC+B,EAAKpM,QAAQuV,cACfnJ,EAAKpM,QAAQuV,aAAajM,SAASpB,IAAIkC,EAAGS,EAAGR,GAE/C+B,EAAKsV,SAAS,SAAAjb,GAAA,IAAGwsB,EAAHxsB,EAAGwsB,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5B3pB,SAAU,IAAIC,IAAQa,EAAGS,EAAGR,SA5NX+B,EAiOvB2oB,eAAiB,SAAC3qB,EAAWS,EAAWR,GAClC+B,EAAKpM,QAAQuV,cACfnJ,EAAKpM,QAAQuV,aAAalD,SAASnK,IAAIkC,EAAGS,EAAGR,GAE/C+B,EAAKsV,SAAS,SAAAlb,GAAA,IAAGysB,EAAHzsB,EAAGysB,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5B5gB,SAAU,IAAI2iB,IAAM5qB,EAAGS,EAAGR,SAxOT+B,EA6OvB6oB,sBAAwB,SAACxjB,GACnBrF,EAAKpM,QAAQuV,eACfnJ,EAAKpM,QAAQuV,aAAa9D,gBAAkBA,GAE9CrF,EAAKsV,SAAS,SAAAta,GAAA,IAAG6rB,EAAH7rB,EAAG6rB,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5BxhB,wBApPiBrF,EAyPvBke,sBAAwB,SAAChY,GACnBlG,EAAKpM,QAAQuV,eACXnJ,EAAKpM,QAAQuV,aAAa3D,UAC5BxF,EAAKpM,QAAQuV,aAAa3D,UAAUhG,OAAO0G,GAE3ClG,EAAKpM,QAAQuV,aAAa3D,UAAY,IAAIhB,GAAU0B,IAGxDlG,EAAKsV,SAAS,SAAAwT,GAAA,IAAGjC,EAAHiC,EAAGjC,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5B3gB,wBApQiBlG,EAyQvB+oB,mBAAqB,WACnB/oB,EAAKsV,SAAS,CACZwR,MAAO7B,GAAU+D,kBA3QEhpB,EAiRvBipB,aAAe,WACbjpB,EAAKsV,SAAS,CAAEwR,MAAO,QAlRF9mB,EAqRvBkpB,YAAc,SAACrvB,GACTmG,EAAKpM,QAAQuV,eACfnJ,EAAKpM,QAAQuV,aAAalQ,UAAUY,EAAMlE,IAC1CqK,EAAKsV,SAAS,SAAA6T,GAAA,IAAGtC,EAAHsC,EAAGtC,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5BhtB,UAEFitB,MAAO,UA7RU9mB,EAkSvBopB,YAAc,SAACrzB,GACbiK,EAAKpM,QAAQmQ,QACb/D,EAAKpM,SAAU,IAAIiV,IAAUR,SAAStS,EAAMA,EAAKJ,IACjDqK,EAAKpM,QAAQkV,OAAS,CACpBJ,SAAU1I,EAAKknB,eACfte,YAAa5I,EAAKmnB,kBAClBxe,QAAS3I,EAAKonB,eAEhBpnB,EAAK2mB,cAAcU,cAAcrnB,EAAKpM,SACtCoM,EAAKsV,SAAS,CACZxS,oBAAqB9C,EAAKpM,QAAQqV,0BAClCF,MAAO/I,EAAKpM,QAAQmV,MAAMvG,IAAI,SAAAgI,GAAC,MAAK,CAClC7U,GAAI6U,EAAE7U,GACNC,KAAM4U,EAAE5U,KACR0N,WAAYkH,EAAElH,WACdG,UAAW+G,EAAE/G,aAEfmjB,eAAgB,EAChBC,eAAgB,KAChBC,MAAO,QArTY9mB,EA2TvBknB,eAAiB,SAAC9e,GACZA,EACFpI,EAAKsV,SAAS,CACZuR,eAAgB,CACdlxB,GAAIyS,EAAEzS,GACNC,KAAMwS,EAAExS,KACRsH,SAAUkL,EAAElL,SACZ2D,MAAOuH,EAAEvH,MACToF,SAAUmC,EAAEnC,SACZZ,gBAAiB+C,EAAE/C,gBACnBa,gBAAiBkC,EAAE5C,WAAa4C,EAAE5C,UAAUvG,OAC5CpF,MAAOuO,EAAEhD,WAAF9R,OAAAsH,EAAA,EAAAtH,CAAA,GACF8U,EAAEhD,UADA,CAELzP,GAAIyS,EAAE/O,aAKZ2G,EAAKsV,SAAS,CAAEuR,eAAgB,QA7Ub7mB,EAiVvBmnB,kBAAoB,SAACrd,GACnB9J,EAAKsV,SAAS,SAAA+T,GAAA,IAAGxC,EAAHwC,EAAGxC,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5B3pB,SAAU4M,QArVO9J,EA0VvBonB,cAAgB,SAACS,GACf7nB,EAAKsV,SAAS,SAAAgU,GAAA,IAAGzC,EAAHyC,EAAGzC,eAAH,MAAyB,CACrCA,eAAgBA,GAAcvzB,OAAAsH,EAAA,EAAAtH,CAAA,GACzBuzB,EADyB,CAE5BnD,KAAM,CACJnd,MAAOshB,EAAE7pB,EACTyI,OAAQohB,EAAEppB,EACV+H,MAAOqhB,EAAE5pB,SAjWM+B,EAyWvBupB,YAAc,WACZvpB,EAAKsV,SAAS,CACZyR,WAAW,EACXjkB,oBAAqB9C,EAAKpM,QAAQqV,6BA5WfjJ,EAkXvBwpB,aAAe,SAAC/b,GACA,MAAVA,GACFzN,EAAK2mB,cAAcnR,OAAO/H,GAC1BzN,EAAK2mB,cAAcpW,SAEnBvQ,EAAK2mB,cAAc1R,UApXrBjV,EAAKpM,QAAQkV,OAAS,CACpBJ,SAAU1I,EAAKknB,eACfte,YAAa5I,EAAKmnB,kBAClBxe,QAAS3I,EAAKonB,eANKpnB,0EA4IZrK,GACTW,KAAK1C,QAAQoW,WAAW1T,KAAK1C,QAAQmV,MAAMpT,IAC3CW,KAAKgf,SAAS,CAAEsR,eAAgBjxB,EAAIkxB,eAAgB,sDA8OpDvwB,KAAKqwB,cAAc1R,0CAGK,IAAA/M,EAAA5R,KAAAsiB,EAC0BtiB,KAAKye,MAA/C+R,EADgBlO,EAChBkO,MAAOC,EADSnO,EACTmO,UAAWjkB,EADF8V,EACE9V,oBACpBsF,EAAI9R,KAAKye,MAAM8R,eAErB,OAAIE,EAEAtR,EAAAhiB,EAAAuX,cAACye,GAAD,CAAkB71B,QAAS0C,KAAK1C,QAASohB,OAAQ1e,KAAKizB,cAKxD9T,EAAAhiB,EAAAuX,cAAC0e,GAAD,MACI5C,IAAU7B,GAAUtpB,cACpBmrB,IAAU7B,GAAU+D,iBACpBvT,EAAAhiB,EAAAuX,cAAC2e,GAAD,CACE51B,aAAcuC,KAAK1C,QAAQG,aAC3B4iB,UAAWrgB,KAAK2yB,aAChBvgB,SACEoe,IAAU7B,GAAU+D,eAAiB1yB,KAAK4yB,iBAAc1uB,KAI5DssB,IAAU7B,GAAUiD,gBACpBpB,IAAU7B,GAAUsC,mBACpB9R,EAAAhiB,EAAAuX,cAAC4e,GAAD,CACE9O,aAAcxkB,KAAK2wB,WACnBtQ,UAAWrgB,KAAK2yB,aAChB3C,gBACEQ,IAAU7B,GAAUsC,iBAChBjxB,KAAK8yB,iBACL5uB,IAIVib,EAAAhiB,EAAAuX,cAAC6e,GAAD,CACE/mB,oBAAqBA,EACrByX,cAAejkB,KAAK2T,0BACpB6Q,aAAcxkB,KAAK2wB,WACnBlM,cAAezkB,KAAKgxB,qBACpBrM,cAAe3kB,KAAKmB,YACpBujB,gBAAiB1kB,KAAKoxB,cACtBxM,gBAAiB5kB,KAAK+vB,cACtBjL,YAAa9kB,KAAKgT,UAClB+R,eAAgB/kB,KAAKqxB,aACrBrM,UAAWhlB,KAAKsxB,QAChBrM,aAAcjlB,KAAKwxB,WACnBrM,mBAAoBnlB,KAAK0xB,iBACzBtM,qBAAsBplB,KAAK2xB,mBAC3BpM,aAAcvlB,KAAK6xB,aAErB1S,EAAAhiB,EAAAuX,cAACiR,GAAD,KACExG,EAAAhiB,EAAAuX,cAACmR,GAAD,KACE1G,EAAAhiB,EAAAuX,cAACwR,GAAD,KACE/G,EAAAhiB,EAAAuX,cAAA,sBACAyK,EAAAhiB,EAAAuX,cAACqS,GAAD,KACG/mB,KAAKye,MAAMhM,MAAMvG,IAAI,SAACgI,EAAGE,GAAJ,OACpB+K,EAAAhiB,EAAAuX,cAACwS,GAAD,CACE/oB,IAAK+V,EAAE7U,GACPuY,QAAS,kBAAMhG,EAAK8B,WAAWU,IAC/BiT,OAAQjT,IAAMxC,EAAK6M,MAAM6R,gBAExBpc,EAAE5U,MAAQ,uBAKjBwS,GACAqN,EAAAhiB,EAAAuX,cAAC8e,GAAD,CACE/f,KAAMzT,KAAKye,MAAMhM,MAAMzS,KAAKye,MAAM6R,gBAClCtI,aAAchoB,KAAK8xB,eACnB9D,mBAAoBhuB,KAAK+xB,qBACzBlE,kBAAmB7tB,KAAKgyB,sBAG3BlgB,GACCqN,EAAAhiB,EAAAuX,cAAC+e,GAAD,CACEpiB,OAAQS,EACRkW,aAAchoB,KAAKiyB,WACnBhK,iBAAkBjoB,KAAKoyB,eACvBlK,iBAAkBloB,KAAKqyB,eACvBlK,cAAenoB,KAAKkyB,YACpB9J,wBAAyBpoB,KAAKuyB,sBAC9B1K,wBAAyB7nB,KAAK4nB,sBAC9BS,qBAAsBroB,KAAKyyB,sBAIjCtT,EAAAhiB,EAAAuX,cAACgf,GAAD,CAAMtU,IAAKpf,KAAKkzB,cACd/T,EAAAhiB,EAAAuX,cAACif,GAAD,0BA1ewBtV,IAAMgB,kBCpCtBuU,QACW,cAA7BrgB,OAAOsgB,SAASC,UAEe,UAA7BvgB,OAAOsgB,SAASC,UAEhBvgB,OAAOsgB,SAASC,SAASC,MACvB,2DCXN,IAAMC,GAASzgB,QAEVygB,GAAOjuB,cAAgBiuB,GAAOC,qBACjCD,GAAOjuB,aAAeiuB,GAAOC,oBAM7B1gB,OAAO+C,iBACL,eACA,iBACE,4EAIN4d,IAASxa,OAAOyF,EAAAhiB,EAAAuX,cAACyf,GAAD,MAAY1f,SAAS2f,eAAe,SDkH9C,kBAAmB3d,WACrBA,UAAU4d,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC","file":"static/js/main.7defdd6b.chunk.js","sourcesContent":["enum AudioImplementation {\n  WebAudio = \"Web Audio API\",\n  Binaural = \"BinauralFIR\",\n  ResonanceAudio = \"Resonance Audio\"\n}\n\nexport default AudioImplementation;\n","/**\n * @author Niklas Korz\n * This module defines functions for exporting and saving projects to the local filesystem.\n */\nimport { saveAs } from \"file-saver\";\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\n\n/**\n * Serializes the given project as JSON and compresses it along its audio\n * data in a ZIP file. The audio data is saved as one file per audio in a\n * dedicated subdirectory \"audio\".\n */\nexport const createZip = async (project: Project): Promise<Blob> => {\n  const metadata = project.toData();\n  const zip = new Zip();\n  zip.file(\"metadata.json\", JSON.stringify(metadata));\n\n  const audioLibrary: Array<{ id: number; name: string; type: string }> = [];\n  const audioFolder = zip.folder(\"audio\");\n  for await (const [key, value] of project.audioLibrary.entries()) {\n    audioLibrary.push({ id: key, name: value.name, type: value.type });\n    audioFolder.file(key.toString(), value.data);\n  }\n  zip.file(\"audioLibrary.json\", JSON.stringify(audioLibrary));\n\n  return zip.generateAsync({ type: \"blob\" });\n};\n\n/**\n * Saves the given project, including its audio data, as a zip file on the\n * user's local filesystem\n */\nexport const saveAsZip = async (project: Project): Promise<void> => {\n  const data = await createZip(project);\n  saveAs(data, `${project.name}.audio3d.zip`);\n};\n","/**\n * @author Niklas Korz\n * Module for loading and saving projects and audio files from/to IndexedDB.\n */\nimport { openDB } from \"idb\";\nimport Project from \"../project/Project\";\nimport { Schema, AudioWithIds, AudioFile, ProjectData } from \"./schema\";\n\nconst dbPromise = openDB<Schema>(\"audio3d\", 1, {\n  upgrade(db) {\n    const projectStore = db.createObjectStore(\"projects\", {\n      keyPath: \"id\",\n      autoIncrement: true\n    });\n    projectStore.createIndex(\"savedAt\", \"savedAt\");\n    const audioStore = db.createObjectStore(\"audios\", {\n      keyPath: [\"projectId\", \"audioId\"]\n    });\n    audioStore.createIndex(\"project\", \"projectId\");\n  }\n});\n\nexport const loadProject = async (id: number): Promise<Project | undefined> => {\n  const db = await dbPromise;\n  const data = await db.get(\"projects\", id);\n  return data && new Project().fromData(data, id);\n};\n\nexport const saveProject = async (project: Project): Promise<number> => {\n  const db = await dbPromise;\n  const data = project.toData();\n  return await db.put(\"projects\", data);\n};\n\nexport const deleteProject = async (id: number): Promise<void> => {\n  const db = await dbPromise;\n  // Database transaction\n  const tx = db.transaction([\"audios\", \"projects\"], \"readwrite\");\n  // Object stores\n  const projects = tx.objectStore(\"projects\");\n  const audios = tx.objectStore(\"audios\");\n\n  // Delete project\n  await projects.delete(id);\n\n  // Delete all related audio files\n  let cursor = await audios.index(\"project\").openKeyCursor(id);\n  while (cursor) {\n    await audios.delete(cursor.primaryKey);\n    cursor = await cursor.continue();\n  }\n\n  await tx.done;\n};\n\nexport const getAllProjects = async (): Promise<ProjectData[]> => {\n  const db = await dbPromise;\n  return await db.getAllFromIndex(\"projects\", \"savedAt\");\n};\n\nexport const loadAudio = async (\n  projectId: number,\n  audioId: number\n): Promise<AudioWithIds | undefined> => {\n  const db = await dbPromise;\n  const data = await db.get(\"audios\", [projectId, audioId]);\n  return data;\n};\n\nexport const saveAudio = async (audio: AudioWithIds): Promise<void> => {\n  const db = await dbPromise;\n  await db.put(\"audios\", audio);\n};\n\nexport const saveAudioMap = async (\n  projectId: number,\n  audioMap: Map<number, AudioFile>\n): Promise<void> => {\n  const db = await dbPromise;\n  const tx = db.transaction(\"audios\", \"readwrite\");\n  for (const [audioId, entry] of audioMap.entries()) {\n    tx.store.put({ ...entry, projectId, audioId });\n  }\n  await tx.done;\n};\n\nexport const deleteAudio = async (\n  projectId: number,\n  audioId: number\n): Promise<void> => {\n  const db = await dbPromise;\n  await db.delete(\"audios\", [projectId, audioId]);\n};\n\nexport async function* iterateProjectAudios(\n  projectId: number\n): AsyncIterableIterator<[number, AudioFile]> {\n  const db = await dbPromise;\n  const tx = db.transaction(\"audios\");\n  let cursor = await tx.store.index(\"project\").openCursor(projectId);\n  while (cursor) {\n    yield [cursor.value.audioId, cursor.value];\n    cursor = await cursor.continue();\n  }\n  await tx.done;\n}\n","/**\n * @author Niklas Korz\n * This modules defines utility functions for working with iterators\n */\n\n/**\n * Wraps an IterableIterator in an AsyncIterableIterator\n * @param iterator The iterator to be wrapped\n */\nexport async function* wrapIteratorAsync<T>(\n  iterator: IterableIterator<T>\n): AsyncIterableIterator<T> {\n  for (const element of iterator) {\n    yield element;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { BoxGeometry, Mesh, MeshLambertMaterial } from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport { ObjectData, AudioFile } from \"../data/schema\";\nimport AudioScene from \"../audio/AudioScene\";\nimport Audio3D from \"../audio/Audio3D\";\nimport defaultAudioContext from \"../audio/defaultAudioContext\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport CodeBlock from \"./CodeBlock\";\n\nconst cubeGeometry = new BoxGeometry(1, 1, 1);\nconst cubeMaterial = new MeshLambertMaterial();\n\nexport enum InteractionType {\n  None = \"No interaction\",\n  CodeBlock = \"Code block\",\n  Teleport = \"Teleport\",\n  PlaySound = \"Play sound\",\n  EndGame = \"End game\"\n}\n\nexport default class GameObject extends Mesh implements Serializable {\n  audioLibrary: AudioLibrary;\n  audioId?: number;\n  audioFile?: AudioFile;\n\n  audio: Audio3D;\n\n  // Interaction specific\n  interactionType = InteractionType.None;\n  interactionAudioId?: number;\n  codeBlock?: CodeBlock;\n\n  constructor(audioLibrary: AudioLibrary, audioScene: AudioScene) {\n    super(cubeGeometry, cubeMaterial);\n    this.audioLibrary = audioLibrary;\n\n    this.audio = audioScene.createAudio3D();\n    this.add(this.audio);\n  }\n\n  async loadAudio(id: number): Promise<void> {\n    this.audioId = id;\n    this.audioFile = await this.audioLibrary.get(id);\n    this.audio.stop();\n    if (this.audioFile) {\n      const buffer = await defaultAudioContext.decodeAudioData(\n        this.audioFile.data.slice(0)\n      );\n      this.audio.setBuffer(buffer);\n      this.audio.setLoop(true);\n      this.audio.play();\n    }\n  }\n\n  toData(): ObjectData {\n    return {\n      name: this.name,\n      position: this.position.toArray(),\n      scale: this.scale.toArray(),\n      rotation: this.rotation.toArray().slice(0, 3),\n      audioId: this.audioId\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.position.set(data.position[0], data.position[1], data.position[2]);\n    this.scale.set(data.scale[0], data.scale[1], data.scale[2]);\n    this.rotation.set(data.rotation[0], data.rotation[1], data.rotation[2]);\n\n    if (data.audioId != null) {\n      this.loadAudio(data.audioId);\n    }\n\n    this.interactionType = data.interactionType || InteractionType.None;\n    this.interactionAudioId = data.interactionAudioId;\n    if (data.codeBlockSource) {\n      this.codeBlock = new CodeBlock(data.codeBlockSource);\n    }\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { AudioFile } from \"../data/schema\";\nimport {\n  saveAudio,\n  loadAudio,\n  deleteAudio,\n  saveAudioMap,\n  iterateProjectAudios\n} from \"../data/db\";\nimport { wrapIteratorAsync } from \"../utils/iter\";\n\nexport default class AudioLibrary {\n  projectId?: number;\n  audioMap = new Map<number, AudioFile>();\n  nextId = 0;\n\n  async add(entry: AudioFile): Promise<number> {\n    if (this.projectId != null) {\n      await saveAudio({\n        ...entry,\n        projectId: this.projectId,\n        audioId: this.nextId\n      });\n    } else {\n      this.audioMap.set(this.nextId, entry);\n    }\n    return this.nextId++;\n  }\n\n  async get(id: number): Promise<AudioFile | undefined> {\n    if (this.projectId != null) {\n      return await loadAudio(this.projectId, id);\n    }\n    return this.audioMap.get(id);\n  }\n\n  async set(id: number, entry: AudioFile): Promise<void> {\n    if (this.projectId != null) {\n      await loadAudio(this.projectId, id);\n    } else {\n      this.audioMap.set(id, entry);\n    }\n  }\n\n  async delete(id: number): Promise<void> {\n    if (this.projectId != null) {\n      await deleteAudio(this.projectId, id);\n    } else {\n      this.audioMap.delete(id);\n    }\n  }\n\n  async saveToProject(projectId: number): Promise<void> {\n    this.projectId = projectId;\n    await saveAudioMap(projectId, this.audioMap);\n    this.audioMap.clear();\n  }\n\n  entries(): AsyncIterableIterator<[number, AudioFile]> {\n    if (this.projectId != null) {\n      return iterateProjectAudios(this.projectId);\n    }\n    return wrapIteratorAsync(this.audioMap.entries());\n  }\n}\n","const defaultAudioContext = new AudioContext();\n\nexport default defaultAudioContext;\n","/**\n * Useful utility functions related to mathematics\n * @author Niklas Korz\n */\n\n// Converts radiant angles to degrees\nexport const radToDeg = (rad: number): number => (rad * 180) / Math.PI;\n\n// Converts degree angles to radiants\nexport const degToRad = (deg: number): number => (deg / 180) * Math.PI;\n\nexport const roundToPrecision = (value: number, precision: number): number =>\n  Math.round(value / precision) * precision;\n","/**\n * @author Niklas Korz, Leon Erath\n */\nimport { Vector3 } from \"three\";\nimport BinauralFIR from \"binauralfir\";\nimport { radToDeg } from \"../../utils/math\";\nimport BinauralScene from \"./BinauralScene\";\n\nexport default class BinauralSource {\n  position = new Vector3();\n  orientation = new Vector3();\n  scene: BinauralScene;\n  binauralFIR: BinauralFIR;\n\n  get input(): AudioNode {\n    return this.binauralFIR.input;\n  }\n\n  constructor(scene: BinauralScene) {\n    this.scene = scene;\n    this.binauralFIR = new BinauralFIR({ audioContext: scene.audioContext });\n    this.binauralFIR.HRTFDataset = scene.hrtfDataset;\n    this.binauralFIR.connect(scene.audioContext.destination);\n  }\n\n  update(): void {\n    const listenerAzimuth = Math.atan2(\n      this.scene.listenerOrientation.x,\n      this.scene.listenerOrientation.z\n    );\n\n    const distance = this.binauralFIR.distance(\n      this.position,\n      this.scene.listenerPosition\n    );\n\n    const deltaZ = this.position.z - this.scene.listenerPosition.z;\n    const azimuth = radToDeg(\n      listenerAzimuth + deltaZ &&\n        Math.atan((this.position.x - this.scene.listenerPosition.x) / deltaZ)\n    );\n\n    const elevation =\n      distance &&\n      radToDeg(\n        Math.asin((this.position.y - this.scene.listenerPosition.y) / distance)\n      );\n\n    this.binauralFIR.setPosition(azimuth, elevation, distance);\n  }\n}\n","/**\n * @author Niklas Korz, Leon Erath\n */\n\nimport { Vector3 } from \"three\";\nimport { HRTF } from \"binauralfir\";\nimport defaultAudioContext from \"../defaultAudioContext\";\nimport BinauralSource from \"./BinauralSource\";\n\nconst dummyHRTFDataset: HRTF[] = [\n  {\n    azimuth: 1,\n    elevation: 1,\n    distance: 1,\n    buffer: defaultAudioContext.createBuffer(2, 512, 44100)\n  }\n];\n\nexport default class BinauralScene {\n  listenerPosition = new Vector3(0, 0, 0);\n  listenerOrientation = new Vector3(0, 0, 0);\n  sources: BinauralSource[] = [];\n  audioContext: AudioContext;\n  hrtfDataset: HRTF[];\n\n  constructor(\n    audioContext: AudioContext,\n    hrtfDataset: HRTF[] = dummyHRTFDataset\n  ) {\n    this.audioContext = audioContext;\n    this.hrtfDataset = hrtfDataset;\n  }\n\n  createSource(): BinauralSource {\n    const source = new BinauralSource(this);\n    this.sources.push(source);\n    return source;\n  }\n\n  setHRTFDataset(hrtfDataset: HRTF[]): void {\n    this.hrtfDataset = hrtfDataset;\n    for (const source of this.sources) {\n      source.binauralFIR.HRTFDataset = hrtfDataset;\n    }\n  }\n\n  update(): void {\n    for (const source of this.sources) {\n      source.update();\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n * @author Leon Erath\n */\nimport { Object3D, Vector3, Quaternion } from \"three\";\nimport { ResonanceAudio } from \"resonance-audio\";\nimport BinauralSource from \"./binaural/BinauralSource\";\nimport AudioImplementation from \"./AudioImplementation\";\n\n/**\n * Class extends Object3D in order to work with the three.js scene graph.\n * The idea is to override the updateWorldMatrix method and change the audio nodes\n * accordingly.\n */\nexport default class Audio3D extends Object3D {\n  webAudioContext: AudioContext;\n  binauralAudioContext: AudioContext;\n  resonanceAudioContext: AudioContext;\n\n  webAudioPannerNode: PannerNode;\n  binauralSource: BinauralSource;\n  resonanceSource: ResonanceAudio.Source;\n\n  webAudioBufferSource: AudioBufferSourceNode;\n  binauralBufferSource: AudioBufferSourceNode;\n  resonanceBufferSource: AudioBufferSourceNode;\n\n  constructor(\n    webAudioContext: AudioContext,\n    binauralAudioContext: AudioContext,\n    resonanceAudioContext: AudioContext,\n    webAudioPannerNode: PannerNode,\n    binauralSource: BinauralSource,\n    resonanceSource: ResonanceAudio.Source\n  ) {\n    super();\n\n    this.webAudioContext = webAudioContext;\n    this.binauralAudioContext = binauralAudioContext;\n    this.resonanceAudioContext = resonanceAudioContext;\n\n    this.webAudioPannerNode = webAudioPannerNode;\n    this.binauralSource = binauralSource;\n    this.resonanceSource = resonanceSource;\n\n    this.webAudioBufferSource = webAudioContext.createBufferSource();\n    this.binauralBufferSource = binauralAudioContext.createBufferSource();\n    this.resonanceBufferSource = resonanceAudioContext.createBufferSource();\n\n    this.webAudioBufferSource.connect(webAudioPannerNode);\n    this.binauralBufferSource.connect(binauralSource.input);\n    this.resonanceBufferSource.connect(resonanceSource.input);\n\n    this.webAudioPannerNode.connect(webAudioContext.destination);\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n\n    const position = new Vector3();\n    const quaternion = new Quaternion();\n    const scale = new Vector3();\n    this.matrixWorld.decompose(position, quaternion, scale);\n    const orientation = new Vector3(0, 0, 1).applyQuaternion(quaternion);\n\n    this.webAudioPannerNode.setPosition(position.x, position.y, position.z);\n    this.webAudioPannerNode.setOrientation(\n      orientation.x,\n      orientation.y,\n      orientation.z\n    );\n\n    this.binauralSource.position.copy(position);\n    this.binauralSource.orientation.copy(orientation);\n    this.binauralSource.update();\n\n    this.resonanceSource.setFromMatrix(this.matrixWorld);\n  }\n\n  setBuffer(buffer: AudioBuffer): void {\n    if (this.webAudioBufferSource.buffer) {\n      // Chrome does not allow \"resetting\" the buffer and throws an error\n      // with this message: Cannot set buffer to non-null after it has been already been set to a non-null buffer\n      // To circumvent this, we have to create a new buffer source\n\n      this.stop();\n\n      this.webAudioBufferSource = this.webAudioContext.createBufferSource();\n      this.binauralBufferSource = this.binauralAudioContext.createBufferSource();\n      this.resonanceBufferSource = this.resonanceAudioContext.createBufferSource();\n\n      this.webAudioBufferSource.connect(this.webAudioPannerNode);\n      this.binauralBufferSource.connect(this.binauralSource.input);\n      this.resonanceBufferSource.connect(this.resonanceSource.input);\n    }\n\n    this.webAudioBufferSource.buffer = buffer;\n    this.binauralBufferSource.buffer = buffer;\n    this.resonanceBufferSource.buffer = buffer;\n  }\n\n  setLoop(loop: boolean): void {\n    this.webAudioBufferSource.loop = loop;\n    this.binauralBufferSource.loop = loop;\n    this.resonanceBufferSource.loop = loop;\n  }\n\n  play(): void {\n    this.webAudioBufferSource.start();\n    this.binauralBufferSource.start();\n    this.resonanceBufferSource.start();\n  }\n\n  stop(): void {\n    if (this.webAudioBufferSource.buffer) {\n      this.webAudioBufferSource.stop();\n      this.binauralBufferSource.stop();\n      this.resonanceBufferSource.stop();\n\n      this.webAudioBufferSource.disconnect();\n      this.binauralBufferSource.disconnect();\n      this.resonanceBufferSource.disconnect();\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n * @author Leon Erath\n */\nimport { Object3D, Vector3, Quaternion } from \"three\";\nimport { ResonanceAudio } from \"resonance-audio\";\nimport BinauralScene from \"./binaural/BinauralScene\";\n\nexport default class Listener3D extends Object3D {\n  webAudioListener: AudioListener;\n  binauralScene: BinauralScene;\n  resonanceScene: ResonanceAudio;\n\n  constructor(\n    webAudioListener: AudioListener,\n    binauralScene: BinauralScene,\n    resonanceScene: ResonanceAudio\n  ) {\n    super();\n    this.webAudioListener = webAudioListener;\n    this.binauralScene = binauralScene;\n    this.resonanceScene = resonanceScene;\n  }\n\n  updateMatrixWorld(force: boolean): void {\n    super.updateMatrixWorld(force);\n\n    const position = new Vector3();\n    const quaternion = new Quaternion();\n    const scale = new Vector3();\n    this.matrixWorld.decompose(position, quaternion, scale);\n    const orientation = new Vector3(0, 0, 1).applyQuaternion(quaternion);\n\n    this.webAudioListener.setPosition(-position.x, position.y, -position.z);\n    this.webAudioListener.setOrientation(\n      orientation.x,\n      orientation.y,\n      orientation.z,\n      this.up.x,\n      this.up.y,\n      this.up.z\n    );\n\n    this.binauralScene.listenerPosition.copy(position);\n    this.binauralScene.listenerOrientation.copy(orientation);\n    this.binauralScene.update();\n\n    this.resonanceScene.setListenerFromMatrix(this.matrixWorld);\n  }\n}\n","import { HRTF } from \"binauralfir\";\nimport defaultAudioContext from \"../defaultAudioContext\";\n\nconst firCoefficientsToAudioBuffer = (\n  firCoeffsLeft: number[],\n  firCoeffsRight: number[]\n): AudioBuffer => {\n  const buffer = defaultAudioContext.createBuffer(2, 512, 44100);\n  buffer.copyToChannel(new Float32Array(firCoeffsLeft), 0);\n  buffer.copyToChannel(new Float32Array(firCoeffsRight), 1);\n  return buffer;\n};\n\nexport const loadHRTFDataset = async (): Promise<HRTF[]> => {\n  const resp = await fetch(\"data/ircam-hrtf.json\");\n  const dataset = await resp.json();\n\n  return dataset.map((hrtf: any) => ({\n    azimuth: hrtf.azimuth,\n    elevation: hrtf.elevation,\n    distance: hrtf.distance,\n    buffer: firCoefficientsToAudioBuffer(\n      hrtf.fir_coeffs_left,\n      hrtf.fir_coeffs_right\n    )\n  }));\n};\n","/**\n * @author Niklas Korz\n * @author Leon Erath\n */\nimport { ResonanceAudio, RoomMaterials, RoomDimensions } from \"resonance-audio\";\nimport { HRTF } from \"binauralfir\";\nimport BinauralScene from \"./binaural/BinauralScene\";\nimport Audio3D from \"./Audio3D\";\nimport AudioImplementation from \"./AudioImplementation\";\nimport Listener3D from \"./Listener3D\";\nimport { loadHRTFDataset } from \"./binaural/hrtf\";\n\ninterface Options {\n  materials?: RoomMaterials;\n  dimensions?: RoomDimensions;\n}\n\nexport default class AudioScene {\n  audioImplementation: AudioImplementation = AudioImplementation.WebAudio;\n\n  webAudioContext = new AudioContext();\n  binauralAudioContext = new AudioContext();\n  resonanceAudioContext = new AudioContext();\n\n  binauralScene = new BinauralScene(this.binauralAudioContext);\n  resonanceScene = new ResonanceAudio(this.resonanceAudioContext);\n\n  binauralHRTFDataset: HRTF[] | null = null;\n  isLoadingBinauralHRTFDataset = false;\n\n  listener3D = new Listener3D(\n    this.webAudioContext.listener,\n    this.binauralScene,\n    this.resonanceScene\n  );\n\n  constructor(options: Options) {\n    this.resonanceScene.setRoomProperties(\n      options.dimensions || ResonanceAudio.Utils.DEFAULT_ROOM_DIMENSIONS,\n      options.materials || ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS\n    );\n    this.resonanceScene.output.connect(this.resonanceAudioContext.destination);\n\n    this.suspend();\n  }\n\n  createAudio3D(): Audio3D {\n    return new Audio3D(\n      this.webAudioContext,\n      this.binauralAudioContext,\n      this.resonanceAudioContext,\n      this.webAudioContext.createPanner(),\n      this.binauralScene.createSource(),\n      this.resonanceScene.createSource()\n    );\n  }\n\n  close(): void {\n    this.webAudioContext.close();\n    this.binauralAudioContext.close();\n    this.resonanceAudioContext.close();\n  }\n\n  suspend(): void {\n    this.webAudioContext.suspend();\n    this.binauralAudioContext.suspend();\n    this.resonanceAudioContext.suspend();\n  }\n\n  resume(): void {\n    switch (this.audioImplementation) {\n      case AudioImplementation.WebAudio:\n        this.webAudioContext.resume();\n        break;\n      case AudioImplementation.Binaural:\n        this.binauralAudioContext.resume();\n        break;\n      case AudioImplementation.ResonanceAudio:\n        this.resonanceAudioContext.resume();\n        break;\n    }\n  }\n\n  selectAudioImplementation(audioImplementation: AudioImplementation): void {\n    if (\n      audioImplementation === AudioImplementation.Binaural &&\n      !this.binauralHRTFDataset &&\n      !this.isLoadingBinauralHRTFDataset\n    ) {\n      this.loadBinauralHRTFDataset();\n    }\n\n    this.suspend();\n    this.audioImplementation = audioImplementation;\n    this.resume();\n  }\n\n  async loadBinauralHRTFDataset(): Promise<void> {\n    this.isLoadingBinauralHRTFDataset = true;\n    try {\n      this.binauralHRTFDataset = await loadHRTFDataset();\n      this.binauralScene.setHRTFDataset(this.binauralHRTFDataset);\n    } catch (ex) {\n      console.error(\"Failed loading BinauralFIR HRTF dataset:\", ex);\n    }\n    this.isLoadingBinauralHRTFDataset = false;\n  }\n\n  setRoomProperties(\n    roomDimensions: RoomDimensions,\n    roomMaterials: RoomMaterials\n  ): void {\n    this.resonanceScene.setRoomProperties(roomDimensions, roomMaterials);\n  }\n}\n","/**\n * @author Niklas Korz\n */\nexport default class CodeBlock {\n  source: string;\n  func?: Function;\n\n  constructor(source: string = \"\") {\n    this.source = source;\n  }\n\n  update(source: string): void {\n    this.source = source;\n    this.func = undefined;\n  }\n\n  execute(playerState: any, roomState: any, thisObject: any = null): void {\n    if (!this.func) {\n      this.func = new Function(\"playerState\", \"roomState\", this.source);\n    }\n    this.func.call(thisObject, playerState, roomState);\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport {\n  AmbientLight,\n  BoxGeometry,\n  GridHelper,\n  Mesh,\n  MeshLambertMaterial,\n  Object3D,\n  PerspectiveCamera,\n  PointLight,\n  Scene,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport { RoomData } from \"../data/schema\";\nimport AudioScene from \"../audio/AudioScene\";\nimport AudioImplementation from \"../audio/AudioImplementation\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\n\nconst wallGeometry = new BoxGeometry(1, 1, 1);\nconst wallMaterial = new MeshLambertMaterial();\n\n// A \"room\" is analog to levels of a game.\n// The user will only hear sounds that are part of the current room.\n// Also, this abstraction is necessary to support Resonance Audio as one of many\n// spatial audio implementations.\nexport default class Room extends Scene implements Serializable {\n  audioLibrary: AudioLibrary;\n  roomDimensions: RoomDimensions;\n  roomMaterials: RoomMaterials;\n\n  grid: GridHelper;\n  wallNorth = new Mesh(wallGeometry, wallMaterial);\n  wallEast = new Mesh(wallGeometry, wallMaterial);\n  wallSouth = new Mesh(wallGeometry, wallMaterial);\n  wallWest = new Mesh(wallGeometry, wallMaterial);\n  camera = new PerspectiveCamera(60, 1, 0.1, 1000);\n\n  audioScene: AudioScene;\n\n  get dimensions(): RoomDimensions {\n    return this.roomDimensions;\n  }\n\n  set dimensions(dimensions: RoomDimensions) {\n    this.roomDimensions = dimensions;\n\n    this.audioScene.setRoomProperties(dimensions, this.roomMaterials);\n\n    this.remove(this.grid);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n\n    this.add(this.grid);\n\n    this.updateWalls();\n  }\n\n  get materials(): RoomMaterials {\n    return this.roomMaterials;\n  }\n\n  set materials(materials: RoomMaterials) {\n    this.roomMaterials = materials;\n    this.audioScene.setRoomProperties(this.roomDimensions, materials);\n  }\n\n  constructor(\n    audioLibrary: AudioLibrary,\n    name: string = \"\",\n    dimensions: RoomDimensions = { width: 15, depth: 15, height: 3 },\n    materials: RoomMaterials = ResonanceAudio.Utils.DEFAULT_ROOM_MATERIALS\n  ) {\n    super();\n\n    this.audioLibrary = audioLibrary;\n    this.name = name;\n    this.roomDimensions = dimensions;\n    this.roomMaterials = materials;\n\n    const ambientLight = new AmbientLight(0xffffff, 0.5);\n    this.add(ambientLight);\n    const light = new PointLight(0xffffff, 0.5);\n    light.position.set(5, 5, 0);\n    light.lookAt(0, 0, 0);\n    this.add(light);\n\n    const gridSize = Math.max(dimensions.width, dimensions.depth);\n    this.grid = new GridHelper(gridSize, gridSize, 0xffffff, 0xffffff);\n    this.add(this.grid);\n\n    this.updateWalls();\n    this.add(this.wallNorth);\n    this.add(this.wallEast);\n    this.add(this.wallSouth);\n    this.add(this.wallWest);\n\n    this.camera.position.z = 4;\n    this.camera.position.y = 3;\n    this.camera.lookAt(new Vector3(0, 1, 0));\n\n    // Audio setup\n    this.audioScene = new AudioScene({\n      dimensions: dimensions,\n      materials: materials\n    });\n\n    this.camera.add(this.audioScene.listener3D);\n  }\n\n  addObject(): GameObject {\n    const object = new GameObject(this.audioLibrary, this.audioScene);\n    object.position.y += 0.5;\n    object.name = \"New object\";\n\n    this.add(object);\n    return object;\n  }\n\n  updateWalls(): void {\n    const { width, depth, height } = this.roomDimensions;\n\n    this.wallNorth.scale.set(width, height, 0.25);\n    this.wallEast.scale.set(0.25, height, depth);\n    this.wallSouth.scale.set(width, height, 0.25);\n    this.wallWest.scale.set(0.25, height, depth);\n\n    this.wallNorth.position.set(0, height / 2, depth / 2);\n    this.wallEast.position.set(width / 2, height / 2, 0);\n    this.wallSouth.position.set(0, height / 2, -depth / 2);\n    this.wallWest.position.set(-width / 2, height / 2, 0);\n  }\n\n  toData(): RoomData {\n    return {\n      name: this.name,\n      dimensions: this.dimensions,\n      materials: this.materials,\n      objects: this.children\n        .filter((c: Object3D): c is GameObject => c instanceof GameObject)\n        .map(go => go.toData())\n    };\n  }\n\n  fromData(data: SerializedData): this {\n    this.name = data.name;\n    this.dimensions = data.dimensions;\n    if (data.materials) {\n      this.materials = data.materials;\n    }\n\n    const gameObjects = data.objects.map((o: SerializedData) =>\n      new GameObject(this.audioLibrary, this.audioScene).fromData(o)\n    );\n    this.add(...gameObjects);\n\n    return this;\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport {\n  BackSide,\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  Vector3\n} from \"three\";\nimport Serializable, { SerializedData } from \"../data/Serializable\";\nimport { ProjectData } from \"../data/schema\";\nimport { saveProject } from \"../data/db\";\nimport AudioImplementation from \"../audio/AudioImplementation\";\nimport AudioLibrary from \"./AudioLibrary\";\nimport GameObject from \"./GameObject\";\nimport Room from \"./Room\";\n\nexport interface ProjectEvents {\n  onSelect(object: GameObject | null): void;\n  onTranslate(position: Vector3): void;\n  onScale(scale: Vector3): void;\n}\n\nconst noop = (): void => {\n  /* noop */\n};\nconst defaultEvents: ProjectEvents = {\n  onSelect: noop,\n  onScale: noop,\n  onTranslate: noop\n};\n\nexport default class Project implements Serializable {\n  events: ProjectEvents;\n  audioLibrary = new AudioLibrary();\n\n  id?: number;\n  name = \"New project\";\n\n  rooms: Room[] = [];\n  audioType: number = 1;\n\n  activeAudioImplementation = AudioImplementation.WebAudio;\n  activeRoom: Room;\n  activeObject: GameObject | null = null;\n\n  outlineMesh = new Mesh();\n\n  get camera(): PerspectiveCamera {\n    return this.activeRoom.camera;\n  }\n\n  constructor(events: ProjectEvents = defaultEvents) {\n    this.events = events;\n\n    const firstRoom = new Room(this.audioLibrary, \"First room\");\n    firstRoom.addObject();\n    this.rooms.push(firstRoom);\n    this.activeRoom = firstRoom;\n\n    this.outlineMesh.material = new MeshBasicMaterial({\n      color: 0xffffff,\n      side: BackSide\n    });\n    this.outlineMesh.scale.multiplyScalar(1.05);\n\n    (window as any).p = this;\n  }\n\n  close(): void {\n    for (const room of this.rooms) {\n      room.audioScene.close();\n    }\n  }\n\n  addRoom(): Room {\n    const room = new Room(this.audioLibrary, \"New room\");\n    room.addObject();\n    this.rooms.push(room);\n    this.selectRoom(room);\n    return room;\n  }\n\n  selectAudioImplementation(audioImplementation: AudioImplementation): void {\n    this.activeAudioImplementation = audioImplementation;\n    this.activeRoom.audioScene.selectAudioImplementation(audioImplementation);\n  }\n\n  selectRoom(room: Room): void {\n    this.activeRoom.audioScene.suspend();\n    room.audioScene.selectAudioImplementation(this.activeAudioImplementation);\n    room.camera.aspect = this.activeRoom.camera.aspect;\n    room.camera.updateProjectionMatrix();\n    this.activeRoom = room;\n    this.selectObject(null);\n  }\n\n  selectObject(o: GameObject | null): void {\n    if (this.activeObject) {\n      this.activeObject.remove(this.outlineMesh);\n    }\n\n    if (o) {\n      this.outlineMesh.geometry = o.geometry;\n      o.add(this.outlineMesh);\n    }\n\n    this.activeObject = o;\n    this.events.onSelect(o);\n  }\n\n  // Serialize instance to a plain JavaScript object\n  toData(): ProjectData {\n    return {\n      savedAt: new Date(),\n      name: this.name,\n      rooms: this.rooms.map(r => r.toData()),\n      nextAudioId: this.audioLibrary.nextId\n    };\n  }\n\n  // Load data from a plain JavaScript object into this instance\n  fromData(data: SerializedData, projectId?: number): this {\n    this.id = projectId;\n    this.audioLibrary.projectId = projectId;\n    this.audioLibrary.nextId = data.nextAudioId || 0;\n\n    this.name = data.name;\n    this.rooms = data.rooms.map((r: SerializedData) =>\n      new Room(this.audioLibrary).fromData(r)\n    );\n    this.activeRoom = this.rooms[0];\n\n    // Disable audio in all inactive rooms\n    for (let i = 1; i < this.rooms.length; i++) {\n      this.rooms[i].audioScene.suspend();\n    }\n\n    return this;\n  }\n\n  async save(): Promise<void> {\n    const id = await saveProject(this);\n    if (this.id == null) {\n      this.id = id;\n      await this.audioLibrary.saveToProject(id);\n    }\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\n// Options for configuring the file modal\nexport interface OpenFileDialogOptions {\n  accept?: string;\n}\n\n/**\n * Opens a file dialog and lets the user select a file\n * @returns The selected file\n */\nexport const openFileDialog = (\n  options: OpenFileDialogOptions = {}\n): Promise<File> =>\n  new Promise(resolve => {\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    if (options.accept) {\n      input.accept = options.accept;\n    }\n    input.onchange = () => {\n      if (input.files) {\n        resolve(input.files[0]);\n      }\n    };\n    input.click();\n  });\n\nexport const readFileAsArrayBuffer = (file: File): Promise<ArrayBuffer> =>\n  new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      if (reader.result) {\n        resolve(reader.result as ArrayBuffer);\n      }\n    };\n    reader.onerror = () => {\n      console.error(\"Error:\", reader.error);\n    };\n    reader.readAsArrayBuffer(file);\n  });\n","/**\n * @author Niklas Korz\n * This module defines functions for loading and importing projects from the local filesystem.\n */\nimport Zip from \"jszip\";\nimport Project from \"../project/Project\";\nimport { openFileDialog } from \"../utils/files\";\n\n/**\n * Decompresses the given zip file, loads the included JSON metadata and reads all\n * included audio files as binary array buffers.\n * @param blob The blob to read from, usually a file returned by a FileReader instance.\n * @returns The project recreated from the data found in the zip\n */\nexport const loadZip = async (blob: Blob): Promise<Project> => {\n  const zip = await Zip.loadAsync(blob);\n  const metadata = JSON.parse(await zip.file(\"metadata.json\").async(\"text\"));\n\n  const audioLibrary = JSON.parse(\n    await zip.file(\"audioLibrary.json\").async(\"text\")\n  );\n  const audioFolder = zip.folder(\"audio\");\n  const project = new Project();\n  for (const { id, name, type } of audioLibrary) {\n    const data = await audioFolder.file(id.toString()).async(\"arraybuffer\");\n    project.audioLibrary.set(id, { name, type, data });\n\n    if (id >= project.audioLibrary.nextId) {\n      project.audioLibrary.nextId = id + 1;\n    }\n  }\n\n  project.fromData(metadata);\n  return project;\n};\n\n/**\n * Opens a file dialog and lets the user select a zip file that will be parsed\n * and loaded as a project.\n * @returns The project found in the zip\n */\nexport const openZip = async (): Promise<Project> => {\n  const file = await openFileDialog({ accept: \"application/zip\" });\n  return await loadZip(file);\n};\n","/**\n * @author Niklas Korz\n */\n\nconst AXIS_THRESHOLD = 0.15; //Inaccuracy of gamepads (tested XBOX One S gamepad up to 0.11 - Daniel)\n\nexport default class GamepadListener {\n  listen(): void {\n    window.addEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.addEventListener(\"gamepaddisconnected\", this.onGamepadDisconnected);\n  }\n\n  stop(): void {\n    window.removeEventListener(\"gamepadconnected\", this.onGamepadConnected);\n    window.removeEventListener(\n      \"gamepaddisconnected\",\n      this.onGamepadDisconnected\n    );\n  }\n\n  onGamepadConnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad connected:\", e.gamepad);\n  };\n\n  onGamepadDisconnected = (e: GamepadEvent) => {\n    console.log(\"Gamepad disconnected:\", e.gamepad);\n  };\n\n  getAxis(index: number): number {\n    const gamepads = navigator.getGamepads();\n\n    let value = 0;\n    for (const gamepad of gamepads) {\n      if (!gamepad || gamepad.mapping !== \"standard\") {\n        continue;\n      }\n\n      if (index < 4) {\n        const axis = gamepad.axes[index];\n        if (\n          Math.abs(axis) >= AXIS_THRESHOLD &&\n          Math.abs(axis) > Math.abs(value)\n        ) {\n          value = axis;\n        }\n      } else if (index === 4) {\n        const v1 = gamepad.buttons[6].value;\n        const v2 = gamepad.buttons[7].value;\n        const axis = v2 - v1;\n        if (Math.abs(axis) > Math.abs(value)) {\n          value = axis;\n        }\n      }\n    }\n    return value;\n  }\n\n  getButtonStatus(index: number): boolean {\n    const gamepads = navigator.getGamepads();\n\n    for (const gamepad of gamepads) {\n      if (!gamepad || gamepad.mapping !== \"standard\") {\n        continue;\n      }\n\n      if (gamepad.buttons[index].pressed) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","/**\n * @author Niklas Korz\n */\n\nexport default class KeyboardListener {\n  target: HTMLElement;\n  keysPressed = new Set<string>();\n  lastKeyUp = new Map<string, number>();\n\n  constructor(target: HTMLElement) {\n    this.target = target;\n  }\n\n  listen(): void {\n    this.target.addEventListener(\"blur\", this.reset);\n    this.target.addEventListener(\"contextmenu\", this.reset);\n    this.target.addEventListener(\"keydown\", this.onKeyDown);\n    this.target.addEventListener(\"keyup\", this.onKeyUp);\n    document.addEventListener(\"click\", this.onClick);\n  }\n\n  stop(): void {\n    this.target.removeEventListener(\"blur\", this.reset);\n    this.target.removeEventListener(\"contextmenu\", this.reset);\n    this.target.removeEventListener(\"keydown\", this.onKeyDown);\n    this.target.removeEventListener(\"keyup\", this.onKeyUp);\n    document.removeEventListener(\"click\", this.onClick);\n    this.reset();\n  }\n\n  isPressed(key: string): boolean {\n    return this.keysPressed.has(key);\n  }\n\n  reset = (): void => {\n    this.keysPressed.clear();\n  };\n\n  onKeyDown = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    // Workaround for browsers firing a queued keydown shortly after a keyup\n    // Ignore keydown if the last keyup was triggered +-100ms from now\n    if (Math.abs(e.timeStamp - (this.lastKeyUp.get(e.key) || 0)) >= 100) {\n      this.keysPressed.add(e.key);\n    }\n  };\n\n  onKeyUp = (e: KeyboardEvent): void => {\n    e.preventDefault();\n    this.keysPressed.delete(e.key);\n    this.lastKeyUp.set(e.key, e.timeStamp);\n  };\n\n  onClick = (e: MouseEvent): void => {\n    // Shift + right click forces context menu in firefox\n    if (e.button === 2 && e.shiftKey) {\n      this.reset();\n    }\n  };\n}\n","/**\n * @author Daniel Salomon\n */\nimport { Raycaster, Vector3, WebGLRenderer, Object3D, Mesh, Box3 } from \"three\";\nimport GamepadListener from \"../input/GamepadListener\";\nimport KeyboardListener from \"../input/KeyboardListener\";\nimport Project from \"../project/Project\";\nimport GameObject from \"../project/GameObject\";\n\nconst axes = {\n  x: new Vector3(1, 0, 0),\n  y: new Vector3(0, 1, 0),\n  z: new Vector3(0, 0, 1)\n};\n\nexport default class Runtime {\n  target: HTMLElement | null = null;\n  project: Project;\n\n  rafHandle = 0;\n  previousTimestamp = 0;\n  playerHeight = 1.8; //1,80m player height, eyes are ~10cm lower\n  lastCollisionSound = 0; //Timestamp, when the last sound for collision was played\n  lastKnownButtonStatus = false; //Variable to check whether or not the button[0] was pressed in the last update() or not (to prevent multiple clicks)\n\n  shouldRender = true; //Should the visuals be rendered or should it be audio-only?\n\n  renderer = new WebGLRenderer();\n  canvas: HTMLCanvasElement;\n\n  raycaster = new Raycaster();\n\n  dummyCamera = new Object3D();\n\n  keys = new KeyboardListener(this.renderer.domElement);\n  gamepads = new GamepadListener();\n\n  constructor(project: Project) {\n    this.project = project;\n    this.canvas = this.renderer.domElement;\n    this.canvas.tabIndex = -1; // Make element focusable\n\n    this.project.selectRoom(this.project.rooms[0]);\n    this.project.camera.position.set(0, this.playerHeight - 0.1, 2);\n    this.project.camera.rotation.set(0, 0, 0);\n  }\n\n  attach(target: HTMLElement): void {\n    this.keys.listen();\n    this.gamepads.listen();\n\n    this.target = target;\n    target.appendChild(this.canvas);\n\n    this.resize();\n    window.requestAnimationFrame(this.animate);\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  detach(): void {\n    window.cancelAnimationFrame(this.rafHandle);\n    window.removeEventListener(\"resize\", this.resize);\n\n    if (this.target) {\n      this.target.removeChild(this.canvas);\n      this.target = null;\n    }\n\n    this.keys.stop();\n    this.gamepads.stop();\n  }\n\n  focus(): void {\n    this.canvas.focus();\n  }\n\n  resize = (): void => {\n    if (!this.target) {\n      return;\n    }\n\n    const { offsetWidth, offsetHeight } = this.target;\n\n    this.project.camera.aspect = offsetWidth / offsetHeight;\n    this.project.camera.updateProjectionMatrix();\n\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(offsetWidth, offsetHeight);\n  };\n\n  animate: FrameRequestCallback = t => {\n    this.rafHandle = window.requestAnimationFrame(this.animate);\n\n    const dt = (t - this.previousTimestamp) / 1000;\n    this.previousTimestamp = t;\n    this.update(dt);\n\n    if (this.shouldRender) {\n      this.renderer.render(this.project.activeRoom, this.project.camera);\n    } else {\n      // When we are not actively rendering, position updates are not passed down\n      // to children in the scene graph automatically.\n      // To enforce this update, we have to update the scene graphs root manually\n      // (i.e., the scene itself), which will in turn update all nodes contained in the\n      // scene graph.\n      // As the camera is not a part of the scene graph, it has to be updated\n      // manually as well.\n      this.project.activeRoom.updateMatrixWorld();\n      this.project.activeRoom.camera.updateMatrixWorld(false);\n    }\n  };\n\n  toggleRendering(): void {\n    this.shouldRender = this.shouldRender ? false : true;\n    this.renderer.clear();\n  }\n\n  // Helper method to check if a number (check) is between or equal to two boundaries (from, to). E.g.: isBetween(2, 1, 5)==true, isBetween(6, 1, 5)==false\n  isBetween(check: number, from: number, to: number): boolean {\n    const min = Math.min.apply(Math, [from, to]),\n      max = Math.max.apply(Math, [from, to]);\n    return check >= min && check <= max;\n  }\n\n  invokeInteraction(): boolean {\n    const toInteractWith = this.project.activeObject;\n    if (toInteractWith != null) {\n      toInteractWith.rotateX(0.1); //TODO - Invoke interaction method on object (not implemented yet)\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  update(dt: number): void {\n    const { camera } = this.project;\n    this.dummyCamera.position.copy(camera.position); //Copy values of the real camera object to the dummy camera, to be used later on for collision detection\n    this.dummyCamera.rotation.copy(camera.rotation);\n\n    let moveX = 0;\n    let moveZ = 0;\n    let rotateY = 0;\n\n    //Sidenote on movement: We really wanted to implement the possibility to look up and down, but it turned out to be way too complex for us to implement in this project.\n    //All tries resulted in either a buggy camera or a buggy movement through the environment, which we were not fine with.\n\n    //Keyboard actions (W/A/S/D to move, Left&Right arrows to rotate)\n    if (this.keys.isPressed(\"w\")) {\n      const newZ = -2 * dt;\n      moveZ = Math.abs(moveZ) < Math.abs(newZ) ? newZ : moveZ;\n    }\n    if (this.keys.isPressed(\"s\")) {\n      const newZ = 2 * dt;\n      moveZ = Math.abs(moveZ) < Math.abs(newZ) ? newZ : moveZ;\n    }\n    if (this.keys.isPressed(\"a\")) {\n      const newX = -2 * dt;\n      moveX = Math.abs(moveX) < Math.abs(newX) ? newX : moveX;\n    }\n    if (this.keys.isPressed(\"d\")) {\n      const newX = 2 * dt;\n      moveX = Math.abs(moveX) < Math.abs(newX) ? newX : moveX;\n    }\n\n    if (this.keys.isPressed(\"ArrowLeft\")) {\n      const newY = dt;\n      rotateY = Math.abs(rotateY) < Math.abs(newY) ? newY : rotateY;\n    }\n    if (this.keys.isPressed(\"ArrowRight\")) {\n      const newY = -dt;\n      rotateY = Math.abs(rotateY) < Math.abs(newY) ? newY : rotateY;\n    }\n\n    //Collect necessary information from the gamepad API, supports analog sticks (slower and faster movement)\n    const gamepadAxes = {\n      x: this.gamepads.getAxis(0),\n      y: this.gamepads.getAxis(1),\n      rX: this.gamepads.getAxis(2)\n    };\n    if (gamepadAxes.x) {\n      const newX = 2 * dt * gamepadAxes.x;\n      moveX = Math.abs(moveX) < Math.abs(newX) ? newX : moveX;\n    }\n    if (gamepadAxes.y) {\n      const newZ = 2 * dt * gamepadAxes.y;\n      moveZ = Math.abs(moveZ) < Math.abs(newZ) ? newZ : moveZ;\n    }\n    if (gamepadAxes.rX) {\n      const newY = -dt * gamepadAxes.rX;\n      rotateY = Math.abs(rotateY) < Math.abs(newY) ? newY : rotateY;\n    }\n\n    // Executing the rotation/movement after all keys are evaluated prevents the issue of double movement speed when both, keyboard and gamepad, is used at the same time.\n    camera.rotateOnWorldAxis(axes.y, rotateY); // Rotate left & right\n    //Apply movement to dummy object first to check if a collision is happening. If not, apply to actual camera.\n    this.dummyCamera.translateOnAxis(axes.z, moveZ); // Move forwards & backwards\n    this.dummyCamera.translateOnAxis(axes.x, moveX); // Move left & right\n\n    //Values to check for collision\n    const newX = this.dummyCamera.position.x;\n    const newZ = this.dummyCamera.position.z;\n\n    //Check for collision\n    let collided = false;\n    for (const i of this.project.activeRoom.children) {\n      if (!(i instanceof Mesh)) {\n        continue;\n      }\n      const thresholdMovement = 0.25; //Minimum allowed distance to an object\n      const thresholdHeight = 0.05; //Minimum allowed distance to an object below or above the player (player height is 1,80[m])\n\n      var bbox = new Box3().setFromObject(i); //Bounding box to take rotation of the object into account.\n      const bboxposition = bbox.getCenter(new Vector3());\n      const bboxscale = bbox.getSize(new Vector3());\n\n      //Estimate boundaries of all (visible) objects in the current room\n      const boundX1 = bboxposition.x + bboxscale.x / 2 + thresholdMovement;\n      const boundX2 = bboxposition.x - bboxscale.x / 2 - thresholdMovement;\n      const boundY1 = bboxposition.y + bboxscale.y / 2 + thresholdHeight;\n      const boundY2 = bboxposition.y - bboxscale.y / 2 - thresholdHeight;\n      const boundZ1 = bboxposition.z + bboxscale.z / 2 + thresholdMovement;\n      const boundZ2 = bboxposition.z - bboxscale.z / 2 - thresholdMovement;\n\n      //Check if the next position of the camera collides with the bondaries or the object (and effectively if a collision is about to happen)\n      if (\n        this.isBetween(newX, boundX2, boundX1) &&\n        this.isBetween(newZ, boundZ2, boundZ1) &&\n        (this.isBetween(boundY1, 0, this.playerHeight) ||\n          this.isBetween(boundY2, 0, this.playerHeight) ||\n          (this.isBetween(this.playerHeight, boundY2, boundY1) &&\n            this.isBetween(0, boundY2, boundY1)))\n      ) {\n        collided = true;\n      }\n    }\n\n    // Move to new position if no collision occured, otherwise play a collision sound\n    if (!collided) {\n      camera.position.copy(this.dummyCamera.position);\n    } else if (this.lastCollisionSound + 1000 < Date.now()) {\n      //TODO - Play sound\n      this.lastCollisionSound = Date.now();\n    }\n\n    //Check for an object to interact with. If found, mark it as active (mostly for debugging and visual help for possible spectators)\n    //The raycaster helps to check for objects in sight. To ensure that objects on the bottom and top of sight are interactable too, the raycasting is called multiple times\n    //That way, objects from the middle top of the sight to the middle bottom of the screen are scanned and checked for their distance.\n    let nearestDist = Infinity;\n    let nearestObj: GameObject | null = null;\n\n    for (let i = 1; i >= -1; i -= 0.1) {\n      //From top (1) to middle(0) to bottom (-1)\n      this.raycaster.setFromCamera({ x: 0, y: i }, camera);\n      const intersections = this.raycaster.intersectObjects(\n        //perform raycasting with the given settings, originating from the main camera\n        this.project.activeRoom.children\n      );\n\n      for (const intersection of intersections) {\n        //Check, if the intersecting objects are actual GameObjects and if they are closer than the current closest intersecting GameObject\n        const o = intersection.object;\n        if (o instanceof GameObject && intersection.distance < nearestDist) {\n          nearestDist = intersection.distance;\n          nearestObj = o;\n        }\n      }\n    }\n\n    if (nearestDist <= 1.5 && nearestObj != null) {\n      //If the clostest GameObject is closer or equal than 1.5m (and not null for safety), select it\n      this.project.selectObject(nearestObj);\n    } else {\n      //Otherwise, unselect all\n      this.project.selectObject(null);\n    }\n\n    //Interact with nearest (selected) object\n    if (\n      // Is the button or key clicked\n      (this.gamepads.getButtonStatus(0) || this.keys.isPressed(\"e\")) &&\n      //Prevent multiple actions on button hold\n      !this.lastKnownButtonStatus\n    ) {\n      this.lastKnownButtonStatus = true;\n      this.invokeInteraction();\n    } else if (!this.gamepads.getButtonStatus(0) && !this.keys.isPressed(\"e\")) {\n      this.lastKnownButtonStatus = false; //Last known button status was unpressed, so clear the value\n    }\n\n    //TODO - sounds for footsteps\n  }\n}\n","/**\n * @author Daniel Salomon\n */\nimport styled, { css } from \"styled-components\";\n\nexport const FocusedLabel = styled.div`\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n`;\n\nexport const RunningLabel = styled.div`\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  font-size: 25px;\n`;\n\nexport const RunningHeadline = styled.p`\n  color: #fff;\n  font-size: 15px;\n  margin: 12px 10px 5px 10px;\n  font-weight: bold;\n`;\n\nexport const RunningButtonContainer = styled.div`\n  display: flex;\n  justify-content: left;\n`;\n\ninterface RunningButtonProps {\n  selected?: boolean;\n}\n\nexport const RunningButton = styled.div<RunningButtonProps>`\n  padding: 10px 15px;\n  margin: 5px;\n  color: #fff;\n  font-size: 15px;\n  border-radius: 3px;\n  background: hsla(0, 0%, 100%, 0.2);\n  ${props =>\n    props.selected &&\n    css`\n      box-shadow: 0px 0px 10px #00ff00;\n      background: #19611c;\n    `}\n\n  border: 1px solid hsl(210, 15%, 40%);\n  text-align: center;\n  cursor: pointer;\n\n  :hover {\n    ${props =>\n      !props.selected &&\n      css`\n        background: hsla(0, 0%, 100%, 0.4);\n      `}\n  }\n`;\n\nexport const ControlsTable = styled.table`\n  border: 0px solid transparent;\n  border-collapse: collapse;\n  font-size: 15px;\n  width: 100%;\n`;\n\nexport const Main = styled.main`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: black;\n\n  :focus-within > ${FocusedLabel} {\n    display: block;\n  }\n`;\n","/**\n * @author Daniel Salomon\n */\nimport React from \"react\";\nimport Project from \"../project/Project\";\nimport AudioImplementation from \"../audio/AudioImplementation\";\nimport Runtime from \"./Runtime\";\nimport {\n  Main,\n  FocusedLabel,\n  RunningLabel,\n  RunningHeadline,\n  RunningButton,\n  RunningButtonContainer,\n  ControlsTable\n} from \"./styled\";\n\ninterface Props {\n  project: Project;\n  onExit(): void;\n}\ninterface State {\n  audioImplementation: AudioImplementation;\n}\n\nexport default class RuntimeContainer extends React.Component<Props> {\n  targetRef = React.createRef<HTMLDivElement>();\n  runtime = new Runtime(this.props.project);\n  activeButtonRef: HTMLElement | null = null;\n\n  state: State = { audioImplementation: AudioImplementation.WebAudio };\n\n  constructor(props: Props) {\n    super(props);\n    this.state.audioImplementation = this.props.project.activeAudioImplementation;\n  }\n\n  componentDidMount(): void {\n    if (this.targetRef.current) {\n      this.runtime.attach(this.targetRef.current);\n      this.runtime.focus();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.runtime.detach();\n  }\n\n  onExit = () => {\n    this.runtime.detach();\n    this.props.onExit();\n  };\n\n  onVisualToggle = () => {\n    this.runtime.toggleRendering();\n  };\n\n  onChangeAudio = (\n    event: React.MouseEvent<HTMLDivElement, MouseEvent>,\n    audio: AudioImplementation\n  ) => {\n    this.props.project.selectAudioImplementation(audio);\n    this.setState({ audioImplementation: audio });\n  };\n\n  render(): React.ReactNode {\n    const { audioImplementation } = this.state;\n\n    return (\n      <Main ref={this.targetRef}>\n        <RunningLabel>\n          Audio3D\n          <RunningHeadline>Menu</RunningHeadline>\n          <RunningButtonContainer>\n            <RunningButton onClick={this.onExit}>Exit</RunningButton>\n            <RunningButton onClick={this.onVisualToggle}>\n              Toggle visuals\n            </RunningButton>\n          </RunningButtonContainer>\n          <RunningHeadline>Audio implementation</RunningHeadline>\n          <RunningButtonContainer>\n            <RunningButton\n              onClick={e => this.onChangeAudio(e, AudioImplementation.WebAudio)}\n              selected={audioImplementation === AudioImplementation.WebAudio}\n            >\n              Web Audio API\n            </RunningButton>\n            <RunningButton\n              selected={audioImplementation === AudioImplementation.Binaural}\n              onClick={e => this.onChangeAudio(e, AudioImplementation.Binaural)}\n            >\n              BinauralFIR\n            </RunningButton>\n            <RunningButton\n              selected={\n                audioImplementation === AudioImplementation.ResonanceAudio\n              }\n              onClick={e =>\n                this.onChangeAudio(e, AudioImplementation.ResonanceAudio)\n              }\n            >\n              Resonance Audio\n            </RunningButton>\n          </RunningButtonContainer>\n          <RunningHeadline>Controls</RunningHeadline>\n          <ControlsTable>\n            <tr>\n              <td>Move</td>\n              <td>W/A/S/D or left stick</td>\n            </tr>\n            <tr>\n              <td>View</td>\n              <td>Arrow keys or right stick</td>\n            </tr>\n            <tr>\n              <td>Interact</td>\n              <td>E or A (XBOX)</td>\n            </tr>\n          </ControlsTable>\n        </RunningLabel>\n        <FocusedLabel>Focused</FocusedLabel>\n      </Main>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport styled from \"styled-components\";\n\nconst Backdrop = styled.div`\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 2;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Container = styled.div`\n  border-radius: 5px;\n  overflow: hidden;\n  max-width: 600px;\n  color: #fff;\n  background: hsl(210, 29%, 29%);\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n`;\n\nconst TitleBar = styled.div`\n  padding: 10px 15px;\n  background: hsl(210, 29%, 15%);\n`;\n\nconst Content = styled.div`\n  padding: 10px 15px;\n`;\n\nexport const ActionGroup = styled.div`\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n`;\n\nexport const Action = styled.button`\n  display: block;\n  appearance: none;\n  border: none;\n  background: hsl(210, 29%, 20%);\n  color: #fff;\n  cursor: pointer;\n  border-radius: 3px;\n  padding: 8px 12px;\n  margin-left: 10px;\n  font-size: 0.9em;\n\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\ninterface Props {\n  title: string;\n  onDismiss?(): void;\n}\n\nexport default class Modal extends React.Component<Props> {\n  onBackdropClick: React.MouseEventHandler = e => {\n    if (e.currentTarget === e.target && this.props.onDismiss) {\n      this.props.onDismiss();\n    }\n  };\n\n  render(): React.ReactNode {\n    return (\n      <Backdrop onClick={this.onBackdropClick}>\n        <Container>\n          <TitleBar>{this.props.title}</TitleBar>\n          <Content>{this.props.children}</Content>\n        </Container>\n      </Backdrop>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\ninterface Props {\n  audioEntry: AudioEntry;\n  onDelete(audioEntry: AudioEntry): void;\n  onExport(audioEntry: AudioEntry): void;\n  onDismiss(): void;\n  onCancel(): void;\n}\n\nexport default class AudioFileModal extends React.Component<Props> {\n  render(): React.ReactNode {\n    const { audioEntry } = this.props;\n    return (\n      <Modal title=\"Audio File\" onDismiss={this.props.onDismiss}>\n        <p>\n          <b>Name:</b> {audioEntry.name}\n        </p>\n        <p>\n          <b>Type:</b> {audioEntry.type}\n        </p>\n        <p>\n          <b>Size:</b> {Math.ceil(audioEntry.data.byteLength / 1024)} KiB\n        </p>\n        <ActionGroup>\n          <Action onClick={() => this.props.onDelete(audioEntry)}>\n            Delete\n          </Action>\n          <Action onClick={() => this.props.onExport(audioEntry)}>\n            Export\n          </Action>\n          <Action onClick={this.props.onCancel}>Back</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { saveAs } from \"file-saver\";\nimport styled from \"styled-components\";\nimport AudioLibrary from \"../project/AudioLibrary\";\nimport { openFileDialog, readFileAsArrayBuffer } from \"../utils/files\";\nimport AudioFileModal from \"./AudioFileModal\";\nimport Modal, { Action, ActionGroup } from \"./Modal\";\nimport { AudioEntry } from \"./types\";\n\nconst AudioList = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  margin: 0 -5px;\n`;\n\nconst AudioItem = styled.div`\n  flex: 1 1 150px;\n  margin: 5px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  cursor: pointer;\n  background: hsl(210, 29%, 20%);\n  transition: 0.2s background-color, 0.2s box-shadow;\n\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n\n  :hover,\n  :active {\n    background: hsl(210, 29%, 35%);\n    box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);\n  }\n`;\n\ninterface Props {\n  audioLibrary: AudioLibrary;\n  onDismiss(): void;\n  onSelect?(entry: AudioEntry): void;\n}\n\ninterface State {\n  entries: AudioEntry[];\n  selectedEntry: AudioEntry | null;\n}\n\nexport default class AudioLibraryModal extends React.Component<Props, State> {\n  previewAudio = new Audio();\n  state: State = { entries: [], selectedEntry: null };\n\n  openAudioFileDialog = async () => {\n    const file = await openFileDialog({ accept: \"audio/*\" });\n    const data = await readFileAsArrayBuffer(file);\n    const audioFile = { name: file.name, type: file.type, data };\n    const id = await this.props.audioLibrary.add(audioFile);\n    this.setState(({ entries }) => ({\n      entries: [\n        ...entries,\n        {\n          id,\n          ...audioFile\n        }\n      ]\n    }));\n  };\n\n  previewEntry(entry: AudioEntry): void {\n    this.previewAudio.src = URL.createObjectURL(new Blob([entry.data]));\n    this.previewAudio.loop = true;\n    this.previewAudio.play();\n  }\n\n  stopPreview = () => {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  };\n\n  dismiss = () => {\n    this.setState({ selectedEntry: null });\n    this.props.onDismiss();\n    this.stopPreview();\n  };\n\n  selectEntry(audioEntry: AudioEntry): void {\n    if (this.props.onSelect) {\n      this.props.onSelect(audioEntry);\n    } else {\n      this.setState({ selectedEntry: audioEntry });\n    }\n  }\n\n  unselectEntry = () => {\n    this.setState({ selectedEntry: null });\n    this.stopPreview();\n  };\n\n  deleteAudio = ({ id }: AudioEntry) => {\n    this.props.audioLibrary.delete(id);\n    this.setState(({ entries }) => ({\n      entries: entries.filter(e => e.id !== id),\n      selectedEntry: null\n    }));\n  };\n\n  exportAudio = ({ name, type, data }: AudioEntry) => {\n    saveAs(new Blob([data], { type }), name);\n  };\n\n  async updateEntries(): Promise<void> {\n    const entries: AudioEntry[] = [];\n    for await (const [id, audioFile] of this.props.audioLibrary.entries()) {\n      entries.push({ ...audioFile, id });\n    }\n    this.setState({\n      entries: entries.sort((a, b) => a.id - b.id)\n    });\n  }\n\n  async componentDidMount(): Promise<void> {\n    await this.updateEntries();\n  }\n\n  async componentDidUpdate(prevProps: Props): Promise<void> {\n    if (prevProps.audioLibrary !== this.props.audioLibrary) {\n      // The project and therefore the audio library to be rendered has changed\n      await this.updateEntries();\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.previewAudio.pause();\n    URL.revokeObjectURL(this.previewAudio.src);\n  }\n\n  render(): React.ReactNode {\n    const { entries, selectedEntry } = this.state;\n\n    if (selectedEntry) {\n      return (\n        <AudioFileModal\n          audioEntry={selectedEntry}\n          onDelete={this.deleteAudio}\n          onExport={this.exportAudio}\n          onCancel={this.unselectEntry}\n          onDismiss={this.dismiss}\n        />\n      );\n    }\n\n    return (\n      <Modal\n        title={this.props.onSelect ? \"Select Audio\" : \"Audio Library\"}\n        onDismiss={this.dismiss}\n      >\n        <AudioList>\n          {entries.length > 0 &&\n            entries.map(e => (\n              <AudioItem\n                key={e.id}\n                title={e.name}\n                onClick={() => this.selectEntry(e)}\n                onMouseEnter={() => this.previewEntry(e)}\n                onMouseLeave={this.stopPreview}\n              >\n                {e.name} <br />\n                {e.type} <br />\n                {Math.ceil(e.data.byteLength / 1024)} KiB\n              </AudioItem>\n            ))}\n        </AudioList>\n        {!entries.length && <div>You haven't added any audio files yet</div>}\n        <ActionGroup>\n          <Action onClick={this.openAudioFileDialog}>Add audio file</Action>\n          <Action onClick={this.dismiss}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport styled, { css } from \"styled-components\";\nimport AudioImplementation from \"../audio/AudioImplementation\";\n\nconst Container = styled.div`\n  flex: 0 0 auto;\n  background: hsl(210, 29%, 15%);\n  color: #fff;\n  font-size: 0.9em;\n  padding: 0 10px;\n  user-select: none;\n\n  :focus {\n    outline: none;\n  }\n`;\n\ninterface MenubarItemProps {\n  isActive?: boolean;\n  alignRight?: boolean;\n}\n\nconst MenubarItem = styled.div<MenubarItemProps>`\n  position: relative;\n  display: inline-block;\n  padding: 10px 15px;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 25%, 20%);\n  }\n\n  ${props =>\n    props.isActive &&\n    css`\n      background: hsl(210, 25%, 20%);\n    `}\n\n  ${props =>\n    props.alignRight &&\n    css`\n      float: right;\n    `}\n`;\n\nconst MenubarItemLabel = styled.label`\n  cursor: pointer;\n`;\n\nconst Menu = styled.div`\n  z-index: 1;\n  position: absolute;\n  left: 0;\n  top: 100%;\n  background: hsl(210, 25%, 20%);\n  padding: 5px 0;\n  min-width: 200px;\n  font-size: 0.95em;\n  box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.5);\n\n  border-bottom-left-radius: 3px;\n  border-bottom-right-radius: 3px;\n\n  cursor: default;\n`;\n\nconst MenuItem = styled.div`\n  white-space: nowrap;\n  padding: 8px 20px;\n  margin: 2px 0;\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 15%);\n  }\n`;\n\nconst MenuDivider = styled.div`\n  height: 0;\n  margin: 5px;\n  border-bottom: 1px solid hsl(210, 15%, 35%);\n`;\n\ninterface Props {\n  audioImplementation: AudioImplementation;\n\n  onNewProject(): void;\n  onLoadProject(): void;\n  onSaveProject(): void;\n  onImportProject(): void;\n  onExportProject(): void;\n  onAudioChange(audioImplementation: AudioImplementation): void;\n  onAddObject(): void;\n  onDeleteObject(): void;\n  onAddRoom(): void;\n  onDeleteRoom(): void;\n\n  onShowAudioLibrary(): void;\n  onShowProjectManager(): void;\n\n  onRunProject(): void;\n}\n\nenum MenuType {\n  FileMenu,\n  EditMenu,\n  AudioMenu,\n  ViewMenu,\n  HelpMenu\n}\n\ninterface State {\n  activeMenu: MenuType | null;\n}\n\nexport default class MenuBar extends React.Component<Props, State> {\n  state: State = {\n    activeMenu: null\n  };\n\n  toggleMenu(menuType: MenuType): void {\n    this.setState(state => ({\n      activeMenu: state.activeMenu === menuType ? null : menuType\n    }));\n  }\n\n  closeMenu(): void {\n    this.setState({ activeMenu: null });\n  }\n\n  render(): React.ReactNode {\n    const { audioImplementation, onAudioChange } = this.props;\n    const { activeMenu } = this.state;\n\n    return (\n      <Container tabIndex={-1} onBlur={() => this.closeMenu()}>\n        <MenubarItem\n          isActive={activeMenu === MenuType.FileMenu}\n          onClick={() => this.toggleMenu(MenuType.FileMenu)}\n        >\n          <MenubarItemLabel>File</MenubarItemLabel>\n          <Menu hidden={activeMenu !== MenuType.FileMenu}>\n            <MenuItem onClick={this.props.onNewProject}>New project</MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onLoadProject}>Load project</MenuItem>\n            <MenuItem onClick={this.props.onImportProject}>\n              Import project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onSaveProject}>Save project</MenuItem>\n            <MenuItem onClick={this.props.onExportProject}>\n              Export project\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem>Settings</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.EditMenu}\n          onClick={() => this.toggleMenu(MenuType.EditMenu)}\n        >\n          <MenubarItemLabel>Edit</MenubarItemLabel>\n          <Menu hidden={activeMenu !== MenuType.EditMenu}>\n            <MenuItem onClick={this.props.onAddObject}>Add object</MenuItem>\n            <MenuItem onClick={this.props.onDeleteObject}>\n              Delete object\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem onClick={this.props.onAddRoom}>Add room</MenuItem>\n            <MenuItem onClick={this.props.onDeleteRoom}>Delete room</MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.ViewMenu}\n          onClick={() => this.toggleMenu(MenuType.ViewMenu)}\n        >\n          <MenubarItemLabel>View</MenubarItemLabel>\n          <Menu hidden={activeMenu !== MenuType.ViewMenu}>\n            <MenuItem onClick={this.props.onShowAudioLibrary}>\n              Audio Library\n            </MenuItem>\n            <MenuItem onClick={this.props.onShowProjectManager}>\n              Project Manager\n            </MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem\n          isActive={activeMenu === MenuType.HelpMenu}\n          onClick={() => this.toggleMenu(MenuType.HelpMenu)}\n        >\n          <MenubarItemLabel>Help</MenubarItemLabel>\n          <Menu hidden={activeMenu !== MenuType.HelpMenu}>\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/issues\",\n                  \"_blank\"\n                )\n              }\n            >\n              Issues\n            </MenuItem>\n            <MenuItem\n              onClick={() =>\n                window.open(\"https://github.com/niklaskorz/audio3d\", \"_blank\")\n              }\n            >\n              Source Code\n            </MenuItem>\n            <MenuDivider />\n            <MenuItem\n              onClick={() =>\n                window.open(\n                  \"https://github.com/niklaskorz/audio3d/blob/master/README.md\",\n                  \"_blank\"\n                )\n              }\n            >\n              About\n            </MenuItem>\n          </Menu>\n        </MenubarItem>\n        <MenubarItem alignRight onClick={this.props.onRunProject}>\n          <MenubarItemLabel>Run</MenubarItemLabel>\n        </MenubarItem>\n        <MenubarItem\n          alignRight\n          isActive={activeMenu === MenuType.AudioMenu}\n          onClick={() => this.toggleMenu(MenuType.AudioMenu)}\n        >\n          <MenubarItemLabel>Audio: {audioImplementation}</MenubarItemLabel>\n          <Menu hidden={activeMenu !== MenuType.AudioMenu}>\n            <MenuItem\n              onClick={() => onAudioChange(AudioImplementation.WebAudio)}\n            >\n              {AudioImplementation.WebAudio}\n            </MenuItem>\n            <MenuItem\n              onClick={() => onAudioChange(AudioImplementation.Binaural)}\n            >\n              {AudioImplementation.Binaural}\n            </MenuItem>\n\n            <MenuItem\n              onClick={() => onAudioChange(AudioImplementation.ResonanceAudio)}\n            >\n              {AudioImplementation.ResonanceAudio}\n            </MenuItem>\n          </Menu>\n        </MenubarItem>\n      </Container>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport styled, { css } from \"styled-components\";\n\nexport const Container = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background: #000;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const InnerContainer = styled.div`\n  flex: 1;\n  overflow: hidden;\n  display: flex;\n  flex-direction: row;\n`;\n\nexport const Sidebar = styled.aside`\n  flex: 0 0 300px;\n  height: 100%;\n  background: hsl(210, 29%, 29%);\n  color: #fff;\n  padding: 0 15px;\n  overflow-x: hidden;\n  overflow-y: auto;\n`;\n\nexport const FocusedLabel = styled.div`\n  display: none;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  padding: 10px 15px;\n  border-radius: 3px;\n  background: hsl(210, 25%, 20%);\n  border: 1px solid hsl(210, 15%, 40%);\n  opacity: 0.8;\n  color: #fff;\n  pointer-events: none;\n`;\n\nexport const Main = styled.main`\n  position: relative;\n  flex: 1;\n  height: 100%;\n\n  :focus-within > ${FocusedLabel} {\n    display: block;\n  }\n`;\n\nexport const Group = styled.div`\n  margin: 20px 0;\n`;\n\nexport const Input = styled.input`\n  display: block;\n  appearance: none;\n  background: hsl(210, 29%, 24%);\n  border-radius: 3px;\n  border: 2px solid hsl(210, 29%, 24%);\n  color: #fff;\n  width: 100%;\n  padding: 10px 12px;\n  margin: 5px 0;\n\n  transition: 0.2s ease border-color;\n  :focus {\n    outline: none;\n    border-color: #3498db;\n  }\n`;\n\nexport const Select = styled(Input.withComponent(\"select\"))`\n  cursor: pointer;\n`;\n\nexport const CustomInput = styled(Input.withComponent(\"div\"))`\n  cursor: pointer;\n`;\n\nexport const CodeEditor = styled(Input.withComponent(\"textarea\"))`\n  min-height: 200px;\n  font-family: \"Fira Code Retina\", \"Fira Code\", Consolas, Menlo, Monaco,\n    monospace;\n  white-space: pre;\n  line-height: 1.5;\n\n  /* Disable user resizing of width */\n  min-width: 100%;\n  max-width: 100%;\n`;\n\nexport const InputGroup = styled.div`\n  display: flex;\n  flex-direction: row;\n\n  > ${Input} {\n    flex: 1;\n    width: auto;\n    min-width: 0;\n\n    margin-right: 5px;\n\n    :last-child {\n      margin-right: 0;\n    }\n  }\n`;\n\nexport const RoomList = styled.ol`\n  list-style: none;\n  padding: 5px;\n  margin: 5px 0;\n  border-radius: 3px;\n  background: hsl(210, 29%, 24%);\n`;\n\ninterface RoomListItemProps {\n  active?: boolean;\n}\n\nexport const RoomListItem = styled.li<RoomListItemProps>`\n  cursor: pointer;\n  padding: 7px 10px;\n  border-radius: 2px;\n  ${props =>\n    props.active &&\n    css`\n      background: hsl(210, 29%, 20%);\n      border-left: 2px solid #3498db;\n    `};\n`;\n","/**\n * @author Niklas Korz\n */\nimport {\n  BoxGeometry,\n  DoubleSide,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  Plane,\n  PlaneGeometry,\n  Raycaster,\n  Scene,\n  SphereGeometry,\n  Vector3\n} from \"three\";\nimport Project from \"../project/Project\";\n\n// The object drag direction is required for calculating the plane to ray cast\n// against later on. Also, of course, to determine whether the object should be\n// moved on one or two axes.\nenum ObjectDragDirection {\n  AxisX,\n  AxisY,\n  AxisZ,\n  PlaneYZ,\n  PlaneXZ,\n  PlaneXY\n}\n\n// Inspired by https://github.com/mrdoob/three.js/blob/dev/examples/js/controls/TransformControls.js\n// As in the example, we are using ray casting for calculating the movements of planes and axes.\n// Everything else in this implementation has resulted either from trial and error or by\n// consulting the Three.js documentation.\n// The controls are grouped as a scene instead of a group object to allow drawing\n// them separately, on top of the main scene, to avoid any controls to be obscured\n// by objects that would theoretically appear in front of them based on their Z coordinate.\n// Furthermore, the scene's position is set to the active mesh's when one is\n// selected. This way, coordinates in the controls scene are always relative to the\n// active mesh.\n// Theoretically, it could also be added as a child node to the active mesh,\n// but this would result in the rotation being copied as well, which is not desirable\n// in this case.\n// Beware though that intersection points are always given in absolute world coordinates.\nexport default class VisualControls extends Scene {\n  project: Project;\n\n  objectDragDirection: ObjectDragDirection | null = null;\n  isScaling: boolean = false;\n  // The drag offset is used to determine the distance of the point where the\n  // user started dragging and the center of the object.\n  // This way, the cursor will always have the same relative position to the\n  // object while dragging.\n  dragOffset = new Vector3();\n  lastPoint = new Vector3();\n\n  // In contrast to the Three.js example, we will be using a real plane instead of a\n  // mesh that only represents an area on a plane.\n  // As a consequence, the ray generated by the ray caster will be used directly\n  // for calculating the intersection.\n  plane = new Plane();\n\n  // The visual controls\n  axisX: Mesh;\n  axisY: Mesh;\n  axisZ: Mesh;\n  scaleX: Mesh;\n  scaleY: Mesh;\n  scaleZ: Mesh;\n  planeYZ: Mesh;\n  planeXZ: Mesh;\n  planeXY: Mesh;\n\n  constructor(project: Project) {\n    super();\n\n    this.project = project;\n\n    // Setup visual controls for transformation\n\n    const materialConfig = {\n      transparent: true,\n      opacity: 0.75,\n      side: DoubleSide // Needed to make the planes viewable from both sides\n    };\n\n    // The X, Y and Z axes, represented as cuboids\n\n    const axisGeometry = new BoxGeometry(0.05, 0.05, 0.5);\n\n    this.axisX = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0xff0000\n      })\n    );\n    this.axisX.position.set(0.275, 0.0, 0.0);\n    this.axisX.rotation.y = Math.PI / 2;\n    this.axisX.userData.direction = ObjectDragDirection.AxisX;\n\n    this.axisY = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x00ff00\n      })\n    );\n    this.axisY.position.set(0.0, 0.275, 0.0);\n    this.axisY.rotation.x = Math.PI / 2;\n    this.axisY.userData.direction = ObjectDragDirection.AxisY;\n\n    this.axisZ = new Mesh(\n      axisGeometry,\n      new MeshBasicMaterial({\n        ...materialConfig,\n        color: 0x0000ff\n      })\n    );\n    this.axisZ.position.set(0.0, 0.0, 0.275);\n    this.axisZ.userData.direction = ObjectDragDirection.AxisZ;\n\n    this.add(this.axisX);\n    this.add(this.axisY);\n    this.add(this.axisZ);\n\n    // Scaling controls per axis, represented as spheres\n\n    const scaleGeometry = new SphereGeometry(0.05, 16, 16);\n\n    this.scaleX = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff0000 })\n    );\n    this.scaleX.position.set(0.65, 0, 0);\n    this.scaleX.userData.direction = ObjectDragDirection.AxisX;\n    this.scaleX.userData.isScale = true;\n\n    this.scaleY = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ff00 })\n    );\n    this.scaleY.position.set(0, 0.65, 0);\n    this.scaleY.userData.direction = ObjectDragDirection.AxisY;\n    this.scaleY.userData.isScale = true;\n\n    this.scaleZ = new Mesh(\n      scaleGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x0000ff })\n    );\n    this.scaleZ.position.set(0, 0, 0.65);\n    this.scaleZ.userData.direction = ObjectDragDirection.AxisZ;\n    this.scaleZ.userData.isScale = true;\n\n    this.add(this.scaleX);\n    this.add(this.scaleY);\n    this.add(this.scaleZ);\n\n    // The YZ, XZ, XY planes, represented as areas on each plane.\n    // Declaration is ordered by the normal of the plane, i.e.\n    // the axis that will not be moved by it.\n\n    const planeGeometry = new PlaneGeometry(0.25, 0.25);\n\n    this.planeYZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0x00ffff })\n    );\n    this.planeYZ.position.set(0.0, 0.25, 0.25);\n    this.planeYZ.rotation.y = Math.PI / 2;\n    this.planeYZ.userData.direction = ObjectDragDirection.PlaneYZ;\n\n    this.planeXZ = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xff00ff })\n    );\n    this.planeXZ.position.set(0.25, 0.0, 0.25);\n    this.planeXZ.rotation.x = Math.PI / 2;\n    this.planeXZ.userData.direction = ObjectDragDirection.PlaneXZ;\n\n    this.planeXY = new Mesh(\n      planeGeometry,\n      new MeshBasicMaterial({ ...materialConfig, color: 0xffff00 })\n    );\n    this.planeXY.position.set(0.25, 0.25, 0.0);\n    this.planeXY.userData.direction = ObjectDragDirection.PlaneXY;\n\n    this.add(this.planeYZ);\n    this.add(this.planeXZ);\n    this.add(this.planeXY);\n  }\n\n  getControlFromRaycaster(raycaster: Raycaster): Object3D | null {\n    if (!this.project.activeObject) {\n      return null;\n    }\n\n    this.position.copy(this.project.activeObject.position);\n\n    const intersections = raycaster.intersectObjects(this.children);\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o.userData.hasOwnProperty(\"direction\")) {\n        // Save the drag offset by subtracting the absolute position of the cursor\n        // (absolute meaning world coordinates) from the object's absolute position.\n        this.dragOffset\n          .copy(intersection.point)\n          .sub(this.project.activeObject.position);\n        this.lastPoint.copy(intersection.point);\n        return o;\n      }\n    }\n    return null;\n  }\n\n  // As we don't have access to the camera here and to avoid creating the ray caster\n  // twice, we just pass it from the initial mouse click handler and use it here.\n  // The original mouse event and screen coordinates are not required for the functionality\n  // of the controls, so they will not be taken as parameters here.\n  onClick(raycaster: Raycaster): boolean {\n    const o = this.getControlFromRaycaster(raycaster);\n    if (o && o.userData.hasOwnProperty(\"direction\")) {\n      this.objectDragDirection = o.userData.direction;\n      this.isScaling = !!o.userData.isScale;\n      this.onMove(raycaster);\n      return true;\n    }\n    return false;\n  }\n\n  // Initially, I used a Vector3(dx, dy, 0) here and applied the world rotation\n  // that can be calculated by the camera with camera.getWorldQuaternion(),\n  // followed by zeroing out the directions that should not be changed based on\n  // the plane or axis selected by the user.\n  // This resulted in a \"weird\" feeling though, as the zeroed axis gets completely lost,\n  // therefore making one of the two remaining axis movements feel slower than the other\n  // even if both are dragged equally on the screen.\n  //\n  // Similar to the Three.js transform controls example, this now uses a ray\n  // casted from the camera origin onto a plane that represents the axes to move\n  // on and sets the position of the object to the intersection point.\n  onMove({ ray }: Raycaster): void {\n    if (this.objectDragDirection === null || !this.project.activeObject) {\n      return;\n    }\n\n    const c = this.project.activeObject.position;\n    const p = this.plane;\n    let altPlane: Plane | null = null;\n\n    // Update the normal and constant (^= position) of the plane\n    // The second parameter of the Plane constructor is called the \"constant\" and\n    // is used for defining the plane in Hessian normal form. It defines\n    // the negative distance from the origin to the plane.\n    switch (this.objectDragDirection) {\n      case ObjectDragDirection.AxisX:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisY:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.AxisZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        altPlane = new Plane(new Vector3(0, 1, 0), -c.y);\n        break;\n      case ObjectDragDirection.PlaneXY:\n        p.set(new Vector3(0, 0, 1), -c.z);\n        break;\n      case ObjectDragDirection.PlaneYZ:\n        p.set(new Vector3(1, 0, 0), -c.x);\n        break;\n      case ObjectDragDirection.PlaneXZ:\n        p.set(new Vector3(0, 1, 0), -c.y);\n        break;\n    }\n\n    // If there is an alternative plane (i.e., for axes),\n    // check which one is farther away from the ray's origin.\n    // This is needed to prevent issues when the camera comes too close to the\n    // plane.\n    if (\n      altPlane &&\n      Math.abs(altPlane.distanceToPoint(ray.origin)) >\n        Math.abs(p.distanceToPoint(ray.origin))\n    ) {\n      p.copy(altPlane);\n    }\n\n    const point = ray.intersectPlane(p, new Vector3());\n    if (!point) {\n      // No intersection\n      return;\n    }\n\n    if (this.isScaling) {\n      // For scaling, we are using the relative movement instead of the position\n      // as no movement at all should leave the scale as is.\n      // I.e., we are adding the distance to the previously recorded intersection point\n      // to the object's scale.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.scale.x = Math.min(\n            Math.max(\n              this.project.activeObject.scale.x + (point.x - this.lastPoint.x),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.scale.y = Math.min(\n            Math.max(\n              this.project.activeObject.scale.y + (point.y - this.lastPoint.y),\n              0.1\n            ),\n            10\n          );\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.scale.z = Math.min(\n            Math.max(\n              this.project.activeObject.scale.z + (point.z - this.lastPoint.z),\n              0.1\n            ),\n            10\n          );\n          break;\n      }\n\n      this.project.events.onScale(this.project.activeObject.scale);\n    } else {\n      point.sub(this.dragOffset);\n\n      // If we are operating on an axis instead of a plane, ensure only the relevant\n      // coordinate is changed.\n      switch (this.objectDragDirection) {\n        case ObjectDragDirection.AxisX:\n          this.project.activeObject.position.x = point.x;\n          break;\n        case ObjectDragDirection.AxisY:\n          this.project.activeObject.position.y = point.y;\n          break;\n        case ObjectDragDirection.AxisZ:\n          this.project.activeObject.position.z = point.z;\n          break;\n        default:\n          // The selected direction is a plane, so we can just copy the\n          // intersection point.\n          this.project.activeObject.position.copy(point);\n      }\n\n      this.project.events.onTranslate(this.project.activeObject.position);\n    }\n\n    this.lastPoint.copy(point);\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { degToRad, radToDeg, roundToPrecision } from \"../utils/math\";\nimport { InteractionType } from \"../project/GameObject\";\nimport {\n  Group,\n  Input,\n  InputGroup,\n  CustomInput,\n  Select,\n  CodeEditor\n} from \"./styled\";\nimport { EditorObject } from \"./types\";\n\ninterface Props {\n  object: EditorObject;\n  onUpdateName(name: string): void;\n  onUpdatePosition(x: number, y: number, z: number): void;\n  onUpdateRotation(x: number, y: number, z: number): void;\n  onUpdateScale(x: number, y: number, z: number): void;\n  onUpdateInteractionType(interactionType: InteractionType): void;\n  onUpdateCodeBlockSource(source: string): void;\n  onShowAudioSelection(): void;\n}\n\ninterface State {\n  codeError?: string;\n}\n\n// UI component for editing properties specific to objects inside a room\nexport default class ObjectEditor extends React.Component<Props, State> {\n  codeCheckTimeout: number | null = null;\n  state: State = {};\n\n  checkCode = () => {\n    const { codeBlockSource } = this.props.object;\n    if (!codeBlockSource) {\n      return;\n    }\n\n    try {\n      // Try to parse the code block source\n      new Function(\"playerState\", \"roomState\", codeBlockSource);\n      this.setState({ codeError: undefined });\n    } catch (ex) {\n      this.setState({ codeError: ex.toString() });\n    }\n  };\n\n  updateCodeBlockSource: React.ChangeEventHandler<HTMLTextAreaElement> = e => {\n    this.props.onUpdateCodeBlockSource(e.currentTarget.value);\n    if (this.codeCheckTimeout != null) {\n      window.clearTimeout(this.codeCheckTimeout);\n    }\n    window.setTimeout(this.checkCode, 2000);\n  };\n\n  render(): React.ReactNode {\n    const {\n      object: o,\n      onUpdateName,\n      onUpdatePosition,\n      onUpdateRotation,\n      onUpdateScale,\n      onUpdateInteractionType,\n      onShowAudioSelection\n    } = this.props;\n    const { codeError } = this.state;\n\n    return (\n      <div>\n        <Group>\n          <label>Object Name</label>\n          <Input\n            type=\"text\"\n            value={o.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Position (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.x.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.y,\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.y.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01),\n                  o.position.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.01}\n              value={o.position.z.toFixed(2)}\n              onChange={e =>\n                onUpdatePosition(\n                  o.position.x,\n                  o.position.y,\n                  roundToPrecision(e.currentTarget.valueAsNumber, 0.01)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Euler-Rotation in Degrees (x, y, z)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.x).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.y,\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.y).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  degToRad(e.currentTarget.valueAsNumber % 360),\n                  o.rotation.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              value={radToDeg(o.rotation.z).toFixed(0)}\n              onChange={e =>\n                onUpdateRotation(\n                  o.rotation.x,\n                  o.rotation.y,\n                  degToRad(e.currentTarget.valueAsNumber % 360)\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Size (width, height, depth)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.x.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  e.currentTarget.valueAsNumber,\n                  o.scale.y,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.y.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  e.currentTarget.valueAsNumber,\n                  o.scale.z\n                )\n              }\n            />\n            <Input\n              type=\"number\"\n              step={0.1}\n              min={0.1}\n              max={10}\n              value={o.scale.z.toFixed(1)}\n              onChange={e =>\n                onUpdateScale(\n                  o.scale.x,\n                  o.scale.y,\n                  e.currentTarget.valueAsNumber\n                )\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Audio</label>\n          <CustomInput onClick={onShowAudioSelection}>\n            {o.audio\n              ? `${o.audio.name} (${Math.ceil(\n                  o.audio.data.byteLength / 1024\n                )} KiB)`\n              : \"None\"}\n          </CustomInput>\n        </Group>\n        <Group>\n          <label>Interaction</label>\n          <Select\n            value={o.interactionType}\n            onChange={e =>\n              onUpdateInteractionType(e.currentTarget.value as InteractionType)\n            }\n          >\n            {Object.values(InteractionType).map(t => (\n              <option key={t}>{t}</option>\n            ))}\n          </Select>\n          {o.interactionType === InteractionType.CodeBlock && (\n            <>\n              <CodeEditor\n                placeholder=\"// JavaScript\"\n                value={o.codeBlockSource}\n                onChange={this.updateCodeBlockSource}\n              />\n              <p>{codeError || \"No syntax errors detected\"}</p>\n            </>\n          )}\n        </Group>\n      </div>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport { Color, Mesh, Raycaster, Vector2, Vector3, WebGLRenderer } from \"three\";\nimport GamepadListener from \"../input/GamepadListener\";\nimport KeyboardListener from \"../input/KeyboardListener\";\nimport GameObject from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport VisualControls from \"./VisualControls\";\n\nenum MouseButton {\n  Primary = 0,\n  Middle = 1,\n  Secondary = 2\n}\n\nconst axes = {\n  x: new Vector3(1, 0, 0),\n  y: new Vector3(0, 1, 0),\n  z: new Vector3(0, 0, 1)\n};\n\nexport default class EditorCanvas {\n  target: HTMLElement | null = null;\n  project: Project;\n\n  rafHandle = 0;\n  previousTimestamp = 0;\n\n  controls: VisualControls;\n\n  renderer = new WebGLRenderer();\n  canvas: HTMLCanvasElement;\n  outlineMesh = new Mesh();\n\n  raycaster = new Raycaster();\n\n  keys = new KeyboardListener(this.renderer.domElement);\n  gamepads = new GamepadListener();\n  isDraggingCamera = false;\n\n  constructor(project: Project) {\n    this.project = project;\n\n    this.renderer.autoClear = false;\n    this.renderer.setClearColor(new Color(0x192a56));\n    this.canvas = this.renderer.domElement;\n    this.canvas.tabIndex = -1; // Make element focusable\n    this.canvas.addEventListener(\"mousedown\", this.onMouseDown);\n    this.canvas.addEventListener(\"mouseup\", this.onMouseUp);\n    this.canvas.addEventListener(\"mousemove\", this.onMouseMove);\n    this.canvas.addEventListener(\"wheel\", this.onWheel);\n    this.canvas.addEventListener(\n      \"contextmenu\",\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      },\n      true\n    );\n\n    // Setup scene\n\n    this.controls = new VisualControls(project);\n\n    // const ph = new PlaneHelper(this.controls.plane, 10, 0x999999);\n    // this.scene.add(ph);\n  }\n\n  attach(target: HTMLElement): void {\n    this.keys.listen();\n    this.gamepads.listen();\n\n    this.target = target;\n    target.appendChild(this.canvas);\n\n    this.resize();\n    window.requestAnimationFrame(this.animate);\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  detach(): void {\n    window.cancelAnimationFrame(this.rafHandle);\n    window.removeEventListener(\"resize\", this.resize);\n\n    if (this.target) {\n      this.target.removeChild(this.canvas);\n      this.target = null;\n    }\n\n    this.keys.stop();\n    this.gamepads.stop();\n  }\n\n  focus(): void {\n    this.canvas.focus();\n  }\n\n  changeProject(project: Project): void {\n    this.project = project;\n    this.controls.project = project;\n    // Ensure the selected project's camera has the correct aspect ratio\n    this.resize();\n  }\n\n  resize = (): void => {\n    if (!this.target) {\n      return;\n    }\n\n    const { offsetWidth, offsetHeight } = this.target;\n\n    this.project.camera.aspect = offsetWidth / offsetHeight;\n    this.project.camera.updateProjectionMatrix();\n\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(offsetWidth, offsetHeight);\n  };\n\n  animate: FrameRequestCallback = t => {\n    this.rafHandle = window.requestAnimationFrame(this.animate);\n\n    const dt = (t - this.previousTimestamp) / 1000;\n    this.previousTimestamp = t;\n    this.update(dt);\n\n    this.renderer.clear();\n    this.renderer.render(this.project.activeRoom, this.project.camera);\n\n    if (this.project.activeObject) {\n      // Draw controls in front of all other objects\n      // https://stackoverflow.com/questions/12666570/how-to-change-the-zorder-of-object-with-threejs/12666937#12666937\n      this.controls.position.copy(this.project.activeObject.position);\n      this.renderer.clearDepth();\n      this.renderer.render(this.controls, this.project.camera);\n    }\n  };\n\n  update(dt: number): void {\n    const { camera } = this.project;\n\n    if (this.keys.isPressed(\"w\")) {\n      camera.translateOnAxis(axes.z, -2 * dt);\n    }\n    if (this.keys.isPressed(\"s\")) {\n      camera.translateOnAxis(axes.z, 2 * dt);\n    }\n    if (this.keys.isPressed(\"a\")) {\n      camera.translateOnAxis(axes.x, -2 * dt);\n    }\n    if (this.keys.isPressed(\"d\")) {\n      camera.translateOnAxis(axes.x, 2 * dt);\n    }\n    if (this.keys.isPressed(\" \")) {\n      camera.position.y += 2 * dt;\n    }\n    if (this.keys.isPressed(\"Shift\")) {\n      camera.position.y -= 2 * dt;\n    }\n\n    if (this.keys.isPressed(\"ArrowLeft\")) {\n      camera.rotateOnWorldAxis(axes.y, dt);\n    }\n    if (this.keys.isPressed(\"ArrowRight\")) {\n      camera.rotateOnWorldAxis(axes.y, -dt);\n    }\n    if (this.keys.isPressed(\"ArrowUp\")) {\n      camera.rotateOnAxis(axes.x, dt);\n    }\n    if (this.keys.isPressed(\"ArrowDown\")) {\n      camera.rotateOnAxis(axes.x, -dt);\n    }\n\n    const gamepadAxes = {\n      x: this.gamepads.getAxis(0),\n      y: this.gamepads.getAxis(1),\n      rX: this.gamepads.getAxis(2),\n      rY: this.gamepads.getAxis(3),\n      b: this.gamepads.getAxis(4)\n    };\n    // console.log(axes);\n    if (gamepadAxes.x) {\n      camera.translateOnAxis(axes.x, 2 * dt * gamepadAxes.x);\n    }\n    if (gamepadAxes.y) {\n      camera.translateOnAxis(axes.z, 2 * dt * gamepadAxes.y);\n    }\n    if (gamepadAxes.b) {\n      camera.translateOnAxis(axes.y, 2 * dt * gamepadAxes.b);\n    }\n    if (gamepadAxes.rX) {\n      camera.rotateOnWorldAxis(axes.y, -dt * gamepadAxes.rX);\n    }\n    if (gamepadAxes.rY) {\n      camera.rotateOnAxis(axes.x, -dt * gamepadAxes.rY);\n    }\n  }\n\n  checkSceneClick(raycaster: Raycaster): boolean {\n    const intersections = raycaster.intersectObjects(\n      this.project.activeRoom.children\n    );\n    for (const intersection of intersections) {\n      const o = intersection.object;\n      if (o instanceof GameObject) {\n        this.project.selectObject(o);\n        return true;\n      }\n    }\n\n    this.project.selectObject(null);\n    return false;\n  }\n\n  updateRaycaster(e: MouseEvent): void {\n    const size = this.renderer.getSize(new Vector2());\n    // Normalize screen coordinates\n    const x = ((e.pageX - this.target!.offsetLeft) / size.x) * 2 - 1;\n    const y = -((e.pageY - this.target!.offsetTop) / size.y) * 2 + 1;\n    // Update raycaster\n    this.raycaster.setFromCamera({ x, y }, this.project.camera);\n  }\n\n  onMouseDown = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary) {\n      this.isDraggingCamera = true;\n      this.canvas.requestPointerLock();\n    }\n\n    if (e.button !== MouseButton.Primary) {\n      return;\n    }\n\n    this.updateRaycaster(e);\n    if (this.controls.onClick(this.raycaster)) {\n      this.canvas.style.cursor = \"grabbing\";\n    } else {\n      this.checkSceneClick(this.raycaster);\n    }\n  };\n\n  onMouseUp = (e: MouseEvent): void => {\n    if (e.button === MouseButton.Secondary && this.isDraggingCamera) {\n      this.isDraggingCamera = false;\n      document.exitPointerLock();\n    }\n    if (\n      e.button === MouseButton.Primary &&\n      this.controls.objectDragDirection !== null\n    ) {\n      this.controls.objectDragDirection = null;\n      if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onMouseMove = (e: MouseEvent): void => {\n    if (this.isDraggingCamera) {\n      if (e.movementX) {\n        this.project.camera.rotateOnWorldAxis(axes.y, -e.movementX / 100);\n      }\n      if (e.movementY) {\n        this.project.camera.rotateOnAxis(axes.x, -e.movementY / 100);\n      }\n    } else {\n      this.updateRaycaster(e);\n      if (this.controls.objectDragDirection !== null) {\n        this.controls.onMove(this.raycaster);\n      } else if (this.controls.getControlFromRaycaster(this.raycaster)) {\n        this.canvas.style.cursor = \"grab\";\n      } else {\n        this.canvas.style.cursor = null;\n      }\n    }\n  };\n\n  onWheel = (e: WheelEvent): void => {\n    e.preventDefault();\n    // console.log('onWheel', e.deltaX, e.deltaY, e.deltaZ, e.deltaMode);\n    let delta = e.deltaY;\n    if (e.deltaMode === 0) {\n      // More granular zoom for pixel mode\n      delta /= 15;\n    }\n    this.project.camera.translateZ(delta / 10);\n  };\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, ResonanceAudio, RoomMaterials } from \"resonance-audio\";\nimport { Group, Input, InputGroup, Select } from \"./styled\";\nimport { EditorRoom } from \"./types\";\n\nconst materials = Object.keys(ResonanceAudio.Utils.ROOM_MATERIAL_COEFFICIENTS);\n\ninterface Props {\n  room: EditorRoom;\n  onUpdateName(name: string): void;\n  onUpdateDimensions(dimensions: RoomDimensions): void;\n  onUpdateMaterials(materials: RoomMaterials): void;\n}\n\n// UI component for editing properties specific to a room itself\nexport default class RoomEditor extends React.Component<Props> {\n  selectMaterialHandler(\n    propertyName: keyof RoomMaterials\n  ): React.ChangeEventHandler<HTMLSelectElement> {\n    return e => {\n      const { room, onUpdateMaterials } = this.props;\n      onUpdateMaterials({\n        ...room.materials,\n        [propertyName]: e.currentTarget.value\n      });\n    };\n  }\n\n  render(): React.ReactNode {\n    const { room: r, onUpdateName, onUpdateDimensions } = this.props;\n\n    const materialOptions = materials.map(ce => <option key={ce}>{ce}</option>);\n\n    return (\n      <div>\n        <Group>\n          <label>Room Name</label>\n          <Input\n            type=\"text\"\n            value={r.name}\n            onChange={e => onUpdateName(e.currentTarget.value)}\n          />\n        </Group>\n        <Group>\n          <label>Dimensions (width, depth, height)</label>\n          <InputGroup>\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.width}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  width: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={5}\n              max={50}\n              value={r.dimensions.depth}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  depth: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n            <Input\n              type=\"number\"\n              step={1}\n              min={2}\n              max={10}\n              value={r.dimensions.height}\n              onChange={e =>\n                onUpdateDimensions({\n                  ...r.dimensions,\n                  height: Math.round(e.currentTarget.valueAsNumber)\n                })\n              }\n            />\n          </InputGroup>\n        </Group>\n        <Group>\n          <label>Left wall material</label>\n          <Select\n            value={r.materials.left}\n            onChange={this.selectMaterialHandler(\"left\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Right wall material</label>\n          <Select\n            value={r.materials.right}\n            onChange={this.selectMaterialHandler(\"right\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Front wall material</label>\n          <Select\n            value={r.materials.front}\n            onChange={this.selectMaterialHandler(\"front\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Back wall material</label>\n          <Select\n            value={r.materials.back}\n            onChange={this.selectMaterialHandler(\"back\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Floor material</label>\n          <Select\n            value={r.materials.down}\n            onChange={this.selectMaterialHandler(\"down\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n        <Group>\n          <label>Ceiling material</label>\n          <Select\n            value={r.materials.up}\n            onChange={this.selectMaterialHandler(\"up\")}\n          >\n            {materialOptions}\n          </Select>\n        </Group>\n      </div>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { ProjectData } from \"../data/schema\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\n\ninterface Props {\n  project: ProjectData;\n  onDelete(project: ProjectData): void;\n  onExport(project: ProjectData): void;\n  onDismiss(): void;\n  onCancel(): void;\n}\n\nexport default class ProjectInfoModal extends React.Component<Props> {\n  render(): React.ReactNode {\n    const { project } = this.props;\n    return (\n      <Modal title=\"Project Info\" onDismiss={this.props.onDismiss}>\n        <p>\n          <b>Name:</b> {project.name}\n        </p>\n        <p>\n          <b>Last update:</b> {project.savedAt.toLocaleString()}\n        </p>\n        <p>\n          <b>Rooms:</b> {project.rooms.length}\n        </p>\n        <ActionGroup>\n          <Action onClick={() => this.props.onDelete(project)}>Delete</Action>\n          <Action onClick={() => this.props.onExport(project)}>Export</Action>\n          <Action onClick={this.props.onCancel}>Back</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { ProjectData } from \"../data/schema\";\nimport { getAllProjects, deleteProject } from \"../data/db\";\nimport Project from \"../project/Project\";\nimport { saveAsZip } from \"../data/export\";\nimport Modal, { ActionGroup, Action } from \"./Modal\";\nimport ProjectInfoModal from \"./ProjectInfoModal\";\n\nconst TableContainer = styled.div`\n  border: 2px solid hsl(210, 29%, 20%);\n  border-radius: 3px;\n  max-height: 400px;\n  min-width: 500px;\n  overflow-y: auto;\n  padding-bottom: 5px;\n`;\n\nconst Table = styled.table`\n  width: 100%;\n`;\n\nconst TableHead = styled.thead`\n  text-align: left;\n`;\n\nconst TableRow = styled.tr`\n  cursor: pointer;\n\n  :hover {\n    background: hsl(210, 29%, 40%);\n  }\n`;\n\nconst ColumnHead = styled.th`\n  padding: 5px 10px;\n`;\n\nconst ColumnData = styled.td`\n  padding: 5px 10px;\n`;\n\ninterface Props {\n  onNewProject(): void;\n  onDismiss(): void;\n  onSelectProject?(data: ProjectData): void;\n}\n\ninterface State {\n  projects: ProjectData[];\n  selectedProject: ProjectData | null;\n}\n\nexport default class ProjectManagerModal extends React.Component<Props, State> {\n  state: State = { projects: [], selectedProject: null };\n\n  dismiss = () => {\n    this.setState({ selectedProject: null });\n    this.props.onDismiss();\n  };\n\n  selectProject(data: ProjectData): void {\n    if (this.props.onSelectProject) {\n      this.props.onSelectProject(data);\n    } else {\n      this.setState({ selectedProject: data });\n    }\n  }\n\n  unselectProject = () => {\n    this.setState({ selectedProject: null });\n  };\n\n  deleteProject = ({ id }: ProjectData) => {\n    if (!id) {\n      return;\n    }\n    deleteProject(id);\n    this.setState(({ projects }) => ({\n      projects: projects.filter(p => p.id !== id),\n      selectedProject: null\n    }));\n  };\n\n  exportProject = (data: ProjectData) => {\n    const project = new Project().fromData(data, data.id);\n    saveAsZip(project);\n  };\n\n  async componentDidMount(): Promise<void> {\n    const projects = await getAllProjects();\n    this.setState({ projects: projects.reverse() });\n  }\n\n  render(): React.ReactNode {\n    const { projects, selectedProject } = this.state;\n\n    if (selectedProject) {\n      return (\n        <ProjectInfoModal\n          project={selectedProject}\n          onDelete={this.deleteProject}\n          onExport={this.exportProject}\n          onCancel={this.unselectProject}\n          onDismiss={this.dismiss}\n        />\n      );\n    }\n\n    return (\n      <Modal\n        title={this.props.onSelectProject ? \"Load Project\" : \"Project Manager\"}\n        onDismiss={this.dismiss}\n      >\n        {projects.length > 0 && (\n          <TableContainer>\n            <Table>\n              <TableHead>\n                <tr>\n                  <ColumnHead>ID</ColumnHead>\n                  <ColumnHead>Name</ColumnHead>\n                  <ColumnHead>Rooms</ColumnHead>\n                  <ColumnHead>Last update</ColumnHead>\n                </tr>\n              </TableHead>\n              <tbody>\n                {projects.map(p => (\n                  <TableRow key={p.id} onClick={() => this.selectProject(p)}>\n                    <ColumnData>{p.id}</ColumnData>\n                    <ColumnData>{p.name}</ColumnData>\n                    <ColumnData>{p.rooms.length}</ColumnData>\n                    <ColumnData>{p.savedAt.toLocaleString()}</ColumnData>\n                  </TableRow>\n                ))}\n              </tbody>\n            </Table>\n          </TableContainer>\n        )}\n        {!projects.length && <p>You don't have any saved projects yet</p>}\n        <ActionGroup>\n          <Action onClick={this.props.onNewProject}>New project</Action>\n          <Action onClick={this.dismiss}>Cancel</Action>\n        </ActionGroup>\n      </Modal>\n    );\n  }\n}\n","/**\n * @author Niklas Korz\n */\nimport React from \"react\";\nimport { RoomDimensions, RoomMaterials } from \"resonance-audio\";\nimport { Euler, Vector3 } from \"three\";\nimport { saveAsZip } from \"../data/export\";\nimport { openZip } from \"../data/import\";\nimport GameObject, { InteractionType } from \"../project/GameObject\";\nimport Project from \"../project/Project\";\nimport { ProjectData } from \"../data/schema\";\nimport AudioImplementation from \"../audio/AudioImplementation\";\nimport RuntimeContainer from \"../runtime/RuntimeContainer\";\nimport CodeBlock from \"../project/CodeBlock\";\nimport AudioLibraryModal from \"./AudioLibraryModal\";\nimport MenuBar from \"./MenuBar\";\nimport ObjectEditor from \"./ObjectEditor\";\nimport EditorCanvas from \"./EditorCanvas\";\nimport RoomEditor from \"./RoomEditor\";\nimport {\n  Container,\n  FocusedLabel,\n  Group,\n  InnerContainer,\n  Main,\n  RoomList,\n  RoomListItem,\n  Sidebar\n} from \"./styled\";\nimport { EditorObject, EditorRoom, AudioEntry } from \"./types\";\nimport ProjectManagerModal from \"./ProjectManagerModal\";\n\nenum ModalType {\n  AudioLibrary,\n  AudioSelection,\n  ProjectManager,\n  ProjectSelection\n}\n\ninterface State {\n  audioImplementation: AudioImplementation;\n  rooms: EditorRoom[];\n  selectedRoomId: number;\n  selectedObject: EditorObject | null;\n  modal: ModalType | null;\n  isRunning: boolean;\n}\n\nexport default class Editor extends React.Component<{}, State> {\n  project: Project = new Project();\n  projectCanvas = new EditorCanvas(this.project);\n\n  state: State = {\n    audioImplementation: this.project.activeAudioImplementation,\n    rooms: this.project.rooms.map(r => ({\n      id: r.id,\n      name: r.name,\n      dimensions: r.dimensions,\n      materials: r.materials\n    })),\n    selectedRoomId: 0,\n    selectedObject: null,\n    modal: null,\n    isRunning: false\n  };\n  mainRef = React.createRef<HTMLElement>();\n\n  constructor(props: {}) {\n    super(props);\n\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n  }\n\n  // Menubar functionality\n\n  newProject = () => {\n    this.project.close();\n    this.project = new Project({\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    });\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      audioImplementation: this.project.activeAudioImplementation,\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null,\n      modal: null\n    });\n  };\n\n  showProjectSelection = async () => {\n    this.setState({\n      modal: ModalType.ProjectSelection\n    });\n  };\n\n  saveProject = async () => {\n    if (this.project.id == null) {\n      const name = prompt(\"Project name:\", this.project.name);\n      if (!name) {\n        return;\n      }\n      this.project.name = name;\n    }\n    await this.project.save();\n  };\n\n  importProject = async () => {\n    this.project.close();\n    this.project = await openZip();\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      audioImplementation: this.project.activeAudioImplementation,\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null\n    });\n  };\n\n  exportProject = () => {\n    saveAsZip(this.project);\n  };\n\n  addObject = () => {\n    this.project.activeRoom.addObject();\n  };\n\n  deleteObject = () => {\n    if (this.project.activeObject) {\n      this.project.activeRoom.remove(this.project.activeObject);\n      this.project.activeObject.audio.stop();\n      this.project.activeObject = null;\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  addRoom = () => {\n    const room = this.project.addRoom();\n    this.setState(s => ({\n      rooms: [\n        ...s.rooms,\n        {\n          id: room.id,\n          name: room.name,\n          dimensions: room.dimensions,\n          materials: room.materials\n        }\n      ],\n      selectedRoomId: s.rooms.length\n    }));\n  };\n\n  deleteRoom = () => {\n    // Ensure the first room cannot be deleted\n    if (this.state.selectedRoomId > 0) {\n      this.project.rooms.splice(this.state.selectedRoomId, 1);\n      this.setState(s => ({\n        rooms: [\n          ...s.rooms.slice(0, s.selectedRoomId),\n          ...s.rooms.slice(s.selectedRoomId + 1)\n        ],\n        selectedRoomId: 0\n      }));\n    }\n  };\n\n  showAudioLibrary = () => {\n    this.setState({ modal: ModalType.AudioLibrary });\n  };\n\n  showProjectManager = () => {\n    this.setState({ modal: ModalType.ProjectManager });\n  };\n\n  selectAudioImplementation = (audioImplementation: AudioImplementation) => {\n    this.project.selectAudioImplementation(audioImplementation);\n    this.setState({ audioImplementation });\n  };\n\n  runProject = () => {\n    this.projectCanvas.detach();\n    this.setState({ isRunning: true });\n  };\n\n  // Room specific editor functionality\n\n  selectRoom(id: number): void {\n    this.project.selectRoom(this.project.rooms[id]);\n    this.setState({ selectedRoomId: id, selectedObject: null });\n  }\n\n  updateRoomName = (name: string) => {\n    this.project.activeRoom.name = name;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          name\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomDimensions = (dimensions: RoomDimensions) => {\n    this.project.activeRoom.dimensions = dimensions;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          dimensions\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  updateRoomMaterials = (materials: RoomMaterials) => {\n    this.project.activeRoom.materials = materials;\n    this.setState(({ rooms, selectedRoomId }) => ({\n      rooms: [\n        ...rooms.slice(0, selectedRoomId),\n        {\n          ...rooms[selectedRoomId],\n          materials\n        },\n        ...rooms.slice(selectedRoomId + 1)\n      ]\n    }));\n  };\n\n  // Object editor functionality\n\n  updateName = (name: string) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.name = name;\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        name\n      }\n    }));\n  };\n\n  updateScale = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.scale.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        scale: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updatePosition = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.position.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: new Vector3(x, y, z)\n      }\n    }));\n  };\n\n  updateRotation = (x: number, y: number, z: number) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.rotation.set(x, y, z);\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        rotation: new Euler(x, y, z)\n      }\n    }));\n  };\n\n  updateInteractionType = (interactionType: InteractionType) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.interactionType = interactionType;\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        interactionType\n      }\n    }));\n  };\n\n  updateCodeBlockSource = (codeBlockSource: string) => {\n    if (this.project.activeObject) {\n      if (this.project.activeObject.codeBlock) {\n        this.project.activeObject.codeBlock.update(codeBlockSource);\n      } else {\n        this.project.activeObject.codeBlock = new CodeBlock(codeBlockSource);\n      }\n    }\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        codeBlockSource\n      }\n    }));\n  };\n\n  showAudioSelection = () => {\n    this.setState({\n      modal: ModalType.AudioSelection\n    });\n  };\n\n  // Modal events\n\n  dismissModal = () => {\n    this.setState({ modal: null });\n  };\n\n  selectAudio = (audio: AudioEntry) => {\n    if (this.project.activeObject) {\n      this.project.activeObject.loadAudio(audio.id);\n      this.setState(({ selectedObject }) => ({\n        selectedObject: selectedObject && {\n          ...selectedObject,\n          audio\n        },\n        modal: null\n      }));\n    }\n  };\n\n  loadProject = (data: ProjectData) => {\n    this.project.close();\n    this.project = new Project().fromData(data, data.id);\n    this.project.events = {\n      onSelect: this.onSelectObject,\n      onTranslate: this.onTranslateObject,\n      onScale: this.onScaleObject\n    };\n    this.projectCanvas.changeProject(this.project);\n    this.setState({\n      audioImplementation: this.project.activeAudioImplementation,\n      rooms: this.project.rooms.map(r => ({\n        id: r.id,\n        name: r.name,\n        dimensions: r.dimensions,\n        materials: r.materials\n      })),\n      selectedRoomId: 0,\n      selectedObject: null,\n      modal: null\n    });\n  };\n\n  // Project canvas events\n\n  onSelectObject = (o: GameObject | null) => {\n    if (o) {\n      this.setState({\n        selectedObject: {\n          id: o.id,\n          name: o.name,\n          position: o.position,\n          scale: o.scale,\n          rotation: o.rotation,\n          interactionType: o.interactionType,\n          codeBlockSource: o.codeBlock && o.codeBlock.source,\n          audio: o.audioFile && {\n            ...o.audioFile,\n            id: o.audioId!\n          }\n        }\n      });\n    } else {\n      this.setState({ selectedObject: null });\n    }\n  };\n\n  onTranslateObject = (p: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        position: p\n      }\n    }));\n  };\n\n  onScaleObject = (s: Vector3) => {\n    this.setState(({ selectedObject }) => ({\n      selectedObject: selectedObject && {\n        ...selectedObject,\n        size: {\n          width: s.x,\n          height: s.y,\n          depth: s.z\n        }\n      }\n    }));\n  };\n\n  // Runtime events\n\n  exitRuntime = () => {\n    this.setState({\n      isRunning: false,\n      audioImplementation: this.project.activeAudioImplementation\n    });\n  };\n\n  // React component lifecycle methods\n\n  attachCanvas = (target: HTMLElement | null) => {\n    if (target != null) {\n      this.projectCanvas.attach(target);\n      this.projectCanvas.focus();\n    } else {\n      this.projectCanvas.detach();\n    }\n  };\n\n  componentWillUnmount(): void {\n    this.projectCanvas.detach();\n  }\n\n  render(): React.ReactNode {\n    const { modal, isRunning, audioImplementation } = this.state;\n    const o = this.state.selectedObject;\n\n    if (isRunning) {\n      return (\n        <RuntimeContainer project={this.project} onExit={this.exitRuntime} />\n      );\n    }\n\n    return (\n      <Container>\n        {(modal === ModalType.AudioLibrary ||\n          modal === ModalType.AudioSelection) && (\n          <AudioLibraryModal\n            audioLibrary={this.project.audioLibrary}\n            onDismiss={this.dismissModal}\n            onSelect={\n              modal === ModalType.AudioSelection ? this.selectAudio : undefined\n            }\n          />\n        )}\n        {(modal === ModalType.ProjectManager ||\n          modal === ModalType.ProjectSelection) && (\n          <ProjectManagerModal\n            onNewProject={this.newProject}\n            onDismiss={this.dismissModal}\n            onSelectProject={\n              modal === ModalType.ProjectSelection\n                ? this.loadProject\n                : undefined\n            }\n          />\n        )}\n        <MenuBar\n          audioImplementation={audioImplementation}\n          onAudioChange={this.selectAudioImplementation}\n          onNewProject={this.newProject}\n          onLoadProject={this.showProjectSelection}\n          onSaveProject={this.saveProject}\n          onImportProject={this.importProject}\n          onExportProject={this.exportProject}\n          onAddObject={this.addObject}\n          onDeleteObject={this.deleteObject}\n          onAddRoom={this.addRoom}\n          onDeleteRoom={this.deleteRoom}\n          onShowAudioLibrary={this.showAudioLibrary}\n          onShowProjectManager={this.showProjectManager}\n          onRunProject={this.runProject}\n        />\n        <InnerContainer>\n          <Sidebar>\n            <Group>\n              <label>Rooms</label>\n              <RoomList>\n                {this.state.rooms.map((r, i) => (\n                  <RoomListItem\n                    key={r.id}\n                    onClick={() => this.selectRoom(i)}\n                    active={i === this.state.selectedRoomId}\n                  >\n                    {r.name || \"Anonymous Room\"}\n                  </RoomListItem>\n                ))}\n              </RoomList>\n            </Group>\n            {!o && (\n              <RoomEditor\n                room={this.state.rooms[this.state.selectedRoomId]}\n                onUpdateName={this.updateRoomName}\n                onUpdateDimensions={this.updateRoomDimensions}\n                onUpdateMaterials={this.updateRoomMaterials}\n              />\n            )}\n            {o && (\n              <ObjectEditor\n                object={o}\n                onUpdateName={this.updateName}\n                onUpdatePosition={this.updatePosition}\n                onUpdateRotation={this.updateRotation}\n                onUpdateScale={this.updateScale}\n                onUpdateInteractionType={this.updateInteractionType}\n                onUpdateCodeBlockSource={this.updateCodeBlockSource}\n                onShowAudioSelection={this.showAudioSelection}\n              />\n            )}\n          </Sidebar>\n          <Main ref={this.attachCanvas}>\n            <FocusedLabel>Focused</FocusedLabel>\n          </Main>\n        </InnerContainer>\n      </Container>\n    );\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See http://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit http://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nexport function unregister(): void {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import \"normalize.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Editor from \"./editor/Editor\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nconst global = window as any;\n// Safari does not yet support the Web Audio API without a prefix\nif (!global.AudioContext && global.webkitAudioContext) {\n  global.AudioContext = global.webkitAudioContext;\n}\n\nif (process.env.NODE_ENV === \"production\") {\n  // If we are running in the production environment, make sure the user\n  // does not close the editor unintentionally.\n  window.addEventListener(\n    \"beforeunload\",\n    () =>\n      \"Do you really want to close the editor? You might have unsaved changes.\"\n  );\n}\n\nReactDOM.render(<Editor />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}